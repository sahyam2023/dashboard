import{B as K,b9 as O,r as t,ba as U,j as e,f as H,bb as $,bc as G,a9 as T,aa as E,s as P,d as B,bd as Y}from"./index-CZ-6_XbN.js";import{D as J,M as Q}from"./Modal-BWOI6av5.js";import{C as W}from"./ConfirmationModal-CfvYQ9DY.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=K("Tags",[["path",{d:"m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19",key:"1cbfv1"}],["path",{d:"M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 0 3.42 0l3.58-3.58a2.426 2.426 0 0 0 0-3.42z",key:"135mg7"}],["circle",{cx:"6.5",cy:"9.5",r:".5",fill:"currentColor",key:"5pm5xn"}]]);function X(s){return O({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"},child:[]}]})(s)}function Z(s){return O({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"},child:[]}]})(s)}const D=({onEdit:s,onDelete:i,refreshKey:b,softwareIdFilter:d})=>{const[v,x]=t.useState([]),[S,h]=t.useState(!1),[j,y]=t.useState(null),[u,g]=t.useState(1),[m,_]=t.useState(10),[p,L]=t.useState(0),[A,C]=t.useState(0),[w,l]=t.useState("version_number"),[k,N]=t.useState("asc"),f=t.useCallback(async()=>{h(!0),y(null);try{const r={page:u,perPage:m,sortBy:w,sortOrder:k};d!=null&&(r.softwareId=d);const n=await U(r);x(n.versions),L(n.total_pages),C(n.total_versions),g(n.page)}catch(r){console.error("Error loading versions:",r),y(r instanceof Error?r.message:"Failed to load versions. Please try again.")}finally{h(!1)}},[u,m,w,k,d]);t.useEffect(()=>{f()},[f,b]);const F=r=>{g(r)},V=r=>{w===r?N(k==="asc"?"desc":"asc"):(l(r),N("asc")),g(1)},a=r=>{if(!r)return"N/A";const n=new Date(r);return isNaN(n.getTime())?"Invalid Date":n.toLocaleDateString()},c=(r,n=50)=>r?r.length<=n?r:r.substring(0,n)+"...":"N/A",o=[{key:"software_name",header:"Software",accessor:"software_name",sortable:!0},{key:"version_number",header:"Version",accessor:"version_number",sortable:!0},{key:"release_date",header:"Release Date",accessor:"release_date",sortable:!0,render:r=>a(r.release_date)},{key:"main_download_link",header:"Download Link",accessor:"main_download_link",sortable:!1,render:r=>r.main_download_link?e.jsx("a",{href:r.main_download_link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 underline",children:"Link"}):"N/A"},{key:"changelog",header:"Changelog",accessor:"changelog",sortable:!1,render:r=>c(r.changelog)},{key:"known_bugs",header:"Known Bugs",accessor:"known_bugs",sortable:!1,render:r=>c(r.known_bugs)},{key:"created_at",header:"Created At",accessor:"created_at",sortable:!0,render:r=>a(r.created_at)},{key:"updated_at",header:"Updated At",accessor:"updated_at",sortable:!0,render:r=>a(r.updated_at)},{key:"actions",header:"Actions",accessor:"actions",render:r=>e.jsxs("div",{className:"flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("button",{onClick:()=>s(r),className:"p-1 text-blue-600 hover:text-blue-800","aria-label":"Edit Version",children:e.jsx(X,{})}),e.jsx("button",{onClick:()=>i(r.id),className:"p-1 text-red-600 hover:text-red-800","aria-label":"Delete Version",children:e.jsx(Z,{})})]})}];return j?e.jsxs("div",{className:"text-red-500 p-4",children:["Error: ",j]}):e.jsx("div",{className:"container mx-auto p-4",children:e.jsx(J,{columns:o,data:v,rowClassName:"group",isLoading:S,pagination:{currentPage:u,totalPages:p,totalItems:A,itemsPerPage:m,onPageChange:F,onItemsPerPageChange:r=>{_(r),g(1)}},sortColumn:w,sortOrder:k,onSort:V})})},z=()=>{const s=new Date,i=s.getFullYear(),b=String(s.getMonth()+1).padStart(2,"0"),d=String(s.getDate()).padStart(2,"0");return`${i}-${b}-${d}`},ee=({initialData:s,onSubmitSuccess:i,onCancel:b})=>{var c;const[d,v]=t.useState((s==null?void 0:s.software_id)||""),[x,S]=t.useState((s==null?void 0:s.version_number)||""),[h,j]=t.useState(((c=s==null?void 0:s.release_date)==null?void 0:c.substring(0,10))||z()),[y,u]=t.useState((s==null?void 0:s.main_download_link)||""),[g,m]=t.useState((s==null?void 0:s.changelog)||""),[_,p]=t.useState((s==null?void 0:s.known_bugs)||""),[L,A]=t.useState([]),[C,w]=t.useState(!1),[l,k]=t.useState(!1),[N,f]=t.useState(null),[F,V]=t.useState(null);t.useEffect(()=>{(async()=>{w(!0);try{const r=await H();A(r)}catch(r){console.error("Error fetching software list:",r),f("Failed to load software list.")}finally{w(!1)}})()},[]),t.useEffect(()=>{var o;s?(v(s.software_id||""),S(s.version_number||""),j(((o=s.release_date)==null?void 0:o.substring(0,10))||""),u(s.main_download_link||""),m(s.changelog||""),p(s.known_bugs||"")):(v(""),S(""),j(z()),u(""),m(""),p(""))},[s]);const a=async o=>{var n,I;if(o.preventDefault(),f(null),V(null),!d){f("Software is required.");return}if(!x.trim()){f("Version number is required.");return}k(!0);const r={software_id:Number(d),version_number:x.trim(),release_date:h||null,main_download_link:y.trim()||null,changelog:g.trim()||null,known_bugs:_.trim()||null};try{s?(await $(s.id,r),V("Version updated successfully!")):(await G(r),V("Version added successfully!")),i&&setTimeout(()=>{i()},1e3)}catch(M){console.error("Error submitting version form:",M);const q=((I=(n=M.response)==null?void 0:n.data)==null?void 0:I.msg)||M.message||(s?"Failed to update version.":"Failed to add version.");f(q)}finally{k(!1)}};return e.jsxs("form",{onSubmit:a,className:"space-y-6 p-4 bg-white dark:bg-gray-800 dark:border dark:border-gray-700 shadow-md rounded-lg",children:[N&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 dark:bg-red-900 dark:border-red-700 dark:text-red-300 px-4 py-3 rounded relative",role:"alert",children:N}),F&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 dark:bg-green-900 dark:border-green-700 dark:text-green-300 px-4 py-3 rounded relative",role:"alert",children:F}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"softwareId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:["Software ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"softwareId",value:d,onChange:o=>v(Number(o.target.value)),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 dark:border-gray-600",disabled:C||l,required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select Software"}),L.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]}),C&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading software..."})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"versionNumber",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:["Version Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"versionNumber",value:x,onChange:o=>S(o.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400",disabled:l,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"releaseDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Release Date"}),e.jsx("input",{type:"date",id:"releaseDate",value:h,onChange:o=>j(o.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 dark:border-gray-600",disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mainDownloadLink",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Main Download Link"}),e.jsx("input",{type:"url",id:"mainDownloadLink",value:y,onChange:o=>u(o.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400",placeholder:"https://example.com/download",disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"changelog",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Changelog"}),e.jsx("textarea",{id:"changelog",value:g,onChange:o=>m(o.target.value),rows:4,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400",disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"knownBugs",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Known Bugs"}),e.jsx("textarea",{id:"knownBugs",value:_,onChange:o=>p(o.target.value),rows:4,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400",disabled:l})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:b,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-500 dark:hover:bg-gray-600",disabled:l,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",disabled:l||C,children:l?s?"Updating...":"Adding...":s?"Update Version":"Add Version"})]})]})},oe=()=>{const[s,i]=t.useState(!1),[b,d]=t.useState(null),[v,x]=t.useState(!1),[S,h]=t.useState(null),[j,y]=t.useState(0),[u,g]=t.useState([]),[m,_]=t.useState(!0),[p,L]=t.useState(null),[A,C]=t.useState(null);t.useEffect(()=>{(async()=>{var c,o;_(!0),L(null);try{const r=await H();g(r)}catch(r){console.error("Failed to load software list for filtering:",r);const n=((o=(c=r.response)==null?void 0:c.data)==null?void 0:o.msg)||"Failed to load software list for filtering.";P(n),L(n),g([])}finally{_(!1)}})()},[]);const w=()=>{d(null),i(!0)},l=a=>{d(a),i(!0)},k=()=>{i(!1),d(null),y(a=>a+1),B(b?"Version updated successfully!":"Version added successfully!")},N=()=>{i(!1),d(null)},f=a=>{h(a),x(!0)},F=async()=>{var a,c;if(S!==null)try{await Y(S),B("Version deleted successfully!"),y(o=>o+1)}catch(o){const r=((c=(a=o.response)==null?void 0:a.data)==null?void 0:c.msg)||o.message||"Failed to delete version.";P(r),console.error("Error deleting version:",o)}finally{x(!1),h(null)}},V=()=>{x(!1),h(null)};return e.jsxs("div",{className:"container mx-auto p-6 bg-gray-50 dark:bg-gray-900 min-h-screen",children:[e.jsx("h1",{className:"text-3xl font-semibold text-gray-800 dark:text-gray-100 mb-8",children:"Manage Software Versions"}),e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsx("div",{}),e.jsxs("div",{className:"flex items-center space-x-4",children:[" ",!m&&!p&&u.length>0&&e.jsxs("div",{className:"min-w-[200px]",children:[" ",e.jsx("label",{htmlFor:"softwareFilter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Filter by Software:"}),e.jsxs("select",{id:"softwareFilter",value:A||"",onChange:a=>{C(a.target.value?Number(a.target.value):null),y(c=>c+1)},className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 dark:border-gray-600",children:[e.jsx("option",{value:"",children:"All Software"}),u.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsx("button",{onClick:w,className:"px-6 py-2 text-white bg-indigo-600 hover:bg-indigo-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:"Add New Version"})]})]}),m?e.jsx(T,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:3,mt:2,backgroundColor:"background.paper",borderRadius:1,boxShadow:1},children:e.jsx(E,{color:"text.secondary",children:"Loading software list for filtering..."})}):p?e.jsxs(T,{sx:{textAlign:"center",mt:4,p:3,border:"1px dashed",borderColor:"error.main",borderRadius:1},children:[e.jsx(R,{size:60,className:"text-red-500 mb-4 mx-auto"}),e.jsx(E,{variant:"h6",color:"error.main",sx:{mb:1},children:"Could not load software list."}),e.jsxs(E,{variant:"body2",color:"text.secondary",children:[p," Please try refreshing the page or contact support."]})]}):u.length===0?e.jsxs(T,{sx:{textAlign:"center",mt:4,p:3,border:"1px dashed",borderColor:"divider",borderRadius:1},children:[e.jsx(R,{size:60,className:"text-gray-400 dark:text-gray-500 mb-4 mx-auto"}),e.jsx(E,{variant:"h6",color:"text.secondary",sx:{mb:1},children:"No software found."}),e.jsx(E,{variant:"body2",color:"text.secondary",children:"Add software first to manage their versions."})]}):e.jsx(D,{onEdit:l,onDelete:f,refreshKey:j,softwareIdFilter:A}),s&&e.jsx(Q,{isOpen:s,onClose:N,title:b?"Edit Software Version":"Add New Software Version",children:e.jsx(ee,{initialData:b,onSubmitSuccess:k,onCancel:N})}),v&&e.jsx(W,{isOpen:v,title:"Confirm Deletion",message:"Are you sure you want to delete this version? This action cannot be undone. Associated items (patches, links) might prevent deletion if they reference this version.",onConfirm:F,onCancel:V,confirmButtonText:"Delete",confirmButtonVariant:"danger"})]})};export{oe as default};
