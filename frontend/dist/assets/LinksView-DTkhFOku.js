import{A as yt,r as s,u as Ye,f as Je,Q as ge,q as _e,j as e,L as Ke,F as We,X as kt,B as vt,C as wt,D as St,E as jt,g as Nt,G as Lt,s as p,i as It,d as B,k as _t,S as Ft,H as Ct,m as Vt,n as Mt,o as At,p as Dt}from"./index-BnshCDTl.js";import{u as Ut,U as Pt,o as zt,c as Rt,a as X,b as $t,P as Et,T as He,D as Ie,M as Ot,F as Bt,C as qt,e as Tt,d as Wt}from"./CommentSection-D2XcrUWX.js";import{C as Ht,D as Gt,M as Xt}from"./Modal-DEwoVWFf.js";import{F as Yt}from"./FilterTabs-D7I3gsQB.js";import{E as Jt}from"./ErrorState-BIYAupsr.js";import{C as Ge}from"./ConfirmationModal-OAjODolL.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=yt("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),Y="CREATE_NEW_VERSION_SENTINEL_VALUE",Kt=Rt().shape({selectedSoftwareId:X().required("Software Product must be selected."),title:X().required("Link Title is required.").max(255,"Title cannot exceed 255 characters."),selectedVersionId:X().required("Version must be selected or a new one entered."),typedVersionString:X().when("selectedVersionId",{is:Y,then:r=>r.required('New Version String is required when "Enter New Version" is selected.').min(1,"New Version String cannot be empty."),otherwise:r=>r.transform(v=>v===""?void 0:v).optional().nullable()}),inputMode:X().oneOf(["url","upload"]).required("Input mode must be selected."),externalUrl:X().when("inputMode",{is:"url",then:r=>r.required("External URL is required for URL mode.").url("Please enter a valid URL (e.g., http://example.com)."),otherwise:r=>r.optional().nullable()}),selectedFile:$t().when(["inputMode","isEditMode","existingFileName"],{is:(r,v,m)=>r==="upload"&&(!v||!m),then:r=>r.required("A file is required for new link uploads.").test("filePresent","A file is required for new link uploads.",v=>!!v),otherwise:r=>r.nullable()}),description:X().optional().max(1e3,"Description cannot exceed 1000 characters.")}),Zt=({linkToEdit:r,onLinkAdded:v,onLinkUpdated:m,onCancelEdit:z})=>{const o=!!r,{register:u,handleSubmit:re,control:J,formState:{errors:d},watch:R,setValue:g,reset:b}=Ut({resolver:zt(Kt),context:{isEditMode:o,existingFileName:(r==null?void 0:r.original_filename_ref)||(r&&!r.is_external_link?r.url.split("/").pop():null)},defaultValues:{selectedSoftwareId:"",title:"",selectedVersionId:"",typedVersionString:"",inputMode:"url",externalUrl:"",selectedFile:null,description:""}}),[K,M]=s.useState([]),[A,I]=s.useState([]),[q,_]=s.useState(null),[y,C]=s.useState(!1),[$,T]=s.useState(!1),{isAuthenticated:F,user:W}=Ye(),H=W==null?void 0:W.role,D=s.useRef(null),S=R("selectedSoftwareId"),ye=R("selectedVersionId"),ae=R("inputMode"),k=R("selectedFile"),le=ye===Y;s.useEffect(()=>{F&&(H==="admin"||H==="super_admin")&&(T(!0),Je().then(M).catch(()=>ge.error("Failed to load software list.")).finally(()=>T(!1)))},[F,H]),s.useEffect(()=>{S?(T(!0),I([]),g("selectedVersionId",""),g("typedVersionString",""),_e(parseInt(S)).then(I).catch(()=>ge.error("Failed to load versions for selected software.")).finally(()=>T(!1))):(I([]),g("selectedVersionId",""),g("typedVersionString",""))},[S,g]),s.useEffect(()=>{if(o&&r){const a={selectedSoftwareId:r.software_id.toString(),title:r.title,description:r.description||"",inputMode:r.is_external_link?"url":"upload",externalUrl:r.is_external_link?r.url:""};r.version_id&&r.software_id.toString()===S&&A.length>0?A.find(N=>N.id===r.version_id)?(a.selectedVersionId=r.version_id.toString(),a.typedVersionString=r.version_number):(a.selectedVersionId=Y,a.typedVersionString=r.version_number):r.version_number&&(a.selectedVersionId=Y,a.typedVersionString=r.version_number),b(a),r.is_external_link?_(null):_(r.original_filename_ref||r.url.split("/").pop()||"unknown_file"),g("selectedFile",null),D.current&&(D.current.value="")}else o||E(!!S)},[o,r,b,g,A,S]);const E=(a=!1)=>{const j=a?R("selectedSoftwareId"):"";b({selectedSoftwareId:j,title:"",selectedVersionId:"",typedVersionString:"",inputMode:"url",externalUrl:"",selectedFile:null,description:""}),_(null),D.current&&(D.current.value="")},ke=a=>{a.target.files&&a.target.files[0]?g("selectedFile",a.target.files[0],{shouldValidate:!0,shouldDirty:!0}):g("selectedFile",null,{shouldValidate:!0,shouldDirty:!0})},Z=()=>{g("selectedFile",null,{shouldValidate:!0,shouldDirty:!0}),D.current&&(D.current.value="")},ne=async a=>{var G,oe,de,U;C(!0);let j,N;a.selectedVersionId===Y&&a.typedVersionString?N=a.typedVersionString.trim():a.selectedVersionId&&a.selectedVersionId!==Y&&(j=parseInt(a.selectedVersionId));const Q={software_id:parseInt(a.selectedSoftwareId),title:a.title.trim(),description:((G=a.description)==null?void 0:G.trim())||void 0};j&&(Q.version_id=j),N&&(Q.typed_version_string=N);try{let w;if(a.inputMode==="url"){const f={...Q,url:a.externalUrl.trim(),is_external_link:!0};o&&r?w=await vt(r.id,f):w=await wt(f)}else{const f=new FormData;f.append("software_id",a.selectedSoftwareId),j&&f.append("version_id",j.toString()),N&&f.append("typed_version_string",N),f.append("title",a.title.trim()),(oe=a.description)!=null&&oe.trim()&&f.append("description",a.description.trim()),a.selectedFile&&f.append("file",a.selectedFile),o&&r?w=await St(r.id,f):w=await jt(f)}ge.success(`Link "${w.title}" ${o?"updated":"added"} successfully!`),o||(E(!0),g("selectedVersionId",""),g("typedVersionString","")),o&&m&&m(w),!o&&v&&v(w)}catch(w){const f=((U=(de=w.response)==null?void 0:de.data)==null?void 0:U.msg)||w.message||`Failed to ${o?"update":"add"} link.`;ge.error(f)}finally{C(!1)}},ie=a=>{console.error("Form validation errors:",a),ge.error("Please correct the errors highlighted in the form.")};return!F||!H||!["admin","super_admin"].includes(H)?null:e.jsxs("form",{onSubmit:re(ne,ie),className:"space-y-6 bg-white dark:bg-gray-800 dark:border-gray-700 p-6 rounded-lg shadow-md border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:[" ",o?"Edit Link":"Add New Link"," "]}),o&&z&&e.jsx("button",{type:"button",onClick:z,className:"text-sm text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",children:" Cancel "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectedSoftwareId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Software Product*"}),$&&!K.length?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading software..."}):e.jsxs("select",{id:"selectedSoftwareId",...u("selectedSoftwareId"),disabled:y||$&&!K.length,className:`mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md ${d.selectedSoftwareId?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`,children:[e.jsx("option",{value:"",disabled:!0,children:"Select Software Product"}),K.map(a=>e.jsx("option",{value:a.id.toString(),children:a.name},a.id))]}),d.selectedSoftwareId&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.selectedSoftwareId.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectedVersionId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Version*"}),e.jsx("div",{className:"mt-1",children:e.jsxs("select",{id:"selectedVersionId",...u("selectedVersionId"),disabled:y||$||!S,className:`block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md ${d.selectedVersionId?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`,children:[e.jsx("option",{value:"",disabled:A.length>0&&!!S,children:$&&S?"Loading versions...":"Select Existing Version"}),A.map(a=>e.jsx("option",{value:a.id.toString(),children:a.version_number},a.id)),e.jsx("option",{value:Y,children:"Enter New Version String..."})]})}),le&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"typedVersionString",className:"block text-xs font-medium text-gray-600 dark:text-gray-400",children:"New Version String*:"}),e.jsx("input",{type:"text",id:"typedVersionString",...u("typedVersionString"),placeholder:"e.g., 1.2.4-final",className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.typedVersionString?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"This version will be created for the selected software if it doesn't exist."})]}),d.selectedVersionId&&!le&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.selectedVersionId.message}),d.typedVersionString&&le&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.typedVersionString.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Link Title*"}),e.jsx("input",{type:"text",id:"title",...u("title"),disabled:y,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.title?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),d.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.title.message})]}),e.jsxs("div",{className:"my-4",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Link Source:"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",...u("inputMode"),value:"url",className:"form-radio h-4 w-4 text-blue-600",disabled:y}),e.jsxs("span",{className:"flex items-center dark:text-gray-300",children:[e.jsx(Ke,{size:16,className:"mr-1 text-gray-600 dark:text-gray-400"}),"Provide External URL"]})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",...u("inputMode"),value:"upload",className:"form-radio h-4 w-4 text-blue-600",disabled:y}),e.jsxs("span",{className:"flex items-center dark:text-gray-300",children:[e.jsx(Pt,{size:16,className:"mr-1 text-gray-600 dark:text-gray-400"}),"Upload File for this Link"]})]})]}),d.inputMode&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.inputMode.message})]}),ae==="url"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"externalUrl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Link URL*"}),e.jsx("input",{type:"url",id:"externalUrl",...u("externalUrl"),placeholder:"https://example.com/resource",disabled:y,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.externalUrl?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),d.externalUrl&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.externalUrl.message})]}),ae==="upload"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o&&q&&!k?"Replace File (Optional)":"Select File to Upload*"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-blue-500 dark:border-gray-600 dark:hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(We,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500"}),e.jsxs("div",{className:"flex text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("label",{htmlFor:"link-file-upload-input",className:"relative cursor-pointer bg-white dark:bg-gray-800 rounded-md font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500",children:[e.jsx("span",{children:k?"Change file":"Upload a file"}),e.jsx("input",{id:"link-file-upload-input",name:"file-input-element",type:"file",className:"sr-only",onChange:ke,ref:D,disabled:y})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Any file type relevant for links."})]})}),(k||o&&q)&&e.jsxs("div",{className:"mt-3 flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden",children:[e.jsx(We,{size:18,className:"text-gray-500 dark:text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:k?k.name:q}),o&&q&&!k&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:"(current)"})]}),k&&e.jsx("button",{type:"button",onClick:Z,disabled:y,className:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-200 dark:text-gray-500 dark:hover:text-gray-300 dark:hover:bg-gray-600",children:e.jsx(kt,{size:16})})]}),d.selectedFile&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.selectedFile.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Description"}),e.jsx("textarea",{id:"description",rows:3,...u("description"),disabled:y,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.description?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),d.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.description.message})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"submit",disabled:y||$,className:"flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:y?o?"Updating...":"Adding...":o?"Update Link":"Add Link"}),o&&z&&e.jsx("button",{type:"button",onClick:z,disabled:y,className:"flex-1 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 dark:border-gray-500 dark:text-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600",children:"Cancel"})]})]})},ls=()=>{const{searchTerm:r,setSearchTerm:v}=Nt(),{isAuthenticated:m,user:z}=Ye(),o=z==null?void 0:z.role,[u,re]=s.useState([]),[J,d]=s.useState([]),[R,g]=s.useState([]),[b,K]=s.useState(null),[M,A]=s.useState(null),[I,q]=s.useState(""),[_,y]=s.useState(""),[C,$]=s.useState(""),[T,F]=s.useState(1),[W,H]=s.useState(15),[D,S]=s.useState(0),[ye,ae]=s.useState(0),[k,le]=s.useState("title"),[E,ke]=s.useState("asc"),[Z,ne]=s.useState(!0),[ie,a]=s.useState(null),[j,N]=s.useState(!1),[Q,G]=s.useState(null),[oe,de]=s.useState(!1),[U,w]=s.useState(null),[f,Fe]=s.useState(!1),[ce,me]=s.useState(new Map),[Ce,Ze]=s.useState(!1),[x,ue]=s.useState(new Set),[Ve,Me]=s.useState(!1),[Qe,Ae]=s.useState(!1),[ee,De]=s.useState(!1),[Ue,fe]=s.useState(!1),[P,ve]=s.useState(null),[Pe,ze]=s.useState([]),[he,pe]=s.useState(void 0),[Re,we]=s.useState(!1),[Se,$e]=s.useState(!1),[L,be]=s.useState(null),je=s.useRef(null),Ne=s.useMemo(()=>b!==null||M!==null||I!==""||_!==""||C!==""||r!=="",[b,M,I,_,C,r]),Ee=s.useCallback(()=>{K(null),A(null),q(""),y(""),$(""),v&&v(""),F(1)},[v]),V=s.useCallback(async(t,l=!1)=>{var n,c;l&&ne(!0),a(null);try{const i=await Lt(b||void 0,M||void 0,t,W,k,E,I||void 0,_||void 0,C||void 0);re(i.links),S(i.total_pages),ae(i.total_links),F(i.page),H(i.per_page);const h=new Map;m&&i.links&&i.links.forEach(xe=>h.set(xe.id,{favoriteId:xe.favorite_id})),me(h)}catch(i){const h=((c=(n=i.response)==null?void 0:n.data)==null?void 0:c.msg)||i.message||"Failed to fetch links.";l?(a(h),re([]),S(0),ae(0)):p(h)}finally{l&&ne(!1)}},[b,M,W,k,E,I,_,C,m]);s.useEffect(()=>{m?Je().then(d).catch(t=>p("Failed to load software list.")):d([])},[m]),s.useEffect(()=>{m?V(1,!0):(re([]),ne(!1))},[m,b,M,k,E,I,_,C,V]),s.useEffect(()=>{ue(new Set)},[b,M,k,E,I,_,C,r,T]),s.useEffect(()=>{b?_e(b).then(g).catch(()=>{p("Failed to load versions for filter."),g([])}):g([])},[b]),s.useEffect(()=>{P?($e(!0),_e(P).then(ze).catch(()=>p("Failed to load versions for move.")).finally(()=>$e(!1))):ze([])},[P]);const et=t=>{K(t),A(null),F(1)},tt=t=>{A(t.target.value?parseInt(t.target.value):null),F(1)},st=t=>{F(t),V(t,!0)},rt=t=>{le(t),ke(l=>k===t&&l==="asc"?"desc":"asc"),F(1)},at=()=>{F(1),V(1,!0)},Oe=t=>{N(!1),G(null),B(t),V(1,!0)},lt=()=>{G(null),N(!0)},nt=t=>{G(t),N(!0)},Be=()=>{G(null),N(!1)},it=t=>{w(t),de(!0)},Le=()=>{w(null),de(!1)},ot=async()=>{if(U){Fe(!0),L&&L.id===U.id&&be(null);try{await Ct(U.id),B(`Link "${U.title}" deleted.`),Le(),V(1,!0)}catch(t){p(t.message||"Delete failed."),Le()}finally{Fe(!1)}}},qe=s.useMemo(()=>{if(!r)return u;const t=r.toLowerCase();return u.filter(l=>l.title.toLowerCase().includes(t)||(l.description||"").toLowerCase().includes(t)||(l.software_name||"").toLowerCase().includes(t)||(l.version_number||"").toLowerCase().includes(t))},[u,r]),dt=(t,l)=>ue(n=>{const c=new Set(n);return l?c.add(t):c.delete(t),c}),ct=t=>{const l=new Set;t&&qe.forEach(n=>l.add(n.id)),ue(l)},mt=()=>{if(x.size===0){p("No items selected.");return}we(!0)},ut=async()=>{we(!1),Me(!0),L&&x.has(L.id)&&be(null);try{const t=await Vt(Array.from(x),"link");B(t.msg||`${t.deleted_count} link(s) deleted.`),ue(new Set),V(1,!0)}catch(t){p(t.message||"Bulk delete failed.")}finally{Me(!1)}},Te=s.useMemo(()=>u.filter(t=>x.has(t.id)&&!t.is_external_link&&t.stored_filename).length,[u,x]),xt=async()=>{if(x.size===0){p("No items selected.");return}const t=u.filter(n=>x.has(n.id)&&!n.is_external_link&&n.stored_filename);if(t.length===0){p("No downloadable files among selected links. External links or links without files cannot be bulk downloaded.");return}const l=t.map(n=>n.id);l.length<x.size&&B(`Starting download for ${l.length} file-based links. External links were excluded.`),Ae(!0);try{const n=await _t(l,"link"),c=URL.createObjectURL(n),i=document.createElement("a");i.href=c;const h=new Date().toISOString().replace(/:/g,"-");i.download=`bulk_download_links_${h}.zip`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(c),l.length===x.size&&B("Download started.")}catch(n){p(n.message||"Bulk download failed.")}finally{Ae(!1)}},gt=()=>{if(x.size===0){p("No items selected.");return}if(J.length===0){p("Software list unavailable.");return}ve(null),pe(void 0),fe(!0)},ft=async()=>{if(!P){p("Select target software.");return}fe(!1),De(!0);const t={target_software_id:P};he!==void 0&&(t.target_version_id=he);try{const l=await Mt(Array.from(x),"link",t);B(l.msg||`${l.moved_count} link(s) moved.`),ue(new Set),V(1,!0)}catch(l){p(l.message||"Bulk move failed.")}finally{De(!1),ve(null),pe(void 0)}},ht=[{key:"title",header:"Title",sortable:!0},{key:"software_name",header:"Software",sortable:!0},{key:"version_name",header:"Version",sortable:!0,render:t=>t.version_number||"N/A"},{key:"description",header:"Description",render:t=>e.jsx("span",{className:"text-sm text-gray-600 block max-w-xs truncate",title:t.description||"",children:t.description||"-"})},{key:"url",header:"URL/File",render:t=>{var c,i;const l=t.is_external_link||t.is_downloadable!==!1,n=t.is_external_link?t.url.length>40?`${t.url.substring(0,37)}...`:t.url:t.original_filename_ref||t.url.split("/").pop()||"Uploaded File";return!l&&!t.is_external_link?e.jsxs("span",{className:"flex items-center text-gray-400 cursor-not-allowed",title:"Download not permitted",children:[t.is_external_link?e.jsx(Xe,{size:14,className:"mr-1 flex-shrink-0"}):e.jsx(Ie,{size:14,className:"mr-1 flex-shrink-0"}),n]}):e.jsxs("a",{href:t.url,target:t.is_external_link||!((c=t.url)!=null&&c.startsWith("/"))?"_blank":"_self",rel:"noopener noreferrer",className:`flex items-center ${l?"text-blue-600 hover:text-blue-800":"text-gray-400 cursor-not-allowed"}`,onClick:h=>{l||h.preventDefault(),h.stopPropagation()},title:l?t.is_external_link?"Open external link":"Download file":"Download not permitted",children:[t.is_external_link||!((i=t.url)!=null&&i.startsWith("/"))?e.jsx(Xe,{size:14,className:"mr-1 flex-shrink-0"}):e.jsx(Ie,{size:14,className:"mr-1 flex-shrink-0"}),n]})}},{key:"uploaded_by_username",header:"Added By",sortable:!0,render:t=>t.uploaded_by_username||"N/A"},{key:"updated_by_username",header:"Updated By",sortable:!1,render:t=>t.updated_by_username||"N/A"},{key:"created_at",header:"Created",sortable:!0,render:t=>t.created_at?new Date(t.created_at).toLocaleDateString("en-CA"):"-"},{key:"updated_at",header:"Updated",sortable:!0,render:t=>t.updated_at?new Date(t.updated_at).toLocaleDateString("en-CA"):"-"},{key:"actions",header:"Actions",render:t=>{var l,n,c;return e.jsxs("div",{className:"flex space-x-1 items-center",children:[m&&e.jsx("button",{onClick:i=>{i.stopPropagation(),bt(t,"link")},className:`p-1 rounded-md ${(l=ce.get(t.id))!=null&&l.favoriteId?"text-yellow-500 hover:text-yellow-600":"text-gray-400 hover:text-yellow-500"}`,title:(n=ce.get(t.id))!=null&&n.favoriteId?"Remove Favorite":"Add Favorite",children:e.jsx(Ft,{size:16,className:(c=ce.get(t.id))!=null&&c.favoriteId?"fill-current":""})}),m&&e.jsxs("button",{onClick:i=>{i.stopPropagation(),L&&L.id===t.id?be(null):(be(t),setTimeout(()=>{var h;return(h=je.current)==null?void 0:h.scrollIntoView({behavior:"smooth"})},0))},className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 rounded-md",title:L&&L.id===t.id?"Hide Comments":"View Comments",children:[e.jsx(Tt,{size:16}),e.jsxs("span",{className:"ml-1 text-xs",children:["(",t.comment_count??0,")"]})]}),(o==="admin"||o==="super_admin")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),nt(t)},className:"p-1 text-blue-600 hover:text-blue-800 rounded-md",title:"Edit",children:e.jsx(Wt,{size:16})}),e.jsx("button",{onClick:i=>{i.stopPropagation(),it(t)},className:"p-1 text-red-600 hover:text-red-800 rounded-md",title:"Delete",children:e.jsx(He,{size:16})})]})]})}}],pt=s.useCallback(()=>{V(1,!0)},[V]),bt=async(t,l)=>{var h,xe;if(!m){p("Please log in to manage favorites.");return}const n=ce.get(t.id),c=!!(n!=null&&n.favoriteId),i=new Map(ce);c?i.set(t.id,{favoriteId:void 0}):i.set(t.id,{favoriteId:-1}),me(i);try{if(c&&typeof(n==null?void 0:n.favoriteId)=="number")await At(t.id,l),B(`"${t.title}" removed from favorites.`),me(O=>{const te=new Map(O);return te.set(t.id,{favoriteId:void 0}),te});else{const O=await Dt(t.id,l);me(te=>{const se=new Map(te);return se.set(t.id,{favoriteId:O.id}),se}),B(`"${t.title}" added to favorites.`)}}catch(O){p(((xe=(h=O==null?void 0:O.response)==null?void 0:h.data)==null?void 0:xe.msg)||O.message||"Failed to update favorite."),me(te=>{const se=new Map(te);return c?se.set(t.id,{favoriteId:n==null?void 0:n.favoriteId}):se.set(t.id,{favoriteId:void 0}),se})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start sm:items-center mb-6 flex-col sm:flex-row",children:[e.jsxs("div",{children:[" ",e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Links"})," ",e.jsx("p",{className:"text-gray-600 mt-1 dark:text-gray-300",children:"Manage and browse useful links and resources."})," "]}),m&&(o==="admin"||o==="super_admin")&&!Q&&e.jsxs("button",{onClick:()=>{j?Be():lt()},className:"mt-4 sm:mt-0 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(Et,{size:18,className:"mr-2"})," ",j?"Cancel":"Add New Link"]})]}),j&&e.jsx("div",{className:"my-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg shadow",children:e.jsx(Zt,{linkToEdit:Q,onLinkAdded:()=>Oe("Link added."),onLinkUpdated:()=>Oe("Link updated."),onCancelEdit:Be})}),x.size>0&&e.jsx("div",{className:"my-4 p-3 bg-gray-100 dark:bg-gray-700 rounded-md shadow-sm border border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:[x.size," item(s) selected"]}),(o==="admin"||o==="super_admin")&&e.jsxs("button",{onClick:mt,disabled:Ve,className:"btn-danger-xs flex items-center",children:[e.jsx(He,{size:14,className:"mr-1.5"}),"Delete"]}),m&&e.jsxs("button",{onClick:xt,disabled:Qe||Te===0,className:"btn-success-xs flex items-center",children:[e.jsx(Ie,{size:14,className:"mr-1.5"}),"Download (",Te,")"]}),(o==="admin"||o==="super_admin")&&e.jsxs("button",{onClick:gt,disabled:ee,className:"btn-warning-xs flex items-center",children:[e.jsx(Ot,{size:14,className:"mr-1.5"}),"Move"]})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end md:gap-4",children:[J.length>0&&e.jsx(Yt,{software:J,selectedSoftwareId:b,onSelectFilter:et}),b&&e.jsxs("div",{className:"flex flex-col min-w-[200px] mt-4 md:mt-0",children:[" ",e.jsx("label",{htmlFor:"versionFilterLinks",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Version"}),e.jsxs("select",{id:"versionFilterLinks",value:M||"",onChange:tt,className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200",disabled:R.length===0,children:[e.jsx("option",{value:"",children:"All Versions"}),R.map(t=>e.jsx("option",{value:t.id,children:t.version_number},t.id))]})]})]}),e.jsxs("div",{className:"mb-4 mt-0",children:[" ",e.jsxs("button",{onClick:()=>Ze(t=>!t),className:"flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-md text-sm font-medium",children:[Ce?e.jsx(Ht,{size:18,className:"mr-1.5"}):e.jsx(Bt,{size:18,className:"mr-1.5"})," Advanced Filters"]})]}),Ce&&e.jsxs("div",{className:"my-4 p-4 border dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 space-y-4 md:space-y-0 md:flex md:flex-wrap md:items-end md:gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"linkTypeFilterSelect",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Link Type"}),e.jsxs("select",{id:"linkTypeFilterSelect",value:I,onChange:t=>q(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200",children:[e.jsx("option",{value:"",children:"All"})," ",e.jsx("option",{value:"external",children:"External URL"})," ",e.jsx("option",{value:"uploaded",children:"Uploaded File"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Created Between"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:_,onChange:t=>y(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"to"}),e.jsx("input",{type:"date",value:C,onChange:t=>$(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"})]})]}),e.jsxs("div",{className:"flex items-end gap-2 pt-5",children:[e.jsx("button",{onClick:at,className:"text-sm px-4 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Apply"}),e.jsx("button",{onClick:Ee,className:"text-sm px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Clear All"})]})]}),Z?e.jsx("div",{className:"py-10",children:e.jsx(It,{message:"Loading links..."})}):ie&&u.length===0&&!Z?e.jsx(Jt,{message:ie,onRetry:pt}):!Z&&!ie&&u.length===0?e.jsxs("div",{className:"text-center py-10 bg-white dark:bg-gray-800 rounded-lg shadow-sm my-6",children:[e.jsx(Ke,{size:48,className:"mx-auto text-yellow-500 dark:text-yellow-400 mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-700 dark:text-gray-200 mb-3",children:Ne?"No Links Found Matching Criteria":"No Links Available"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 px-4",children:Ne?"Try adjusting or clearing your search/filter settings.":o==="admin"||o==="super_admin"?"Add new links to get started.":"Please check back later."}),Ne&&e.jsx("button",{onClick:Ee,className:"mt-6 btn-primary text-sm",children:"Clear All Filters & Search"})]}):e.jsx(Gt,{columns:ht,data:qe,rowClassName:"group",isLoading:Z||f,currentPage:T,totalPages:D,onPageChange:st,itemsPerPage:W,totalItems:ye,sortColumn:k,sortOrder:E,onSort:rt,isSelectionEnabled:!0,selectedItemIds:x,onSelectItem:dt,onSelectAllItems:ct}),oe&&U&&e.jsx(Ge,{isOpen:oe,title:"Delete Link",message:`Delete "${U.title}"?`,onConfirm:ot,onCancel:Le,isConfirming:f,confirmButtonText:"Delete",confirmButtonVariant:"danger"}),Re&&e.jsx(Ge,{isOpen:Re,title:`Delete ${x.size} Link(s)`,message:`Delete ${x.size} selected items?`,onConfirm:ut,onCancel:()=>we(!1),isConfirming:Ve,confirmButtonText:"Delete Selected",confirmButtonVariant:"danger"}),Ue&&e.jsx(Xt,{isOpen:Ue,onClose:()=>fe(!1),title:`Move ${x.size} Link(s)`,children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:"Select target Software and optionally a Version:"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"modalSoftwareMoveLinks",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Target Software*"}),e.jsxs("select",{id:"modalSoftwareMoveLinks",value:P??"",onChange:t=>{ve(t.target.value?parseInt(t.target.value):null),pe(void 0)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200",disabled:ee||J.length===0,children:[e.jsx("option",{value:"",children:"Select Software..."}),J.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),P&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"modalVersionMoveLinks",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Target Version (Optional)"}),e.jsxs("select",{id:"modalVersionMoveLinks",value:he===null?"NULL_VERSION":he??"",onChange:t=>pe(t.target.value==="NULL_VERSION"?null:t.target.value?parseInt(t.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200",disabled:ee||Se,children:[e.jsx("option",{value:"",children:Se?"Loading...":"Select Version (Optional)..."}),e.jsx("option",{value:"NULL_VERSION",children:"No Specific Version (Clear Association)"}),Pe.map(t=>e.jsx("option",{value:t.id,children:t.version_number},t.id))]}),Pe.length===0&&!Se&&P&&e.jsx("p",{className:"text-xs text-yellow-600 mt-1",children:"No versions for selected software. You can still move to the software without a specific version."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>fe(!1),className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:ee,children:"Cancel"}),e.jsx("button",{type:"button",onClick:ft,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:ee||!P,children:ee?"Moving...":"Confirm Move"})]})]})}),m&&L&&e.jsxs("div",{ref:je,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-4",children:["Comments for: ",e.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:L.title})]}),e.jsx(qt,{itemId:L.id,itemType:"link"})]}),!m&&L&&e.jsx("div",{ref:je,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Please log in to view and manage comments."})})]})};export{ls as default};
