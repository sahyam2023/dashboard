import{r as a,u as Be,f as Re,s as f,j as e,L as ct,F as ve,X as mt,e as ut,a as xt,b as gt,c as ft,d as P,g as pt,h as ht,i as yt,k as bt,S as wt,l as kt,m as vt,n as jt,o as Nt,p as St}from"./index-BnshCDTl.js";import{C as Dt,D as Ft,M as _t}from"./Modal-DEwoVWFf.js";import{F as Ct}from"./FilterTabs-D7I3gsQB.js";import{E as It}from"./ErrorState-BIYAupsr.js";import{u as Mt,U as At,o as Pt,c as Ut,a as Q,b as Lt,P as Tt,T as $e,D as ke,M as $t,F as zt,C as Et,d as Bt,e as Rt}from"./CommentSection-D2XcrUWX.js";import{C as ze}from"./ConfirmationModal-OAjODolL.js";const Ot=Ut().shape({selectedSoftwareId:Q().required("Software selection is required."),docName:Q().required("Document Name is required.").max(255,"Document Name cannot exceed 255 characters."),docType:Q().transform(r=>r===""?void 0:r).nullable().optional(),inputMode:Q().oneOf(["url","upload"]).required("Input mode must be selected."),externalUrl:Q().when("inputMode",{is:"url",then:r=>r.required("External Download URL is required.").url("Please enter a valid URL (e.g., http://example.com)."),otherwise:r=>r.optional().nullable()}),selectedFile:Lt().when(["inputMode","$isEditMode","$documentToEditIsExternal"],{is:(r,p,U)=>r!=="upload"?!1:!!(!p||p&&U),then:r=>r.required("Please select a file to upload.").test("filePresent","File is required.",p=>!!p),otherwise:r=>r.nullable()}),description:Q().optional().max(1e3,"Description cannot exceed 1000 characters.")}),Ee=({documentToEdit:r,onDocumentAdded:p,onDocumentUpdated:U,onCancelEdit:c})=>{const i=!!r,{register:m,handleSubmit:re,control:ee,formState:{errors:d},watch:L,setValue:T,reset:X}=Mt({resolver:Pt(Ot),context:{isEditMode:i,documentToEditIsExternal:(r==null?void 0:r.is_external_link)||!1},defaultValues:{selectedSoftwareId:"",docName:"",docType:"",description:"",inputMode:"url",externalUrl:"",selectedFile:null}}),[$,oe]=a.useState([]),[J,z]=a.useState(null),[u,S]=a.useState(!1),[Z,le]=a.useState(!1),g=a.useRef(null),{isAuthenticated:Y,user:D}=Be(),F=D==null?void 0:D.role,_=L("inputMode"),C=L("selectedFile");a.useEffect(()=>{Y&&(F==="admin"||F==="super_admin")&&(le(!0),Re().then(oe).catch(()=>f("Failed to load software list.")).finally(()=>le(!1)))},[Y,F]),a.useEffect(()=>{var s;if(i&&r){const I={selectedSoftwareId:((s=r.software_id)==null?void 0:s.toString())||"",docName:r.doc_name,docType:r.doc_type||"",description:r.description||"",inputMode:r.is_external_link?"url":"upload",externalUrl:r.is_external_link?r.download_link:""};if(X(I),r.is_external_link)z(null);else{const E=r.download_link.split("/");z(r.original_filename_ref||E[E.length-1])}T("selectedFile",null),g.current&&(g.current.value="")}else B()},[r,i,X,T]);const B=(s=!1)=>{const I=s?L("selectedSoftwareId"):"";X({selectedSoftwareId:I,docName:"",docType:"",description:"",inputMode:"url",externalUrl:"",selectedFile:null}),z(null),g.current&&(g.current.value="")},te=s=>{s.target.files&&s.target.files[0]?(T("selectedFile",s.target.files[0],{shouldValidate:!0,shouldDirty:!0}),z(null)):T("selectedFile",null,{shouldValidate:!0,shouldDirty:!0})},ge=()=>{if(T("selectedFile",null,{shouldValidate:!0,shouldDirty:!0}),g.current&&(g.current.value=""),i&&r&&!r.is_external_link){const s=r.download_link.split("/");z(r.original_filename_ref||s[s.length-1])}},ne=async s=>{var I,E,ie,fe,R,M;S(!0);try{let y;const N={software_id:parseInt(s.selectedSoftwareId),doc_name:s.docName.trim(),description:((I=s.description)==null?void 0:I.trim())||void 0,doc_type:((E=s.docType)==null?void 0:E.trim())||void 0};if(s.inputMode==="url"){const b={...N,download_link:s.externalUrl.trim()};i&&r?y=await ut(r.id,b):y=await xt(b)}else{const b=new FormData;b.append("software_id",s.selectedSoftwareId),b.append("doc_name",s.docName.trim()),(ie=s.docType)!=null&&ie.trim()&&b.append("doc_type",s.docType.trim()),(fe=s.description)!=null&&fe.trim()&&b.append("description",s.description.trim()),s.selectedFile&&b.append("file",s.selectedFile),i&&r?y=await gt(r.id,b):y=await ft(b)}P(`Document "${y.doc_name}" ${i?"updated":"added"} successfully!`),i||B(!0),i&&U&&U(y),!i&&p&&p(y)}catch(y){const N=((M=(R=y.response)==null?void 0:R.data)==null?void 0:M.msg)||y.message||`Failed to ${i?"update":"add"} document.`;f(N)}finally{S(!1)}},ae=s=>{console.error("Form validation errors:",s),f("Please correct the errors highlighted in the form.")},de=["Guide","Manual","API Reference","Datasheet","Whitepaper","Specification","Other"];return!Y||!F||!["admin","super_admin"].includes(F)?null:e.jsxs("form",{onSubmit:re(ne,ae),className:"space-y-6 bg-white dark:bg-gray-800 dark:border-gray-700 p-6 rounded-lg shadow-md border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:i?"Edit Document":"Add New Document"}),i&&c&&e.jsx("button",{type:"button",onClick:c,className:"text-sm text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",children:"Cancel Edit"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectedSoftwareId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Software*"}),Z?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading software..."}):e.jsxs("select",{id:"selectedSoftwareId",...m("selectedSoftwareId"),disabled:u||Z,className:`mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md ${d.selectedSoftwareId?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`,children:[e.jsx("option",{value:"",disabled:!0,children:"Select Software"}),$.map(s=>e.jsx("option",{value:s.id.toString(),children:s.name},s.id))]}),d.selectedSoftwareId&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.selectedSoftwareId.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"docName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Document Name*"}),e.jsx("input",{type:"text",id:"docName",...m("docName"),disabled:u,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.docName?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),d.docName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.docName.message})]}),e.jsxs("div",{className:"my-4",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Document Source:"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",...m("inputMode"),value:"url",className:"form-radio h-4 w-4 text-blue-600",disabled:u}),e.jsxs("span",{className:"flex items-center dark:text-gray-300",children:[e.jsx(ct,{size:16,className:"mr-1 text-gray-600 dark:text-gray-400"}),"Provide External Link"]})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",...m("inputMode"),value:"upload",className:"form-radio h-4 w-4 text-blue-600",disabled:u}),e.jsxs("span",{className:"flex items-center dark:text-gray-300",children:[e.jsx(At,{size:16,className:"mr-1 text-gray-600 dark:text-gray-400"}),"Upload File"]})]})]}),d.inputMode&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.inputMode.message})]}),_==="url"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"externalUrl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"External Download URL*"}),e.jsx("input",{type:"url",id:"externalUrl",...m("externalUrl"),placeholder:"https://example.com/document.pdf",disabled:u,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.externalUrl?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),d.externalUrl&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.externalUrl.message})]}),_==="upload"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i&&J&&!C?"Replace File (Optional)":"Select File to Upload*"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-blue-500 dark:border-gray-600 dark:hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(ve,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500"}),e.jsxs("div",{className:"flex text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("label",{htmlFor:"doc-file-upload-input",className:"relative cursor-pointer bg-white dark:bg-gray-800 rounded-md font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500",children:[e.jsx("span",{children:C?"Change file":"Upload a file"}),e.jsx("input",{id:"doc-file-upload-input",name:"doc-file-input",type:"file",className:"sr-only",onChange:te,ref:g,disabled:u})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PDF, DOCX, PNG, JPG, ZIP etc."})]})}),(C||J)&&e.jsxs("div",{className:"mt-3 flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden",children:[e.jsx(ve,{size:18,className:"text-gray-500 dark:text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:C?C.name:J}),i&&J&&!C&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:"(current)"})]}),C&&e.jsx("button",{type:"button",onClick:ge,disabled:u,className:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-200 dark:text-gray-500 dark:hover:text-gray-300 dark:hover:bg-gray-600",children:e.jsx(mt,{size:16})})]}),d.selectedFile&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.selectedFile.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"docType",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Document Type"}),e.jsxs("select",{id:"docType",...m("docType"),disabled:u,className:`mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md ${d.docType?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`,children:[e.jsx("option",{value:"",children:"Select Type (Optional)"}),de.map(s=>e.jsx("option",{value:s,children:s},s))]}),d.docType&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.docType.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Description"}),e.jsx("textarea",{id:"description",rows:3,...m("description"),disabled:u,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.description?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),d.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.description.message})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"submit",disabled:u||Z,className:"flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:u?i?"Updating...":"Adding...":i?"Update Document":"Add Document"}),i&&c&&e.jsx("button",{type:"button",onClick:c,disabled:u,className:"flex-1 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:border-gray-500 dark:text-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600",children:"Cancel"})]})]})},Jt=()=>{const{searchTerm:p,setSearchTerm:U}=pt(),{isAuthenticated:c,user:i}=Be(),m=i==null?void 0:i.role,[re,ee]=a.useState(!1),[d,L]=a.useState(null),[T,X]=a.useState(!1),[$,oe]=a.useState(null),[J,z]=a.useState(!1),[u,S]=a.useState(new Map),[Z,le]=a.useState(!1),[g,Y]=a.useState(null),[D,F]=a.useState([]),[_,C]=a.useState([]),[B,te]=a.useState(!0),[ge,ne]=a.useState(!1),[ae,de]=a.useState(null),[s,I]=a.useState(1),[E,ie]=a.useState(0),[fe,R]=a.useState(!1),[M,y]=a.useState("doc_name"),[N,b]=a.useState("asc"),[O,je]=a.useState(""),[V,Ne]=a.useState(""),[q,Se]=a.useState(""),[G,De]=a.useState(""),[W,Fe]=a.useState(""),[h,K]=a.useState(new Set),[_e,ce]=a.useState(!1),[me,pe]=a.useState(null),[Ce,he]=a.useState(!1),[Ie,Me]=a.useState(!1),[Oe,Ae]=a.useState(!1),[se,Pe]=a.useState(!1),[w,ue]=a.useState(null),ye=a.useRef(null),be=a.useMemo(()=>g!==null||O!==""||V!==""||q!==""||G!==""||W!==""||p!=="",[g,O,V,q,G,W,p]),Ue=a.useCallback(()=>{Y(null),je(""),Ne(""),Se(""),De(""),Fe(""),U&&U("")},[U]),k=a.useCallback(async(t,o=!1)=>{var l,x;o?(te(!0),de(null)):ne(!0);try{const n=await ht(g===null?void 0:g,t,15,M,N,O||void 0,V||void 0,q||void 0,G||void 0,W||void 0),j=n.documents;F(xe=>{const v=o?j:[...xe,...j];return S(H=>{const A=new Map;if(c&&v)for(const Te of v)A.set(Te.id,{favoriteId:Te.favorite_id});return A}),v}),ie(n.total_documents),I(n.page),R(n.page<n.total_pages)}catch(n){console.error(`Failed to load documents (page ${t}):`,n);const j=((x=(l=n.response)==null?void 0:l.data)==null?void 0:x.msg)||n.message||"Failed to fetch documents.";o?(de(j),F([]),R(!1)):(f(j),R(!1))}finally{o?te(!1):ne(!1)}},[g,15,M,N,O,V,q,G,W,c]);a.useEffect(()=>{if(!c){F([]),S(new Map),I(1),R(!1),te(!1);return}k(1,!0)},[c,g,M,N,O,V,q,G,W,k]),a.useEffect(()=>{K(new Set)},[g,M,N,O,V,q,G,W,p,s]),a.useEffect(()=>{c&&(async()=>{try{const o=await Re();C(o)}catch(o){console.error("Failed to load software for filters",o),f("Failed to load software list for filtering.")}})()},[c]);const Ve=t=>Y(t),qe=t=>{const o=M===t&&N==="asc"?"desc":"asc";y(t),b(o)},Ge=a.useCallback(t=>{k(t,!0),K(new Set)},[k]),We=t=>{ee(!1),P(`Document "${t.doc_name}" added.`),k(1,!0)},He=t=>{L(null),P(`Document "${t.doc_name}" updated.`),k(1,!0)},Xe=t=>{ee(!1),L(t)},Je=()=>L(null),Ze=t=>{oe(t),X(!0)},we=()=>{oe(null),X(!1)},Ye=async()=>{if($){z(!0),w&&$.id===w.id&&ue(null);try{await kt($.id),P(`Document "${$.doc_name}" deleted.`),we(),k(1,!0)}catch(t){f(t.message||"Failed to delete document."),we()}finally{z(!1)}}},Le=a.useMemo(()=>{if(!p)return D;const t=p.toLowerCase();return D.filter(o=>o.doc_name.toLowerCase().includes(t)||(o.description||"").toLowerCase().includes(t)||(o.software_name||"").toLowerCase().includes(t))},[D,p]),Ke=(t,o)=>{K(l=>{const x=new Set(l);return o?x.add(t):x.delete(t),x})},Qe=t=>{const o=new Set;t&&Le.forEach(l=>o.add(l.id)),K(o)},et=()=>{if(h.size===0){f("No items selected.");return}he(!0)},tt=async()=>{he(!1),Me(!0);try{const t=await vt(Array.from(h),"document");P(t.msg||`${t.deleted_count} item(s) deleted.`),K(new Set),w&&h.has(w.id)&&ue(null),k(1,!0)}catch(t){f(t.message||"Bulk delete failed.")}finally{Me(!1)}},at=async()=>{if(h.size===0){f("No items selected.");return}Ae(!0);try{const t=await bt(Array.from(h),"document"),o=URL.createObjectURL(t),l=document.createElement("a");l.href=o;const x=new Date().toISOString().replace(/:/g,"-");l.download=`bulk_download_document_${x}.zip`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(o),P("Download started.")}catch(t){f(t.message||"Bulk download failed.")}finally{Ae(!1)}},st=()=>{if(h.size===0){f("No items selected.");return}if(_.length===0){f("Software list unavailable.");return}pe(null),ce(!0)},rt=async()=>{if(!me){f("Select target software.");return}ce(!1),Pe(!0);try{const t=await jt(Array.from(h),"document",{target_software_id:me});P(t.msg||`${t.moved_count} item(s) moved.`),K(new Set),k(1,!0)}catch(t){f(t.message||"Bulk move failed.")}finally{Pe(!1),pe(null)}},ot=[{key:"doc_name",header:"Name",sortable:!0},{key:"doc_type",header:"Type",sortable:!0},{key:"software_name",header:"Software",sortable:!0},{key:"description",header:"Description",render:t=>e.jsx("span",{className:"text-sm text-gray-600 block max-w-xs truncate",title:t.description||"",children:t.description||"-"})},{key:"download_link",header:"Download",render:t=>{var x;const o=t.is_external_link||t.is_downloadable;return!(t.is_external_link||t.is_downloadable!==!1)&&!t.is_external_link?e.jsxs("span",{className:"flex items-center text-gray-400 cursor-not-allowed",title:"Download not permitted",children:[e.jsx(ke,{size:14,className:"mr-1"}),"Link"]}):e.jsxs("a",{href:t.download_link,target:t.is_external_link||!((x=t.download_link)!=null&&x.startsWith("/"))?"_blank":"_self",rel:"noopener noreferrer",className:`flex items-center ${o?"text-blue-600 hover:text-blue-800":"text-gray-400 cursor-not-allowed"}`,onClick:n=>{o||n.preventDefault(),n.stopPropagation()},title:o?t.is_external_link?"Open external link":"Download file":"Download not permitted",children:[e.jsx(ke,{size:14,className:"mr-1"}),"Link"]})}},{key:"uploaded_by_username",header:"Uploaded By",sortable:!0,render:t=>t.uploaded_by_username||"N/A"},{key:"updated_by_username",header:"Updated By",sortable:!1,render:t=>t.updated_by_username||"N/A"},{key:"created_at",header:"Created At",sortable:!0,render:t=>t.created_at?new Date(t.created_at).toLocaleDateString("en-CA"):"-"},{key:"updated_at",header:"Updated At",sortable:!0,render:t=>t.updated_at?new Date(t.updated_at).toLocaleDateString("en-CA"):"-"},{key:"actions",header:"Actions",render:t=>{var o,l,x;return e.jsxs("div",{className:"flex space-x-1 items-center",children:[c&&e.jsx("button",{onClick:n=>{n.stopPropagation(),it(t,"document")},className:`p-1 rounded-md ${(o=u.get(t.id))!=null&&o.favoriteId?"text-yellow-500 hover:text-yellow-600":"text-gray-400 hover:text-yellow-500"}`,title:(l=u.get(t.id))!=null&&l.favoriteId?"Remove Favorite":"Add Favorite",children:e.jsx(wt,{size:16,className:(x=u.get(t.id))!=null&&x.favoriteId?"fill-current":""})}),(m==="admin"||m==="super_admin")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),Xe(t)},className:"p-1 text-blue-600 hover:text-blue-800 rounded-md",title:"Edit",children:e.jsx(Bt,{size:16})}),e.jsx("button",{onClick:n=>{n.stopPropagation(),Ze(t)},className:"p-1 text-red-600 hover:text-red-800 rounded-md",title:"Delete",children:e.jsx($e,{size:16})})]}),c&&e.jsxs("button",{onClick:n=>{n.stopPropagation(),w&&w.id===t.id?ue(null):(ue(t),setTimeout(()=>{var j;return(j=ye.current)==null?void 0:j.scrollIntoView({behavior:"smooth"})},0))},className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 rounded-md",title:w&&w.id===t.id?"Hide Comments":"View Comments",children:[e.jsx(Rt,{size:16}),e.jsxs("span",{className:"ml-1 text-xs",children:["(",t.comment_count??0,")"]})]})]})}}],lt=Math.ceil(E/15),nt=a.useCallback(()=>{k(1,!0)},[k]),dt=()=>d?e.jsx("div",{className:"my-6 p-4 bg-gray-50 rounded-lg shadow dark:bg-gray-700",children:e.jsx(Ee,{documentToEdit:d,onDocumentUpdated:He,onCancelEdit:Je})}):re?e.jsx("div",{className:"my-6 p-4 bg-gray-50 rounded-lg shadow dark:bg-gray-700",children:e.jsx(Ee,{onDocumentAdded:We,onCancelEdit:()=>ee(!1)})}):null,it=async(t,o)=>{var j,xe;if(!c){f("Please log in to manage favorites.");return}const l=u.get(t.id),x=!!(l!=null&&l.favoriteId),n=new Map(u);x?n.set(t.id,{favoriteId:void 0}):n.set(t.id,{favoriteId:-1}),S(n);try{if(x&&typeof(l==null?void 0:l.favoriteId)=="number")await Nt(t.id,o),P(`"${t.doc_name}" removed from favorites.`),S(v=>{const H=new Map(v);return H.set(t.id,{favoriteId:void 0}),H});else{const v=await St(t.id,o);S(H=>{const A=new Map(H);return A.set(t.id,{favoriteId:v.id}),A}),P(`"${t.doc_name}" added to favorites.`)}}catch(v){f(((xe=(j=v==null?void 0:v.response)==null?void 0:j.data)==null?void 0:xe.msg)||v.message||"Failed to update favorite."),S(H=>{const A=new Map(H);return x?A.set(t.id,{favoriteId:l==null?void 0:l.favoriteId}):A.set(t.id,{favoriteId:void 0}),A})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start sm:items-center mb-6 flex-col sm:flex-row",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Documents"}),e.jsx("p",{className:"text-gray-600 mt-1 dark:text-gray-300",children:"Browse and manage official documents and resources."})]}),c&&(m==="admin"||m==="super_admin")&&!d&&e.jsxs("button",{onClick:()=>{ee(t=>!t),L(null)},className:"mt-4 sm:mt-0 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(Tt,{size:18,className:"mr-2"}),re?"Cancel":"Add New Document"]})]}),dt(),h.size>0&&e.jsx("div",{className:"my-4 p-3 bg-gray-100 dark:bg-gray-700 rounded-md shadow-sm border border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:[h.size," item(s) selected"]}),(m==="admin"||m==="super_admin")&&e.jsxs("button",{onClick:et,disabled:Ie,className:"px-3 py-1.5 text-xs font-medium text-white bg-red-600 hover:bg-red-700 rounded-md shadow-sm disabled:opacity-50 flex items-center",children:[e.jsx($e,{size:14,className:"mr-1.5"}),"Delete"]}),c&&e.jsxs("button",{onClick:at,disabled:Oe,className:"px-3 py-1.5 text-xs font-medium text-white bg-green-600 hover:bg-green-700 rounded-md shadow-sm disabled:opacity-50 flex items-center",children:[e.jsx(ke,{size:14,className:"mr-1.5"}),"Download"]}),(m==="admin"||m==="super_admin")&&e.jsxs("button",{onClick:st,disabled:se,className:"px-3 py-1.5 text-xs font-medium text-black bg-yellow-400 hover:bg-yellow-500 rounded-md shadow-sm disabled:opacity-50 flex items-center",children:[e.jsx($t,{size:14,className:"mr-1.5"}),"Move"]})]})}),_.length>0&&e.jsx(Ct,{software:_,selectedSoftwareId:g,onSelectFilter:Ve}),e.jsx("div",{className:"mb-4",children:e.jsxs("button",{onClick:()=>le(t=>!t),className:"flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-md text-sm font-medium",children:[Z?e.jsxs(e.Fragment,{children:[e.jsx(Dt,{size:18,className:"mr-2"}),"Hide"]}):e.jsxs(e.Fragment,{children:[e.jsx(zt,{size:18,className:"mr-2"}),"Show"]})," Advanced Filters"]})}),Z&&e.jsxs("div",{className:"my-4 p-4 border dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 space-y-4 md:space-y-0 md:flex md:flex-wrap md:items-end md:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"docTypeFilterInput",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Doc Type"}),e.jsx("input",{id:"docTypeFilterInput",type:"text",value:O,onChange:t=>je(t.target.value),placeholder:"e.g., Manual",className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Created"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:V,onChange:t=>Ne(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"to"}),e.jsx("input",{type:"date",value:q,onChange:t=>Se(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Updated"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:G,onChange:t=>De(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"to"}),e.jsx("input",{type:"date",value:W,onChange:t=>Fe(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"})]})]}),e.jsxs("div",{className:"flex items-end gap-2 pt-5",children:[e.jsx("button",{onClick:()=>k(1,!0),className:"text-sm px-4 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Apply"}),e.jsx("button",{onClick:Ue,className:"text-sm px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Clear"})]})]}),B?e.jsx("div",{className:"py-10",children:e.jsx(yt,{message:"Loading documents..."})}):ae&&D.length===0&&!B?e.jsx(It,{message:ae,onRetry:nt}):!B&&!ae&&D.length===0?e.jsxs("div",{className:"text-center py-10 bg-white dark:bg-gray-800 rounded-lg shadow-sm my-6",children:[e.jsx(ve,{size:48,className:"mx-auto text-yellow-500 dark:text-yellow-400 mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-700 dark:text-gray-200 mb-3",children:be?"No Documents Found Matching Criteria":"No Documents Available"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 px-4",children:be?"Try adjusting or clearing your search/filter settings.":m==="admin"||m==="super_admin"?"Add new documents to get started.":"Please check back later."}),be&&e.jsx("button",{onClick:Ue,className:"mt-6 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 text-sm font-medium",children:"Clear All Filters & Search"})]}):e.jsx(Ft,{columns:ot,data:Le,rowClassName:"group",isLoading:B||ge,currentPage:s,totalPages:lt,onPageChange:Ge,itemsPerPage:15,totalItems:E,sortColumn:M,sortOrder:N,onSort:qe,isSelectionEnabled:!0,selectedItemIds:h,onSelectItem:Ke,onSelectAllItems:Qe}),T&&$&&e.jsx(ze,{isOpen:T,title:"Delete Document",message:`Delete "${$.doc_name}"?`,onConfirm:Ye,onCancel:we,isConfirming:J,confirmButtonText:"Delete",confirmButtonVariant:"danger"}),Ce&&e.jsx(ze,{isOpen:Ce,title:`Delete ${h.size} Document(s)`,message:`Delete ${h.size} selected items?`,onConfirm:tt,onCancel:()=>he(!1),isConfirming:Ie,confirmButtonText:"Delete Selected",confirmButtonVariant:"danger"}),_e&&e.jsx(_t,{isOpen:_e,onClose:()=>ce(!1),title:`Move ${h.size} Document(s)`,children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:"Select target software:"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"targetSoftware",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Target Software"}),e.jsxs("select",{id:"targetSoftware",value:me??"",onChange:t=>pe(t.target.value?parseInt(t.target.value):null),className:"input-class w-full",disabled:_.length===0||se,children:[e.jsx("option",{value:"",children:"Select Software..."}),_.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),_.length===0&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Software list unavailable."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>ce(!1),className:"btn-secondary",disabled:se,children:"Cancel"}),e.jsx("button",{type:"button",onClick:rt,className:"btn-primary",disabled:se||!me,children:se?"Moving...":"Confirm Move"})]})]})}),c&&w&&e.jsxs("div",{ref:ye,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-4",children:["Comments for: ",e.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:w.doc_name})]}),e.jsx(Et,{itemId:w.id,itemType:"document"})]}),!c&&w&&e.jsx("div",{ref:ye,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Please log in to view and manage comments."})})]})};export{Jt as default};
