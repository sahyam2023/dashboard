import{R as U,be as H,r as t,bf as $,j as r,y as G,k as P,f as q,bg as Y,bh as J,a7 as T,a8 as E,s as B,a as R,bi as Q}from"./index-D1VA2Jel.js";import{D as W,a as X}from"./ConfirmationModal-BBIvRaSY.js";import{M as Z}from"./Modal-DkSCFKXR.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=U("Tags",[["path",{d:"m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19",key:"1cbfv1"}],["path",{d:"M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 0 3.42 0l3.58-3.58a2.426 2.426 0 0 0 0-3.42z",key:"135mg7"}],["circle",{cx:"6.5",cy:"9.5",r:".5",fill:"currentColor",key:"5pm5xn"}]]);function D(s){return H({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"},child:[]}]})(s)}function ee(s){return H({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"},child:[]}]})(s)}const re=({onEdit:s,onDelete:c,refreshKey:f,softwareIdFilter:n})=>{const[k,b]=t.useState([]),[v,x]=t.useState(!1),[S,h]=t.useState(null),[i,u]=t.useState(1),[g,N]=t.useState(10),[y,V]=t.useState(0),[L,_]=t.useState(0),[p,d]=t.useState("version_number"),[w,j]=t.useState("asc"),m=t.useCallback(async()=>{x(!0),h(null);try{const e={page:i,perPage:g,sortBy:p,sortOrder:w};n!=null&&(e.softwareId=n);const a=await $(e);b(a.versions),V(a.total_pages),_(a.total_versions),u(a.page)}catch(e){console.error("Error loading versions:",e),h(e instanceof Error?e.message:"Failed to load versions. Please try again.")}finally{x(!1)}},[i,g,p,w,n]);t.useEffect(()=>{m()},[m,f]);const F=e=>{u(e)},C=e=>{p===e?j(w==="asc"?"desc":"asc"):(d(e),j("asc")),u(1)},o=(e,a=50)=>e?e.length<=a?e:e.substring(0,a)+"...":"N/A",l=[{key:"software_name",header:"Software",accessor:"software_name",sortable:!0},{key:"version_number",header:"Version",accessor:"version_number",sortable:!0},{key:"release_date",header:"Release Date",accessor:"release_date",sortable:!0,render:e=>G(e.release_date)},{key:"main_download_link",header:"Download Link",accessor:"main_download_link",sortable:!1,render:e=>e.main_download_link?r.jsx("a",{href:e.main_download_link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-700 underline",children:"Link"}):"N/A"},{key:"changelog",header:"Changelog",accessor:"changelog",sortable:!1,render:e=>o(e.changelog)},{key:"known_bugs",header:"Known Bugs",accessor:"known_bugs",sortable:!1,render:e=>o(e.known_bugs)},{key:"created_at",header:"Created At",accessor:"created_at",sortable:!0,render:e=>P(e.created_at)},{key:"updated_at",header:"Updated At",accessor:"updated_at",sortable:!0,render:e=>P(e.updated_at)},{key:"actions",header:"Actions",accessor:"actions",render:e=>r.jsxs("div",{className:"flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[r.jsx("button",{onClick:()=>s(e),className:"p-1 text-blue-600 hover:text-blue-800","aria-label":"Edit Version",children:r.jsx(D,{})}),r.jsx("button",{onClick:()=>c(e.id),className:"p-1 text-red-600 hover:text-red-800","aria-label":"Delete Version",children:r.jsx(ee,{})})]})}];return S?r.jsxs("div",{className:"text-red-500 p-4",children:["Error: ",S]}):r.jsx("div",{className:"container mx-auto p-4",children:r.jsx(W,{columns:l,data:k,rowClassName:"group",isLoading:v,pagination:{currentPage:i,totalPages:y,totalItems:L,itemsPerPage:g,onPageChange:F,onItemsPerPageChange:e=>{N(e),u(1)}},sortColumn:p,sortOrder:w,onSort:C})})},O=()=>{const s=new Date,c=s.getFullYear(),f=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0");return`${c}-${f}-${n}`},se=({initialData:s,onSubmitSuccess:c,onCancel:f})=>{var l;const[n,k]=t.useState((s==null?void 0:s.software_id)||""),[b,v]=t.useState((s==null?void 0:s.version_number)||""),[x,S]=t.useState(((l=s==null?void 0:s.release_date)==null?void 0:l.substring(0,10))||O()),[h,i]=t.useState((s==null?void 0:s.main_download_link)||""),[u,g]=t.useState((s==null?void 0:s.changelog)||""),[N,y]=t.useState((s==null?void 0:s.known_bugs)||""),[V,L]=t.useState([]),[_,p]=t.useState(!1),[d,w]=t.useState(!1),[j,m]=t.useState(null),[F,C]=t.useState(null);t.useEffect(()=>{(async()=>{p(!0);try{const a=await q();L(a)}catch(a){console.error("Error fetching software list:",a),m("Failed to load software list.")}finally{p(!1)}})()},[]),t.useEffect(()=>{var e;s?(k(s.software_id||""),v(s.version_number||""),S(((e=s.release_date)==null?void 0:e.substring(0,10))||""),i(s.main_download_link||""),g(s.changelog||""),y(s.known_bugs||"")):(k(""),v(""),S(O()),i(""),g(""),y(""))},[s]);const o=async e=>{var A,I;if(e.preventDefault(),m(null),C(null),!n){m("Software is required.");return}if(!b.trim()){m("Version number is required.");return}w(!0);const a={software_id:Number(n),version_number:b.trim(),release_date:x||null,main_download_link:h.trim()||null,changelog:u.trim()||null,known_bugs:N.trim()||null};try{s?(await Y(s.id,a),C("Version updated successfully!")):(await J(a),C("Version added successfully!")),c&&setTimeout(()=>{c()},1e3)}catch(M){console.error("Error submitting version form:",M);const K=((I=(A=M.response)==null?void 0:A.data)==null?void 0:I.msg)||M.message||(s?"Failed to update version.":"Failed to add version.");m(K)}finally{w(!1)}};return r.jsxs("form",{onSubmit:o,className:"space-y-6 p-4 bg-white dark:bg-gray-800 dark:border dark:border-gray-700 shadow-md rounded-lg",children:[j&&r.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 dark:bg-red-900 dark:border-red-700 dark:text-red-300 px-4 py-3 rounded relative",role:"alert",children:j}),F&&r.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 dark:bg-green-900 dark:border-green-700 dark:text-green-300 px-4 py-3 rounded relative",role:"alert",children:F}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"softwareId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:["Software ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("select",{id:"softwareId",value:n,onChange:e=>k(Number(e.target.value)),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 dark:border-gray-600",disabled:_||d,required:!0,children:[r.jsx("option",{value:"",disabled:!0,children:"Select Software"}),V.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]}),_&&r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading software..."})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"versionNumber",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:["Version Number ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",id:"versionNumber",value:b,onChange:e=>v(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400",disabled:d,required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"releaseDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Release Date"}),r.jsx("input",{type:"date",id:"releaseDate",value:x,onChange:e=>S(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 dark:border-gray-600",disabled:d})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"mainDownloadLink",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Main Download Link"}),r.jsx("input",{type:"url",id:"mainDownloadLink",value:h,onChange:e=>i(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400",placeholder:"https://example.com/download",disabled:d})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"changelog",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Changelog"}),r.jsx("textarea",{id:"changelog",value:u,onChange:e=>g(e.target.value),rows:4,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400",disabled:d})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"knownBugs",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Known Bugs"}),r.jsx("textarea",{id:"knownBugs",value:N,onChange:e=>y(e.target.value),rows:4,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400",disabled:d})]}),r.jsxs("div",{className:"flex justify-end space-x-3",children:[r.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-500 dark:hover:bg-gray-600",disabled:d,children:"Cancel"}),r.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",disabled:d||_,children:d?s?"Updating...":"Adding...":s?"Update Version":"Add Version"})]})]})},ne=()=>{const[s,c]=t.useState(!1),[f,n]=t.useState(null),[k,b]=t.useState(!1),[v,x]=t.useState(null),[S,h]=t.useState(0),[i,u]=t.useState([]),[g,N]=t.useState(!0),[y,V]=t.useState(null),[L,_]=t.useState(null);t.useEffect(()=>{(async()=>{var l,e;N(!0),V(null);try{const a=await q();u(a)}catch(a){console.error("Failed to load software list for filtering:",a);const A=((e=(l=a.response)==null?void 0:l.data)==null?void 0:e.msg)||"Failed to load software list for filtering.";B(A),V(A),u([])}finally{N(!1)}})()},[]);const p=()=>{n(null),c(!0)},d=o=>{n(o),c(!0)},w=()=>{c(!1),n(null),h(o=>o+1),R(f?"Version updated successfully!":"Version added successfully!")},j=()=>{c(!1),n(null)},m=o=>{x(o),b(!0)},F=async()=>{var o,l;if(v!==null)try{await Q(v),R("Version deleted successfully!"),h(e=>e+1)}catch(e){const a=((l=(o=e.response)==null?void 0:o.data)==null?void 0:l.msg)||e.message||"Failed to delete version.";B(a),console.error("Error deleting version:",e)}finally{b(!1),x(null)}},C=()=>{b(!1),x(null)};return r.jsxs("div",{className:"container mx-auto p-6 bg-gray-50 dark:bg-gray-900 min-h-screen",children:[r.jsx("h1",{className:"text-3xl font-semibold text-gray-800 dark:text-gray-100 mb-8",children:"Manage Software Versions"}),r.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[r.jsx("div",{}),r.jsxs("div",{className:"flex items-center space-x-4",children:[" ",!g&&!y&&i.length>0&&r.jsxs("div",{className:"min-w-[200px]",children:[" ",r.jsx("label",{htmlFor:"softwareFilter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Filter by Software:"}),r.jsxs("select",{id:"softwareFilter",value:L||"",onChange:o=>{_(o.target.value?Number(o.target.value):null),h(l=>l+1)},className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 dark:border-gray-600",children:[r.jsx("option",{value:"",children:"All Software"}),i.map(o=>r.jsx("option",{value:o.id,children:o.name},o.id))]})]}),r.jsx("button",{onClick:p,className:"px-6 py-2 text-white bg-indigo-600 hover:bg-indigo-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:"Add New Version"})]})]}),g?r.jsx(T,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:3,mt:2,backgroundColor:"background.paper",borderRadius:1,boxShadow:1},children:r.jsx(E,{color:"text.secondary",children:"Loading software list for filtering..."})}):y?r.jsxs(T,{sx:{textAlign:"center",mt:4,p:3,border:"1px dashed",borderColor:"error.main",borderRadius:1},children:[r.jsx(z,{size:60,className:"text-red-500 mb-4 mx-auto"}),r.jsx(E,{variant:"h6",color:"error.main",sx:{mb:1},children:"Could not load software list."}),r.jsxs(E,{variant:"body2",color:"text.secondary",children:[y," Please try refreshing the page or contact support."]})]}):i.length===0?r.jsxs(T,{sx:{textAlign:"center",mt:4,p:3,border:"1px dashed",borderColor:"divider",borderRadius:1},children:[r.jsx(z,{size:60,className:"text-gray-400 dark:text-gray-500 mb-4 mx-auto"}),r.jsx(E,{variant:"h6",color:"text.secondary",sx:{mb:1},children:"No software found."}),r.jsx(E,{variant:"body2",color:"text.secondary",children:"Add software first to manage their versions."})]}):r.jsx(re,{onEdit:d,onDelete:m,refreshKey:S,softwareIdFilter:L}),s&&r.jsx(Z,{isOpen:s,onClose:j,title:f?"Edit Software Version":"Add New Software Version",children:r.jsx(se,{initialData:f,onSubmitSuccess:w,onCancel:j})}),k&&r.jsx(X,{isOpen:k,title:"Confirm Deletion",message:"Are you sure you want to delete this version? This action cannot be undone. Associated items (patches, links) might prevent deletion if they reference this version.",onConfirm:F,onCancel:C,confirmButtonText:"Delete",confirmButtonVariant:"danger"})]})};export{ne as default};
