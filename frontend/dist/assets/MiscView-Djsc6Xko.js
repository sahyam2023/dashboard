import{r as s,u as ke,J as Ge,Q as A,j as e,F as jt,X as Ct,K as wt,M as Ft,N as Nt,O as St,g as _t,h as Mt,s as w,R as Dt,k as It,d as U,l as At,S as zt,T as $t,U as Pt,n as Bt,o as Lt,p as Ut,q as Ot}from"./index-CcqupFqY.js";import{u as He,U as Vt,o as Je,c as Xe,a as ie,b as Et,P as qe,T as Ke,D as pe,M as Rt,F as Tt,C as qt,e as Kt,d as Gt}from"./CommentSection-D1iWOaUn.js";import{C as Ht,D as Jt,M as Xt}from"./Modal-BBl7JktG.js";import{E as Yt}from"./ErrorState-BUnD8Ro5.js";import{C as ve}from"./ConfirmationModal-BqqEz0pv.js";import{A as Wt}from"./archive-CrV05yHG.js";const Zt=Xe().shape({selectedCategoryId:ie().required("Please select a misc category."),selectedFile:Et().when("$isEditMode",{is:a=>!a,then:a=>a.required("Please select a file to upload.").test("filePresent","File is required for upload.",d=>!!d),otherwise:a=>a.nullable()}),title:ie().transform(a=>a===""?void 0:a).optional().max(255,"Title cannot exceed 255 characters.").nullable(),description:ie().transform(a=>a===""?void 0:a).optional().max(1e3,"Description cannot exceed 1000 characters.").nullable()}),Qt=({fileToEdit:a,preselectedCategoryId:d,onUploadSuccess:u,onFileUpdated:h,onCancelEdit:g})=>{const o=!!a,{register:k,handleSubmit:O,control:oe,formState:{errors:f},watch:z,setValue:j,reset:N}=He({resolver:Je(Zt),context:{isEditMode:o},defaultValues:{selectedCategoryId:(d==null?void 0:d.toString())||"",title:"",description:"",selectedFile:null}}),[D,q]=s.useState([]),[$,p]=s.useState(null),[m,P]=s.useState(!1),[V,M]=s.useState(!1),c=s.useRef(null),{isAuthenticated:C,user:B}=ke(),S=B==null?void 0:B.role,_=z("selectedFile");s.useEffect(()=>{C&&(S==="admin"||S==="super_admin")&&(M(!0),Ge().then(q).catch(()=>A.error("Failed to load misc categories.")).finally(()=>M(!1)))},[C,S]),s.useEffect(()=>{o&&a?(N({selectedCategoryId:a.misc_category_id.toString(),title:a.user_provided_title||"",description:a.user_provided_description||"",selectedFile:null}),p(a.original_filename),c.current&&(c.current.value="")):(N({selectedCategoryId:(d==null?void 0:d.toString())||"",title:"",description:"",selectedFile:null}),p(null),c.current&&(c.current.value=""))},[o,a,d,N]);const ne=x=>{x.target.files&&x.target.files[0]?(j("selectedFile",x.target.files[0],{shouldValidate:!0,shouldDirty:!0}),o&&p(null)):j("selectedFile",null,{shouldValidate:!0,shouldDirty:!0})},E=()=>{j("selectedFile",null,{shouldValidate:!0,shouldDirty:!0}),c.current&&(c.current.value=""),o&&a&&p(a.original_filename)},ge=async x=>{var G,J,X,Y;if(!C||!S||!["admin","super_admin"].includes(S)){A.error("Not authorized.");return}P(!0);const I=new FormData;I.append("misc_category_id",x.selectedCategoryId),I.append("user_provided_title",((G=x.title)==null?void 0:G.trim())||""),I.append("user_provided_description",((J=x.description)==null?void 0:J.trim())||""),x.selectedFile&&I.append("file",x.selectedFile);try{let v;o&&a?(v=await wt(a.id,I),A.success(`File "${v.user_provided_title||v.original_filename}" updated successfully!`),h&&h(v)):(v=await Ft(I),A.success(`File "${v.original_filename}" uploaded successfully!`),N({selectedCategoryId:(d==null?void 0:d.toString())||x.selectedCategoryId,title:"",description:"",selectedFile:null}),c.current&&(c.current.value=""),u&&u(v))}catch(v){const Z=((Y=(X=v.response)==null?void 0:X.data)==null?void 0:Y.msg)||v.message||"File operation failed.";A.error(Z)}finally{P(!1)}},K=x=>{console.error("Form validation errors:",x),A.error("Please correct the errors highlighted in the form.")};return!C||!S||!["admin","super_admin"].includes(S)?null:e.jsxs("form",{onSubmit:O(ge,K),className:"space-y-6 bg-white dark:bg-gray-800 dark:border-gray-700 p-6 rounded-lg shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:o?"Edit Miscellaneous File":"Upload File to Misc Category"}),o&&g&&e.jsx("button",{type:"button",onClick:g,className:"text-sm text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",children:"Cancel Edit"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectedCategoryId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Misc Category*"}),V?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading categories..."}):e.jsxs("select",{id:"selectedCategoryId",...k("selectedCategoryId"),disabled:m||D.length===0,className:`mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md ${f.selectedCategoryId?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a category"}),D.map(x=>e.jsx("option",{value:x.id.toString(),children:x.name},x.id))]}),f.selectedCategoryId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:f.selectedCategoryId.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o?"Replace File (Optional)":"Select File*"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md dark:border-gray-600 hover:border-blue-500 dark:hover:border-blue-400",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(Vt,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500"}),e.jsxs("div",{className:"flex text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("label",{htmlFor:"selectedFile",className:"relative cursor-pointer bg-white dark:bg-gray-800 rounded-md font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300 focus-within:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("span",{children:_?"Change file":"Upload a file"}),e.jsx("input",{id:"selectedFile",name:"selectedFile-input",type:"file",className:"sr-only",onChange:ne,ref:c,disabled:m})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Any allowed file type."})]})}),(_||o&&$)&&e.jsxs("div",{className:"mt-3 flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden",children:[e.jsx(jt,{size:18,className:"text-gray-500 dark:text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:_?_.name:$}),o&&$&&!_&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:"(current file)"})]}),_&&e.jsx("button",{type:"button",onClick:E,disabled:m,className:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-200 dark:text-gray-500 dark:hover:text-gray-300 dark:hover:bg-gray-600",children:e.jsx(Ct,{size:16})})]}),f.selectedFile&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:f.selectedFile.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"File Title (Optional)"}),e.jsx("input",{type:"text",id:"title",...k("title"),placeholder:o&&a?a.original_filename:"Defaults to filename if blank",disabled:m,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${f.title?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),f.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:f.title.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"File Description (Optional)"}),e.jsx("textarea",{id:"description",rows:3,...k("description"),disabled:m,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${f.description?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),f.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:f.description.message})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"submit",disabled:m||V||!o&&!_||!z("selectedCategoryId"),className:"flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:m?o?"Updating...":"Uploading...":o?"Update File Details":"Upload to Misc"}),o&&g&&e.jsx("button",{type:"button",onClick:g,disabled:m,className:"flex-1 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 dark:border-gray-500 dark:text-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600",children:"Cancel"})]})]})},es=Xe().shape({name:ie().required("Category name is required.").max(100,"Category name cannot exceed 100 characters."),description:ie().optional().max(500,"Description cannot exceed 500 characters.").nullable()}),ts=({categoryToEdit:a,onSuccess:d,onCancel:u})=>{const h=!!a,{register:g,handleSubmit:o,formState:{errors:k},reset:O,setValue:oe}=He({resolver:Je(es),defaultValues:{name:"",description:""}}),[f,z]=s.useState(!1),{isAuthenticated:j,user:N}=ke(),D=N==null?void 0:N.role;s.useEffect(()=>{O(h&&a?{name:a.name,description:a.description||""}:{name:"",description:""})},[a,h,O]);const q=async p=>{var m,P,V,M;z(!0);try{let c;if(h&&a){const C={};let B=!1;p.name.trim()!==a.name&&(C.name=p.name.trim(),B=!0);const S=a.description||"",_=((m=p.description)==null?void 0:m.trim())||"";if(_!==S&&(C.description=_||void 0,B=!0),!B){A.info("No changes detected."),z(!1),d&&d(a);return}c=await Nt(a.id,C)}else{const C={name:p.name.trim(),description:((P=p.description)==null?void 0:P.trim())||void 0};c=await St(C)}A.success(`Category "${c.name}" ${h?"updated":"added"} successfully!`),h||O({name:"",description:""}),d&&d(c)}catch(c){const C=((M=(V=c.response)==null?void 0:V.data)==null?void 0:M.msg)||c.message||`Failed to ${h?"update":"add"} category.`;A.error(C)}finally{z(!1)}},$=p=>{console.error("Form validation errors:",p),A.error("Please correct the errors in the form.")};return!j||!D||!["admin","super_admin"].includes(D)?e.jsx("p",{children:"You are not authorized to manage categories."}):e.jsxs("form",{onSubmit:o(q,$),className:"space-y-4 p-4 border border-gray-200 rounded-lg bg-white shadow-sm dark:bg-gray-800 dark:border-gray-700",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800 dark:text-gray-100",children:h?"Edit Miscellaneous Category":"Add New Miscellaneous Category"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name*"}),e.jsx("input",{type:"text",id:"name",...g("name"),disabled:f,className:`mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${k.name?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),k.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:k.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Description"}),e.jsx("textarea",{id:"description",...g("description"),rows:3,disabled:f,className:`mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${k.description?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),k.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:k.description.message})]}),e.jsxs("div",{className:"flex items-center space-x-3 pt-2",children:[e.jsx("button",{type:"submit",disabled:f,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-60",children:f?h?"Updating...":"Adding...":h?"Save Changes":"Add Category"}),u&&e.jsx("button",{type:"button",onClick:u,disabled:f,className:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:border-gray-500 dark:text-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600",children:"Cancel"})]})]})},ss="http://localhost:7000",ds=()=>{const{searchTerm:a,setSearchTerm:d}=_t(),{isAuthenticated:u,user:h}=ke(),g=h==null?void 0:h.role,[o,k]=s.useState([]),[O,oe]=s.useState(!0),[f,z]=s.useState(null),[j,N]=s.useState([]),[D,q]=s.useState(!0),[$,p]=s.useState(null),[m,P]=s.useState(null),[V,M]=s.useState(1),[c,C]=s.useState(15),[B,S]=s.useState(0),[_,ne]=s.useState(0),[E,ge]=s.useState("user_provided_title"),[K,x]=s.useState("asc"),[I,G]=s.useState(!1),[J,X]=s.useState(null),[Y,v]=s.useState(!1),[Z,fe]=s.useState(null),[W,Ye]=s.useState(null),[je,We]=s.useState(!1),[Ze,Ce]=s.useState(!1),[R,we]=s.useState(null),[Fe,Ne]=s.useState(!1),[Se,_e]=s.useState(!1),[Q,ee]=s.useState(new Map),[Me,Qe]=s.useState(!0),[F,te]=s.useState(new Set),[De,Ie]=s.useState(!1),[et,Ae]=s.useState(!1),[se,ze]=s.useState(!1),[$e,de]=s.useState(!1),[ce,xe]=s.useState(null),[Pe,he]=s.useState(!1),[y,ae]=s.useState(null),me=s.useRef(null),Be=Mt(),ye=s.useMemo(()=>m!==null||a!=="",[m,a]),tt=s.useCallback(()=>{P(null),d&&d(""),M(1)},[d]),ue=s.useCallback(async()=>{var t,r;oe(!0),z(null);try{const l=await Ge();k(l)}catch(l){k([]);const n=((r=(t=l.response)==null?void 0:t.data)==null?void 0:r.msg)||l.message||"Failed to load categories.";z(n),w(n)}finally{oe(!1)}},[]);s.useEffect(()=>{u?ue():k([])},[u,ue]),s.useEffect(()=>{const t=new URLSearchParams(Be.search),r=t.get("item_id"),l=t.get("comment_id");if(r&&l&&j.length>0){const n=parseInt(r,10);if(!isNaN(n)){const i=j.find(b=>b.id===n);i?((!y||y.id!==i.id)&&ae(i),setTimeout(()=>{var b;(b=me.current)==null||b.scrollIntoView({behavior:"smooth",block:"center"})},100)):console.warn(`MiscView: MiscFile with item_id ${n} not found in the current list.`)}}},[Be.search,j,y]);const L=s.useCallback(async(t,r=!1)=>{var l,n;r&&q(!0),p(null);try{const i=await Dt(m||void 0,t,c,E,K);N(i.misc_files),S(i.total_pages),ne(i.total_misc_files),M(i.page),C(i.per_page);const b=new Map;u&&i.misc_files&&i.misc_files.forEach(re=>b.set(re.id,{favoriteId:re.favorite_id})),ee(b)}catch(i){const b=((n=(l=i.response)==null?void 0:l.data)==null?void 0:n.msg)||i.message||"Failed to fetch files.";r?(p(b),N([]),S(0),ne(0)):w(b)}finally{r&&q(!1)}},[m,c,E,K,u]);s.useEffect(()=>{u?L(1,!0):(N([]),q(!1))},[u,m,E,K,L]),s.useEffect(()=>{te(new Set)},[m,E,K,a,V]);const st=t=>{P(t.target.value?parseInt(t.target.value):null),M(1)},at=t=>{M(t),L(t,!0)},rt=t=>{ge(t),x(r=>E===t&&r==="asc"?"desc":"asc"),M(1)},Le=(t,r)=>{v(!1),fe(null),U(`File "${t.user_provided_title||t.original_filename}" ${r?"updated":"uploaded"}.`),L(1,!0)},lt=t=>{G(!1),X(null),U(t),ue()},Ue=t=>{fe(t||null),v(!0),G(!1)},Oe=()=>{fe(null),v(!1)},it=()=>{X(null),G(!0),v(!1)},Ve=()=>{X(null),G(!1)},Ee=()=>{Ye(null),We(!1)},ot=t=>{we(t),Ne(!0)},be=()=>{we(null),Ne(!1)},nt=async()=>{var t,r;if(W){Ce(!0);try{await $t(W.id),U(`Category "${W.name}" deleted.`),Ee(),ue(),m===W.id&&P(null)}catch(l){w(((r=(t=l.response)==null?void 0:t.data)==null?void 0:r.msg)||"Delete failed.")}finally{Ce(!1)}}},dt=async()=>{if(R){_e(!0),y&&y.id===R.id&&ae(null);try{await Pt(R.id),U(`File "${R.user_provided_title||R.original_filename}" deleted.`),be(),L(1,!0)}catch(t){w(t.message||"Delete failed."),be()}finally{_e(!1)}}},Re=s.useMemo(()=>{if(!a)return j;const t=a.toLowerCase();return j.filter(r=>(r.user_provided_title||"").toLowerCase().includes(t)||r.original_filename.toLowerCase().includes(t)||(r.user_provided_description||"").toLowerCase().includes(t)||(r.category_name||"").toLowerCase().includes(t))},[j,a]),ct=(t,r)=>te(l=>{const n=new Set(l);return r?n.add(t):n.delete(t),n}),mt=t=>{const r=new Set;t&&Re.forEach(l=>r.add(l.id)),te(r)},ut=()=>{if(F.size===0){w("No items selected.");return}he(!0)},gt=async()=>{he(!1),Ie(!0),y&&F.has(y.id)&&ae(null);try{const t=await Bt(Array.from(F),"misc_file");U(t.msg||`${t.deleted_count} file(s) deleted.`),te(new Set),L(1,!0)}catch(t){w(t.message||"Bulk delete failed.")}finally{Ie(!1)}},ft=async()=>{if(F.size===0){w("No items selected.");return}Ae(!0);try{const t=await At(Array.from(F),"misc_file"),r=URL.createObjectURL(t),l=document.createElement("a");l.href=r;const n=new Date().toISOString().replace(/:/g,"-");l.download=`bulk_download_misc_files_${n}.zip`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(r),U("Download started.")}catch(t){w(t.message||"Bulk download failed.")}finally{Ae(!1)}},xt=()=>{if(F.size===0){w("No items selected.");return}if(o.length===0){w("Categories unavailable for move.");return}xe(null),de(!0)},ht=async()=>{if(!ce){w("Select target category.");return}de(!1),ze(!0);try{const t=await Lt(Array.from(F),"misc_file",{target_misc_category_id:ce});U(t.msg||`${t.moved_count} file(s) moved.`),te(new Set),L(1,!0)}catch(t){w(t.message||"Bulk move failed.")}finally{ze(!1),xe(null)}},yt=t=>t?new Date(t).toLocaleDateString("en-CA"):"-",bt=t=>{if(t==null)return"N/A";if(t===0)return"0 B";const r=1024,l=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(t)/Math.log(r));return parseFloat((t/Math.pow(r,n)).toFixed(2))+" "+l[n]},pt=[{key:"user_provided_title",header:"Title",sortable:!0,render:t=>t.user_provided_title||e.jsx("span",{className:"italic text-gray-500 dark:text-gray-400",children:t.original_filename})},{key:"original_filename",header:"Original Filename",sortable:!0},{key:"category_name",header:"Category",sortable:!0},{key:"uploaded_by_username",header:"Uploaded By",sortable:!0,render:t=>t.uploaded_by_username||"N/A"},{key:"file_size",header:"Size",sortable:!0,render:t=>bt(t.file_size)},{key:"created_at",header:"Uploaded At",sortable:!0,render:t=>yt(t.created_at)},{key:"file_path",header:"Link",render:t=>t.is_downloadable!==!1?e.jsxs("a",{href:`${ss}${t.file_path}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-blue-600 hover:text-blue-800",onClick:l=>l.stopPropagation(),title:"Download file",children:[e.jsx(pe,{size:14,className:"mr-1"}),"Download"]}):e.jsxs("span",{className:"flex items-center text-gray-400 cursor-not-allowed",title:"Download not permitted",children:[e.jsx(pe,{size:14,className:"mr-1"}),"Download"]})},{key:"actions",header:"Actions",render:t=>{var r,l,n;return e.jsxs("div",{className:"flex space-x-1 items-center",children:[u&&e.jsx("button",{onClick:i=>{i.stopPropagation(),kt(t,"misc_file")},className:`p-1 rounded-md ${(r=Q.get(t.id))!=null&&r.favoriteId?"text-yellow-500 hover:text-yellow-600":"text-gray-400 hover:text-yellow-500"}`,title:(l=Q.get(t.id))!=null&&l.favoriteId?"Remove Favorite":"Add Favorite",children:e.jsx(zt,{size:16,className:(n=Q.get(t.id))!=null&&n.favoriteId?"fill-current":""})}),u&&e.jsxs("button",{onClick:i=>{i.stopPropagation(),y&&y.id===t.id?ae(null):(ae(t),setTimeout(()=>{var b;return(b=me.current)==null?void 0:b.scrollIntoView({behavior:"smooth"})},0))},className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 rounded-md",title:y&&y.id===t.id?"Hide Comments":"View Comments",children:[e.jsx(Kt,{size:16}),e.jsxs("span",{className:"ml-1 text-xs",children:["(",t.comment_count??0,")"]})]}),(g==="admin"||g==="super_admin")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),Ue(t)},className:"p-1 text-blue-600 hover:text-blue-800 rounded-md",title:"Edit",children:e.jsx(Gt,{size:16})}),e.jsx("button",{onClick:i=>{i.stopPropagation(),ot(t)},className:"p-1 text-red-600 hover:text-red-800 rounded-md",title:"Delete",children:e.jsx(Ke,{size:16})})]})]})}}],vt=s.useCallback(()=>{L(1,!0)},[L]),kt=async(t,r)=>{var b,re;if(!u){w("Log in to manage favorites.");return}const l=Q.get(t.id),n=!!(l!=null&&l.favoriteId),i=new Map(Q);n?i.set(t.id,{favoriteId:void 0}):i.set(t.id,{favoriteId:-1}),ee(i);try{const H=t.user_provided_title||t.original_filename;if(n&&typeof(l==null?void 0:l.favoriteId)=="number")await Ut(t.id,r),U(`"${H}" removed from favorites.`),ee(le=>{const T=new Map(le);return T.set(t.id,{favoriteId:void 0}),T});else{const le=await Ot(t.id,r);ee(T=>{const Te=new Map(T);return Te.set(t.id,{favoriteId:le.id}),Te}),U(`"${H}" added to favorites.`)}}catch(H){w(((re=(b=H==null?void 0:H.response)==null?void 0:b.data)==null?void 0:re.msg)||H.message||"Failed to update favorite."),ee(le=>{const T=new Map(le);return n?T.set(t.id,{favoriteId:l==null?void 0:l.favoriteId}):T.set(t.id,{favoriteId:void 0}),T})}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-start sm:items-center mb-6 flex-col sm:flex-row",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Miscellaneous Files"}),e.jsx("p",{className:"text-gray-600 mt-1 dark:text-gray-300",children:"Manage and browse categorized files."})]}),u&&(g==="admin"||g==="super_admin")&&e.jsxs("div",{className:"flex space-x-3 mt-4 sm:mt-0",children:[e.jsxs("button",{onClick:I&&!J?Ve:it,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(qe,{size:18,className:"mr-2"}),I&&!J?"Cancel":"Add/Edit Category"]}),e.jsxs("button",{onClick:Y&&!Z?Oe:()=>Ue(),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(qe,{size:18,className:"mr-2"}),Y&&!Z?"Cancel":"Upload New File"]})]})]}),I&&e.jsx("div",{className:"my-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg shadow",children:e.jsx(ts,{categoryToEdit:J,onSuccess:t=>lt(`Category "${t.name}" saved.`),onCancel:Ve})}),Y&&e.jsx("div",{className:"my-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg shadow",children:e.jsx(Qt,{fileToEdit:Z,onUploadSuccess:t=>Le(t,!1),onFileUpdated:t=>Le(t,!0),onCancelEdit:Oe})}),F.size>0&&e.jsx("div",{className:"my-4 p-3 bg-gray-100 dark:bg-gray-700 rounded-md shadow-sm border border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:[F.size," item(s) selected"]}),(g==="admin"||g==="super_admin")&&e.jsxs("button",{onClick:ut,disabled:De,className:"btn-danger-xs flex items-center",children:[e.jsx(Ke,{size:14,className:"mr-1.5"}),"Delete"]}),u&&e.jsxs("button",{onClick:ft,disabled:et,className:"btn-success-xs flex items-center",children:[e.jsx(pe,{size:14,className:"mr-1.5"}),"Download"]}),(g==="admin"||g==="super_admin")&&e.jsxs("button",{onClick:xt,disabled:se,className:"btn-warning-xs flex items-center",children:[e.jsx(Rt,{size:14,className:"mr-1.5"}),"Move"]})]})}),e.jsxs("div",{className:"my-4",children:[e.jsxs("button",{onClick:()=>Qe(t=>!t),className:"flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-md text-sm font-medium mb-2",children:[Me?e.jsx(Ht,{size:18,className:"mr-2"}):e.jsx(Tt,{size:18,className:"mr-2"})," Category Filter"]}),Me&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"category-filter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sr-only",children:"Filter by Category"}),e.jsxs("select",{id:"category-filter",value:m??"",onChange:st,className:"block w-full sm:w-1/3 pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200",disabled:O||o.length===0,children:[e.jsx("option",{value:"",children:"All Categories"}),o.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),D?e.jsx("div",{className:"py-10",children:e.jsx(It,{message:"Loading files..."})}):$&&j.length===0&&!D?e.jsx(Yt,{message:$,onRetry:vt}):!D&&!$&&j.length===0?e.jsxs("div",{className:"text-center py-10 bg-white dark:bg-gray-800 rounded-lg shadow-sm my-6",children:[e.jsx(Wt,{size:48,className:"mx-auto text-yellow-500 dark:text-yellow-400 mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-700 dark:text-gray-200 mb-3",children:ye?"No Files Found Matching Criteria":"No Files Available"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 px-4",children:ye?"Try adjusting or clearing your search/filter settings.":g==="admin"||g==="super_admin"?"Upload new files to get started.":"Please check back later."}),ye&&e.jsx("button",{onClick:tt,className:"mt-6 btn-primary text-sm",children:"Clear All Filters & Search"})]}):e.jsx(Jt,{columns:pt,data:Re,rowClassName:"group",isLoading:D||Se,currentPage:V,totalPages:B,onPageChange:at,itemsPerPage:c,totalItems:_,sortColumn:E,sortOrder:K,onSort:rt,isSelectionEnabled:!0,selectedItemIds:F,onSelectItem:ct,onSelectAllItems:mt}),je&&W&&e.jsx(ve,{isOpen:je,title:"Delete Category",message:`Delete category "${W.name}"? Files in it won't be deleted but will become uncategorized.`,onConfirm:nt,onCancel:Ee,isConfirming:Ze,confirmButtonText:"Delete",confirmButtonVariant:"danger"}),Fe&&R&&e.jsx(ve,{isOpen:Fe,title:"Delete File",message:`Delete "${R.user_provided_title||R.original_filename}"?`,onConfirm:dt,onCancel:be,isConfirming:Se,confirmButtonText:"Delete",confirmButtonVariant:"danger"}),Pe&&e.jsx(ve,{isOpen:Pe,title:`Delete ${F.size} File(s)`,message:`Delete ${F.size} selected items?`,onConfirm:gt,onCancel:()=>he(!1),isConfirming:De,confirmButtonText:"Delete Selected",confirmButtonVariant:"danger"}),$e&&e.jsx(Xt,{isOpen:$e,onClose:()=>de(!1),title:`Move ${F.size} File(s)`,children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:"Select target category:"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"modalCategoryMove",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Target Category*"}),e.jsxs("select",{id:"modalCategoryMove",value:ce??"",onChange:t=>xe(t.target.value?parseInt(t.target.value):null),className:"input-class w-full",disabled:se||o.length===0,children:[e.jsx("option",{value:"",children:"Select Category..."}),o.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),o.length===0&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Categories unavailable."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>de(!1),className:"btn-secondary",disabled:se,children:"Cancel"}),e.jsx("button",{type:"button",onClick:ht,className:"btn-primary",disabled:se||!ce,children:se?"Moving...":"Confirm Move"})]})]})}),u&&y&&e.jsxs("div",{ref:me,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-4",children:["Comments for: ",e.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:y.user_provided_title||y.original_filename})]}),e.jsx(qt,{itemId:y.id,itemType:"misc_file"})]}),!u&&y&&e.jsx("div",{ref:me,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Please log in to view and manage comments."})})]})};export{ds as default};
