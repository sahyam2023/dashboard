import{r,j as e,ad as ns,s as Ie,ae as ds,a as ls,u as is,af as cs,a7 as us,ag as ms,h as gs,ah as bs,ai as xs,aj as hs,ak as fs,al as ps,am as ys,an as ws,ao as ks,ap as vs,aq as js,ar as Ns,as as Ss}from"./index-CEpsALSJ.js";import{D as Ps,M as Qe}from"./Modal-BOs8f6Ew.js";const Pe=l=>l.length<8?{strong:!1,message:"Password must be at least 8 characters long."}:/[A-Z]/.test(l)?/[a-z]/.test(l)?/[0-9]/.test(l)?/[!@#$%^&*(),.?":{}|<>]/.test(l)?{strong:!0,message:"Password is strong."}:{strong:!1,message:"Password must include at least one special character."}:{strong:!1,message:"Password must include at least one digit."}:{strong:!1,message:"Password must include at least one lowercase letter."}:{strong:!1,message:"Password must include at least one uppercase letter."},_s=({onUserCreated:l,onCancel:p})=>{const[D,X]=r.useState(""),[P,K]=r.useState(""),[ee,_]=r.useState(""),[j,B]=r.useState(""),[se,de]=r.useState("user"),[h,we]=r.useState([]),[le,ie]=r.useState(!1),[y,O]=r.useState(""),[C,ce]=r.useState(""),[N,F]=r.useState(""),[R,c]=r.useState(""),[S,w]=r.useState(""),[$,te]=r.useState(""),[q,re]=r.useState(!1),[z,V]=r.useState(null),[u,k]=r.useState({}),[L,I]=r.useState("");r.useEffect(()=>{(async()=>{ie(!0);try{const i=await ns();we(i),i.length>0&&(i.length>=1&&O(i[0].id.toString()),i.length>=2&&F(i[1].id.toString()),i.length>=3&&w(i[2].id.toString()))}catch{V("Failed to load security questions."),Ie("Failed to load security questions. Please try again.")}finally{ie(!1)}})()},[]);const Y=o=>{const i=o.target.value;K(i);const f=Pe(i);I(f.message)},ue=()=>{const o={};D.trim()||(o.username="Username is required.");const i=Pe(P);i.strong||(o.password=i.message),P!==ee&&(o.confirmPassword="Passwords do not match."),j.trim()&&!/\S+@\S+\.\S+/.test(j)&&(o.email="Email is invalid."),se||(o.role="Role is required.");const f=y,m=N,v=S;return!f||!m||!v?o.securityQuestions="All three security questions must be selected.":(f===m||f===v||m===v)&&(o.securityQuestions="Security questions must be unique."),C.trim()||(o.answer1="Answer for question 1 is required."),R.trim()||(o.answer2="Answer for question 2 is required."),$.trim()||(o.answer3="Answer for question 3 is required."),k(o),Object.keys(o).length===0},me=async o=>{var f,m;if(o.preventDefault(),V(null),!ue())return;re(!0);const i={username:D,password:P,email:j.trim()||void 0,role:se,security_answers:[{question_id:parseInt(y,10),answer:C},{question_id:parseInt(N,10),answer:R},{question_id:parseInt(S,10),answer:$}]};try{await ds(i),ls(`User "${D}" created successfully!`),l(),X(""),K(""),_(""),B(""),de("user"),h.length>=1&&O(h[0].id.toString()),h.length>=2&&F(h[1].id.toString()),h.length>=3?w(h[2].id.toString()):h.length===2?w(""):h.length===1?(F(""),w("")):(O(""),F(""),w("")),ce(""),c(""),te(""),k({}),I("")}catch(v){const ae=((m=(f=v.response)==null?void 0:f.data)==null?void 0:m.msg)||v.message||"Failed to create user.";V(ae),Ie(ae)}finally{re(!1)}},Z=o=>{const i=[y,N,S].filter(Boolean);return h.filter(f=>{const m=f.id.toString();return o==="q1"?m===y||!i.includes(m)||m==="":o==="q2"?m===N||!i.includes(m)||m==="":o==="q3"?m===S||!i.includes(m)||m==="":!i.includes(m)})};return le?e.jsx("div",{className:"text-center p-4",children:"Loading security questions..."}):e.jsxs("form",{onSubmit:me,className:"space-y-6 p-4 sm:p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:"Create New User"}),z&&e.jsx("div",{className:"p-3 mb-4 text-sm text-red-700 bg-red-100 rounded-lg dark:bg-red-200 dark:text-red-800",role:"alert",children:z}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Username"}),e.jsx("input",{type:"text",id:"username",value:D,onChange:o=>X(o.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0}),u.username&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:u.username})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Password"}),e.jsx("input",{type:"password",id:"password",value:P,onChange:Y,className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0}),L&&e.jsx("p",{className:`mt-1 text-xs ${Pe(P).strong?"text-green-500":"text-red-500"}`,children:L}),u.password&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:u.password})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Confirm Password"}),e.jsx("input",{type:"password",id:"confirmPassword",value:ee,onChange:o=>_(o.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0}),u.confirmPassword&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:u.confirmPassword})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Email (Optional)"}),e.jsx("input",{type:"email",id:"email",value:j,onChange:o=>B(o.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"}),u.email&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:u.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Role"}),e.jsxs("select",{id:"role",value:se,onChange:o=>de(o.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"super_admin",children:"Super Admin"})]}),u.role&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:u.role})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-md font-medium text-gray-900 dark:text-white",children:"Security Questions"}),u.securityQuestions&&e.jsx("p",{className:"text-xs text-red-500",children:u.securityQuestions}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"question1",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Question 1"}),e.jsxs("select",{id:"question1",value:y,onChange:o=>O(o.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md dark:bg-gray-700 dark:text-white",disabled:h.length===0,children:[e.jsx("option",{value:"",children:"Select a question"}),Z("q1").map(o=>e.jsx("option",{value:o.id.toString(),children:o.question_text},`q1-${o.id}`))]}),e.jsx("input",{type:"text",id:"answer1",value:C,onChange:o=>ce(o.target.value),placeholder:"Answer for question 1",className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0}),u.answer1&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:u.answer1})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"question2",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Question 2"}),e.jsxs("select",{id:"question2",value:N,onChange:o=>F(o.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md dark:bg-gray-700 dark:text-white",disabled:h.length===0,children:[e.jsx("option",{value:"",children:"Select a question"}),Z("q2").map(o=>e.jsx("option",{value:o.id.toString(),children:o.question_text},`q2-${o.id}`))]}),e.jsx("input",{type:"text",id:"answer2",value:R,onChange:o=>c(o.target.value),placeholder:"Answer for question 2",className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0}),u.answer2&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:u.answer2})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"question3",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Question 3"}),e.jsxs("select",{id:"question3",value:S,onChange:o=>w(o.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md dark:bg-gray-700 dark:text-white",disabled:h.length===0,children:[e.jsx("option",{value:"",children:"Select a question"}),Z("q3").map(o=>e.jsx("option",{value:o.id.toString(),children:o.question_text},`q3-${o.id}`))]}),e.jsx("input",{type:"text",id:"answer3",value:$,onChange:o=>te(o.target.value),placeholder:"Answer for question 3",className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0}),u.answer3&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:u.answer3})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:p,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white dark:bg-gray-600 dark:text-gray-200 border border-gray-300 dark:border-gray-500 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:q||le,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 border border-transparent rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:q?"Creating...":"Create User"})]})]})},As=()=>{var Me,De,Re,$e;const l=is(),[p,D]=r.useState([]),[X,P]=r.useState(!0),[K,ee]=r.useState(null),[_,j]=r.useState(1),[B,se]=r.useState(10),[de,h]=r.useState(0),[we,le]=r.useState(0),[ie,y]=r.useState(!1),O=()=>{y(!1),T(),c({type:"success",message:"New user created successfully!"})},[C,ce]=r.useState("username"),[N,F]=r.useState("asc"),[R,c]=r.useState(null),[S,w]=r.useState(null),[$,te]=r.useState("user"),[q,re]=r.useState(""),[z,V]=r.useState(""),[u,k]=r.useState(null),[L,I]=r.useState(null),[Y,ue]=r.useState(!1),[me,Z]=r.useState(!1),[o,i]=r.useState(null),[f,m]=r.useState(null),[v,ae]=r.useState(!1),[_e,ke]=r.useState(null),[Ce,ge]=r.useState(null),[ve,je]=r.useState(null),[Ge,Te]=r.useState(Date.now()),[A,Fe]=r.useState(!1),[be,xe]=r.useState(!0),[he,fe]=r.useState(null),[U,qe]=r.useState(null),[Cs,pe]=r.useState([]),[Q,Ne]=r.useState([]),[Ae,oe]=r.useState([]),[W,ne]=r.useState(!1),[H,G]=r.useState(null),[ye,E]=r.useState(null),[Se,Ue]=r.useState(""),Ee=(s,t,n,d)=>{oe(a=>{let g;const b=a.findIndex(x=>x.file_id===s&&x.file_type===t);if(b>-1)return a.map((M,J)=>J===b?(g={...M,[n]:d},g):M);{const x=Q.find(M=>M.id===s&&M.type===t);if(x)return g={file_id:x.id,file_type:x.type,can_view:!0,can_download:!0},g[n]=d,[...a,g]}return a}),ye&&E(null),H&&G(null)},Be=async()=>{var t,n;if(!U){E({type:"error",message:"No user selected."});return}ne(!0),G(null),E(null);const s=Ae.map(d=>({...d,can_view:typeof d.can_view=="boolean"?d.can_view:!1,can_download:typeof d.can_download=="boolean"?d.can_download:!1}));try{const d=await ws(U.id,s);E({type:"success",message:d.msg||"Permissions updated successfully!"});const a=d.permissions||[];pe(a);const g=Q.map(b=>{const x=a.find(J=>J.file_id===b.id&&J.file_type===b.type);return{file_id:b.id,file_type:b.type,can_view:x?!!x.can_view:!0,can_download:x?!!x.can_download:!0}});oe(g)}catch(d){console.error("Error saving permissions:",d);const a=((n=(t=d.response)==null?void 0:t.data)==null?void 0:n.msg)||d.message||"Failed to save permissions.";G(a),E({type:"error",message:a})}finally{ne(!1)}},Oe=()=>{qe(null),pe([]),Ne([]),oe([]),G(null),E(null),Ue("")},T=r.useCallback(async()=>{var s;if(l.isAuthenticated&&((s=l.user)==null?void 0:s.role)==="super_admin"){P(!0),ee(null);try{const t=await cs(_,B,C,N);D(t.users),h(t.total_pages),le(t.total_users),j(t.page),se(t.per_page)}catch(t){D([]),ee(t.message||"Failed to fetch users."),c({type:"error",message:t.message||"Failed to fetch users."})}finally{P(!1)}}},[l.isAuthenticated,(Me=l.user)==null?void 0:Me.role,_,B,C,N]);if(r.useEffect(()=>{T()},[T]),r.useEffect(()=>{(async()=>{var t,n,d;if(l.isAuthenticated&&((t=l.user)==null?void 0:t.role)==="super_admin"){xe(!0),fe(null);try{const a=await ms();Fe(a.maintenance_mode_enabled)}catch(a){console.error("Failed to fetch maintenance mode status:",a);const g=((d=(n=a.response)==null?void 0:n.data)==null?void 0:d.msg)||a.message||"Failed to fetch maintenance status.";fe(g)}finally{xe(!1)}}})()},[l.isAuthenticated,(De=l.user)==null?void 0:De.role]),r.useEffect(()=>{U&&(async()=>{var t;if(!l.isAuthenticated||((t=l.user)==null?void 0:t.role)!=="super_admin"){G("User not authorized for this action."),ne(!1);return}ne(!0),G(null),E(null),pe([]),Ne([]),oe([]);try{const d=(await gs(void 0,1,100)).documents.map(b=>({id:b.id,name:b.doc_name,type:"document"}));Ne(d);const a=await bs(U.id);pe(a);const g=d.map(b=>{const x=a.find(Le=>Le.file_id===b.id&&Le.file_type===b.type),M=x?!!x.can_view:!0,J=x?!!x.can_download:!0;return{file_id:b.id,file_type:b.type,can_view:M,can_download:J}});oe(g)}catch(n){console.error("Error fetching data for permissions:",n);const d=n.message||"Failed to fetch data for permissions.";G(d),E({type:"error",message:d})}finally{ne(!1)}})()},[U,l.isAuthenticated,(Re=l.user)==null?void 0:Re.role]),!l.isAuthenticated)return e.jsx(us,{to:"/login",replace:!0});if((($e=l.user)==null?void 0:$e.role)!=="super_admin")return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600",children:"Unauthorized"}),e.jsx("p",{children:"You do not have permission to view this page."})]});const ze=s=>{j(s)},Ve=s=>{C===s?F(t=>t==="asc"?"desc":"asc"):(ce(s),F("asc")),j(1)},Ye=s=>{w(s.id),te(s.role),c(null)},Ze=async s=>{if(!(!S||s!==S)){c(null);try{const n=await ks(s,{new_role:$});c({type:"success",message:`User ${n.username}'s role updated to ${n.role}.`}),T()}catch(t){c({type:"error",message:t.message||"Failed to update role."})}finally{w(null)}}},We=s=>s.length<8?"Password must be at least 8 characters long.":/[A-Z]/.test(s)?/[a-z]/.test(s)?/[0-9]/.test(s)?"":"Password must include at least one digit.":"Password must include at least one lowercase letter.":"Password must include at least one uppercase letter.",He=async s=>{var n,d;if(s.preventDefault(),k(null),I(null),!q||!z){k("Both password fields are required.");return}if(q!==z){k("New passwords do not match.");return}const t=We(q);if(t){k(t);return}ue(!0);try{const g=await xs({new_password:q});I(g.msg||"Global password updated successfully!"),re(""),V("")}catch(a){k(((d=(n=a.response)==null?void 0:n.data)==null?void 0:d.msg)||a.message||"Failed to change global password.")}finally{ue(!1)}},Je=async(s,t)=>{if(window.confirm(`Are you sure you want to deactivate user ${t}?`)){c(null);try{await vs(s),c({type:"success",message:`User ${t} deactivated.`}),T()}catch(n){c({type:"error",message:n.message||`Failed to deactivate ${t}.`})}}},Xe=async()=>{var d,a;xe(!0),fe(null),c(null);const s=A?ps:ys,t=A?"Maintenance mode disabled.":"Maintenance mode enabled.",n=A?"Failed to disable maintenance mode.":"Failed to enable maintenance mode.";try{const g=await s();Fe(g.maintenance_mode_enabled),c({type:"success",message:t})}catch(g){const b=((a=(d=g.response)==null?void 0:d.data)==null?void 0:a.msg)||g.message||n;fe(b),c({type:"error",message:b})}finally{xe(!1)}},Ke=async(s,t)=>{if(window.confirm(`Are you sure you want to activate user ${t}?`)){c(null);try{await js(s),c({type:"success",message:`User ${t} activated.`}),T()}catch(n){c({type:"error",message:n.message||`Failed to activate ${t}.`})}}},es=async(s,t)=>{if(window.confirm(`Are you sure you want to PERMANENTLY DELETE user ${t}? This action cannot be undone.`)){c(null);try{await Ns(s),c({type:"success",message:`User ${t} deleted.`}),p.length===1&&_>1?j(_-1):T()}catch(n){c({type:"error",message:n.message||`Failed to delete ${t}.`})}}},ss=async(s,t)=>{if(window.confirm(`Are you sure you want to require user ${t} to reset their password on next login?`)){c(null);try{await Ss(s),c({type:"success",message:`User ${t} will be required to reset their password on next login.`})}catch(n){c({type:"error",message:n.message||`Failed to force password reset for ${t}.`})}}},ts=async()=>{var s,t;Z(!0),i(null),m(null);try{const n=await hs();i(n.message+(n.backup_path?` Path: ${n.backup_path}`:""))}catch(n){m(((t=(s=n.response)==null?void 0:s.data)==null?void 0:t.msg)||n.message||"Failed to create backup.")}finally{Z(!1)}},rs=s=>{s.target.files&&s.target.files[0]?(je(s.target.files[0]),ge(null),ke(null)):je(null)},as=async()=>{var t,n;if(!ve){ge("Please select a .db backup file to restore.");return}if(window.confirm("Are you sure you want to restore the database? This will overwrite the current data and cannot be undone. It is highly recommended to take a fresh backup before restoring.")){ae(!0),ke(null),ge(null);const d=new FormData;d.append("backup_file",ve);try{const a=await fs(d);ke(a.message),je(null),Te(Date.now())}catch(a){ge(((n=(t=a.response)==null?void 0:t.data)==null?void 0:n.msg)||a.message||"Failed to restore database.")}finally{ae(!1)}}},os=[{key:"username",header:"Username",sortable:!0},{key:"email",header:"Email",sortable:!0,render:s=>s.email||"N/A"},{key:"role",header:"Role",sortable:!0,render:s=>{var t,n,d;return S===s.id?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:$,onChange:a=>te(a.target.value),className:"block w-auto pl-3 pr-10 py-1.5 text-sm border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200",disabled:((t=l.user)==null?void 0:t.username)===s.username&&p.filter(a=>a.role==="super_admin").length<=1&&$!=="super_admin",onClick:a=>a.stopPropagation(),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"super_admin",children:"Super Admin"})]}),e.jsx("button",{onClick:a=>{a.stopPropagation(),Ze(s.id)},className:"px-3 py-1 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Save"}),e.jsx("button",{onClick:a=>{a.stopPropagation(),w(null)},className:"px-3 py-1 border border-gray-300 dark:border-gray-500 text-xs font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 shadow-sm",children:"Cancel"})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:s.role}),((n=l.user)==null?void 0:n.username)!==s.username&&e.jsx("button",{onClick:a=>{a.stopPropagation(),Ye(s)},className:"text-blue-600 hover:text-blue-700 text-xs font-medium",children:"Edit"}),((d=l.user)==null?void 0:d.username)===s.username&&s.role==="super_admin"&&p.filter(a=>a.role==="super_admin").length<=1&&e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500 italic",children:"(Cannot change role - only Super Admin)"})]})}},{key:"is_active",header:"Status",sortable:!0,render:s=>e.jsx("span",{className:`px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full ${s.is_active?"bg-green-100 text-green-800 dark:bg-green-700 dark:text-green-100":"bg-red-100 text-red-800 dark:bg-red-700 dark:text-red-100"}`,children:s.is_active?"Active":"Inactive"})},{key:"created_at",header:"Created At",sortable:!0,render:s=>s.created_at?new Date(s.created_at).toLocaleDateString():"N/A"},{key:"actions",header:"Actions",render:s=>{var t,n,d;return e.jsxs("div",{className:"flex items-center space-x-3 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[s.is_active?e.jsx("button",{onClick:a=>{a.stopPropagation(),Je(s.id,s.username)},className:"text-yellow-600 hover:text-yellow-700 disabled:text-gray-400 dark:disabled:text-gray-500 text-xs font-medium",disabled:((t=l.user)==null?void 0:t.username)===s.username&&p.filter(a=>a.role==="super_admin"&&a.is_active).length<=1,children:"Deactivate"}):e.jsx("button",{onClick:a=>{a.stopPropagation(),Ke(s.id,s.username)},className:"text-green-600 hover:text-green-700 text-xs font-medium",children:"Activate"}),e.jsx("button",{onClick:a=>{a.stopPropagation(),es(s.id,s.username)},className:"text-red-600 hover:text-red-700 disabled:text-gray-400 dark:disabled:text-gray-500 text-xs font-medium",disabled:((n=l.user)==null?void 0:n.username)===s.username,children:"Delete"}),s.role!=="super_admin"&&((d=l.user)==null?void 0:d.username)!==s.username&&e.jsx("button",{onClick:a=>{a.stopPropagation(),ss(s.id,s.username)},className:"text-purple-600 hover:text-purple-700 text-xs font-medium",children:"Force Reset"}),e.jsx("button",{onClick:a=>{a.stopPropagation(),qe(s)},className:"text-teal-600 hover:text-teal-700 text-xs font-medium",children:"Permissions"})]})}}];return e.jsxs("div",{className:"container mx-auto p-4 md:p-6 lg:p-8 space-y-10 md:space-y-12",children:[e.jsxs("section",{className:"bg-white dark:bg-gray-800 shadow-xl rounded-xl p-6 md:p-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 dark:text-gray-100",children:"User Management"}),e.jsx("button",{onClick:()=>y(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition ease-in-out duration-150",children:"Create User"})]}),R&&e.jsx("div",{className:`p-4 mb-6 rounded-lg text-sm ${R.type==="success"?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-200 border border-green-200 dark:border-green-700":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-200 border border-red-200 dark:border-red-700"}`,children:R.message}),K&&p.length===0&&!X&&e.jsxs("div",{className:"text-red-500 bg-red-100 dark:bg-red-900 dark:text-red-200 p-4 rounded-lg mb-6 text-sm",children:["Error: ",K]}),e.jsx(Ps,{columns:os,data:p,rowClassName:"group hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",isLoading:X,currentPage:_,totalPages:de,onPageChange:ze,itemsPerPage:B,totalItems:we,sortColumn:C,sortOrder:N,onSort:Ve})]}),e.jsxs("section",{className:"bg-white dark:bg-gray-800 shadow-xl rounded-xl p-6 md:p-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 text-gray-800 dark:text-gray-100",children:"Global Site Password"}),u&&e.jsx("div",{className:"p-3 mb-4 rounded-md bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 border border-red-200 dark:border-red-700 text-sm",children:u}),L&&e.jsx("div",{className:"p-3 mb-4 rounded-md bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 border border-green-200 dark:border-green-700 text-sm",children:L}),e.jsxs("form",{onSubmit:He,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newGlobalPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"New Global Password"}),e.jsx("input",{id:"newGlobalPassword",type:"password",value:q,onChange:s=>{re(s.target.value),u&&k(null),L&&I(null)},className:"block w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500",required:!0,disabled:Y})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmNewGlobalPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Confirm New Global Password"}),e.jsx("input",{id:"confirmNewGlobalPassword",type:"password",value:z,onChange:s=>{V(s.target.value),u&&k(null),L&&I(null)},className:"block w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500",required:!0,disabled:Y})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"submit",disabled:Y,className:"w-full flex justify-center py-2.5 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-60 transition-colors",children:Y?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"}):"Change Global Password"})})]})]}),e.jsxs("section",{className:"bg-white dark:bg-gray-800 shadow-xl rounded-xl p-6 md:p-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 text-gray-800 dark:text-gray-100",children:"Database Backup"}),f&&e.jsx("div",{className:"p-3 mb-4 rounded-md bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 border border-red-200 dark:border-red-700 text-sm",children:f}),o&&e.jsx("div",{className:"p-3 mb-4 rounded-md bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 border border-green-200 dark:border-green-700 text-sm",children:o}),e.jsx("button",{onClick:ts,disabled:me,className:"w-full flex justify-center py-2.5 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-60 transition-colors",children:me?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"}):"Create Backup"})]}),e.jsxs("section",{className:"bg-white dark:bg-gray-800 shadow-xl rounded-xl p-6 md:p-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 text-gray-800 dark:text-gray-100",children:"Database Restore"}),Ce&&e.jsx("div",{className:"p-3 mb-4 rounded-md bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 border border-red-200 dark:border-red-700 text-sm",children:Ce}),_e&&e.jsx("div",{className:"p-3 mb-4 rounded-md bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 border border-green-200 dark:border-green-700 text-sm",children:_e}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"restoreFile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Select .db Backup File"}),e.jsx("input",{id:"restoreFile",type:"file",accept:".db",onChange:rs,className:"block w-full text-sm text-gray-700 dark:text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 dark:file:bg-gray-600 file:text-blue-700 dark:file:text-gray-200 hover:file:bg-blue-100 dark:hover:file:bg-gray-500 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white dark:bg-gray-700",disabled:v},Ge)]}),e.jsx("button",{onClick:as,disabled:v||!ve,className:"w-full flex justify-center py-2.5 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 transition-colors",children:v?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"}):"Restore from Backup"})]})]}),e.jsxs("section",{className:"bg-white dark:bg-gray-800 shadow-xl rounded-xl p-6 md:p-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 text-gray-800 dark:text-gray-100",children:"System Maintenance Mode"}),he&&e.jsxs("div",{className:"p-3 mb-4 rounded-md bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 border border-red-200 dark:border-red-700 text-sm",children:["Error: ",he]}),be&&!p.length&&!he&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading maintenance status..."}),(!be||p.length>0||he)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-3",children:[e.jsx("label",{htmlFor:"maintenanceToggle",className:"flex items-center cursor-pointer",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",id:"maintenanceToggle",className:"sr-only",checked:A,onChange:Xe,disabled:be}),e.jsx("div",{className:`block w-14 h-8 rounded-full transition-colors ${A?"bg-green-500":"bg-gray-300 dark:bg-gray-600"}`}),e.jsx("div",{className:`dot absolute left-1 top-1 bg-white dark:bg-gray-300 w-6 h-6 rounded-full shadow-md transition-transform duration-300 ease-in-out ${A?"transform translate-x-6":""}`})]})}),e.jsxs("span",{className:`text-sm font-medium ${A?"text-green-700 dark:text-green-300":"text-gray-700 dark:text-gray-300"}`,children:["Maintenance Mode is ",A?"ACTIVATED":"DEACTIVATED"]}),be&&e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-blue-500"})]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2",children:"When activated, only Super Administrators can log in. Other users will be denied access."})]})]}),e.jsx(Qe,{isOpen:U!==null,onClose:Oe,title:U?`File Permissions: ${U.username}`:"",children:e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search files...",value:Se,onChange:s=>Ue(s.target.value),className:"block w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500"})}),W&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:"Loading permissions..."}),H&&e.jsx("div",{className:"p-3 mb-4 rounded-md bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 border border-red-200 dark:border-red-700 text-sm",children:H}),ye&&e.jsx("div",{className:`p-3 mb-4 rounded-md text-sm ${ye.type==="success"?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 border border-green-200 dark:border-green-700":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 border border-red-200 dark:border-red-700"}`,children:ye.message}),!W&&!H&&Q.length>0&&e.jsxs("form",{onSubmit:s=>{s.preventDefault(),Be()},className:"space-y-4",children:[e.jsx("div",{className:"max-h-96 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg p-1 bg-gray-50 dark:bg-gray-800/50",children:Q.filter(s=>s.name.toLowerCase().includes(Se.toLowerCase())).map(s=>{const t=Ae.find(n=>n.file_id===s.id&&n.file_type===s.type);return e.jsxs("div",{className:"p-3 border-b border-gray-200 dark:border-gray-600 last:border-b-0 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors duration-150 bg-white dark:bg-gray-700 shadow-sm my-1",children:[e.jsxs("h4",{className:"font-medium text-gray-800 dark:text-gray-100 truncate",title:s.name,children:[s.name," ",e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",s.type.replace("_"," "),")"]})]}),e.jsxs("div",{className:"flex items-center space-x-6 mt-2.5",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",className:"rounded text-blue-600 focus:ring-blue-500 h-4 w-4 border-gray-300 dark:border-gray-500 bg-gray-100 dark:bg-gray-600 checked:bg-blue-600 dark:checked:bg-blue-500",checked:(t==null?void 0:t.can_view)??!0,onChange:n=>Ee(s.id,s.type,"can_view",n.target.checked)}),e.jsx("span",{children:"View"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",className:"rounded text-blue-600 focus:ring-blue-500 h-4 w-4 border-gray-300 dark:border-gray-500 bg-gray-100 dark:bg-gray-600 checked:bg-blue-600 dark:checked:bg-blue-500",checked:(t==null?void 0:t.can_download)??!0,onChange:n=>Ee(s.id,s.type,"can_download",n.target.checked)}),e.jsx("span",{children:"Download"})]})]})]},`${s.type}-${s.id}`)})}),e.jsx("div",{className:"flex justify-end pt-3",children:e.jsx("button",{type:"submit",disabled:W,className:"px-6 py-2.5 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-blue-500 disabled:opacity-50",children:W?"Saving...":"Save Permissions"})})]}),!W&&!H&&Q.filter(s=>s.name.toLowerCase().includes(Se.toLowerCase())).length===0&&Q.length>0&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:"No files match your search term."}),!W&&!H&&Q.length===0&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:"No documents found to set permissions for. Ensure documents are uploaded."})]})}),e.jsx(Qe,{isOpen:ie,onClose:()=>y(!1),title:"Create New User",children:e.jsx(_s,{onUserCreated:O,onCancel:()=>y(!1)})})]})};export{As as default};
