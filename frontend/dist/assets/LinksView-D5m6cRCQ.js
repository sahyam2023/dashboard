import{B as jt,r as s,u as et,f as tt,Q as ge,t as ve,j as e,L as st,F as Je,X as Nt,C as Lt,D as It,E as _t,G as Ft,g as Ct,h as Vt,H as Mt,s as b,k as At,d as B,l as Dt,S as Ut,I as Pt,n as zt,o as Et,p as Rt,q as $t}from"./index-D7yCX6eS.js";import{u as Ot,U as Bt,o as qt,c as Tt,a as X,b as Wt,P as Ht,T as Ke,D as Fe,M as Gt,F as Xt,C as Yt,e as Jt,d as Kt}from"./CommentSection-Dt7Nwfoc.js";import{C as Zt,D as Qt,M as es}from"./Modal-BLhqIw1m.js";import{F as ts}from"./FilterTabs-Dh4xHP_c.js";import{E as ss}from"./ErrorState-CQlQILZP.js";import{C as Ze}from"./ConfirmationModal-Cm3sq2pp.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=jt("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),Y="CREATE_NEW_VERSION_SENTINEL_VALUE",rs=Tt().shape({selectedSoftwareId:X().required("Software Product must be selected."),title:X().required("Link Title is required.").max(255,"Title cannot exceed 255 characters."),selectedVersionId:X().required("Version must be selected or a new one entered."),typedVersionString:X().when("selectedVersionId",{is:Y,then:r=>r.required('New Version String is required when "Enter New Version" is selected.').min(1,"New Version String cannot be empty."),otherwise:r=>r.transform(S=>S===""?void 0:S).optional().nullable()}),inputMode:X().oneOf(["url","upload"]).required("Input mode must be selected."),externalUrl:X().when("inputMode",{is:"url",then:r=>r.required("External URL is required for URL mode.").url("Please enter a valid URL (e.g., http://example.com)."),otherwise:r=>r.optional().nullable()}),selectedFile:Wt().when(["inputMode","isEditMode","existingFileName"],{is:(r,S,x)=>r==="upload"&&(!S||!x),then:r=>r.required("A file is required for new link uploads.").test("filePresent","A file is required for new link uploads.",S=>!!S),otherwise:r=>r.nullable()}),description:X().optional().max(1e3,"Description cannot exceed 1000 characters.")}),as=({linkToEdit:r,onLinkAdded:S,onLinkUpdated:x,onCancelEdit:U})=>{const o=!!r,{register:u,handleSubmit:ae,control:J,formState:{errors:d},watch:P,setValue:g,reset:f}=Ot({resolver:qt(rs),context:{isEditMode:o,existingFileName:(r==null?void 0:r.original_filename_ref)||(r&&!r.is_external_link?r.url.split("/").pop():null)},defaultValues:{selectedSoftwareId:"",title:"",selectedVersionId:"",typedVersionString:"",inputMode:"url",externalUrl:"",selectedFile:null,description:""}}),[K,F]=s.useState([]),[C,N]=s.useState([]),[q,V]=s.useState(null),[k,z]=s.useState(!1),[E,M]=s.useState(!1),{isAuthenticated:ne,user:R}=et(),T=R==null?void 0:R.role,I=s.useRef(null),h=P("selectedSoftwareId"),le=P("selectedVersionId"),fe=P("inputMode"),A=P("selectedFile"),Z=le===Y;s.useEffect(()=>{ne&&(T==="admin"||T==="super_admin")&&(M(!0),tt().then(F).catch(()=>ge.error("Failed to load software list.")).finally(()=>M(!1)))},[ne,T]),s.useEffect(()=>{h?(M(!0),N([]),g("selectedVersionId",""),g("typedVersionString",""),ve(parseInt(h)).then(N).catch(()=>ge.error("Failed to load versions for selected software.")).finally(()=>M(!1))):(N([]),g("selectedVersionId",""),g("typedVersionString",""))},[h,g]),s.useEffect(()=>{if(o&&r){const a={selectedSoftwareId:r.software_id.toString(),title:r.title,description:r.description||"",inputMode:r.is_external_link?"url":"upload",externalUrl:r.is_external_link?r.url:""};r.version_id&&r.software_id.toString()===h&&C.length>0?C.find(L=>L.id===r.version_id)?(a.selectedVersionId=r.version_id.toString(),a.typedVersionString=r.version_number):(a.selectedVersionId=Y,a.typedVersionString=r.version_number):r.version_number&&(a.selectedVersionId=Y,a.typedVersionString=r.version_number),f(a),r.is_external_link?V(null):V(r.original_filename_ref||r.url.split("/").pop()||"unknown_file"),g("selectedFile",null),I.current&&(I.current.value="")}else o||he(!!h)},[o,r,f,g,C,h]);const he=(a=!1)=>{const j=a?P("selectedSoftwareId"):"";f({selectedSoftwareId:j,title:"",selectedVersionId:"",typedVersionString:"",inputMode:"url",externalUrl:"",selectedFile:null,description:""}),V(null),I.current&&(I.current.value="")},pe=a=>{a.target.files&&a.target.files[0]?g("selectedFile",a.target.files[0],{shouldValidate:!0,shouldDirty:!0}):g("selectedFile",null,{shouldValidate:!0,shouldDirty:!0})},$=()=>{g("selectedFile",null,{shouldValidate:!0,shouldDirty:!0}),I.current&&(I.current.value="")},Se=async a=>{var ie,Q,G,oe;z(!0);let j,L;a.selectedVersionId===Y&&a.typedVersionString?L=a.typedVersionString.trim():a.selectedVersionId&&a.selectedVersionId!==Y&&(j=parseInt(a.selectedVersionId));const H={software_id:parseInt(a.selectedSoftwareId),title:a.title.trim(),description:((ie=a.description)==null?void 0:ie.trim())||void 0};j&&(H.version_id=j),L&&(H.typed_version_string=L);try{let w;if(a.inputMode==="url"){const y={...H,url:a.externalUrl.trim(),is_external_link:!0};o&&r?w=await Lt(r.id,y):w=await It(y)}else{const y=new FormData;y.append("software_id",a.selectedSoftwareId),j&&y.append("version_id",j.toString()),L&&y.append("typed_version_string",L),y.append("title",a.title.trim()),(Q=a.description)!=null&&Q.trim()&&y.append("description",a.description.trim()),a.selectedFile&&y.append("file",a.selectedFile),o&&r?w=await _t(r.id,y):w=await Ft(y)}ge.success(`Link "${w.title}" ${o?"updated":"added"} successfully!`),o||(he(!0),g("selectedVersionId",""),g("typedVersionString","")),o&&x&&x(w),!o&&S&&S(w)}catch(w){const y=((oe=(G=w.response)==null?void 0:G.data)==null?void 0:oe.msg)||w.message||`Failed to ${o?"update":"add"} link.`;ge.error(y)}finally{z(!1)}},W=a=>{console.error("Form validation errors:",a),ge.error("Please correct the errors highlighted in the form.")};return!ne||!T||!["admin","super_admin"].includes(T)?null:e.jsxs("form",{onSubmit:ae(Se,W),className:"space-y-6 bg-white dark:bg-gray-800 dark:border-gray-700 p-6 rounded-lg shadow-md border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:[" ",o?"Edit Link":"Add New Link"," "]}),o&&U&&e.jsx("button",{type:"button",onClick:U,className:"text-sm text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",children:" Cancel "})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectedSoftwareId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Software Product*"}),E&&!K.length?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading software..."}):e.jsxs("select",{id:"selectedSoftwareId",...u("selectedSoftwareId"),disabled:k||E&&!K.length,className:`mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md ${d.selectedSoftwareId?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`,children:[e.jsx("option",{value:"",disabled:!0,children:"Select Software Product"}),K.map(a=>e.jsx("option",{value:a.id.toString(),children:a.name},a.id))]}),d.selectedSoftwareId&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.selectedSoftwareId.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectedVersionId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Version*"}),e.jsx("div",{className:"mt-1",children:e.jsxs("select",{id:"selectedVersionId",...u("selectedVersionId"),disabled:k||E||!h,className:`block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md ${d.selectedVersionId?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`,children:[e.jsx("option",{value:"",disabled:C.length>0&&!!h,children:E&&h?"Loading versions...":"Select Existing Version"}),C.map(a=>e.jsx("option",{value:a.id.toString(),children:a.version_number},a.id)),e.jsx("option",{value:Y,children:"Enter New Version String..."})]})}),Z&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"typedVersionString",className:"block text-xs font-medium text-gray-600 dark:text-gray-400",children:"New Version String*:"}),e.jsx("input",{type:"text",id:"typedVersionString",...u("typedVersionString"),placeholder:"e.g., 1.2.4-final",className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.typedVersionString?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"This version will be created for the selected software if it doesn't exist."})]}),d.selectedVersionId&&!Z&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.selectedVersionId.message}),d.typedVersionString&&Z&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.typedVersionString.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Link Title*"}),e.jsx("input",{type:"text",id:"title",...u("title"),disabled:k,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.title?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),d.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.title.message})]}),e.jsxs("div",{className:"my-4",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Link Source:"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",...u("inputMode"),value:"url",className:"form-radio h-4 w-4 text-blue-600",disabled:k}),e.jsxs("span",{className:"flex items-center dark:text-gray-300",children:[e.jsx(st,{size:16,className:"mr-1 text-gray-600 dark:text-gray-400"}),"Provide External URL"]})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",...u("inputMode"),value:"upload",className:"form-radio h-4 w-4 text-blue-600",disabled:k}),e.jsxs("span",{className:"flex items-center dark:text-gray-300",children:[e.jsx(Bt,{size:16,className:"mr-1 text-gray-600 dark:text-gray-400"}),"Upload File for this Link"]})]})]}),d.inputMode&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.inputMode.message})]}),fe==="url"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"externalUrl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Link URL*"}),e.jsx("input",{type:"url",id:"externalUrl",...u("externalUrl"),placeholder:"https://example.com/resource",disabled:k,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.externalUrl?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),d.externalUrl&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.externalUrl.message})]}),fe==="upload"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o&&q&&!A?"Replace File (Optional)":"Select File to Upload*"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-blue-500 dark:border-gray-600 dark:hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(Je,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500"}),e.jsxs("div",{className:"flex text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("label",{htmlFor:"link-file-upload-input",className:"relative cursor-pointer bg-white dark:bg-gray-800 rounded-md font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500",children:[e.jsx("span",{children:A?"Change file":"Upload a file"}),e.jsx("input",{id:"link-file-upload-input",name:"file-input-element",type:"file",className:"sr-only",onChange:pe,ref:I,disabled:k})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Any file type relevant for links."})]})}),(A||o&&q)&&e.jsxs("div",{className:"mt-3 flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden",children:[e.jsx(Je,{size:18,className:"text-gray-500 dark:text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:A?A.name:q}),o&&q&&!A&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:"(current)"})]}),A&&e.jsx("button",{type:"button",onClick:$,disabled:k,className:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-200 dark:text-gray-500 dark:hover:text-gray-300 dark:hover:bg-gray-600",children:e.jsx(Nt,{size:16})})]}),d.selectedFile&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.selectedFile.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Description"}),e.jsx("textarea",{id:"description",rows:3,...u("description"),disabled:k,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.description?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),d.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.description.message})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"submit",disabled:k||E,className:"flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:k?o?"Updating...":"Adding...":o?"Update Link":"Add Link"}),o&&U&&e.jsx("button",{type:"button",onClick:U,disabled:k,className:"flex-1 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 dark:border-gray-500 dark:text-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600",children:"Cancel"})]})]})},ms=()=>{const{searchTerm:r,setSearchTerm:S}=Ct(),{isAuthenticated:x,user:U}=et(),o=U==null?void 0:U.role,[u,ae]=s.useState([]),[J,d]=s.useState([]),[P,g]=s.useState([]),[f,K]=s.useState(null),[F,C]=s.useState(null),[N,q]=s.useState(""),[V,k]=s.useState(""),[z,E]=s.useState(""),[M,ne]=s.useState(""),[R,T]=s.useState(""),[I,h]=s.useState(1),[le,fe]=s.useState(15),[A,Z]=s.useState(0),[he,pe]=s.useState(0),[$,Se]=s.useState("title"),[W,a]=s.useState("asc"),[j,L]=s.useState(!0),[H,ie]=s.useState(null),[Q,G]=s.useState(!1),[oe,w]=s.useState(null),[y,Ce]=s.useState(!1),[ee,Ve]=s.useState(null),[Me,Ae]=s.useState(!1),[de,ce]=s.useState(new Map),[De,rt]=s.useState(!1),[p,me]=s.useState(new Set),[Ue,Pe]=s.useState(!1),[at,ze]=s.useState(!1),[te,Ee]=s.useState(!1),[Re,be]=s.useState(!1),[D,je]=s.useState(null),[$e,Oe]=s.useState([]),[ye,ke]=s.useState(void 0),[Be,Ne]=s.useState(!1),[Le,qe]=s.useState(!1),[v,ue]=s.useState(null),we=s.useRef(null),Te=Vt(),Ie=s.useMemo(()=>f!==null||F!==null||N!==""||V!==""||z!==""||r!=="",[f,F,N,V,z,r]),We=s.useCallback(()=>{K(null),C(null),q(""),k(""),E(""),S&&S(""),h(1)},[S]),_=s.useCallback(async(t,n=!1)=>{var i,c;n&&L(!0),ie(null);try{const l=await Mt(f||void 0,F||void 0,t,le,$,W,N||void 0,M||void 0,R||void 0);ae(l.links),Z(l.total_pages),pe(l.total_links),h(l.page),fe(l.per_page);const m=new Map;x&&l.links&&l.links.forEach(xe=>m.set(xe.id,{favoriteId:xe.favorite_id})),ce(m)}catch(l){const m=((c=(i=l.response)==null?void 0:i.data)==null?void 0:c.msg)||l.message||"Failed to fetch links.";n?(ie(m),ae([]),Z(0),pe(0)):b(m)}finally{n&&L(!1)}},[f,F,le,$,W,N,M,R,x]);s.useEffect(()=>{const t=setTimeout(()=>ne(V),500);return()=>clearTimeout(t)},[V]),s.useEffect(()=>{const t=setTimeout(()=>T(z),500);return()=>clearTimeout(t)},[z]),s.useEffect(()=>{x?tt().then(d).catch(t=>b("Failed to load software list.")):d([])},[x]),s.useEffect(()=>{x?_(1,!0):(ae([]),L(!1))},[x,f,F,$,W,N,M,R,r,_]),s.useEffect(()=>{me(new Set)},[f,F,$,W,N,M,R,r,I]),s.useEffect(()=>{f?ve(f).then(g).catch(()=>{b("Failed to load versions for filter."),g([])}):g([])},[f]),s.useEffect(()=>{const t=new URLSearchParams(Te.search),n=t.get("item_id"),i=t.get("comment_id");if(n&&i&&u.length>0){const c=parseInt(n,10);if(!isNaN(c)){const l=u.find(m=>m.id===c);l?((!v||v.id!==l.id)&&ue(l),setTimeout(()=>{var m;(m=we.current)==null||m.scrollIntoView({behavior:"smooth",block:"center"})},100)):console.warn(`LinksView: Link with item_id ${c} not found in the current list.`)}}},[Te.search,u,v]),s.useEffect(()=>{D?(qe(!0),ve(D).then(Oe).catch(()=>b("Failed to load versions for move.")).finally(()=>qe(!1))):Oe([])},[D]);const nt=t=>{K(t),C(null),h(1)},lt=t=>{C(t.target.value?parseInt(t.target.value):null),h(1)},it=t=>{h(t),_(t,!0)},ot=t=>{Se(t),a(n=>$===t&&n==="asc"?"desc":"asc"),h(1)},dt=()=>{h(1),_(1,!0)},He=async t=>{if(G(!1),w(null),B(t),await _(1,!0),f)try{const n=await ve(f);g(n)}catch(n){console.error("Error refreshing version list after operation:",n),b("Failed to refresh version list for the current software filter.")}},ct=()=>{w(null),G(!0)},mt=t=>{w(t),G(!0)},Ge=()=>{w(null),G(!1)},ut=t=>{Ve(t),Ce(!0)},_e=()=>{Ve(null),Ce(!1)},xt=async()=>{if(ee){Ae(!0),v&&v.id===ee.id&&ue(null);try{await Pt(ee.id),B(`Link "${ee.title}" deleted.`),_e(),_(1,!0)}catch(t){b(t.message||"Delete failed."),_e()}finally{Ae(!1)}}},Xe=s.useMemo(()=>{if(!r)return u;const t=r.toLowerCase();return u.filter(n=>n.title.toLowerCase().includes(t)||(n.description||"").toLowerCase().includes(t)||(n.software_name||"").toLowerCase().includes(t)||(n.version_name||"").toLowerCase().includes(t))},[u,r]),gt=(t,n)=>me(i=>{const c=new Set(i);return n?c.add(t):c.delete(t),c}),ft=t=>{const n=new Set;t&&Xe.forEach(i=>n.add(i.id)),me(n)},ht=()=>{if(p.size===0){b("No items selected.");return}Ne(!0)},pt=async()=>{Ne(!1),Pe(!0),v&&p.has(v.id)&&ue(null);try{const t=await zt(Array.from(p),"link");B(t.msg||`${t.deleted_count} link(s) deleted.`),me(new Set),_(1,!0)}catch(t){b(t.message||"Bulk delete failed.")}finally{Pe(!1)}},Ye=s.useMemo(()=>u.filter(t=>p.has(t.id)&&!t.is_external_link&&t.stored_filename).length,[u,p]),bt=async()=>{if(p.size===0){b("No items selected.");return}const t=u.filter(i=>p.has(i.id)&&!i.is_external_link&&i.stored_filename);if(t.length===0){b("No downloadable files among selected links. External links or links without files cannot be bulk downloaded.");return}const n=t.map(i=>i.id);n.length<p.size&&B(`Starting download for ${n.length} file-based links. External links were excluded.`),ze(!0);try{const i=await Dt(n,"link"),c=URL.createObjectURL(i),l=document.createElement("a");l.href=c;const m=new Date().toISOString().replace(/:/g,"-");l.download=`bulk_download_links_${m}.zip`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(c),n.length===p.size&&B("Download started.")}catch(i){b(i.message||"Bulk download failed.")}finally{ze(!1)}},yt=()=>{if(p.size===0){b("No items selected.");return}if(J.length===0){b("Software list unavailable.");return}je(null),ke(void 0),be(!0)},kt=async()=>{if(!D){b("Select target software.");return}be(!1),Ee(!0);const t={target_software_id:D};ye!==void 0&&(t.target_version_id=ye);try{const n=await Et(Array.from(p),"link",t);B(n.msg||`${n.moved_count} link(s) moved.`),me(new Set),_(1,!0)}catch(n){b(n.message||"Bulk move failed.")}finally{Ee(!1),je(null),ke(void 0)}},wt=[{key:"title",header:"Title",sortable:!0},{key:"software_name",header:"Software",sortable:!0},{key:"version_name",header:"Version",sortable:!0,render:t=>t.version_name||"N/A"},{key:"description",header:"Description",render:t=>e.jsx("span",{className:"text-sm text-gray-600 block max-w-xs truncate",title:t.description||"",children:t.description||"-"})},{key:"url",header:"URL/File",render:t=>{var c,l;const n=t.is_external_link||t.is_downloadable!==!1,i=t.is_external_link?t.url.length>40?`${t.url.substring(0,37)}...`:t.url:t.original_filename_ref||t.url.split("/").pop()||"Uploaded File";return!n&&!t.is_external_link?e.jsxs("span",{className:"flex items-center text-gray-400 cursor-not-allowed",title:"Download not permitted",children:[t.is_external_link?e.jsx(Qe,{size:14,className:"mr-1 flex-shrink-0"}):e.jsx(Fe,{size:14,className:"mr-1 flex-shrink-0"}),i]}):e.jsxs("a",{href:t.url,target:t.is_external_link||!((c=t.url)!=null&&c.startsWith("/"))?"_blank":"_self",rel:"noopener noreferrer",className:`flex items-center ${n?"text-blue-600 hover:text-blue-800":"text-gray-400 cursor-not-allowed"}`,onClick:m=>{n||m.preventDefault(),m.stopPropagation()},title:n?t.is_external_link?"Open external link":"Download file":"Download not permitted",children:[t.is_external_link||!((l=t.url)!=null&&l.startsWith("/"))?e.jsx(Qe,{size:14,className:"mr-1 flex-shrink-0"}):e.jsx(Fe,{size:14,className:"mr-1 flex-shrink-0"}),i]})}},{key:"uploaded_by_username",header:"Added By",sortable:!0,render:t=>t.uploaded_by_username||"N/A"},{key:"updated_by_username",header:"Updated By",sortable:!1,render:t=>t.updated_by_username||"N/A"},{key:"created_at",header:"Created",sortable:!0,render:t=>t.created_at?new Date(t.created_at).toLocaleDateString("en-CA"):"-"},{key:"updated_at",header:"Updated",sortable:!0,render:t=>t.updated_at?new Date(t.updated_at).toLocaleDateString("en-CA"):"-"},{key:"actions",header:"Actions",render:t=>{var n,i,c;return e.jsxs("div",{className:"flex space-x-1 items-center",children:[x&&e.jsx("button",{onClick:l=>{l.stopPropagation(),St(t,"link")},className:`p-1 rounded-md ${(n=de.get(t.id))!=null&&n.favoriteId?"text-yellow-500 hover:text-yellow-600":"text-gray-400 hover:text-yellow-500"}`,title:(i=de.get(t.id))!=null&&i.favoriteId?"Remove Favorite":"Add Favorite",children:e.jsx(Ut,{size:16,className:(c=de.get(t.id))!=null&&c.favoriteId?"fill-current":""})}),x&&e.jsxs("button",{onClick:l=>{l.stopPropagation(),v&&v.id===t.id?ue(null):(ue(t),setTimeout(()=>{var m;return(m=we.current)==null?void 0:m.scrollIntoView({behavior:"smooth"})},0))},className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 rounded-md",title:v&&v.id===t.id?"Hide Comments":"View Comments",children:[e.jsx(Jt,{size:16}),e.jsxs("span",{className:"ml-1 text-xs",children:["(",t.comment_count??0,")"]})]}),(o==="admin"||o==="super_admin")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),mt(t)},className:"p-1 text-blue-600 hover:text-blue-800 rounded-md",title:"Edit",children:e.jsx(Kt,{size:16})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),ut(t)},className:"p-1 text-red-600 hover:text-red-800 rounded-md",title:"Delete",children:e.jsx(Ke,{size:16})})]})]})}}],vt=s.useCallback(()=>{_(1,!0)},[_]),St=async(t,n)=>{var m,xe;if(!x){b("Please log in to manage favorites.");return}const i=de.get(t.id),c=!!(i!=null&&i.favoriteId),l=new Map(de);c?l.set(t.id,{favoriteId:void 0}):l.set(t.id,{favoriteId:-1}),ce(l);try{if(c&&typeof(i==null?void 0:i.favoriteId)=="number")await Rt(t.id,n),B(`"${t.title}" removed from favorites.`),ce(O=>{const se=new Map(O);return se.set(t.id,{favoriteId:void 0}),se});else{const O=await $t(t.id,n);ce(se=>{const re=new Map(se);return re.set(t.id,{favoriteId:O.id}),re}),B(`"${t.title}" added to favorites.`)}}catch(O){b(((xe=(m=O==null?void 0:O.response)==null?void 0:m.data)==null?void 0:xe.msg)||O.message||"Failed to update favorite."),ce(se=>{const re=new Map(se);return c?re.set(t.id,{favoriteId:i==null?void 0:i.favoriteId}):re.set(t.id,{favoriteId:void 0}),re})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start sm:items-center mb-6 flex-col sm:flex-row",children:[e.jsxs("div",{children:[" ",e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Links"})," ",e.jsx("p",{className:"text-gray-600 mt-1 dark:text-gray-300",children:"Manage and browse useful links and resources."})," "]}),x&&(o==="admin"||o==="super_admin")&&!oe&&e.jsxs("button",{onClick:()=>{Q?Ge():ct()},className:"mt-4 sm:mt-0 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(Ht,{size:18,className:"mr-2"})," ",Q?"Cancel":"Add New Link"]})]}),Q&&e.jsx("div",{className:"my-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg shadow",children:e.jsx(as,{linkToEdit:oe,onLinkAdded:()=>He("Link added."),onLinkUpdated:()=>He("Link updated."),onCancelEdit:Ge})}),p.size>0&&e.jsx("div",{className:"my-4 p-3 bg-gray-100 dark:bg-gray-700 rounded-md shadow-sm border border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:[p.size," item(s) selected"]}),(o==="admin"||o==="super_admin")&&e.jsxs("button",{onClick:ht,disabled:Ue,className:"btn-danger-xs flex items-center",children:[e.jsx(Ke,{size:14,className:"mr-1.5"}),"Delete"]}),x&&e.jsxs("button",{onClick:bt,disabled:at||Ye===0,className:"btn-success-xs flex items-center",children:[e.jsx(Fe,{size:14,className:"mr-1.5"}),"Download (",Ye,")"]}),(o==="admin"||o==="super_admin")&&e.jsxs("button",{onClick:yt,disabled:te,className:"btn-warning-xs flex items-center",children:[e.jsx(Gt,{size:14,className:"mr-1.5"}),"Move"]})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end md:gap-4",children:[J.length>0&&e.jsx(ts,{software:J,selectedSoftwareId:f,onSelectFilter:nt}),f&&e.jsxs("div",{className:"flex flex-col min-w-[200px] mt-4 md:mt-0",children:[" ",e.jsx("label",{htmlFor:"versionFilterLinks",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Version"}),e.jsxs("select",{id:"versionFilterLinks",value:F||"",onChange:lt,className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200",disabled:P.length===0,children:[e.jsx("option",{value:"",children:"All Versions"}),P.map(t=>e.jsx("option",{value:t.id,children:t.version_number},t.id))]})]})]}),e.jsxs("div",{className:"mb-4 mt-0",children:[" ",e.jsxs("button",{onClick:()=>rt(t=>!t),className:"flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-md text-sm font-medium",children:[De?e.jsx(Zt,{size:18,className:"mr-1.5"}):e.jsx(Xt,{size:18,className:"mr-1.5"})," Advanced Filters"]})]}),De&&e.jsxs("div",{className:"my-4 p-4 border dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 space-y-4 md:space-y-0 md:flex md:flex-wrap md:items-end md:gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"linkTypeFilterSelect",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Link Type"}),e.jsxs("select",{id:"linkTypeFilterSelect",value:N,onChange:t=>q(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200",children:[e.jsx("option",{value:"",children:"All"})," ",e.jsx("option",{value:"external",children:"External URL"})," ",e.jsx("option",{value:"uploaded",children:"Uploaded File"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Created Between"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:V,onChange:t=>k(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"to"}),e.jsx("input",{type:"date",value:z,onChange:t=>E(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"})]})]}),e.jsxs("div",{className:"flex items-end gap-2 pt-5",children:[e.jsx("button",{onClick:dt,className:"text-sm px-4 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Apply"}),e.jsx("button",{onClick:We,className:"text-sm px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Clear All"})]})]}),j?e.jsx("div",{className:"py-10",children:e.jsx(At,{message:"Loading links..."})}):H&&u.length===0&&!j?e.jsx(ss,{message:H,onRetry:vt}):!j&&!H&&u.length===0?e.jsxs("div",{className:"text-center py-10 bg-white dark:bg-gray-800 rounded-lg shadow-sm my-6",children:[e.jsx(st,{size:48,className:"mx-auto text-yellow-500 dark:text-yellow-400 mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-700 dark:text-gray-200 mb-3",children:Ie?"No Links Found Matching Criteria":"No Links Available"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 px-4",children:Ie?"Try adjusting or clearing your search/filter settings.":o==="admin"||o==="super_admin"?"Add new links to get started.":"Please check back later."}),Ie&&e.jsx("button",{onClick:We,className:"mt-6 btn-primary text-sm",children:"Clear All Filters & Search"})]}):e.jsx(Qt,{columns:wt,data:Xe,rowClassName:"group",isLoading:j||Me,currentPage:I,totalPages:A,onPageChange:it,itemsPerPage:le,totalItems:he,sortColumn:$,sortOrder:W,onSort:ot,isSelectionEnabled:!0,selectedItemIds:p,onSelectItem:gt,onSelectAllItems:ft}),y&&ee&&e.jsx(Ze,{isOpen:y,title:"Delete Link",message:`Delete "${ee.title}"?`,onConfirm:xt,onCancel:_e,isConfirming:Me,confirmButtonText:"Delete",confirmButtonVariant:"danger"}),Be&&e.jsx(Ze,{isOpen:Be,title:`Delete ${p.size} Link(s)`,message:`Delete ${p.size} selected items?`,onConfirm:pt,onCancel:()=>Ne(!1),isConfirming:Ue,confirmButtonText:"Delete Selected",confirmButtonVariant:"danger"}),Re&&e.jsx(es,{isOpen:Re,onClose:()=>be(!1),title:`Move ${p.size} Link(s)`,children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:"Select target Software and optionally a Version:"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"modalSoftwareMoveLinks",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Target Software*"}),e.jsxs("select",{id:"modalSoftwareMoveLinks",value:D??"",onChange:t=>{je(t.target.value?parseInt(t.target.value):null),ke(void 0)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200",disabled:te||J.length===0,children:[e.jsx("option",{value:"",children:"Select Software..."}),J.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),D&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"modalVersionMoveLinks",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Target Version (Optional)"}),e.jsxs("select",{id:"modalVersionMoveLinks",value:ye===null?"NULL_VERSION":ye??"",onChange:t=>ke(t.target.value==="NULL_VERSION"?null:t.target.value?parseInt(t.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200",disabled:te||Le,children:[e.jsx("option",{value:"",children:Le?"Loading...":"Select Version (Optional)..."}),e.jsx("option",{value:"NULL_VERSION",children:"No Specific Version (Clear Association)"}),$e.map(t=>e.jsx("option",{value:t.id,children:t.version_number},t.id))]}),$e.length===0&&!Le&&D&&e.jsx("p",{className:"text-xs text-yellow-600 mt-1",children:"No versions for selected software. You can still move to the software without a specific version."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>be(!1),className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:te,children:"Cancel"}),e.jsx("button",{type:"button",onClick:kt,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:te||!D,children:te?"Moving...":"Confirm Move"})]})]})}),x&&v&&e.jsxs("div",{ref:we,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-4",children:["Comments for: ",e.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:v.title})]}),e.jsx(Yt,{itemId:v.id,itemType:"link"})]}),!x&&v&&e.jsx("div",{ref:we,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Please log in to view and manage comments."})})]})};export{ms as default};
