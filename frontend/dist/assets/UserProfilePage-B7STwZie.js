import{K as ae,u as te,r as a,j as e,a7 as oe,s as u,a8 as ne,a as h,a9 as de,aa as le,ab as ie}from"./index-_JQw1_U5.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=ae("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),me=()=>{var V,Z,G;const t=te(),Q="http://localhost:7000",[d,x]=a.useState(null),[w,f]=a.useState(null),[y,v]=a.useState(!1),[k,U]=a.useState(""),[l,S]=a.useState(""),[N,C]=a.useState(""),[E,c]=a.useState(null),[F,i]=a.useState(""),[_,A]=a.useState(null),[m,I]=a.useState(""),[j,L]=a.useState(""),[D,g]=a.useState(null),[R,q]=a.useState(null),[b,z]=a.useState(""),[P,$]=a.useState(""),[B,p]=a.useState(null),[M,T]=a.useState(null),[H,K]=a.useState(!1),W=async r=>{if(r.preventDefault(),p(null),T(null),!b||!P){p("New username and current password are required.");return}if(b.length<3){p("New username must be at least 3 characters long.");return}K(!0);try{const s=await ie({new_username:b,current_password:P});h(s.msg||"Username updated successfully!"),T(s.msg||"Username updated successfully!"),t&&t.updateAuthUsername?t.updateAuthUsername(s.new_username):console.warn("AuthContext does not have updateAuthUsername method. UI might not reflect new username immediately."),z("")}catch(s){u(s.message||"Failed to update username."),p(s.message||"Failed to update username.")}finally{$(""),K(!1)}};if(!t.isAuthenticated)return e.jsx(oe,{to:"/login",replace:!0});const O=r=>r.length<8?"Password must be at least 8 characters long.":/[A-Z]/.test(r)?/[a-z]/.test(r)?/[0-9]/.test(r)?"":"Password must include at least one digit.":"Password must include at least one lowercase letter.":"Password must include at least one uppercase letter.",X=r=>{const s=r.target.value;S(s);const o=O(s);i(o)},Y=async r=>{var o;r.preventDefault(),c(null),A(null);const s=O(l);if(s){i(s);return}else i("");if(!k||!l||!N){c("All password fields are required.");return}if(l!==N){c("New passwords do not match.");return}try{const n=await de({current_password:k,new_password:l});h(n.msg||"Password changed successfully!"),A(n.msg||"Password changed successfully!"),U(""),S(""),C(""),i("")}catch(n){const J=((o=n.message)==null?void 0:o.toLowerCase())||"";J.includes("password must")||J.includes("password should")?i(n.message):c(n.message||"Failed to change password."),u(n.message||"Failed to change password.")}},ee=async r=>{if(r.preventDefault(),g(null),q(null),!m||!j){g("Both email and password are required.");return}if(!/\S+@\S+\.\S+/.test(m)){g("Invalid email format.");return}try{const s=await le({new_email:m,password:j});h(s.msg||"Email updated successfully!"),q(s.msg||"Email updated successfully!"),I(""),L("")}catch(s){u(s.message||"Failed to update email."),g(s.message||"Failed to update email.")}},re=r=>{var o;const s=(o=r.target.files)==null?void 0:o[0];s?(x(s),f(URL.createObjectURL(s))):(x(null),f(null))},se=async()=>{if(!d){u("Please select a file first.");return}v(!0);const r=new FormData;r.append("profile_picture",d);try{const s=await ne(r);h(s.msg||"Profile picture updated successfully!"),t.user&&s.profile_picture_url&&t.updateUserProfilePictureUrl(s.profile_picture_url),x(null),f(null)}catch(s){u(s.message||"Failed to upload profile picture."),console.error("Profile picture upload error:",s)}finally{v(!1)}};return a.useEffect(()=>{var r;(r=t.user)!=null&&r.profile_picture_url},[(V=t.user)==null?void 0:V.profile_picture_url,w,d]),e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-8 text-gray-900 dark:text-white",children:"User Profile"}),e.jsxs("div",{className:"mb-8 p-6 bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Profile Picture"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("div",{className:"shrink-0",children:e.jsx("img",{className:"h-24 w-24 object-cover rounded-full",src:w||((Z=t.user)!=null&&Z.profile_picture_url?`${Q}${t.user.profile_picture_url}`:`https://ui-avatars.com/api/?name=${encodeURIComponent(((G=t.user)==null?void 0:G.username)||"User")}&background=random&size=128`),alt:"Profile"})}),e.jsxs("label",{htmlFor:"profile-picture-upload",className:"block",children:[e.jsx("span",{className:"sr-only",children:"Choose profile photo"}),e.jsx("input",{type:"file",id:"profile-picture-upload",accept:"image/png, image/jpeg, image/gif",onChange:re,className:`block w-full text-sm text-gray-500 dark:text-gray-400\r
                         file:mr-4 file:py-2 file:px-4\r
                         file:rounded-lg file:border-0\r
                         file:text-sm file:font-semibold\r
                         file:bg-indigo-50 dark:file:bg-indigo-800 file:text-indigo-600 dark:file:text-indigo-300\r
                         hover:file:bg-indigo-100 dark:hover:file:bg-indigo-700\r
                         disabled:opacity-50`,disabled:y})]})]}),d&&e.jsx("div",{className:"mt-4",children:e.jsxs("button",{onClick:se,disabled:y||!d,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:[y?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}):e.jsx(ue,{size:16,className:"mr-2"}),"Upload New Picture"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Change Password"}),E&&e.jsx("p",{className:"text-red-600 dark:text-red-300 bg-red-100 dark:bg-red-900 border border-red-300 dark:border-red-700 p-3 rounded mb-4",children:E}),_&&e.jsx("p",{className:"text-green-600 dark:text-green-300 bg-green-100 dark:bg-green-900 border border-green-300 dark:border-green-700 p-3 rounded mb-4",children:_}),e.jsxs("form",{onSubmit:Y,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"currentPassword",children:"Current Password"}),e.jsx("input",{type:"password",id:"currentPassword",value:k,onChange:r=>U(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"newPassword",children:"New Password"}),e.jsx("input",{type:"password",id:"newPassword",value:l,onChange:X,className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"}),F&&e.jsx("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:F})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"confirmNewPassword",children:"Confirm New Password"}),e.jsx("input",{type:"password",id:"confirmNewPassword",value:N,onChange:r=>C(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 mb-3 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsx("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Change Password"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Update Email"}),D&&e.jsx("p",{className:"text-red-600 dark:text-red-300 bg-red-100 dark:bg-red-900 border border-red-300 dark:border-red-700 p-3 rounded mb-4",children:D}),R&&e.jsx("p",{className:"text-green-600 dark:text-green-300 bg-green-100 dark:bg-green-900 border border-green-300 dark:border-green-700 p-3 rounded mb-4",children:R}),e.jsxs("form",{onSubmit:ee,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"newEmail",children:"New Email"}),e.jsx("input",{type:"email",id:"newEmail",value:m,onChange:r=>I(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"confirmPasswordForEmail",children:"Confirm Password"}),e.jsx("input",{type:"password",id:"confirmPasswordForEmail",value:j,onChange:r=>L(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 mb-3 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsx("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Update Email"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Change Username"}),B&&e.jsx("p",{className:"text-red-600 dark:text-red-300 bg-red-100 dark:bg-red-900 border border-red-300 dark:border-red-700 p-3 rounded mb-4",children:B}),M&&e.jsx("p",{className:"text-green-600 dark:text-green-300 bg-green-100 dark:bg-green-900 border border-green-300 dark:border-green-700 p-3 rounded mb-4",children:M}),e.jsxs("form",{onSubmit:W,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"newUsername",children:"New Username"}),e.jsx("input",{type:"text",id:"newUsername",value:b,onChange:r=>z(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"currentPasswordForUsername",children:"Current Password"}),e.jsx("input",{type:"password",id:"currentPasswordForUsername",value:P,onChange:r=>$(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 mb-3 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsx("button",{type:"submit",disabled:H,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline disabled:opacity-50",children:H?"Changing...":"Change Username"})]})]})]})]})};export{me as default};
