import{K as ce,u as we,r as t,j as e,a7 as ye,s as u,a8 as ke,a as p,a9 as Ne,aa as Pe,ab as je}from"./index-BsMkM1Ju.js";import{P as le}from"./plus-circle-BGV8Mm6J.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=ce("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=ce("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Ce=async()=>(console.log("API CALL: getUserWatchPreferences"),await new Promise(o=>setTimeout(o,500)),[]),Ue=async o=>(console.log("API CALL: updateUserWatchPreferences with data:",o),await new Promise(g=>setTimeout(g,500)),{message:"Preferences updated successfully",updated_preferences:o.filter(g=>g.watch).map(({watch:g,...i})=>i)}),Ee=()=>{var ae,te,ne;const o=we(),g="http://localhost:7000",[i,P]=t.useState(null),[j,v]=t.useState(null),[C,A]=t.useState(!1),[U,W]=t.useState(""),[m,I]=t.useState(""),[S,L]=t.useState(""),[M,f]=t.useState(null),[z,h]=t.useState(""),[V,D]=t.useState(null),[x,O]=t.useState(""),[_,R]=t.useState(""),[q,w]=t.useState(null),[$,T]=t.useState(null),[y,B]=t.useState(""),[E,G]=t.useState(""),[H,k]=t.useState(null),[Z,J]=t.useState(null),[Q,X]=t.useState(!1),[c,N]=t.useState([]),[ue,Y]=t.useState(!0),[F,K]=t.useState(!1),ee={documents:{displayName:"Documents",categories:["VA","VMS","ICCC","Analytic Manager","ITMS"]},patches:{displayName:"Patches",categories:["VA","VMS","ICCC","Analytic Manager","ITMS"]},links:{displayName:"Links",categories:["VA","VMS","ICCC","Analytic Manager","ITMS"]},misc:{displayName:"Miscellaneous",categories:null}};t.useEffect(()=>{(async()=>{Y(!0);try{const s=await Ce();N(s)}catch(s){u(s.message||"Failed to load watch preferences.")}finally{Y(!1)}})()},[]);const re=async(r,s,a)=>{K(!0);const n=!a;let d;n?d=[...c,{content_type:r,category:s}]:d=c.filter(l=>!(l.content_type===r&&l.category===s)),N(d);const xe=Object.entries(ee).flatMap(([l,oe])=>oe.categories?oe.categories.map(b=>({content_type:l,category:b,watch:d.some(de=>de.content_type===l&&de.category===b)})):[{content_type:l,watch:d.some(b=>b.content_type===l&&!b.category)}]);try{const l=await Ue(xe);N(l.updated_preferences||d),p(l.message||"Watch preferences updated.")}catch(l){u(l.message||"Failed to update watch preferences."),N(c)}finally{K(!1)}},ge=async r=>{if(r.preventDefault(),k(null),J(null),!y||!E){k("New username and current password are required.");return}if(y.length<3){k("New username must be at least 3 characters long.");return}X(!0);try{const s=await je({new_username:y,current_password:E});p(s.msg||"Username updated successfully!"),J(s.msg||"Username updated successfully!"),o&&o.updateAuthUsername?o.updateAuthUsername(s.new_username):console.warn("AuthContext does not have updateAuthUsername method. UI might not reflect new username immediately."),B("")}catch(s){u(s.message||"Failed to update username."),k(s.message||"Failed to update username.")}finally{G(""),X(!1)}};if(!o.isAuthenticated)return e.jsx(ye,{to:"/login",replace:!0});const se=r=>r.length<8?"Password must be at least 8 characters long.":/[A-Z]/.test(r)?/[a-z]/.test(r)?/[0-9]/.test(r)?"":"Password must include at least one digit.":"Password must include at least one lowercase letter.":"Password must include at least one uppercase letter.",me=r=>{const s=r.target.value;I(s);const a=se(s);h(a)},he=async r=>{var a;r.preventDefault(),f(null),D(null);const s=se(m);if(s){h(s);return}else h("");if(!U||!m||!S){f("All password fields are required.");return}if(m!==S){f("New passwords do not match.");return}try{const n=await Ne({current_password:U,new_password:m});p(n.msg||"Password changed successfully!"),D(n.msg||"Password changed successfully!"),W(""),I(""),L(""),h("")}catch(n){const d=((a=n.message)==null?void 0:a.toLowerCase())||"";d.includes("password must")||d.includes("password should")?h(n.message):f(n.message||"Failed to change password."),u(n.message||"Failed to change password.")}},be=async r=>{if(r.preventDefault(),w(null),T(null),!x||!_){w("Both email and password are required.");return}if(!/\S+@\S+\.\S+/.test(x)){w("Invalid email format.");return}try{const s=await Pe({new_email:x,password:_});p(s.msg||"Email updated successfully!"),T(s.msg||"Email updated successfully!"),O(""),R("")}catch(s){u(s.message||"Failed to update email."),w(s.message||"Failed to update email.")}},pe=r=>{var a;const s=(a=r.target.files)==null?void 0:a[0];s?(P(s),v(URL.createObjectURL(s))):(P(null),v(null))},fe=async()=>{if(!i){u("Please select a file first.");return}A(!0);const r=new FormData;r.append("profile_picture",i);try{const s=await ke(r);p(s.msg||"Profile picture updated successfully!"),o.user&&s.profile_picture_url&&o.updateUserProfilePictureUrl(s.profile_picture_url),P(null),v(null)}catch(s){u(s.message||"Failed to upload profile picture."),console.error("Profile picture upload error:",s)}finally{A(!1)}};return t.useEffect(()=>{var r;(r=o.user)!=null&&r.profile_picture_url},[(ae=o.user)==null?void 0:ae.profile_picture_url,j,i]),e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-8 text-gray-900 dark:text-white",children:"User Profile"}),e.jsxs("div",{className:"mb-8 p-6 bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Profile Picture"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("div",{className:"shrink-0",children:e.jsx("img",{className:"h-24 w-24 object-cover rounded-full",src:j||((te=o.user)!=null&&te.profile_picture_url?`${g}${o.user.profile_picture_url}`:`https://ui-avatars.com/api/?name=${encodeURIComponent(((ne=o.user)==null?void 0:ne.username)||"User")}&background=random&size=128`),alt:"Profile"})}),e.jsxs("label",{htmlFor:"profile-picture-upload",className:"block",children:[e.jsx("span",{className:"sr-only",children:"Choose profile photo"}),e.jsx("input",{type:"file",id:"profile-picture-upload",accept:"image/png, image/jpeg, image/gif",onChange:pe,className:`block w-full text-sm text-gray-500 dark:text-gray-400\r
                         file:mr-4 file:py-2 file:px-4\r
                         file:rounded-lg file:border-0\r
                         file:text-sm file:font-semibold\r
                         file:bg-indigo-50 dark:file:bg-indigo-800 file:text-indigo-600 dark:file:text-indigo-300\r
                         hover:file:bg-indigo-100 dark:hover:file:bg-indigo-700\r
                         disabled:opacity-50`,disabled:C})]})]}),i&&e.jsx("div",{className:"mt-4",children:e.jsxs("button",{onClick:fe,disabled:C||!i,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:[C?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}):e.jsx(ve,{size:16,className:"mr-2"}),"Upload New Picture"]})})]}),e.jsxs("div",{className:"mb-8 p-6 bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Watch Preferences"}),ue?e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:"Loading watch preferences..."}):e.jsxs("div",{className:"space-y-6",children:[Object.entries(ee).map(([r,s])=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-200 mb-2",children:s.displayName}),s.categories?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2",children:s.categories.map(a=>{const n=c.some(d=>d.content_type===r&&d.category===a);return e.jsxs("button",{onClick:()=>re(r,a,n),className:`w-full flex items-center justify-center px-3 py-2 border text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-1
                                        ${n?"bg-green-600 hover:bg-green-700 text-white border-transparent focus:ring-green-500":"bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600 border-gray-300 dark:border-gray-500 focus:ring-indigo-500"} transition-colors duration-150 ease-in-out`,disabled:F,children:[n?e.jsx(ie,{size:16,className:"mr-2"}):e.jsx(le,{size:16,className:"mr-2"}),n?"Watching":"Watch"," ",e.jsxs("span",{className:"ml-1 font-normal hidden sm:inline",children:["- ",a]})]},a)})}):e.jsxs("button",{onClick:()=>{const a=c.some(n=>n.content_type===r&&!n.category);re(r,void 0,a)},className:`w-auto flex items-center justify-center px-4 py-2 border text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-1
                                  ${c.some(a=>a.content_type===r&&!a.category)?"bg-green-600 hover:bg-green-700 text-white border-transparent focus:ring-green-500":"bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600 border-gray-300 dark:border-gray-500 focus:ring-indigo-500"} transition-colors duration-150 ease-in-out`,disabled:F,children:[c.some(a=>a.content_type===r&&!a.category)?e.jsx(ie,{size:16,className:"mr-2"}):e.jsx(le,{size:16,className:"mr-2"}),c.some(a=>a.content_type===r&&!a.category)?"Watching":"Watch General"]})]},r)),F&&e.jsxs("div",{className:"mt-4 flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-indigo-500 mr-2"}),"Saving preferences..."]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Change Password"}),M&&e.jsx("p",{className:"text-red-600 dark:text-red-300 bg-red-100 dark:bg-red-900 border border-red-300 dark:border-red-700 p-3 rounded mb-4",children:M}),V&&e.jsx("p",{className:"text-green-600 dark:text-green-300 bg-green-100 dark:bg-green-900 border border-green-300 dark:border-green-700 p-3 rounded mb-4",children:V}),e.jsxs("form",{onSubmit:he,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"currentPassword",children:"Current Password"}),e.jsx("input",{type:"password",id:"currentPassword",value:U,onChange:r=>W(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"newPassword",children:"New Password"}),e.jsx("input",{type:"password",id:"newPassword",value:m,onChange:me,className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"}),z&&e.jsx("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:z})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"confirmNewPassword",children:"Confirm New Password"}),e.jsx("input",{type:"password",id:"confirmNewPassword",value:S,onChange:r=>L(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 mb-3 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsx("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Change Password"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Update Email"}),q&&e.jsx("p",{className:"text-red-600 dark:text-red-300 bg-red-100 dark:bg-red-900 border border-red-300 dark:border-red-700 p-3 rounded mb-4",children:q}),$&&e.jsx("p",{className:"text-green-600 dark:text-green-300 bg-green-100 dark:bg-green-900 border border-green-300 dark:border-green-700 p-3 rounded mb-4",children:$}),e.jsxs("form",{onSubmit:be,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"newEmail",children:"New Email"}),e.jsx("input",{type:"email",id:"newEmail",value:x,onChange:r=>O(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"confirmPasswordForEmail",children:"Confirm Password"}),e.jsx("input",{type:"password",id:"confirmPasswordForEmail",value:_,onChange:r=>R(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 mb-3 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsx("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Update Email"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Change Username"}),H&&e.jsx("p",{className:"text-red-600 dark:text-red-300 bg-red-100 dark:bg-red-900 border border-red-300 dark:border-red-700 p-3 rounded mb-4",children:H}),Z&&e.jsx("p",{className:"text-green-600 dark:text-green-300 bg-green-100 dark:bg-green-900 border border-green-300 dark:border-green-700 p-3 rounded mb-4",children:Z}),e.jsxs("form",{onSubmit:ge,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"newUsername",children:"New Username"}),e.jsx("input",{type:"text",id:"newUsername",value:y,onChange:r=>B(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"currentPasswordForUsername",children:"Current Password"}),e.jsx("input",{type:"password",id:"currentPasswordForUsername",value:E,onChange:r=>G(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 mb-3 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsx("button",{type:"submit",disabled:Q,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline disabled:opacity-50",children:Q?"Changing...":"Change Username"})]})]})]})]})};export{Ee as default};
