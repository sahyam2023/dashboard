import{T as te,u as he,ac as be,r as a,j as e,ad as xe,s as u,ae as pe,a as w,af as fe,ag as we,ah as ye}from"./index-C33pLru1.js";import{M as ke}from"./Modal-CHHjrBd5.js";import{P as se}from"./plus-circle-DF08xboe.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=te("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=te("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Ce=()=>{var Y,K,ee;const o=he(),{watchPreferences:g,isLoading:m,updatePreference:ne,isWatching:l}=be(),oe="http://localhost:7000",[d,y]=a.useState(null),[k,N]=a.useState(null),[j,S]=a.useState(!1),[E,F]=a.useState(!1),[v,_]=a.useState(""),[i,M]=a.useState(""),[P,A]=a.useState(""),[W,h]=a.useState(null),[I,c]=a.useState(""),[L,z]=a.useState(null),[b,V]=a.useState(""),[C,O]=a.useState(""),[D,x]=a.useState(null),[q,R]=a.useState(null),[p,$]=a.useState(""),[U,T]=a.useState(""),[B,f]=a.useState(null),[G,H]=a.useState(null),[Z,J]=a.useState(!1),de={documents:{displayName:"Documents",categories:["VA","VMS","ICCC","Analytic Manager","ITMS"]},patches:{displayName:"Patches",categories:["VA","VMS","ICCC","Analytic Manager","ITMS"]},links:{displayName:"Links",categories:["VA","VMS","ICCC","Analytic Manager","ITMS"]},misc:{displayName:"Miscellaneous",categories:null}},Q=async(r,s,t)=>{await ne(r,s??null,!t)},le=async r=>{if(r.preventDefault(),f(null),H(null),!p||!U){f("New username and current password are required.");return}if(p.length<3){f("New username must be at least 3 characters long.");return}J(!0);try{const s=await ye({new_username:p,current_password:U});w(s.msg||"Username updated successfully!"),H(s.msg||"Username updated successfully!"),o&&o.updateAuthUsername?o.updateAuthUsername(s.new_username):console.warn("AuthContext does not have updateAuthUsername method. UI might not reflect new username immediately."),$("")}catch(s){u(s.message||"Failed to update username."),f(s.message||"Failed to update username.")}finally{T(""),J(!1)}};if(!o.isAuthenticated)return e.jsx(xe,{to:"/login",replace:!0});const X=r=>r.length<8?"Password must be at least 8 characters long.":/[A-Z]/.test(r)?/[a-z]/.test(r)?/[0-9]/.test(r)?"":"Password must include at least one digit.":"Password must include at least one lowercase letter.":"Password must include at least one uppercase letter.",ie=r=>{const s=r.target.value;M(s);const t=X(s);c(t)},ce=async r=>{var t;r.preventDefault(),h(null),z(null);const s=X(i);if(s){c(s);return}else c("");if(!v||!i||!P){h("All password fields are required.");return}if(i!==P){h("New passwords do not match.");return}try{const n=await fe({current_password:v,new_password:i});w(n.msg||"Password changed successfully!"),z(n.msg||"Password changed successfully!"),_(""),M(""),A(""),c("")}catch(n){const re=((t=n.message)==null?void 0:t.toLowerCase())||"";re.includes("password must")||re.includes("password should")?c(n.message):h(n.message||"Failed to change password."),u(n.message||"Failed to change password.")}},ue=async r=>{if(r.preventDefault(),x(null),R(null),!b||!C){x("Both email and password are required.");return}if(!/\S+@\S+\.\S+/.test(b)){x("Invalid email format.");return}try{const s=await we({new_email:b,password:C});w(s.msg||"Email updated successfully!"),R(s.msg||"Email updated successfully!"),V(""),O("")}catch(s){u(s.message||"Failed to update email."),x(s.message||"Failed to update email.")}},ge=r=>{var t;const s=(t=r.target.files)==null?void 0:t[0];s?(y(s),N(URL.createObjectURL(s))):(y(null),N(null))},me=async()=>{if(!d){u("Please select a file first.");return}S(!0);const r=new FormData;r.append("profile_picture",d);try{const s=await pe(r);w(s.msg||"Profile picture updated successfully!"),o.user&&s.profile_picture_url&&o.updateUserProfilePictureUrl(s.profile_picture_url),y(null),N(null)}catch(s){u(s.message||"Failed to upload profile picture."),console.error("Profile picture upload error:",s)}finally{S(!1)}};return a.useEffect(()=>{var r;(r=o.user)!=null&&r.profile_picture_url},[(Y=o.user)==null?void 0:Y.profile_picture_url,k,d]),e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-8 text-gray-900 dark:text-white",children:"User Profile"}),e.jsxs("div",{className:"mb-8 p-6 bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Profile Picture"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("div",{className:"shrink-0",children:e.jsx("img",{className:"h-24 w-24 object-cover rounded-full",src:k||((K=o.user)!=null&&K.profile_picture_url?`${oe}${o.user.profile_picture_url}`:`https://ui-avatars.com/api/?name=${encodeURIComponent(((ee=o.user)==null?void 0:ee.username)||"User")}&background=random&size=128`),alt:"Profile"})}),e.jsxs("label",{htmlFor:"profile-picture-upload",className:"block",children:[e.jsx("span",{className:"sr-only",children:"Choose profile photo"}),e.jsx("input",{type:"file",id:"profile-picture-upload",accept:"image/png, image/jpeg, image/gif",onChange:ge,className:`block w-full text-sm text-gray-500 dark:text-gray-400\r
                         file:mr-4 file:py-2 file:px-4\r
                         file:rounded-lg file:border-0\r
                         file:text-sm file:font-semibold\r
                         file:bg-indigo-50 dark:file:bg-indigo-800 file:text-indigo-600 dark:file:text-indigo-300\r
                         hover:file:bg-indigo-100 dark:hover:file:bg-indigo-700\r
                         disabled:opacity-50`,disabled:j})]})]}),d&&e.jsx("div",{className:"mt-4",children:e.jsxs("button",{onClick:me,disabled:j||!d,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:[j?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}):e.jsx(Ne,{size:16,className:"mr-2"}),"Upload New Picture"]})})]}),e.jsxs("div",{className:"mb-8 p-6 bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Watch Preferences"}),e.jsx("button",{onClick:()=>F(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Manage Watch Preferences"})]}),E&&e.jsx(ke,{isOpen:E,onClose:()=>F(!1),title:"Manage Watch Preferences",children:m&&(!g||g.length===0)?e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-center py-4",children:"Loading watch preferences..."}):e.jsxs("div",{className:"space-y-6",children:[" ",Object.entries(de).map(([r,s])=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-200 mb-2",children:s.displayName}),s.categories?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2",children:s.categories.map(t=>{const n=l(r,t);return e.jsxs("button",{onClick:()=>Q(r,t,n),className:`w-full flex items-center justify-center px-3 py-2 border text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-1
                                          ${n?"bg-green-600 hover:bg-green-700 text-white border-transparent focus:ring-green-500":"bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600 border-gray-300 dark:border-gray-500 focus:ring-indigo-500"} transition-colors duration-150 ease-in-out`,disabled:m,children:[n?e.jsx(ae,{size:16,className:"mr-2"}):e.jsx(se,{size:16,className:"mr-2"}),n?"Watching":"Watch"," ",e.jsxs("span",{className:"ml-1 font-normal hidden sm:inline",children:["- ",t]})]},t)})}):e.jsxs("button",{onClick:()=>{const t=l(r,void 0);Q(r,void 0,t)},className:`w-auto flex items-center justify-center px-4 py-2 border text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-1
                                    ${l(r,void 0)?"bg-green-600 hover:bg-green-700 text-white border-transparent focus:ring-green-500":"bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600 border-gray-300 dark:border-gray-500 focus:ring-indigo-500"} transition-colors duration-150 ease-in-out`,disabled:m,children:[l(r,void 0)?e.jsx(ae,{size:16,className:"mr-2"}):e.jsx(se,{size:16,className:"mr-2"}),l(r,void 0)?"Watching":"Watch General"]})]},r)),m&&g&&g.length>0&&e.jsxs("div",{className:"mt-4 flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-indigo-500 mr-2"}),"Saving preferences..."]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Change Password"}),W&&e.jsx("p",{className:"text-red-600 dark:text-red-300 bg-red-100 dark:bg-red-900 border border-red-300 dark:border-red-700 p-3 rounded mb-4",children:W}),L&&e.jsx("p",{className:"text-green-600 dark:text-green-300 bg-green-100 dark:bg-green-900 border border-green-300 dark:border-green-700 p-3 rounded mb-4",children:L}),e.jsxs("form",{onSubmit:ce,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"currentPassword",children:"Current Password"}),e.jsx("input",{type:"password",id:"currentPassword",value:v,onChange:r=>_(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"newPassword",children:"New Password"}),e.jsx("input",{type:"password",id:"newPassword",value:i,onChange:ie,className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"}),I&&e.jsx("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:I})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"confirmNewPassword",children:"Confirm New Password"}),e.jsx("input",{type:"password",id:"confirmNewPassword",value:P,onChange:r=>A(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 mb-3 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsx("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Change Password"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Update Email"}),D&&e.jsx("p",{className:"text-red-600 dark:text-red-300 bg-red-100 dark:bg-red-900 border border-red-300 dark:border-red-700 p-3 rounded mb-4",children:D}),q&&e.jsx("p",{className:"text-green-600 dark:text-green-300 bg-green-100 dark:bg-green-900 border border-green-300 dark:border-green-700 p-3 rounded mb-4",children:q}),e.jsxs("form",{onSubmit:ue,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"newEmail",children:"New Email"}),e.jsx("input",{type:"email",id:"newEmail",value:b,onChange:r=>V(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"confirmPasswordForEmail",children:"Confirm Password"}),e.jsx("input",{type:"password",id:"confirmPasswordForEmail",value:C,onChange:r=>O(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 mb-3 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsx("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Update Email"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Change Username"}),B&&e.jsx("p",{className:"text-red-600 dark:text-red-300 bg-red-100 dark:bg-red-900 border border-red-300 dark:border-red-700 p-3 rounded mb-4",children:B}),G&&e.jsx("p",{className:"text-green-600 dark:text-green-300 bg-green-100 dark:bg-green-900 border border-green-300 dark:border-green-700 p-3 rounded mb-4",children:G}),e.jsxs("form",{onSubmit:le,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"newUsername",children:"New Username"}),e.jsx("input",{type:"text",id:"newUsername",value:p,onChange:r=>$(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"currentPasswordForUsername",children:"Current Password"}),e.jsx("input",{type:"password",id:"currentPasswordForUsername",value:U,onChange:r=>T(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 mb-3 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsx("button",{type:"submit",disabled:Z,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline disabled:opacity-50",children:Z?"Changing...":"Change Username"})]})]})]})]})};export{Ce as default};
