import{r as s,u as We,f as He,s as g,j as e,L as kt,F as Fe,X as vt,e as jt,a as F,b as Nt,c as St,d as Dt,g as Ft,h as _t,i as Ct,k as It,S as Mt,l as Tt,m as At,n as Pt,o as Ut,p as Lt}from"./index-CEpsALSJ.js";import{C as Et,D as $t,M as zt}from"./Modal-BOs8f6Ew.js";import{F as Bt}from"./FilterTabs-TK-3I57I.js";import{E as Rt}from"./ErrorState-BTODZg_V.js";import{u as Ot,U as Vt,o as qt,c as Gt,a as X,b as Wt,P as Ht,T as Ve,D as De,M as Xt,F as Jt,C as Zt,d as Yt,e as Kt}from"./CommentSection-C4sK7cLR.js";import{C as qe}from"./ConfirmationModal-BXexJkzR.js";const Qt=Gt().shape({selectedSoftwareId:X().required("Software selection is required."),docName:X().required("Document Name is required.").max(255,"Document Name cannot exceed 255 characters."),docType:X().transform(a=>a===""?void 0:a).nullable().optional(),inputMode:X().oneOf(["url","upload"]).required("Input mode must be selected."),externalUrl:X().when("inputMode",{is:"url",then:a=>a.required("External Download URL is required.").url("Please enter a valid URL (e.g., http://example.com)."),otherwise:a=>a.optional().nullable()}),selectedFile:Wt().when(["inputMode","$isEditMode","$documentToEditIsExternal"],{is:(a,m,M)=>a!=="upload"?!1:!!(!m||m&&M),then:a=>a.required("Please select a file to upload.").test("filePresent","File is required.",m=>!!m),otherwise:a=>a.nullable()}),description:X().optional().max(1e3,"Description cannot exceed 1000 characters.")}),Ge=({documentToEdit:a,onDocumentAdded:m,onDocumentUpdated:M,onCancelEdit:c})=>{const u=!!a,{register:x,handleSubmit:me,control:J,formState:{errors:d},watch:T,setValue:A,reset:O}=Ot({resolver:qt(Qt),context:{isEditMode:u,documentToEditIsExternal:(a==null?void 0:a.is_external_link)||!1},defaultValues:{selectedSoftwareId:"",docName:"",docType:"",description:"",inputMode:"url",externalUrl:"",selectedFile:null}}),[P,fe]=s.useState([]),[V,U]=s.useState(null),[f,N]=s.useState(!1),[q,ge]=s.useState(!1),[b,Z]=s.useState(0),p=s.useRef(null),{isAuthenticated:L,user:_}=We(),B=_==null?void 0:_.role,E=T("inputMode"),S=T("selectedFile");s.useEffect(()=>{L&&(B==="admin"||B==="super_admin")&&(ge(!0),He().then(fe).catch(()=>g("Failed to load software list.")).finally(()=>ge(!1)))},[L,B]),s.useEffect(()=>{var r;if(u&&a){const $={selectedSoftwareId:((r=a.software_id)==null?void 0:r.toString())||"",docName:a.doc_name,docType:a.doc_type||"",description:a.description||"",inputMode:a.is_external_link?"url":"upload",externalUrl:a.is_external_link?a.download_link:""};if(O($),a.is_external_link)U(null);else{const G=a.download_link.split("/");U(a.original_filename_ref||G[G.length-1])}A("selectedFile",null),p.current&&(p.current.value="")}else Y()},[a,u,O,A]);const Y=(r=!1)=>{const $=r?T("selectedSoftwareId"):"";O({selectedSoftwareId:$,docName:"",docType:"",description:"",inputMode:"url",externalUrl:"",selectedFile:null}),U(null),p.current&&(p.current.value="")},xe=r=>{r.target.files&&r.target.files[0]?(A("selectedFile",r.target.files[0],{shouldValidate:!0,shouldDirty:!0}),U(null)):A("selectedFile",null,{shouldValidate:!0,shouldDirty:!0})},K=()=>{if(A("selectedFile",null,{shouldValidate:!0,shouldDirty:!0}),p.current&&(p.current.value=""),u&&a&&!a.is_external_link){const r=a.download_link.split("/");U(a.original_filename_ref||r[r.length-1])}},he=async r=>{var $,G,z,C;N(!0),Z(0);try{let y;const w={software_id:r.selectedSoftwareId,doc_name:r.docName.trim(),description:(($=r.description)==null?void 0:$.trim())||"",doc_type:((G=r.docType)==null?void 0:G.trim())||""};if(r.inputMode==="url"){const W={software_id:parseInt(r.selectedSoftwareId),doc_name:w.doc_name,description:w.description,doc_type:w.doc_type,download_link:r.externalUrl.trim()};u&&a?(y=await jt(a.id,W),F(`Document "${y.doc_name}" updated successfully!`),M&&M(y)):(y=await Nt(W),F(`Document "${y.doc_name}" added successfully!`),m&&m(y),u||Y(!0))}else if(!r.selectedFile){if(u&&a&&!a.is_external_link&&!r.selectedFile){g("To update metadata of an existing uploaded file without re-uploading, please use a different form or feature (not implemented in this version of chunked upload). To replace the file, select a new file."),N(!1);return}if(!r.selectedFile&&!u){g("No file selected for upload."),N(!1);return}y=await St(r.selectedFile,"document",w,W=>Z(W)),F(`Document "${y.doc_name}" added successfully via chunked upload!`),m&&m(y),Y(!0)}}catch(y){const w=((C=(z=y.response)==null?void 0:z.data)==null?void 0:C.msg)||y.message||`Failed to ${u&&r.inputMode==="url"?"update":"add"} document.`;g(w)}finally{N(!1)}},pe=r=>{console.error("Form validation errors:",r),g("Please correct the errors highlighted in the form.")},Q=["Guide","Manual","API Reference","Datasheet","Whitepaper","Specification","Other"];return!L||!B||!["admin","super_admin"].includes(B)?null:e.jsxs("form",{onSubmit:me(he,pe),className:"space-y-6 bg-white dark:bg-gray-800 dark:border-gray-700 p-6 rounded-lg shadow-md border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:u?"Edit Document":"Add New Document"}),u&&c&&e.jsx("button",{type:"button",onClick:c,className:"text-sm text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",children:"Cancel Edit"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectedSoftwareId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Software*"}),q?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading software..."}):e.jsxs("select",{id:"selectedSoftwareId",...x("selectedSoftwareId"),disabled:f||q,className:`mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md ${d.selectedSoftwareId?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`,children:[e.jsx("option",{value:"",disabled:!0,children:"Select Software"}),P.map(r=>e.jsx("option",{value:r.id.toString(),children:r.name},r.id))]}),d.selectedSoftwareId&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.selectedSoftwareId.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"docName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Document Name*"}),e.jsx("input",{type:"text",id:"docName",...x("docName"),disabled:f,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.docName?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),d.docName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.docName.message})]}),e.jsxs("div",{className:"my-4",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Document Source:"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",...x("inputMode"),value:"url",className:"form-radio h-4 w-4 text-blue-600",disabled:f}),e.jsxs("span",{className:"flex items-center dark:text-gray-300",children:[e.jsx(kt,{size:16,className:"mr-1 text-gray-600 dark:text-gray-400"}),"Provide External Link"]})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",...x("inputMode"),value:"upload",className:"form-radio h-4 w-4 text-blue-600",disabled:f}),e.jsxs("span",{className:"flex items-center dark:text-gray-300",children:[e.jsx(Vt,{size:16,className:"mr-1 text-gray-600 dark:text-gray-400"}),"Upload File"]})]})]}),d.inputMode&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.inputMode.message})]}),E==="url"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"externalUrl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"External Download URL*"}),e.jsx("input",{type:"url",id:"externalUrl",...x("externalUrl"),placeholder:"https://example.com/document.pdf",disabled:f,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.externalUrl?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),d.externalUrl&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.externalUrl.message})]}),E==="upload"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:u&&V&&!S?"Replace File (Optional)":"Select File to Upload*"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-blue-500 dark:border-gray-600 dark:hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(Fe,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500"}),e.jsxs("div",{className:"flex text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("label",{htmlFor:"doc-file-upload-input",className:"relative cursor-pointer bg-white dark:bg-gray-800 rounded-md font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500",children:[e.jsx("span",{children:S?"Change file":"Upload a file"}),e.jsx("input",{id:"doc-file-upload-input",name:"doc-file-input",type:"file",className:"sr-only",onChange:xe,ref:p,disabled:f})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PDF, DOCX, PNG, JPG, ZIP etc."})]})}),(S||V)&&e.jsxs("div",{className:"mt-3 flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden",children:[e.jsx(Fe,{size:18,className:"text-gray-500 dark:text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:S?S.name:V}),u&&V&&!S&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:"(current)"})]}),S&&e.jsx("button",{type:"button",onClick:K,disabled:f,className:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-200 dark:text-gray-500 dark:hover:text-gray-300 dark:hover:bg-gray-600",children:e.jsx(vt,{size:16})})]}),d.selectedFile&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.selectedFile.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"docType",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Document Type"}),e.jsxs("select",{id:"docType",...x("docType"),disabled:f,className:`mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md ${d.docType?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`,children:[e.jsx("option",{value:"",children:"Select Type (Optional)"}),Q.map(r=>e.jsx("option",{value:r,children:r},r))]}),d.docType&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.docType.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Description"}),e.jsx("textarea",{id:"description",rows:3,...x("description"),disabled:f,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.description?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),d.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.description.message})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"submit",disabled:f||q,className:"flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:f?u?"Updating...":"Adding...":u?"Update Document":"Add Document"}),u&&c&&e.jsx("button",{type:"button",onClick:c,disabled:f,className:"flex-1 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:border-gray-500 dark:text-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600",children:"Cancel"})]}),f&&E==="upload"&&b>0&&e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-4 dark:bg-gray-700 my-3 relative",children:[e.jsx("div",{className:"bg-blue-600 h-4 rounded-full transition-all duration-150 ease-out",style:{width:`${b}%`}}),e.jsxs("p",{className:"absolute inset-0 text-center text-xs font-medium leading-4 text-white dark:text-gray-100",children:[Math.round(b),"%"]})]})]})},ls=()=>{const{searchTerm:m,setSearchTerm:M}=Dt(),{isAuthenticated:c,user:u}=We(),x=u==null?void 0:u.role,[me,J]=s.useState(!1),[d,T]=s.useState(null),[A,O]=s.useState(!1),[P,fe]=s.useState(null),[V,U]=s.useState(!1),[f,N]=s.useState(new Map),[q,ge]=s.useState(!1),[b,Z]=s.useState(null),[p,L]=s.useState([]),[_,B]=s.useState([]),[E,S]=s.useState(!0),[Y,xe]=s.useState(!1),[K,he]=s.useState(null),[pe,Q]=s.useState(1),[r,$]=s.useState(0),[G,z]=s.useState(!1),[C,y]=s.useState("doc_name"),[w,W]=s.useState("asc"),[ee,_e]=s.useState(""),[te,Ce]=s.useState(""),[se,Ie]=s.useState(""),[ae,Me]=s.useState(""),[re,Te]=s.useState(""),[oe,Xe]=s.useState(""),[le,Je]=s.useState(""),[ne,Ze]=s.useState(""),[de,Ye]=s.useState(""),[ie,Ke]=s.useState(""),[k,H]=s.useState(new Set),[Ae,be]=s.useState(!1),[ye,ve]=s.useState(null),[Pe,je]=s.useState(!1),[Ue,Le]=s.useState(!1),[Qe,Ee]=s.useState(!1),[ce,$e]=s.useState(!1),[v,ue]=s.useState(null),we=s.useRef(null),ze=Ft(),Ne=s.useMemo(()=>b!==null||ee!==""||te!==""||se!==""||ae!==""||re!==""||m!=="",[b,ee,te,se,ae,re,m]),Be=s.useCallback(()=>{Z(null),_e(""),Ce(""),Ie(""),Me(""),Te(""),M&&M("")},[M]),j=s.useCallback(async(t,o=!1)=>{var n,i;o?(S(!0),he(null)):xe(!0);try{const l=await _t(b===null?void 0:b,t,15,C,w,oe||void 0,le||void 0,ne||void 0,de||void 0,ie||void 0),h=l.documents;L(ke=>{const D=o?h:[...ke,...h];return N(R=>{const I=new Map;if(c&&D)for(const Oe of D)I.set(Oe.id,{favoriteId:Oe.favorite_id});return I}),D}),$(l.total_documents),Q(l.page),z(l.page<l.total_pages)}catch(l){console.error(`Failed to load documents (page ${t}):`,l);const h=((i=(n=l.response)==null?void 0:n.data)==null?void 0:i.msg)||l.message||"Failed to fetch documents.";o?(he(h),L([]),z(!1)):(g(h),z(!1))}finally{o?S(!1):xe(!1)}},[b,15,C,w,oe,le,ne,de,ie,c]);s.useEffect(()=>{const t=setTimeout(()=>Xe(ee),500);return()=>clearTimeout(t)},[ee]),s.useEffect(()=>{const t=setTimeout(()=>Je(te),500);return()=>clearTimeout(t)},[te]),s.useEffect(()=>{const t=setTimeout(()=>Ze(se),500);return()=>clearTimeout(t)},[se]),s.useEffect(()=>{const t=setTimeout(()=>Ye(ae),500);return()=>clearTimeout(t)},[ae]),s.useEffect(()=>{const t=setTimeout(()=>Ke(re),500);return()=>clearTimeout(t)},[re]),s.useEffect(()=>{if(!c){L([]),N(new Map),Q(1),z(!1),S(!1);return}j(1,!0)},[c,b,C,w,oe,le,ne,de,ie,m,j]),s.useEffect(()=>{H(new Set)},[b,C,w,oe,le,ne,de,ie,m,pe]),s.useEffect(()=>{c&&(async()=>{try{const o=await He();B(o),console.log("*** Software List loaded:",o)}catch(o){console.error("Failed to load software for filters",o),g("Failed to load software list for filtering.")}})()},[c]),s.useEffect(()=>{const t=new URLSearchParams(ze.search),o=t.get("item_id"),n=t.get("comment_id");if(o&&n&&p.length>0){const i=parseInt(o,10);if(!isNaN(i)){const l=p.find(h=>h.id===i);l?((!v||v.id!==l.id)&&ue(l),setTimeout(()=>{var h;(h=we.current)==null||h.scrollIntoView({behavior:"smooth",block:"center"})},100)):console.warn(`DocumentsView: Document with item_id ${i} not found in the current list.`)}}},[ze.search,p]);const et=t=>{console.log("*** handleFilterChange called with softwareId:",t),Z(t)};s.useEffect(()=>{if(!c){L([]),N(new Map),Q(1),z(!1),S(!1);return}console.log("*** useEffect triggered for fetch. Current selectedSoftwareId:",b,"searchTerm:",m),j(1,!0)},[c,b,C,w,oe,le,ne,de,ie,m,j]);const tt=t=>{const o=C===t&&w==="asc"?"desc":"asc";y(t),W(o)},st=s.useCallback(t=>{j(t,!0),H(new Set)},[j]),at=t=>{J(!1),F(`Document "${t.doc_name}" added.`),j(1,!0)},rt=t=>{T(null),F(`Document "${t.doc_name}" updated.`),j(1,!0)},ot=t=>{J(!1),T(t),window.scrollTo({top:0,behavior:"smooth"})},lt=()=>T(null),nt=t=>{fe(t),O(!0)},Se=()=>{fe(null),O(!1)},dt=async()=>{if(P){U(!0),v&&P.id===v.id&&ue(null);try{await Tt(P.id),F(`Document "${P.doc_name}" deleted.`),Se(),j(1,!0)}catch(t){g(t.message||"Failed to delete document."),Se()}finally{U(!1)}}},Re=s.useMemo(()=>{if(!m)return p;const t=m.toLowerCase();return p.filter(o=>o.doc_name.toLowerCase().includes(t)||(o.description||"").toLowerCase().includes(t)||(o.software_name||"").toLowerCase().includes(t))},[p,m]),it=(t,o)=>{H(n=>{const i=new Set(n);return o?i.add(t):i.delete(t),i})},ct=t=>{const o=new Set;t&&Re.forEach(n=>o.add(n.id)),H(o)},ut=()=>{if(k.size===0){g("No items selected.");return}je(!0)},mt=async()=>{je(!1),Le(!0);try{const t=await At(Array.from(k),"document");F(t.msg||`${t.deleted_count} item(s) deleted.`),H(new Set),v&&k.has(v.id)&&ue(null),j(1,!0)}catch(t){g(t.message||"Bulk delete failed.")}finally{Le(!1)}},ft=async()=>{if(k.size===0){g("No items selected.");return}const t=p.filter(n=>k.has(n.id)&&!n.is_external_link&&n.is_downloadable!==!1);if(t.length===0){g("No downloadable files selected. External links or non-downloadable items cannot be bulk downloaded.");return}const o=t.map(n=>n.id);Ee(!0);try{const n=await It(o,"document"),i=URL.createObjectURL(n),l=document.createElement("a");l.href=i;const h=new Date().toISOString().replace(/:/g,"-");l.download=`bulk_download_documents_${h}.zip`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i),o.length===k.size?F("Download started for all selected downloadable documents."):F(`Starting download for ${o.length} file(s). External links or non-downloadable items were excluded.`)}catch(n){g(n.message||"Bulk download failed.")}finally{Ee(!1)}},gt=()=>{if(k.size===0){g("No items selected.");return}if(_.length===0){g("Software list unavailable.");return}ve(null),be(!0)},xt=async()=>{if(!ye){g("Select target software.");return}be(!1),$e(!0);try{const t=await Pt(Array.from(k),"document",{target_software_id:ye});F(t.msg||`${t.moved_count} item(s) moved.`),H(new Set),j(1,!0)}catch(t){g(t.message||"Bulk move failed.")}finally{$e(!1),ve(null)}},ht=[{key:"doc_name",header:"Name",sortable:!0},{key:"doc_type",header:"Type",sortable:!0},{key:"software_name",header:"Software",sortable:!0},{key:"description",header:"Description",render:t=>e.jsx("span",{className:"text-sm text-gray-600 block max-w-xs truncate",title:t.description||"",children:t.description||"-"})},{key:"download_link",header:"Download",render:t=>{var i;const o=t.is_external_link||t.is_downloadable;return!(t.is_external_link||t.is_downloadable!==!1)&&!t.is_external_link?e.jsxs("span",{className:"flex items-center text-gray-400 cursor-not-allowed",title:"Download not permitted",children:[e.jsx(De,{size:14,className:"mr-1"}),"Link"]}):e.jsxs("a",{href:t.download_link,target:t.is_external_link||!((i=t.download_link)!=null&&i.startsWith("/"))?"_blank":"_self",rel:"noopener noreferrer",className:`flex items-center ${o?"text-blue-600 hover:text-blue-800":"text-gray-400 cursor-not-allowed"}`,onClick:l=>{o||l.preventDefault(),l.stopPropagation()},title:o?t.is_external_link?"Open external link":"Download file":"Download not permitted",children:[e.jsx(De,{size:14,className:"mr-1"}),"Link"]})}},{key:"uploaded_by_username",header:"Uploaded By",sortable:!0,render:t=>t.uploaded_by_username||"N/A"},{key:"updated_by_username",header:"Updated By",sortable:!1,render:t=>t.updated_by_username||"N/A"},{key:"created_at",header:"Created At",sortable:!0,render:t=>t.created_at?new Date(t.created_at).toLocaleDateString("en-CA"):"-"},{key:"updated_at",header:"Updated At",sortable:!0,render:t=>t.updated_at?new Date(t.updated_at).toLocaleDateString("en-CA"):"-"},{key:"actions",header:"Actions",render:t=>{var o,n,i;return e.jsxs("div",{className:"flex space-x-1 items-center",children:[c&&e.jsx("button",{onClick:l=>{l.stopPropagation(),wt(t,"document")},className:`p-1 rounded-md ${(o=f.get(t.id))!=null&&o.favoriteId?"text-yellow-500 hover:text-yellow-600":"text-gray-400 hover:text-yellow-500"}`,title:(n=f.get(t.id))!=null&&n.favoriteId?"Remove Favorite":"Add Favorite",children:e.jsx(Mt,{size:16,className:(i=f.get(t.id))!=null&&i.favoriteId?"fill-current":""})}),(x==="admin"||x==="super_admin")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),ot(t)},className:"p-1 text-blue-600 hover:text-blue-800 rounded-md",title:"Edit",children:e.jsx(Yt,{size:16})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),nt(t)},className:"p-1 text-red-600 hover:text-red-800 rounded-md",title:"Delete",children:e.jsx(Ve,{size:16})})]}),c&&e.jsxs("button",{onClick:l=>{l.stopPropagation(),v&&v.id===t.id?ue(null):(ue(t),setTimeout(()=>{var h;return(h=we.current)==null?void 0:h.scrollIntoView({behavior:"smooth"})},0))},className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 rounded-md",title:v&&v.id===t.id?"Hide Comments":"View Comments",children:[e.jsx(Kt,{size:16}),e.jsxs("span",{className:"ml-1 text-xs",children:["(",t.comment_count??0,")"]})]})]})}}],pt=Math.ceil(r/15),bt=s.useCallback(()=>{j(1,!0)},[j]),yt=()=>d?e.jsx("div",{className:"my-6 p-4 bg-gray-50 rounded-lg shadow dark:bg-gray-700",children:e.jsx(Ge,{documentToEdit:d,onDocumentUpdated:rt,onCancelEdit:lt})}):me?e.jsx("div",{className:"my-6 p-4 bg-gray-50 rounded-lg shadow dark:bg-gray-700",children:e.jsx(Ge,{onDocumentAdded:at,onCancelEdit:()=>J(!1)})}):null,wt=async(t,o)=>{var h,ke;if(!c){g("Please log in to manage favorites.");return}const n=f.get(t.id),i=!!(n!=null&&n.favoriteId),l=new Map(f);i?l.set(t.id,{favoriteId:void 0}):l.set(t.id,{favoriteId:-1}),N(l);try{if(i&&typeof(n==null?void 0:n.favoriteId)=="number")await Ut(t.id,o),F(`"${t.doc_name}" removed from favorites.`),N(D=>{const R=new Map(D);return R.set(t.id,{favoriteId:void 0}),R});else{const D=await Lt(t.id,o);N(R=>{const I=new Map(R);return I.set(t.id,{favoriteId:D.id}),I}),F(`"${t.doc_name}" added to favorites.`)}}catch(D){g(((ke=(h=D==null?void 0:D.response)==null?void 0:h.data)==null?void 0:ke.msg)||D.message||"Failed to update favorite."),N(R=>{const I=new Map(R);return i?I.set(t.id,{favoriteId:n==null?void 0:n.favoriteId}):I.set(t.id,{favoriteId:void 0}),I})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start sm:items-center mb-6 flex-col sm:flex-row",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Documents"}),e.jsx("p",{className:"text-gray-600 mt-1 dark:text-gray-300",children:"Browse and manage official documents and resources."})]}),c&&(x==="admin"||x==="super_admin")&&!d&&e.jsxs("button",{onClick:()=>{J(t=>!t),T(null)},className:"mt-4 sm:mt-0 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(Ht,{size:18,className:"mr-2"}),me?"Cancel":"Add New Document"]})]}),yt(),k.size>0&&e.jsx("div",{className:"my-4 p-3 bg-gray-100 dark:bg-gray-700 rounded-md shadow-sm border border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:[k.size," item(s) selected"]}),(x==="admin"||x==="super_admin")&&e.jsxs("button",{onClick:ut,disabled:Ue,className:"px-3 py-1.5 text-xs font-medium rounded-md shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 text-white bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 focus:ring-red-500 disabled:opacity-50",children:[e.jsx(Ve,{size:14,className:"mr-1.5"}),"Delete"]}),c&&e.jsxs("button",{onClick:ft,disabled:Qe,className:"px-3 py-1.5 text-xs font-medium rounded-md shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 text-white bg-green-500 hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700 focus:ring-green-500 disabled:opacity-50",children:[e.jsx(De,{size:14,className:"mr-1.5"}),"Download"]}),(x==="admin"||x==="super_admin")&&e.jsxs("button",{onClick:gt,disabled:ce,className:"px-3 py-1.5 text-xs font-medium rounded-md shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 text-white bg-blue-500 hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700 focus:ring-blue-500 disabled:opacity-50",children:[e.jsx(Xt,{size:14,className:"mr-1.5"}),"Move"]})]})}),_.length>0&&e.jsx(Bt,{software:_,selectedSoftwareId:b,onSelectFilter:et}),e.jsx("div",{className:"mb-4",children:e.jsxs("button",{onClick:()=>ge(t=>!t),className:"flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-md text-sm font-medium",children:[q?e.jsxs(e.Fragment,{children:[e.jsx(Et,{size:18,className:"mr-2"}),"Hide"]}):e.jsxs(e.Fragment,{children:[e.jsx(Jt,{size:18,className:"mr-2"}),"Show"]})," Advanced Filters"]})}),q&&e.jsxs("div",{className:"my-4 p-4 border dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 space-y-4 md:space-y-0 md:flex md:flex-wrap md:items-end md:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"docTypeFilterInput",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Doc Type"}),e.jsx("input",{id:"docTypeFilterInput",type:"text",value:ee,onChange:t=>_e(t.target.value),placeholder:"e.g., Manual",className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Created"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:te,onChange:t=>Ce(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"to"}),e.jsx("input",{type:"date",value:se,onChange:t=>Ie(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Updated"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:ae,onChange:t=>Me(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"to"}),e.jsx("input",{type:"date",value:re,onChange:t=>Te(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"})]})]}),e.jsxs("div",{className:"flex items-end gap-2 pt-5",children:[e.jsx("button",{onClick:()=>j(1,!0),className:"text-sm px-4 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Apply"}),e.jsx("button",{onClick:Be,className:"text-sm px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Clear"})]})]}),E?e.jsx("div",{className:"py-10",children:e.jsx(Ct,{message:"Loading documents..."})}):K&&p.length===0&&!E?e.jsx(Rt,{message:K,onRetry:bt}):!E&&!K&&p.length===0?e.jsxs("div",{className:"text-center py-10 bg-white dark:bg-gray-800 rounded-lg shadow-sm my-6",children:[e.jsx(Fe,{size:48,className:"mx-auto text-yellow-500 dark:text-yellow-400 mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-700 dark:text-gray-200 mb-3",children:Ne?"No Documents Found Matching Criteria":"No Documents Available"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 px-4",children:Ne?"Try adjusting or clearing your search/filter settings.":x==="admin"||x==="super_admin"?"Add new documents to get started.":"Please check back later."}),Ne&&e.jsx("button",{onClick:Be,className:"mt-6 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 text-sm font-medium",children:"Clear All Filters & Search"})]}):e.jsx($t,{columns:ht,data:Re,rowClassName:"group",isLoading:E||Y,currentPage:pe,totalPages:pt,onPageChange:st,itemsPerPage:15,totalItems:r,sortColumn:C,sortOrder:w,onSort:tt,isSelectionEnabled:!0,selectedItemIds:k,onSelectItem:it,onSelectAllItems:ct}),A&&P&&e.jsx(qe,{isOpen:A,title:"Delete Document",message:`Delete "${P.doc_name}"?`,onConfirm:dt,onCancel:Se,isConfirming:V,confirmButtonText:"Delete",confirmButtonVariant:"danger"}),Pe&&e.jsx(qe,{isOpen:Pe,title:`Delete ${k.size} Document(s)`,message:`Delete ${k.size} selected items?`,onConfirm:mt,onCancel:()=>je(!1),isConfirming:Ue,confirmButtonText:"Delete Selected",confirmButtonVariant:"danger"}),Ae&&e.jsx(zt,{isOpen:Ae,onClose:()=>be(!1),title:`Move ${k.size} Document(s)`,children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:"Select target software:"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"targetSoftware",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Target Software"}),e.jsxs("select",{id:"targetSoftware",value:ye??"",onChange:t=>ve(t.target.value?parseInt(t.target.value):null),className:"input-class w-full dark:bg-gray-700 dark:text-white dark:border-gray-600",disabled:_.length===0||ce,children:[e.jsx("option",{value:"",children:"Select Software..."}),_.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),_.length===0&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Software list unavailable."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>be(!1),className:"btn-secondary",disabled:ce,children:"Cancel"}),e.jsx("button",{type:"button",onClick:xt,className:"btn-primary",disabled:ce||!ye,children:ce?"Moving...":"Confirm Move"})]})]})}),c&&v&&e.jsxs("div",{ref:we,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-4",children:["Comments for: ",e.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:v.doc_name})]}),e.jsx(Zt,{itemId:v.id,itemType:"document"})]}),!c&&v&&e.jsx("div",{ref:we,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Please log in to view and manage comments."})})]})};export{ls as default};
