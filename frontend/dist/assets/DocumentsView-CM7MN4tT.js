import{r as s,u as We,f as He,s as p,j as e,L as kt,F as Fe,X as vt,e as jt,a as Nt,b as St,c as Dt,d as T,g as Ft,h as _t,i as Ct,k as It,l as Mt,S as At,m as Tt,n as Pt,o as Ut,p as Lt,q as Et}from"./index-BHLdGC3O.js";import{C as $t,D as zt,M as Bt}from"./Modal-om1FYrPw.js";import{F as Rt}from"./FilterTabs-Dy6H-lxC.js";import{E as Ot}from"./ErrorState-pVpylQz5.js";import{u as Vt,U as qt,o as Gt,c as Wt,a as X,b as Ht,P as Xt,T as Ve,D as De,M as Jt,F as Zt,C as Yt,d as Kt,e as Qt}from"./CommentSection-CvdoD4fU.js";import{C as qe}from"./ConfirmationModal-Bx6ilQbM.js";const es=Wt().shape({selectedSoftwareId:X().required("Software selection is required."),docName:X().required("Document Name is required.").max(255,"Document Name cannot exceed 255 characters."),docType:X().transform(r=>r===""?void 0:r).nullable().optional(),inputMode:X().oneOf(["url","upload"]).required("Input mode must be selected."),externalUrl:X().when("inputMode",{is:"url",then:r=>r.required("External Download URL is required.").url("Please enter a valid URL (e.g., http://example.com)."),otherwise:r=>r.optional().nullable()}),selectedFile:Ht().when(["inputMode","$isEditMode","$documentToEditIsExternal"],{is:(r,h,P)=>r!=="upload"?!1:!!(!h||h&&P),then:r=>r.required("Please select a file to upload.").test("filePresent","File is required.",h=>!!h),otherwise:r=>r.nullable()}),description:X().optional().max(1e3,"Description cannot exceed 1000 characters.")}),Ge=({documentToEdit:r,onDocumentAdded:h,onDocumentUpdated:P,onCancelEdit:m})=>{const i=!!r,{register:u,handleSubmit:oe,control:J,formState:{errors:d},watch:U,setValue:L,reset:V}=Vt({resolver:Gt(es),context:{isEditMode:i,documentToEditIsExternal:(r==null?void 0:r.is_external_link)||!1},defaultValues:{selectedSoftwareId:"",docName:"",docType:"",description:"",inputMode:"url",externalUrl:"",selectedFile:null}}),[E,le]=s.useState([]),[q,$]=s.useState(null),[x,D]=s.useState(!1),[G,ne]=s.useState(!1),f=s.useRef(null),{isAuthenticated:W,user:w}=We(),F=w==null?void 0:w.role,_=U("inputMode"),C=U("selectedFile");s.useEffect(()=>{W&&(F==="admin"||F==="super_admin")&&(ne(!0),He().then(le).catch(()=>p("Failed to load software list.")).finally(()=>ne(!1)))},[W,F]),s.useEffect(()=>{var a;if(i&&r){const I={selectedSoftwareId:((a=r.software_id)==null?void 0:a.toString())||"",docName:r.doc_name,docType:r.doc_type||"",description:r.description||"",inputMode:r.is_external_link?"url":"upload",externalUrl:r.is_external_link?r.download_link:""};if(V(I),r.is_external_link)$(null);else{const z=r.download_link.split("/");$(r.original_filename_ref||z[z.length-1])}L("selectedFile",null),f.current&&(f.current.value="")}else B()},[r,i,V,L]);const B=(a=!1)=>{const I=a?U("selectedSoftwareId"):"";V({selectedSoftwareId:I,docName:"",docType:"",description:"",inputMode:"url",externalUrl:"",selectedFile:null}),$(null),f.current&&(f.current.value="")},Z=a=>{a.target.files&&a.target.files[0]?(L("selectedFile",a.target.files[0],{shouldValidate:!0,shouldDirty:!0}),$(null)):L("selectedFile",null,{shouldValidate:!0,shouldDirty:!0})},we=()=>{if(L("selectedFile",null,{shouldValidate:!0,shouldDirty:!0}),f.current&&(f.current.value=""),i&&r&&!r.is_external_link){const a=r.download_link.split("/");$(r.original_filename_ref||a[a.length-1])}},de=async a=>{var I,z,ce,ke,R,M;D(!0);try{let k;const S={software_id:parseInt(a.selectedSoftwareId),doc_name:a.docName.trim(),description:((I=a.description)==null?void 0:I.trim())||void 0,doc_type:((z=a.docType)==null?void 0:z.trim())||void 0};if(a.inputMode==="url"){const v={...S,download_link:a.externalUrl.trim()};i&&r?k=await jt(r.id,v):k=await Nt(v)}else{const v=new FormData;v.append("software_id",a.selectedSoftwareId),v.append("doc_name",a.docName.trim()),(ce=a.docType)!=null&&ce.trim()&&v.append("doc_type",a.docType.trim()),(ke=a.description)!=null&&ke.trim()&&v.append("description",a.description.trim()),a.selectedFile&&v.append("file",a.selectedFile),i&&r?k=await St(r.id,v):k=await Dt(v)}T(`Document "${k.doc_name}" ${i?"updated":"added"} successfully!`),i||B(!0),i&&P&&P(k),!i&&h&&h(k)}catch(k){const S=((M=(R=k.response)==null?void 0:R.data)==null?void 0:M.msg)||k.message||`Failed to ${i?"update":"add"} document.`;p(S)}finally{D(!1)}},Y=a=>{console.error("Form validation errors:",a),p("Please correct the errors highlighted in the form.")},ie=["Guide","Manual","API Reference","Datasheet","Whitepaper","Specification","Other"];return!W||!F||!["admin","super_admin"].includes(F)?null:e.jsxs("form",{onSubmit:oe(de,Y),className:"space-y-6 bg-white dark:bg-gray-800 dark:border-gray-700 p-6 rounded-lg shadow-md border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:i?"Edit Document":"Add New Document"}),i&&m&&e.jsx("button",{type:"button",onClick:m,className:"text-sm text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",children:"Cancel Edit"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectedSoftwareId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Software*"}),G?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading software..."}):e.jsxs("select",{id:"selectedSoftwareId",...u("selectedSoftwareId"),disabled:x||G,className:`mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md ${d.selectedSoftwareId?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`,children:[e.jsx("option",{value:"",disabled:!0,children:"Select Software"}),E.map(a=>e.jsx("option",{value:a.id.toString(),children:a.name},a.id))]}),d.selectedSoftwareId&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.selectedSoftwareId.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"docName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Document Name*"}),e.jsx("input",{type:"text",id:"docName",...u("docName"),disabled:x,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.docName?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),d.docName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.docName.message})]}),e.jsxs("div",{className:"my-4",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Document Source:"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",...u("inputMode"),value:"url",className:"form-radio h-4 w-4 text-blue-600",disabled:x}),e.jsxs("span",{className:"flex items-center dark:text-gray-300",children:[e.jsx(kt,{size:16,className:"mr-1 text-gray-600 dark:text-gray-400"}),"Provide External Link"]})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",...u("inputMode"),value:"upload",className:"form-radio h-4 w-4 text-blue-600",disabled:x}),e.jsxs("span",{className:"flex items-center dark:text-gray-300",children:[e.jsx(qt,{size:16,className:"mr-1 text-gray-600 dark:text-gray-400"}),"Upload File"]})]})]}),d.inputMode&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.inputMode.message})]}),_==="url"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"externalUrl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"External Download URL*"}),e.jsx("input",{type:"url",id:"externalUrl",...u("externalUrl"),placeholder:"https://example.com/document.pdf",disabled:x,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.externalUrl?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),d.externalUrl&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.externalUrl.message})]}),_==="upload"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i&&q&&!C?"Replace File (Optional)":"Select File to Upload*"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-blue-500 dark:border-gray-600 dark:hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(Fe,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500"}),e.jsxs("div",{className:"flex text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("label",{htmlFor:"doc-file-upload-input",className:"relative cursor-pointer bg-white dark:bg-gray-800 rounded-md font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500",children:[e.jsx("span",{children:C?"Change file":"Upload a file"}),e.jsx("input",{id:"doc-file-upload-input",name:"doc-file-input",type:"file",className:"sr-only",onChange:Z,ref:f,disabled:x})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PDF, DOCX, PNG, JPG, ZIP etc."})]})}),(C||q)&&e.jsxs("div",{className:"mt-3 flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden",children:[e.jsx(Fe,{size:18,className:"text-gray-500 dark:text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:C?C.name:q}),i&&q&&!C&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:"(current)"})]}),C&&e.jsx("button",{type:"button",onClick:we,disabled:x,className:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-200 dark:text-gray-500 dark:hover:text-gray-300 dark:hover:bg-gray-600",children:e.jsx(vt,{size:16})})]}),d.selectedFile&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.selectedFile.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"docType",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Document Type"}),e.jsxs("select",{id:"docType",...u("docType"),disabled:x,className:`mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md ${d.docType?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`,children:[e.jsx("option",{value:"",children:"Select Type (Optional)"}),ie.map(a=>e.jsx("option",{value:a,children:a},a))]}),d.docType&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.docType.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Description"}),e.jsx("textarea",{id:"description",rows:3,...u("description"),disabled:x,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.description?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),d.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.description.message})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"submit",disabled:x||G,className:"flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:x?i?"Updating...":"Adding...":i?"Update Document":"Add Document"}),i&&m&&e.jsx("button",{type:"button",onClick:m,disabled:x,className:"flex-1 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:border-gray-500 dark:text-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600",children:"Cancel"})]})]})},ns=()=>{const{searchTerm:h,setSearchTerm:P}=Ft(),{isAuthenticated:m,user:i}=We(),u=i==null?void 0:i.role,[oe,J]=s.useState(!1),[d,U]=s.useState(null),[L,V]=s.useState(!1),[E,le]=s.useState(null),[q,$]=s.useState(!1),[x,D]=s.useState(new Map),[G,ne]=s.useState(!1),[f,W]=s.useState(null),[w,F]=s.useState([]),[_,C]=s.useState([]),[B,Z]=s.useState(!0),[we,de]=s.useState(!1),[Y,ie]=s.useState(null),[a,I]=s.useState(1),[z,ce]=s.useState(0),[ke,R]=s.useState(!1),[M,k]=s.useState("doc_name"),[S,v]=s.useState("asc"),[K,_e]=s.useState(""),[Q,Ce]=s.useState(""),[ee,Ie]=s.useState(""),[te,Me]=s.useState(""),[se,Ae]=s.useState(""),[me,Xe]=s.useState(""),[ue,Je]=s.useState(""),[xe,Ze]=s.useState(""),[fe,Ye]=s.useState(""),[ge,Ke]=s.useState(""),[y,H]=s.useState(new Set),[Te,pe]=s.useState(!1),[he,ve]=s.useState(null),[Pe,je]=s.useState(!1),[Ue,Le]=s.useState(!1),[Qe,Ee]=s.useState(!1),[ae,$e]=s.useState(!1),[b,re]=s.useState(null),be=s.useRef(null),ze=_t(),Ne=s.useMemo(()=>f!==null||K!==""||Q!==""||ee!==""||te!==""||se!==""||h!=="",[f,K,Q,ee,te,se,h]),Be=s.useCallback(()=>{W(null),_e(""),Ce(""),Ie(""),Me(""),Ae(""),P&&P("")},[P]),j=s.useCallback(async(t,o=!1)=>{var l,c;o?(Z(!0),ie(null)):de(!0);try{const n=await Ct(f===null?void 0:f,t,15,M,S,me||void 0,ue||void 0,xe||void 0,fe||void 0,ge||void 0),g=n.documents;F(ye=>{const N=o?g:[...ye,...g];return D(O=>{const A=new Map;if(m&&N)for(const Oe of N)A.set(Oe.id,{favoriteId:Oe.favorite_id});return A}),N}),ce(n.total_documents),I(n.page),R(n.page<n.total_pages)}catch(n){console.error(`Failed to load documents (page ${t}):`,n);const g=((c=(l=n.response)==null?void 0:l.data)==null?void 0:c.msg)||n.message||"Failed to fetch documents.";o?(ie(g),F([]),R(!1)):(p(g),R(!1))}finally{o?Z(!1):de(!1)}},[f,15,M,S,me,ue,xe,fe,ge,m]);s.useEffect(()=>{const t=setTimeout(()=>Xe(K),500);return()=>clearTimeout(t)},[K]),s.useEffect(()=>{const t=setTimeout(()=>Je(Q),500);return()=>clearTimeout(t)},[Q]),s.useEffect(()=>{const t=setTimeout(()=>Ze(ee),500);return()=>clearTimeout(t)},[ee]),s.useEffect(()=>{const t=setTimeout(()=>Ye(te),500);return()=>clearTimeout(t)},[te]),s.useEffect(()=>{const t=setTimeout(()=>Ke(se),500);return()=>clearTimeout(t)},[se]),s.useEffect(()=>{if(!m){F([]),D(new Map),I(1),R(!1),Z(!1);return}j(1,!0)},[m,f,M,S,me,ue,xe,fe,ge,h,j]),s.useEffect(()=>{H(new Set)},[f,M,S,me,ue,xe,fe,ge,h,a]),s.useEffect(()=>{m&&(async()=>{try{const o=await He();C(o)}catch(o){console.error("Failed to load software for filters",o),p("Failed to load software list for filtering.")}})()},[m]),s.useEffect(()=>{const t=new URLSearchParams(ze.search),o=t.get("item_id"),l=t.get("comment_id");if(o&&l&&w.length>0){const c=parseInt(o,10);if(!isNaN(c)){const n=w.find(g=>g.id===c);n?((!b||b.id!==n.id)&&re(n),setTimeout(()=>{var g;(g=be.current)==null||g.scrollIntoView({behavior:"smooth",block:"center"})},100)):console.warn(`DocumentsView: Document with item_id ${c} not found in the current list.`)}}},[ze.search,w]);const et=t=>W(t),tt=t=>{const o=M===t&&S==="asc"?"desc":"asc";k(t),v(o)},st=s.useCallback(t=>{j(t,!0),H(new Set)},[j]),at=t=>{J(!1),T(`Document "${t.doc_name}" added.`),j(1,!0)},rt=t=>{U(null),T(`Document "${t.doc_name}" updated.`),j(1,!0)},ot=t=>{J(!1),U(t)},lt=()=>U(null),nt=t=>{le(t),V(!0)},Se=()=>{le(null),V(!1)},dt=async()=>{if(E){$(!0),b&&E.id===b.id&&re(null);try{await Tt(E.id),T(`Document "${E.doc_name}" deleted.`),Se(),j(1,!0)}catch(t){p(t.message||"Failed to delete document."),Se()}finally{$(!1)}}},Re=s.useMemo(()=>{if(!h)return w;const t=h.toLowerCase();return w.filter(o=>o.doc_name.toLowerCase().includes(t)||(o.description||"").toLowerCase().includes(t)||(o.software_name||"").toLowerCase().includes(t))},[w,h]),it=(t,o)=>{H(l=>{const c=new Set(l);return o?c.add(t):c.delete(t),c})},ct=t=>{const o=new Set;t&&Re.forEach(l=>o.add(l.id)),H(o)},mt=()=>{if(y.size===0){p("No items selected.");return}je(!0)},ut=async()=>{je(!1),Le(!0);try{const t=await Pt(Array.from(y),"document");T(t.msg||`${t.deleted_count} item(s) deleted.`),H(new Set),b&&y.has(b.id)&&re(null),j(1,!0)}catch(t){p(t.message||"Bulk delete failed.")}finally{Le(!1)}},xt=async()=>{if(y.size===0){p("No items selected.");return}Ee(!0);try{const t=await Mt(Array.from(y),"document"),o=URL.createObjectURL(t),l=document.createElement("a");l.href=o;const c=new Date().toISOString().replace(/:/g,"-");l.download=`bulk_download_document_${c}.zip`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(o),T("Download started.")}catch(t){p(t.message||"Bulk download failed.")}finally{Ee(!1)}},ft=()=>{if(y.size===0){p("No items selected.");return}if(_.length===0){p("Software list unavailable.");return}ve(null),pe(!0)},gt=async()=>{if(!he){p("Select target software.");return}pe(!1),$e(!0);try{const t=await Ut(Array.from(y),"document",{target_software_id:he});T(t.msg||`${t.moved_count} item(s) moved.`),H(new Set),j(1,!0)}catch(t){p(t.message||"Bulk move failed.")}finally{$e(!1),ve(null)}},pt=[{key:"doc_name",header:"Name",sortable:!0},{key:"doc_type",header:"Type",sortable:!0},{key:"software_name",header:"Software",sortable:!0},{key:"description",header:"Description",render:t=>e.jsx("span",{className:"text-sm text-gray-600 block max-w-xs truncate",title:t.description||"",children:t.description||"-"})},{key:"download_link",header:"Download",render:t=>{var c;const o=t.is_external_link||t.is_downloadable;return!(t.is_external_link||t.is_downloadable!==!1)&&!t.is_external_link?e.jsxs("span",{className:"flex items-center text-gray-400 cursor-not-allowed",title:"Download not permitted",children:[e.jsx(De,{size:14,className:"mr-1"}),"Link"]}):e.jsxs("a",{href:t.download_link,target:t.is_external_link||!((c=t.download_link)!=null&&c.startsWith("/"))?"_blank":"_self",rel:"noopener noreferrer",className:`flex items-center ${o?"text-blue-600 hover:text-blue-800":"text-gray-400 cursor-not-allowed"}`,onClick:n=>{o||n.preventDefault(),n.stopPropagation()},title:o?t.is_external_link?"Open external link":"Download file":"Download not permitted",children:[e.jsx(De,{size:14,className:"mr-1"}),"Link"]})}},{key:"uploaded_by_username",header:"Uploaded By",sortable:!0,render:t=>t.uploaded_by_username||"N/A"},{key:"updated_by_username",header:"Updated By",sortable:!1,render:t=>t.updated_by_username||"N/A"},{key:"created_at",header:"Created At",sortable:!0,render:t=>t.created_at?new Date(t.created_at).toLocaleDateString("en-CA"):"-"},{key:"updated_at",header:"Updated At",sortable:!0,render:t=>t.updated_at?new Date(t.updated_at).toLocaleDateString("en-CA"):"-"},{key:"actions",header:"Actions",render:t=>{var o,l,c;return e.jsxs("div",{className:"flex space-x-1 items-center",children:[m&&e.jsx("button",{onClick:n=>{n.stopPropagation(),wt(t,"document")},className:`p-1 rounded-md ${(o=x.get(t.id))!=null&&o.favoriteId?"text-yellow-500 hover:text-yellow-600":"text-gray-400 hover:text-yellow-500"}`,title:(l=x.get(t.id))!=null&&l.favoriteId?"Remove Favorite":"Add Favorite",children:e.jsx(At,{size:16,className:(c=x.get(t.id))!=null&&c.favoriteId?"fill-current":""})}),(u==="admin"||u==="super_admin")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),ot(t)},className:"p-1 text-blue-600 hover:text-blue-800 rounded-md",title:"Edit",children:e.jsx(Kt,{size:16})}),e.jsx("button",{onClick:n=>{n.stopPropagation(),nt(t)},className:"p-1 text-red-600 hover:text-red-800 rounded-md",title:"Delete",children:e.jsx(Ve,{size:16})})]}),m&&e.jsxs("button",{onClick:n=>{n.stopPropagation(),b&&b.id===t.id?re(null):(re(t),setTimeout(()=>{var g;return(g=be.current)==null?void 0:g.scrollIntoView({behavior:"smooth"})},0))},className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 rounded-md",title:b&&b.id===t.id?"Hide Comments":"View Comments",children:[e.jsx(Qt,{size:16}),e.jsxs("span",{className:"ml-1 text-xs",children:["(",t.comment_count??0,")"]})]})]})}}],ht=Math.ceil(z/15),bt=s.useCallback(()=>{j(1,!0)},[j]),yt=()=>d?e.jsx("div",{className:"my-6 p-4 bg-gray-50 rounded-lg shadow dark:bg-gray-700",children:e.jsx(Ge,{documentToEdit:d,onDocumentUpdated:rt,onCancelEdit:lt})}):oe?e.jsx("div",{className:"my-6 p-4 bg-gray-50 rounded-lg shadow dark:bg-gray-700",children:e.jsx(Ge,{onDocumentAdded:at,onCancelEdit:()=>J(!1)})}):null,wt=async(t,o)=>{var g,ye;if(!m){p("Please log in to manage favorites.");return}const l=x.get(t.id),c=!!(l!=null&&l.favoriteId),n=new Map(x);c?n.set(t.id,{favoriteId:void 0}):n.set(t.id,{favoriteId:-1}),D(n);try{if(c&&typeof(l==null?void 0:l.favoriteId)=="number")await Lt(t.id,o),T(`"${t.doc_name}" removed from favorites.`),D(N=>{const O=new Map(N);return O.set(t.id,{favoriteId:void 0}),O});else{const N=await Et(t.id,o);D(O=>{const A=new Map(O);return A.set(t.id,{favoriteId:N.id}),A}),T(`"${t.doc_name}" added to favorites.`)}}catch(N){p(((ye=(g=N==null?void 0:N.response)==null?void 0:g.data)==null?void 0:ye.msg)||N.message||"Failed to update favorite."),D(O=>{const A=new Map(O);return c?A.set(t.id,{favoriteId:l==null?void 0:l.favoriteId}):A.set(t.id,{favoriteId:void 0}),A})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start sm:items-center mb-6 flex-col sm:flex-row",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Documents"}),e.jsx("p",{className:"text-gray-600 mt-1 dark:text-gray-300",children:"Browse and manage official documents and resources."})]}),m&&(u==="admin"||u==="super_admin")&&!d&&e.jsxs("button",{onClick:()=>{J(t=>!t),U(null)},className:"mt-4 sm:mt-0 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(Xt,{size:18,className:"mr-2"}),oe?"Cancel":"Add New Document"]})]}),yt(),y.size>0&&e.jsx("div",{className:"my-4 p-3 bg-gray-100 dark:bg-gray-700 rounded-md shadow-sm border border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:[y.size," item(s) selected"]}),(u==="admin"||u==="super_admin")&&e.jsxs("button",{onClick:mt,disabled:Ue,className:"px-3 py-1.5 text-xs font-medium text-white bg-red-600 hover:bg-red-700 rounded-md shadow-sm disabled:opacity-50 flex items-center",children:[e.jsx(Ve,{size:14,className:"mr-1.5"}),"Delete"]}),m&&e.jsxs("button",{onClick:xt,disabled:Qe,className:"px-3 py-1.5 text-xs font-medium text-white bg-green-600 hover:bg-green-700 rounded-md shadow-sm disabled:opacity-50 flex items-center",children:[e.jsx(De,{size:14,className:"mr-1.5"}),"Download"]}),(u==="admin"||u==="super_admin")&&e.jsxs("button",{onClick:ft,disabled:ae,className:"px-3 py-1.5 text-xs font-medium text-black bg-yellow-400 hover:bg-yellow-500 rounded-md shadow-sm disabled:opacity-50 flex items-center",children:[e.jsx(Jt,{size:14,className:"mr-1.5"}),"Move"]})]})}),_.length>0&&e.jsx(Rt,{software:_,selectedSoftwareId:f,onSelectFilter:et}),e.jsx("div",{className:"mb-4",children:e.jsxs("button",{onClick:()=>ne(t=>!t),className:"flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-md text-sm font-medium",children:[G?e.jsxs(e.Fragment,{children:[e.jsx($t,{size:18,className:"mr-2"}),"Hide"]}):e.jsxs(e.Fragment,{children:[e.jsx(Zt,{size:18,className:"mr-2"}),"Show"]})," Advanced Filters"]})}),G&&e.jsxs("div",{className:"my-4 p-4 border dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 space-y-4 md:space-y-0 md:flex md:flex-wrap md:items-end md:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"docTypeFilterInput",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Doc Type"}),e.jsx("input",{id:"docTypeFilterInput",type:"text",value:K,onChange:t=>_e(t.target.value),placeholder:"e.g., Manual",className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Created"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:Q,onChange:t=>Ce(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"to"}),e.jsx("input",{type:"date",value:ee,onChange:t=>Ie(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Updated"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:te,onChange:t=>Me(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"to"}),e.jsx("input",{type:"date",value:se,onChange:t=>Ae(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"})]})]}),e.jsxs("div",{className:"flex items-end gap-2 pt-5",children:[e.jsx("button",{onClick:()=>j(1,!0),className:"text-sm px-4 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Apply"}),e.jsx("button",{onClick:Be,className:"text-sm px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Clear"})]})]}),B?e.jsx("div",{className:"py-10",children:e.jsx(It,{message:"Loading documents..."})}):Y&&w.length===0&&!B?e.jsx(Ot,{message:Y,onRetry:bt}):!B&&!Y&&w.length===0?e.jsxs("div",{className:"text-center py-10 bg-white dark:bg-gray-800 rounded-lg shadow-sm my-6",children:[e.jsx(Fe,{size:48,className:"mx-auto text-yellow-500 dark:text-yellow-400 mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-700 dark:text-gray-200 mb-3",children:Ne?"No Documents Found Matching Criteria":"No Documents Available"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 px-4",children:Ne?"Try adjusting or clearing your search/filter settings.":u==="admin"||u==="super_admin"?"Add new documents to get started.":"Please check back later."}),Ne&&e.jsx("button",{onClick:Be,className:"mt-6 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 text-sm font-medium",children:"Clear All Filters & Search"})]}):e.jsx(zt,{columns:pt,data:Re,rowClassName:"group",isLoading:B||we,currentPage:a,totalPages:ht,onPageChange:st,itemsPerPage:15,totalItems:z,sortColumn:M,sortOrder:S,onSort:tt,isSelectionEnabled:!0,selectedItemIds:y,onSelectItem:it,onSelectAllItems:ct}),L&&E&&e.jsx(qe,{isOpen:L,title:"Delete Document",message:`Delete "${E.doc_name}"?`,onConfirm:dt,onCancel:Se,isConfirming:q,confirmButtonText:"Delete",confirmButtonVariant:"danger"}),Pe&&e.jsx(qe,{isOpen:Pe,title:`Delete ${y.size} Document(s)`,message:`Delete ${y.size} selected items?`,onConfirm:ut,onCancel:()=>je(!1),isConfirming:Ue,confirmButtonText:"Delete Selected",confirmButtonVariant:"danger"}),Te&&e.jsx(Bt,{isOpen:Te,onClose:()=>pe(!1),title:`Move ${y.size} Document(s)`,children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:"Select target software:"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"targetSoftware",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Target Software"}),e.jsxs("select",{id:"targetSoftware",value:he??"",onChange:t=>ve(t.target.value?parseInt(t.target.value):null),className:"input-class w-full",disabled:_.length===0||ae,children:[e.jsx("option",{value:"",children:"Select Software..."}),_.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),_.length===0&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Software list unavailable."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>pe(!1),className:"btn-secondary",disabled:ae,children:"Cancel"}),e.jsx("button",{type:"button",onClick:gt,className:"btn-primary",disabled:ae||!he,children:ae?"Moving...":"Confirm Move"})]})]})}),m&&b&&e.jsxs("div",{ref:be,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-4",children:["Comments for: ",e.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:b.doc_name})]}),e.jsx(Yt,{itemId:b.id,itemType:"document"})]}),!m&&b&&e.jsx("div",{ref:be,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Please log in to view and manage comments."})})]})};export{ns as default};
