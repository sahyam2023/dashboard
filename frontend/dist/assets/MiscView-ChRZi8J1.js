import{r as s,u as Ne,Q as Xe,s as u,j as e,F as Ft,X as Nt,a as St,g as _t,R as Mt,T as Ye,U as It,V as Dt,b as W,h as At,i as Pt,k as zt,W as Ut,D as Ce,m as Et,n as $t,C as Fe,o as Bt,S as Lt,M as Ot,Y as Vt,Z as Rt,q as Tt,t as qt,v as Qt,w as Ht}from"./index-kTCMLqQo.js";import{u as Ze,M as ye,U as Wt,o as Je,c as et,a as ue,b as Yt,T as Ge,d as Gt,F as Kt,C as Xt,P as Zt}from"./CommentSection-BDi--OqO.js";import{C as Jt,D as es}from"./DataTable-B7M9kmQr.js";import{E as ts}from"./ErrorState-BDKX-uvj.js";import{M as ss}from"./Modal-Co5e9u24.js";import{P as Ke}from"./plus-circle-C6nL9ayl.js";import{A as rs}from"./archive-I-kedVHK.js";const as=et().shape({selectedCategoryId:ue().required("Please select a misc category."),selectedFile:Yt().when("$isEditMode",{is:i=>!i,then:i=>i.required("Please select a file to upload.").test("filePresent","File is required for upload.",c=>!!c),otherwise:i=>i.nullable()}),title:ue().transform(i=>i===""?void 0:i).optional().max(255,"Title cannot exceed 255 characters.").nullable(),description:ue().transform(i=>i===""?void 0:i).optional().max(1e3,"Description cannot exceed 1000 characters.").nullable()}),is=({fileToEdit:i,preselectedCategoryId:c,onUploadSuccess:g,onFileUpdated:x,onCancelEdit:b})=>{const d=!!i,{register:N,handleSubmit:O,formState:{errors:m},watch:Y,setValue:V,reset:y}=Ze({resolver:Je(as),context:{isEditMode:d},defaultValues:{selectedCategoryId:(c==null?void 0:c.toString())||"",title:"",description:"",selectedFile:null}}),[P,R]=s.useState([]),[z,p]=s.useState(null),[w,j]=s.useState(!1),[U,D]=s.useState(!1),[f,h]=s.useState(0),[S,G]=s.useState(!1),C=s.useRef(null),{isAuthenticated:te,user:se}=Ne(),_=se==null?void 0:se.role,A=Y("selectedFile");s.useEffect(()=>{const l=E=>{S&&(E.preventDefault(),E.returnValue="")};return window.addEventListener("beforeunload",l),()=>{window.removeEventListener("beforeunload",l)}},[S]),s.useEffect(()=>{const l=()=>{document.visibilityState==="hidden"&&S&&St("Changing tabs or minimizing the window might interrupt the upload process.")};return document.addEventListener("visibilitychange",l),()=>{document.removeEventListener("visibilitychange",l)}},[S]),s.useEffect(()=>{te&&(_==="admin"||_==="super_admin")&&(D(!0),Xe().then(R).catch(()=>u("Failed to load misc categories.")).finally(()=>D(!1)))},[te,_]),s.useEffect(()=>{d&&i?(y({selectedCategoryId:i.misc_category_id.toString(),title:i.user_provided_title||"",description:i.user_provided_description||"",selectedFile:null}),p(i.original_filename),C.current&&(C.current.value="")):(y({selectedCategoryId:(c==null?void 0:c.toString())||"",title:"",description:"",selectedFile:null}),p(null),C.current&&(C.current.value=""))},[d,i,c,y]);const K=l=>{l.target.files&&l.target.files[0]?(V("selectedFile",l.target.files[0],{shouldValidate:!0,shouldDirty:!0}),d&&p(null)):V("selectedFile",null,{shouldValidate:!0,shouldDirty:!0})},pe=()=>{V("selectedFile",null,{shouldValidate:!0,shouldDirty:!0}),C.current&&(C.current.value=""),d&&i&&p(i.original_filename)},X=async l=>{var E,T,Z,q,ae,$;if(!te||!_||!["admin","super_admin"].includes(_)){u("Not authorized.");return}j(!0),l.selectedFile&&G(!0),h(0);try{let B;if(l.selectedFile){const F={misc_category_id:l.selectedCategoryId,user_provided_title:((E=l.title)==null?void 0:E.trim())||"",user_provided_description:((T=l.description)==null?void 0:T.trim())||""};B=await _t(l.selectedFile,"misc_file",F,J=>h(J)),g&&g(B),y({selectedCategoryId:(c==null?void 0:c.toString())||l.selectedCategoryId,title:"",description:"",selectedFile:null}),C.current&&(C.current.value="")}else if(d&&i){const F=new FormData;F.append("misc_category_id",l.selectedCategoryId),F.append("user_provided_title",((Z=l.title)==null?void 0:Z.trim())||""),F.append("user_provided_description",((q=l.description)==null?void 0:q.trim())||""),B=await Mt(i.id,F),x&&x(B)}else{u("No file selected for new upload."),j(!1);return}}catch(B){const F=(($=(ae=B.response)==null?void 0:ae.data)==null?void 0:$.msg)||B.message;let J="File operation failed.";F&&typeof F=="string"&&F.includes("UNIQUE constraint failed")?J="A file with this title or name already exists in this category. Please use a different title or check for duplicates.":F&&(J=F),u(J),l.selectedFile&&G(!1)}finally{j(!1),l.selectedFile&&G(!1)}},re=l=>{console.error("Form validation errors:",l),u("Please correct the errors highlighted in the form.")};return!te||!_||!["admin","super_admin"].includes(_)?null:e.jsxs("form",{onSubmit:O(X,re),className:"space-y-6 bg-white dark:bg-gray-800 dark:border-gray-700 p-6 rounded-lg shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:d?"Edit Miscellaneous File":"Upload File to Misc Category"}),d&&b&&e.jsxs("button",{type:"button",onClick:b,disabled:w,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[e.jsx(ye,{size:18,className:"mr-2"}),"Cancel Edit"]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectedCategoryId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Misc Category*"}),U?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading categories..."}):e.jsxs("select",{id:"selectedCategoryId",...N("selectedCategoryId"),disabled:w||P.length===0,className:`mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md ${m.selectedCategoryId?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a category"}),P.map(l=>e.jsx("option",{value:l.id.toString(),children:l.name},l.id))]}),m.selectedCategoryId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.selectedCategoryId.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d?"Replace File (Optional)":"Select File*"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md dark:border-gray-600 hover:border-blue-500 dark:hover:border-blue-400",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(Wt,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500"}),e.jsxs("div",{className:"flex text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("label",{htmlFor:"selectedFile",className:"relative cursor-pointer bg-white dark:bg-gray-800 rounded-md font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300 focus-within:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("span",{children:A?"Change file":"Upload a file"}),e.jsx("input",{id:"selectedFile",name:"selectedFile-input",type:"file",className:"sr-only",onChange:K,ref:C,disabled:w})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Any allowed file type."})]})}),(A||d&&z)&&e.jsxs("div",{className:"mt-3 flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden",children:[e.jsx(Ft,{size:18,className:"text-gray-500 dark:text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:A?A.name:z}),d&&z&&!A&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:"(current file)"})]}),A&&e.jsx("button",{type:"button",onClick:pe,disabled:w,className:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-200 dark:text-gray-500 dark:hover:text-gray-300 dark:hover:bg-gray-600",children:e.jsx(Nt,{size:16})})]}),m.selectedFile&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.selectedFile.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"File Title (Optional)"}),e.jsx("input",{type:"text",id:"title",...N("title"),placeholder:d&&i?i.original_filename:"Defaults to filename if blank",disabled:w,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${m.title?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),m.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.title.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"File Description (Optional)"}),e.jsx("textarea",{id:"description",rows:3,...N("description"),disabled:w,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${m.description?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),m.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.description.message})]}),e.jsx("div",{className:"flex space-x-3",children:e.jsx("button",{type:"submit",disabled:w||U||!d&&!A||!Y("selectedCategoryId"),className:"flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:w?d?"Updating...":"Uploading...":d?"Update File Details":"Upload to Misc"})}),w&&A&&f>0&&e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-4 dark:bg-gray-700 my-3 relative",children:[e.jsx("div",{className:"bg-blue-600 h-4 rounded-full transition-all duration-150 ease-out",style:{width:`${f}%`}}),e.jsxs("p",{className:"absolute inset-0 text-center text-xs font-medium leading-4 text-white dark:text-gray-100",children:[Math.round(f),"%"]})]})]})},ls=et().shape({name:ue().required("Category name is required.").max(100,"Category name cannot exceed 100 characters."),description:ue().optional().max(500,"Description cannot exceed 500 characters.").nullable()}),os=({categoryToEdit:i,onSuccess:c,onCancel:g})=>{const x=!!i,{register:b,handleSubmit:d,formState:{errors:N},reset:O}=Ze({resolver:Je(ls),defaultValues:{name:"",description:""}}),[m,Y]=s.useState(!1),{isAuthenticated:V,user:y}=Ne(),P=y==null?void 0:y.role;s.useEffect(()=>{O(x&&i?{name:i.name,description:i.description||""}:{name:"",description:""})},[i,x,O]);const R=async p=>{var w,j,U,D;Y(!0);try{let f;if(x&&i){const h={};let S=!1;p.name.trim()!==i.name&&(h.name=p.name.trim(),S=!0);const G=i.description||"",C=((w=p.description)==null?void 0:w.trim())||"";if(C!==G&&(h.description=C||void 0,S=!0),!S){Ye.info("No changes detected."),Y(!1),c&&c(i);return}f=await It(i.id,h)}else{const h={name:p.name.trim(),description:((j=p.description)==null?void 0:j.trim())||void 0};f=await Dt(h)}W("Category saved successfully!"),x||O({name:"",description:""}),c&&c(f)}catch(f){const h=((D=(U=f.response)==null?void 0:U.data)==null?void 0:D.msg)||f.message;let S=`Failed to ${x?"update":"add"} category.`;h&&typeof h=="string"&&h.includes("UNIQUE constraint failed")?S="A category with this name already exists. Please use a different name.":h&&(S=h),u(S)}finally{Y(!1)}},z=p=>{console.error("Form validation errors:",p),Ye.error("Please correct the errors in the form.")};return!V||!P||!["admin","super_admin"].includes(P)?e.jsx("p",{children:"You are not authorized to manage categories."}):e.jsxs("form",{onSubmit:d(R,z),className:"space-y-4 p-4 border border-gray-200 rounded-lg bg-white shadow-sm dark:bg-gray-800 dark:border-gray-700",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800 dark:text-gray-100",children:x?"Edit Miscellaneous Category":"Add New Miscellaneous Category"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name*"}),e.jsx("input",{type:"text",id:"name",...b("name"),disabled:m,className:`mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${N.name?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),N.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:N.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Description"}),e.jsx("textarea",{id:"description",...b("description"),rows:3,disabled:m,className:`mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${N.description?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),N.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:N.description.message})]}),e.jsxs("div",{className:"flex items-center space-x-3 pt-2",children:[e.jsx("button",{type:"submit",disabled:m,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-60",children:m?x?"Updating...":"Adding...":x?"Save Changes":"Add Category"}),g&&e.jsxs("button",{type:"button",onClick:g,disabled:m,className:"inline-flex items-center justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-60",children:[e.jsx(ye,{size:18,className:"mr-2"}),x?"Cancel Edit":"Cancel"]})]})]})},ns="http://192.168.3.129:7000",xs=()=>{const{searchTerm:i,setSearchTerm:c}=At(),{isAuthenticated:g,user:x}=Ne(),b=x==null?void 0:x.role,[d,N]=s.useState([]),[O,m]=s.useState(!0),[Y,V]=s.useState(null),[y,P]=s.useState([]),[R,z]=s.useState(!0),[p,w]=s.useState(null),[j,U]=s.useState(null),[D,f]=s.useState(1),[h,S]=s.useState(15),[G,C]=s.useState(0),[te,se]=s.useState(0),[_,A]=s.useState("user_provided_title"),[K,pe]=s.useState("asc"),[X,re]=s.useState(!1),[l,E]=s.useState(null),[T,Z]=s.useState(!1),[q,ae]=s.useState(null),[$,B]=s.useState(null),[F,J]=s.useState(!1),[tt,Se]=s.useState(!1),[Q,_e]=s.useState(null),[Me,Ie]=s.useState(!1),[De,Ae]=s.useState(!1),[ie,le]=s.useState(new Map),[Pe,st]=s.useState(!0),[M,oe]=s.useState(new Set),[ze,Ue]=s.useState(!1),[rt,Ee]=s.useState(!1),[ne,$e]=s.useState(!1),[Be,ge]=s.useState(!1),[fe,ve]=s.useState(null),[Le,ke]=s.useState(!1),[v,de]=s.useState(null),he=s.useRef(null),Oe=Pt(),[xe,at]=zt(),[it,L]=s.useState(null),we=s.useMemo(()=>j!==null||i!=="",[j,i]),I=s.useCallback(async(t,r=!1)=>{var a,n;r&&z(!0),w(null);try{const o=await Ut(j||void 0,t,h,_,K,i);P(o.misc_files),C(o.total_pages),se(o.total_misc_files),f(o.page),S(o.per_page);const k=new Map;g&&o.misc_files&&o.misc_files.forEach(ce=>k.set(ce.id,{favoriteId:ce.favorite_id})),le(k)}catch(o){const k=((n=(a=o.response)==null?void 0:a.data)==null?void 0:n.msg)||o.message||"Failed to fetch files.";r?(w(k),P([]),C(0),se(0)):u(k)}finally{r&&z(!1)}},[j,h,_,K,g,i]),lt=s.useCallback(()=>{L(null),U(null),c&&c(""),f(1)},[c,L]),be=s.useCallback(async()=>{var t,r;m(!0),V(null);try{const a=await Xe();N(a)}catch(a){N([]);const n=((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.msg)||a.message||"Failed to load categories.";V(n),u(n)}finally{m(!1)}},[]);s.useEffect(()=>{g?be():N([])},[g,be]),s.useEffect(()=>{const t=xe.get("page"),r=xe.get("highlight");if(t){const a=parseInt(t,10);!isNaN(a)&&a>0&&a!==D&&(f(a),I(a,!0))}L(r||null)},[xe,D,f,I]),s.useEffect(()=>{const t=new URLSearchParams(Oe.search),r=t.get("item_id"),a=t.get("comment_id");if(r&&a&&y.length>0){const n=parseInt(r,10);if(!isNaN(n)){const o=y.find(k=>k.id===n);o?((!v||v.id!==o.id)&&de(o),setTimeout(()=>{var k;(k=he.current)==null||k.scrollIntoView({behavior:"smooth",block:"center"})},100)):console.warn(`MiscView: MiscFile with item_id ${n} not found in the current list.`)}}},[Oe.search,y,v]),s.useEffect(()=>{L(null),g?I(1,!0):(P([]),z(!1))},[g,j,_,K,i,I,L]),s.useEffect(()=>{oe(new Set)},[j,_,K,i,D]);const ot=t=>{L(null),U(t.target.value?parseInt(t.target.value):null),f(1)},nt=t=>{L(null),f(t),I(t,!0);const r=new URLSearchParams(xe);r.set("page",t.toString()),r.delete("highlight"),at(r)},dt=t=>{L(null),A(t),pe(r=>_===t&&r==="asc"?"desc":"asc"),f(1)},Ve=(t,r)=>{Z(!1),ae(null),I(1,!0)},ct=t=>{re(!1),E(null),be()},Re=t=>{ae(t||null),Z(!0),re(!1),t&&window.scrollTo({top:0,behavior:"smooth"})},Te=()=>{ae(null),Z(!1)},mt=()=>{E(null),re(!0),Z(!1)},qe=()=>{E(null),re(!1)},Qe=()=>{B(null),J(!1)},ut=t=>{_e(t),Ie(!0)},je=()=>{_e(null),Ie(!1)},gt=async()=>{var t,r;if($){Se(!0);try{await Vt($.id),W(`Category "${$.name}" deleted.`),Qe(),be(),j===$.id&&U(null)}catch(a){u(((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.msg)||"Delete failed.")}finally{Se(!1)}}},ft=async()=>{if(Q){Ae(!0),v&&v.id===Q.id&&de(null);try{await Rt(Q.id),W(`File "${Q.user_provided_title||Q.original_filename}" deleted.`),je(),I(1,!0)}catch(t){u(t.message||"Delete failed."),je()}finally{Ae(!1)}}},ht=(t,r)=>oe(a=>{const n=new Set(a);return r?n.add(t):n.delete(t),n}),xt=t=>{const r=new Set;t&&y.forEach(a=>r.add(a.id)),oe(r)},bt=()=>{if(M.size===0){u("No items selected.");return}ke(!0)},yt=async()=>{ke(!1),Ue(!0),v&&M.has(v.id)&&de(null);try{const t=await Tt(Array.from(M),"misc_file");W(t.msg||`${t.deleted_count} file(s) deleted.`),oe(new Set),I(1,!0)}catch(t){u(t.message||"Bulk delete failed.")}finally{Ue(!1)}},pt=async()=>{if(M.size===0){u("No items selected.");return}Ee(!0);try{const t=await Bt(Array.from(M),"misc_file"),r=URL.createObjectURL(t),a=document.createElement("a");a.href=r;const n=new Date().toISOString().replace(/:/g,"-");a.download=`bulk_download_misc_files_${n}.zip`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r),W("Download started.")}catch(t){u(t.message||"Bulk download failed.")}finally{Ee(!1)}},vt=()=>{if(M.size===0){u("No items selected.");return}if(d.length===0){u("Categories unavailable for move.");return}ve(null),ge(!0)},kt=async()=>{if(!fe){u("Select target category.");return}ge(!1),$e(!0);try{const t=await qt(Array.from(M),"misc_file",{target_misc_category_id:fe});W(t.msg||`${t.moved_count} file(s) moved.`),oe(new Set),I(1,!0)}catch(t){let r="Bulk move failed.";t.message&&typeof t.message=="string"&&t.message.includes("UNIQUE constraint failed")?r="A file with this name already exists in the target category. Please check for duplicates.":t.message&&(r=t.message),u(r)}finally{$e(!1),ve(null)}},wt=t=>{if(t==null)return"N/A";if(t===0)return"0 B";const r=1024,a=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(t)/Math.log(r));return parseFloat((t/Math.pow(r,n)).toFixed(2))+" "+a[n]},jt=[{key:"user_provided_title",header:"Title",sortable:!0,render:t=>t.user_provided_title||e.jsx("span",{className:"italic text-gray-500 dark:text-gray-400",children:t.original_filename})},{key:"original_filename",header:"Original Filename",sortable:!0},{key:"category_name",header:"Category",sortable:!0},{key:"uploaded_by_username",header:"Uploaded By",sortable:!0,render:t=>t.uploaded_by_username||"N/A"},{key:"file_size",header:"Size",sortable:!0,render:t=>wt(t.file_size)},{key:"created_at",header:"Uploaded At",sortable:!0,render:t=>$t(t.created_at??"")},{key:"file_path",header:"Link",render:t=>t.is_downloadable!==!1?e.jsxs("a",{href:`${ns}${t.file_path}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-blue-600 hover:text-blue-800",onClick:a=>a.stopPropagation(),title:"Download file",children:[e.jsx(Ce,{size:14,className:"mr-1"}),"Download"]}):e.jsxs("span",{className:"flex items-center text-gray-400 cursor-not-allowed",title:"Download not permitted",children:[e.jsx(Ce,{size:14,className:"mr-1"}),"Download"]})},{key:"actions",header:"Actions",render:t=>{var r,a,n;return e.jsxs("div",{className:"flex space-x-1 items-center",children:[g&&e.jsx("button",{onClick:o=>{o.stopPropagation(),Ct(t,"misc_file")},className:`p-1 rounded-md ${(r=ie.get(t.id))!=null&&r.favoriteId?"text-yellow-500 hover:text-yellow-600":"text-gray-400 hover:text-yellow-500"}`,title:(a=ie.get(t.id))!=null&&a.favoriteId?"Remove Favorite":"Add Favorite",children:e.jsx(Lt,{size:16,className:(n=ie.get(t.id))!=null&&n.favoriteId?"fill-current":""})}),g&&e.jsxs("button",{onClick:o=>{o.stopPropagation(),v&&v.id===t.id?de(null):(de(t),setTimeout(()=>{var k;return(k=he.current)==null?void 0:k.scrollIntoView({behavior:"smooth"})},0))},className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 rounded-md",title:v&&v.id===t.id?"Hide Comments":"View Comments",children:[e.jsx(Ot,{size:16}),e.jsxs("span",{className:"ml-1 text-xs",children:["(",t.comment_count??0,")"]})]}),(b==="admin"||b==="super_admin")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),Re(t)},className:"p-1 text-blue-600 hover:text-blue-800 rounded-md",title:"Edit",children:e.jsx(Zt,{size:16})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),ut(t)},className:"p-1 text-red-600 hover:text-red-800 rounded-md",title:"Delete",children:e.jsx(Ge,{size:16})})]})]})}}],He=s.useCallback(()=>{I(1,!0)},[I]),Ct=async(t,r)=>{var k,ce;if(!g){u("Log in to manage favorites.");return}const a=ie.get(t.id),n=!!(a!=null&&a.favoriteId),o=new Map(ie);n?o.set(t.id,{favoriteId:void 0}):o.set(t.id,{favoriteId:-1}),le(o);try{const ee=t.user_provided_title||t.original_filename;if(n&&typeof(a==null?void 0:a.favoriteId)=="number")await Qt(t.id,r),W(`"${ee}" removed from favorites.`),le(me=>{const H=new Map(me);return H.set(t.id,{favoriteId:void 0}),H});else{const me=await Ht(t.id,r);le(H=>{const We=new Map(H);return We.set(t.id,{favoriteId:me.id}),We}),W(`"${ee}" added to favorites.`)}}catch(ee){u(((ce=(k=ee==null?void 0:ee.response)==null?void 0:k.data)==null?void 0:ce.msg)||ee.message||"Failed to update favorite."),le(me=>{const H=new Map(me);return n?H.set(t.id,{favoriteId:a==null?void 0:a.favoriteId}):H.set(t.id,{favoriteId:void 0}),H})}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-start sm:items-center mb-6 flex-col sm:flex-row",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Miscellaneous Files"}),e.jsx("p",{className:"text-gray-600 mt-1 dark:text-gray-300",children:"Manage and browse categorized files."})]}),g&&(b==="admin"||b==="super_admin")&&e.jsxs("div",{className:"flex space-x-3 mt-4 sm:mt-0",children:[e.jsxs("button",{onClick:X&&!l?qe:mt,className:`inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white focus:outline-none focus:ring-2 focus:ring-offset-2
                ${X&&!l?"bg-red-600 hover:bg-red-700 focus:ring-red-500":"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500"}`,children:[X&&!l?e.jsx(ye,{size:18,className:"mr-2"}):e.jsx(Ke,{size:18,className:"mr-2"}),X&&!l?"Cancel":"Add/Edit Category"]}),e.jsxs("button",{onClick:T&&!q?Te:()=>Re(),className:`inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white focus:outline-none focus:ring-2 focus:ring-offset-2
                ${T&&!q?"bg-red-600 hover:bg-red-700 focus:ring-red-500":"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500"}`,children:[T&&!q?e.jsx(ye,{size:18,className:"mr-2"}):e.jsx(Ke,{size:18,className:"mr-2"}),T&&!q?"Cancel":"Upload New File"]})]})]}),X&&e.jsx("div",{className:"my-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg shadow",children:e.jsx(os,{categoryToEdit:l,onSuccess:t=>ct(`Category "${t.name}" saved.`),onCancel:qe})}),T&&e.jsx("div",{className:"my-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg shadow",children:e.jsx(is,{fileToEdit:q,onUploadSuccess:t=>Ve(),onFileUpdated:t=>Ve(),onCancelEdit:Te})}),M.size>0&&e.jsx("div",{className:"my-4 p-3 bg-gray-100 dark:bg-gray-700 rounded-md shadow-sm border border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:[M.size," item(s) selected"]}),(b==="admin"||b==="super_admin")&&e.jsxs("button",{onClick:bt,disabled:ze,className:"px-3 py-1.5 text-xs font-medium rounded-md shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 text-white bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 focus:ring-red-500 disabled:opacity-50",children:[e.jsx(Ge,{size:14,className:"mr-1.5"}),"Delete"]}),g&&e.jsxs("button",{onClick:pt,disabled:rt,className:"px-3 py-1.5 text-xs font-medium rounded-md shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 text-white bg-green-500 hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700 focus:ring-green-500 disabled:opacity-50",children:[e.jsx(Ce,{size:14,className:"mr-1.5"}),"Download"]}),(b==="admin"||b==="super_admin")&&e.jsxs("button",{onClick:vt,disabled:ne,className:"px-3 py-1.5 text-xs font-medium rounded-md shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 text-white bg-blue-500 hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700 focus:ring-blue-500 disabled:opacity-50",children:[e.jsx(Gt,{size:14,className:"mr-1.5"}),"Move"]})]})}),e.jsxs("div",{className:"my-4",children:[e.jsxs("button",{onClick:()=>st(t=>!t),className:"flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-md text-sm font-medium mb-2",children:[Pe?e.jsx(Jt,{size:18,className:"mr-2"}):e.jsx(Kt,{size:18,className:"mr-2"})," Category Filter"]}),Pe&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"category-filter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sr-only",children:"Filter by Category"}),e.jsxs("select",{id:"category-filter",value:j??"",onChange:ot,className:"block w-full sm:w-1/3 pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200",disabled:O||d.length===0,children:[e.jsx("option",{value:"",children:"All Categories"}),d.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),R?e.jsx("div",{className:"py-10",children:e.jsx(Et,{message:"Loading files..."})}):p&&y.length===0&&!R?e.jsx(ts,{message:p,onRetry:He}):!R&&!p&&y.length===0?e.jsxs("div",{className:"text-center py-10 bg-white dark:bg-gray-800 rounded-lg shadow-sm my-6",children:[e.jsx(rs,{size:48,className:"mx-auto text-yellow-500 dark:text-yellow-400 mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-700 dark:text-gray-200 mb-3",children:we?"No Files Found Matching Criteria":"No Files Available"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 px-4",children:we?"Try adjusting or clearing your search/filter settings.":b==="admin"||b==="super_admin"?"Upload new files to get started.":"Please check back later."}),we&&e.jsx("button",{onClick:lt,className:"mt-6 btn-primary text-sm",children:"Clear All Filters & Search"})]}):e.jsx(es,{columns:jt,data:y,highlightedRowId:it,rowClassName:"group",isLoading:R||De,currentPage:D,totalPages:G,onPageChange:nt,itemsPerPage:h,totalItems:te,sortColumn:_,sortOrder:K,onSort:dt,isSelectionEnabled:!0,selectedItemIds:M,onSelectItem:ht,onSelectAllItems:xt}),F&&$&&e.jsx(Fe,{isOpen:F,title:"Delete Category",message:`Delete category "${$.name}"? Files in it won't be deleted but will become uncategorized.`,onConfirm:gt,onCancel:Qe,isConfirming:tt,confirmButtonText:"Delete",confirmButtonVariant:"danger"}),Me&&Q&&e.jsx(Fe,{isOpen:Me,title:"Delete File",message:`Delete "${Q.user_provided_title||Q.original_filename}"?`,onConfirm:ft,onCancel:je,isConfirming:De,confirmButtonText:"Delete",confirmButtonVariant:"danger"}),Le&&e.jsx(Fe,{isOpen:Le,title:`Delete ${M.size} File(s)`,message:`Delete ${M.size} selected items?`,onConfirm:yt,onCancel:()=>ke(!1),isConfirming:ze,confirmButtonText:"Delete Selected",confirmButtonVariant:"danger"}),Be&&e.jsx(ss,{isOpen:Be,onClose:()=>ge(!1),title:`Move ${M.size} File(s)`,children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:"Select target category:"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"modalCategoryMove",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Target Category*"}),e.jsxs("select",{id:"modalCategoryMove",value:fe??"",onChange:t=>ve(t.target.value?parseInt(t.target.value):null),className:"input-class w-full dark:bg-gray-700 dark:text-white dark:border-gray-600",disabled:ne||d.length===0,children:[e.jsx("option",{value:"",children:"Select Category..."}),d.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),d.length===0&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Categories unavailable."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>ge(!1),className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:ne,children:"Cancel"}),e.jsx("button",{type:"button",onClick:kt,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:ne||!fe,children:ne?"Moving...":"Confirm Move"})]})]})}),g&&v&&e.jsxs("div",{ref:he,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-4",children:["Comments for: ",e.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:v.user_provided_title||v.original_filename})]}),e.jsx(Xt,{itemId:v.id,itemType:"misc_file",onCommentAction:He})]}),!g&&v&&e.jsx("div",{ref:he,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Please log in to view and manage comments."})})]})};export{xs as default};
