import{r as a,u as nt,f as ot,s as u,x as Ae,j as e,L as Pt,F as tt,X as Ct,a as Dt,y as Mt,b as M,z as At,A as Lt,g as Ut,h as $t,i as Rt,k as zt,B as Et,D as Oe,m as Bt,P as Ot,G as qt,n as st,C as rt,o as Tt,R as qe,E as Ht,S as Wt,M as Xt,H as Gt,q as Jt,t as Yt,v as Zt,w as Kt}from"./index-CRY20gw9.js";import{u as Qt,M as it,e as es,U as ts,o as ss,c as rs,f as as,a as D,b as ls,T as at,d as ns,F as os,C as is,P as ds}from"./CommentSection-DzCzTiYL.js";import{C as cs,D as ms}from"./DataTable-DQWsU1Ng.js";import{y as us,F as fs,E as gs}from"./validationUtils-WU0SlS9E.js";import{E as hs}from"./ErrorState-Bk4iuA34.js";import{F as xs}from"./fuse-Ch1WBRTM.js";import{M as ps}from"./Modal-Dq8btZl1.js";import{P as bs}from"./plus-circle-B969A4oC.js";const lt=()=>{const r=new Date,y=r.getFullYear(),f=String(r.getMonth()+1).padStart(2,"0"),W=String(r.getDate()).padStart(2,"0");return`${y}-${f}-${W}`},ce="CREATE_NEW_VERSION_SENTINEL_VALUE",ys=rs().shape({selectedSoftwareId:D().required("Software Product must be selected."),selectedVersionId:D().required("Version selection is required."),typedVersionString:D().when("selectedVersionId",{is:ce,then:r=>r.required("New Version String is required when 'Enter New Version' is selected.").min(1),otherwise:r=>r.transform(y=>y===""?void 0:y).optional().nullable()}),patchName:D().trim().min(1,"Patch Name cannot be empty and must contain non-space characters.").max(255,"Patch Name cannot exceed 255 characters."),releaseDate:D().transform(r=>r===""?void 0:r).optional().nullable(),inputMode:D().oneOf(["url","upload"]).required("Input mode must be selected."),externalUrl:D().when("inputMode",(r,y)=>(Array.isArray(r)?r[0]:r)==="url"?us().required("External Download URL is required."):D().optional().nullable()),selectedFile:ls().when(["inputMode","$isEditMode","$patchToEditIsExternal"],{is:(r,y,f)=>r!=="upload"?!1:!!(!y||y&&f),then:r=>r.required("Please select a file to upload.").test("filePresent","File is required for upload.",y=>!!y),otherwise:r=>r.nullable()}),description:D().transform(r=>r===""?void 0:r).optional().max(2e3,"Description cannot exceed 2000 characters.").nullable(),patch_by_developer:D().transform(r=>r===""?void 0:r).optional().max(255,"Patch developer name cannot exceed 255 characters.").nullable(),compatibleVmsVersionIds:as().of(D().required()).optional()}),vs=({patchToEdit:r,onPatchAdded:y,onPatchUpdated:f,onCancelEdit:W})=>{const d=!!r,{register:p,handleSubmit:we,control:Q,formState:{errors:i},watch:w,setValue:k,reset:me}=Qt({resolver:ss(ys),context:{isEditMode:d,patchToEditIsExternal:(r==null?void 0:r.is_external_link)||!1},defaultValues:{selectedSoftwareId:"",selectedVersionId:"",typedVersionString:"",patchName:"",releaseDate:lt(),description:"",inputMode:"url",externalUrl:"",selectedFile:null,patch_by_developer:"",compatibleVmsVersionIds:[]}}),[I,E]=a.useState([]),[A,B]=a.useState([]),[ue,L]=a.useState([]),[X,U]=a.useState(!1),[G,$]=a.useState(null),[v,O]=a.useState(!1),[ee,q]=a.useState(!1),[Ne,te]=a.useState(!1),[T,fe]=a.useState(0),[ge,se]=a.useState(!1),R=a.useRef(null),{isAuthenticated:ke,user:he}=nt(),F=he==null?void 0:he.role,j=w("selectedSoftwareId"),re=w("selectedVersionId"),Se=w("inputMode"),P=w("selectedFile"),ae=re===ce;a.useEffect(()=>{const s=c=>{ge&&(c.preventDefault(),c.returnValue="")};return window.addEventListener("beforeunload",s),()=>{window.removeEventListener("beforeunload",s)}},[ge]),a.useEffect(()=>{const s=()=>{document.visibilityState==="hidden"&&ge&&Dt("Changing tabs or minimizing the window might interrupt the upload process.")};return document.addEventListener("visibilitychange",s),()=>{document.removeEventListener("visibilitychange",s)}},[ge]),a.useEffect(()=>{ke&&(F==="admin"||F==="super_admin")&&(q(!0),ot().then(E).catch(()=>u("Failed to load software list.")).finally(()=>q(!1)))},[ke,F]),a.useEffect(()=>{if(j&&I.length>0){q(!0),B([]),k("selectedVersionId",""),k("typedVersionString","");const s=I.find(c=>c.id.toString()===j);if(s&&s.name==="VA"){U(!0);const c=I.find(g=>g.name==="VMS");c?(te(!0),Ae(c.id).then(L).catch(()=>u("Failed to load VMS versions for compatibility.")).finally(()=>te(!1))):L([])}else U(!1),L([]);Ae(parseInt(j)).then(B).catch(()=>u("Failed to load versions.")).finally(()=>q(!1))}else B([]),U(!1),L([]),k("selectedVersionId",""),k("typedVersionString","")},[j,k,I]),a.useEffect(()=>{if(d&&r&&I.length>0){const s=I.find(h=>h.id===r.software_id),c=!!s&&(s.name==="VMS"||s.name==="VA");U(c);const g={selectedSoftwareId:j&&j!==r.software_id.toString()?j:r.software_id.toString(),patchName:r.patch_name,releaseDate:r.release_date?r.release_date.split("T")[0]:"",description:r.description||"",inputMode:r.is_external_link?"url":"upload",externalUrl:r.is_external_link?r.download_link:"",patch_by_developer:r.patch_by_developer||"",compatibleVmsVersionIds:c&&r.compatible_vms_versions?typeof r.compatible_vms_versions=="string"?r.compatible_vms_versions.split(",").map(h=>h.trim()).filter(h=>h):Array.isArray(r.compatible_vms_versions)?r.compatible_vms_versions.map(String):[]:[]};j===r.software_id.toString()&&(r.version_id&&A.length>0?A.find(z=>z.id===r.version_id)?g.selectedVersionId=r.version_id.toString():(g.selectedVersionId=ce,g.typedVersionString=r.version_number):r.version_number&&(g.selectedVersionId=ce,g.typedVersionString=r.version_number)),me(g),r.is_external_link?$(null):$(r.original_filename_ref||r.download_link.split("/").pop()||"unknown_file"),k("selectedFile",null),R.current&&(R.current.value="")}else d||le(!!j)},[d,r,A,j,me,k,I]);const le=(s=!1)=>{const c=s?w("selectedSoftwareId"):"";me({selectedSoftwareId:c,selectedVersionId:"",typedVersionString:"",patchName:"",releaseDate:lt(),description:"",inputMode:"url",externalUrl:"",selectedFile:null,patch_by_developer:"",compatibleVmsVersionIds:[]}),$(null),R.current&&(R.current.value="")},Ie=s=>{s.target.files&&s.target.files[0]?(k("selectedFile",s.target.files[0],{shouldValidate:!0,shouldDirty:!0}),$(null)):k("selectedFile",null,{shouldValidate:!0,shouldDirty:!0})},ne=()=>{k("selectedFile",null,{shouldValidate:!0,shouldDirty:!0}),R.current&&(R.current.value=""),d&&r&&!r.is_external_link&&$(r.original_filename_ref||r.download_link.split("/").pop()||"unknown_file")},xe=async s=>{var z,oe,ie,Y,Z,_e,Ve,S;O(!0),s.inputMode==="upload"&&s.selectedFile&&se(!0),fe(0);let c,g;s.selectedVersionId===ce&&s.typedVersionString?g=s.typedVersionString.trim():s.selectedVersionId&&s.selectedVersionId!==ce&&(c=parseInt(s.selectedVersionId));const h={software_id:parseInt(s.selectedSoftwareId),patch_name:s.patchName.trim(),description:((z=s.description)==null?void 0:z.trim())||void 0,release_date:s.releaseDate||void 0,patch_by_developer:((oe=s.patch_by_developer)==null?void 0:oe.trim())||void 0};c&&(h.version_id=c),g&&(h.typed_version_string=g),X&&s.compatibleVmsVersionIds&&s.compatibleVmsVersionIds.length>0&&(h.compatible_vms_version_ids=s.compatibleVmsVersionIds);try{let x;if(s.inputMode==="url"){const V={...h,download_link:s.externalUrl.trim(),is_external_link:!0};d&&r?(x=await Mt(r.id,V),M(`Patch "${x.patch_name}" updated successfully!`),f&&f(x)):(x=await At(V),M(`Patch "${x.patch_name}" added successfully!`),y&&y(x),d||(le(!0),k("selectedVersionId",""),k("typedVersionString","")))}else{const V={software_id:parseInt(s.selectedSoftwareId),patch_name:s.patchName.trim(),description:((ie=s.description)==null?void 0:ie.trim())||void 0,release_date:s.releaseDate||void 0,patch_by_developer:((Y=s.patch_by_developer)==null?void 0:Y.trim())||void 0,version_id:c,typed_version_string:g,compatible_vms_version_ids:X&&s.compatibleVmsVersionIds&&s.compatibleVmsVersionIds.length>0?s.compatibleVmsVersionIds:void 0};if(d&&r)if(!r.is_external_link||r.is_external_link&&s.selectedFile)x=await Lt(r.id,V,s.selectedFile||null),M(`Patch "${x.patch_name}" updated successfully!`),f&&f(x);else{u("If switching from a URL to an uploaded file, please select a file."),O(!1),se(!1);return}else if(s.selectedFile){const H={software_id:s.selectedSoftwareId,...c&&{version_id:c.toString()},...g&&{typed_version_string:g},patch_name:s.patchName.trim(),...s.releaseDate&&{release_date:s.releaseDate},description:((Z=s.description)==null?void 0:Z.trim())||"",patch_by_developer:((_e=s.patch_by_developer)==null?void 0:_e.trim())||"",...X&&s.compatibleVmsVersionIds&&s.compatibleVmsVersionIds.length>0&&{compatible_vms_version_ids_json:JSON.stringify(s.compatibleVmsVersionIds)}};x=await Ut(s.selectedFile,"patch",H,Le=>fe(Le)),M(`Patch "${x.patch_name}" added successfully via chunked upload!`),y&&y(x),le(!0),k("selectedVersionId",""),k("typedVersionString","")}else{u("No file selected for upload. Please select a file."),O(!1),se(!1);return}}}catch(x){const V=((S=(Ve=x.response)==null?void 0:Ve.data)==null?void 0:S.msg)||x.message;let H=`Failed to ${d?"update":"add"} patch.`;V&&typeof V=="string"&&V.includes("UNIQUE constraint failed")?d?H="A patch with this name already exists for this software/version. Please use a different name or check for duplicates.":H="A patch with this name already exists for this software/version. Please use a different name.":V&&(H=V),u(H),s.inputMode==="upload"&&se(!1)}finally{O(!1),s.inputMode==="upload"&&se(!1)}},J=s=>{console.error("Form validation errors:",s),u("Please correct the errors highlighted in the form.")};return!ke||!F||!["admin","super_admin"].includes(F)?null:e.jsxs("form",{onSubmit:we(xe,J),className:"space-y-6 bg-white dark:bg-gray-800 dark:border-gray-700 p-6 rounded-lg shadow-md border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:d?"Edit Patch":"Add New Patch"}),d&&W&&e.jsxs("button",{type:"button",onClick:W,disabled:v,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[e.jsx(it,{size:18,className:"mr-2"}),"Cancel Edit"]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectedSoftwareId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Software Product*"}),ee&&!I.length?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading software..."}):e.jsxs("select",{id:"selectedSoftwareId",...p("selectedSoftwareId"),disabled:v||ee&&!I.length,className:`mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md ${i.selectedSoftwareId?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`,children:[e.jsx("option",{value:"",disabled:!0,children:"Select Software Product"}),I.map(s=>e.jsx("option",{value:s.id.toString(),children:s.name},s.id))]}),i.selectedSoftwareId&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:i.selectedSoftwareId.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectedVersionId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Version*"}),e.jsx("div",{className:"mt-1",children:e.jsxs("select",{id:"selectedVersionId",...p("selectedVersionId"),disabled:v||ee||!j,className:`block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md ${i.selectedVersionId?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`,children:[e.jsx("option",{value:"",disabled:A.length>0&&!!j,children:ee&&j?"Loading versions...":"Select Existing Version"}),A.map(s=>e.jsx("option",{value:s.id.toString(),children:s.version_number},s.id)),e.jsx("option",{value:ce,children:"Enter New Version String..."})]})}),ae&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"typedVersionString",className:"block text-xs font-medium text-gray-600 dark:text-gray-400",children:"New Version String*:"}),e.jsx("input",{type:"text",id:"typedVersionString",...p("typedVersionString"),placeholder:"e.g., 2.5.1-hotfix",className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${i.typedVersionString?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"This version will be created for the selected software if it doesn't exist."})]}),i.selectedVersionId&&!ae&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.selectedVersionId.message}),i.typedVersionString&&ae&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.typedVersionString.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"patchName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Patch Name*"}),e.jsx("input",{type:"text",id:"patchName",...p("patchName"),disabled:v,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${i.patchName?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),i.patchName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.patchName.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"releaseDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Release Date"}),e.jsx("input",{type:"date",id:"releaseDate",...p("releaseDate"),disabled:v,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${i.releaseDate?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`}),i.releaseDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.releaseDate.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"patch_by_developer",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Patch By Developer"}),e.jsx("input",{type:"text",id:"patch_by_developer",...p("patch_by_developer"),disabled:v,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${i.patch_by_developer?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),i.patch_by_developer&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.patch_by_developer.message})]}),X&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"compatibleVmsVersionIds",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Compatible VMS Versions (for VMS/VA Patches)"}),Ne?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading VMS versions..."}):e.jsx(es,{name:"compatibleVmsVersionIds",control:Q,defaultValue:[],render:({field:s})=>e.jsx("div",{className:"mt-1 block w-full max-h-40 overflow-y-auto p-2 border border-gray-300 rounded-md bg-white dark:bg-gray-700 dark:border-gray-600",children:ue.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No VMS versions available."}):ue.map(c=>{var g;return e.jsxs("label",{className:"flex items-center space-x-2 p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:focus:ring-blue-600",value:c.id.toString(),checked:(g=s.value)==null?void 0:g.includes(c.id.toString()),onChange:h=>{const z=h.target.value,oe=h.target.checked?[...s.value||[],z]:(s.value||[]).filter(ie=>ie!==z);s.onChange(oe)},disabled:v||Ne}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:c.version_number})]},c.id)})})}),i.compatibleVmsVersionIds&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.compatibleVmsVersionIds.message}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Select VMS versions this patch is compatible with. Only applicable if the patch is for 'VMS' or 'VA' software."})]}),e.jsxs("div",{className:"my-4",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Patch Source:"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",...p("inputMode"),value:"url",className:"form-radio h-4 w-4 text-blue-600",disabled:v}),e.jsxs("span",{className:"flex items-center dark:text-gray-300",children:[e.jsx(Pt,{size:16,className:"mr-1 text-gray-600 dark:text-gray-400"}),"Provide External Link"]})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",...p("inputMode"),value:"upload",className:"form-radio h-4 w-4 text-blue-600",disabled:v}),e.jsxs("span",{className:"flex items-center dark:text-gray-300",children:[e.jsx(ts,{size:16,className:"mr-1 text-gray-600 dark:text-gray-400"}),"Upload File"]})]})]}),i.inputMode&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.inputMode.message})]}),Se==="url"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"externalUrl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"External Download URL*"}),e.jsx("input",{type:"text",id:"externalUrl",...p("externalUrl"),placeholder:"https://example.com/patch.exe",disabled:v,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${i.externalUrl?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),i.externalUrl&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.externalUrl.message})]}),Se==="upload"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d&&G&&!P?"Replace File (Optional)":"Select File to Upload*"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-blue-500 dark:border-gray-600 dark:hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(tt,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500"}),e.jsxs("div",{className:"flex text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("label",{htmlFor:"patch-file-upload-input",className:"relative cursor-pointer bg-white dark:bg-gray-800 rounded-md font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500",children:[e.jsx("span",{children:P?"Change file":"Upload a file"}),e.jsx("input",{id:"patch-file-upload-input",name:"patch-file-input",type:"file",className:"sr-only",onChange:Ie,ref:R,disabled:v})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"EXE, MSI, ZIP, etc."})]})}),(P||d&&G)&&e.jsxs("div",{className:"mt-3 flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden",children:[e.jsx(tt,{size:18,className:"text-gray-500 dark:text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:P?P.name:G}),d&&G&&!P&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:"(current)"})]}),P&&e.jsx("button",{type:"button",onClick:ne,disabled:v,className:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-200 dark:text-gray-500 dark:hover:text-gray-300 dark:hover:bg-gray-600",children:e.jsx(Ct,{size:16})})]}),i.selectedFile&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.selectedFile.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Description"}),e.jsx("textarea",{id:"description",rows:3,...p("description"),disabled:v,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${i.description?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),i.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.description.message})]}),e.jsx("div",{className:"flex space-x-3",children:e.jsx("button",{type:"submit",disabled:v||ee,className:"flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:v?d?"Updating...":"Adding...":d?"Update Patch":"Add Patch"})}),v&&Se==="upload"&&T>0&&e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-4 dark:bg-gray-700 my-3 relative",children:[e.jsx("div",{className:"bg-blue-600 h-4 rounded-full transition-all duration-150 ease-out",style:{width:`${T}%`}}),e.jsxs("p",{className:"absolute inset-0 text-center text-xs font-medium leading-4 text-white dark:text-gray-100",children:[Math.round(T),"%"]})]})]})},Fs=()=>{const{searchTerm:r,setSearchTerm:y}=$t(),{isAuthenticated:f,user:W}=nt(),d=W==null?void 0:W.role,[p,we]=a.useState([]),[Q,i]=a.useState([]),[w,k]=a.useState(null),[me,I]=a.useState([]),[E,A]=a.useState(null),[B,ue]=a.useState(""),[L,X]=a.useState(""),[U,G]=a.useState(""),[$,v]=a.useState(""),[O,ee]=a.useState(""),[q,Ne]=a.useState(""),[te,T]=a.useState(1),[fe,ge]=a.useState(15),[se,R]=a.useState(0),[ke,he]=a.useState(0),[F,j]=a.useState("patch_name"),[re,Se]=a.useState("asc"),[P,ae]=a.useState(!0),[le,Ie]=a.useState(null),[ne,xe]=a.useState(!1),[J,s]=a.useState(null),[c,g]=a.useState(!1),[h,z]=a.useState(null),[oe,ie]=a.useState(!1),[Y,Z]=a.useState(new Map),[_e,Ve]=a.useState(!1),[S,x]=a.useState(new Set),[V,H]=a.useState(!1),[Le,Te]=a.useState(!1),[pe,He]=a.useState(!1),[We,Fe]=a.useState(!1),[be,Ue]=a.useState(null),[$e,Xe]=a.useState([]),[Pe,Ce]=a.useState(null),[Ge,Re]=a.useState(!1),[ze,Je]=a.useState(!1),[N,je]=a.useState(null),De=a.useRef(null),Ye=Rt(),[Me,dt]=zt(),[ct,_]=a.useState(null),Ee=a.useMemo(()=>w!==null||E!==null||B!==""||L!==""||U!==""||r!=="",[w,E,B,L,U,r]),mt=a.useCallback(()=>{_(null),k(null),A(null),ue(""),X(""),G(""),y&&y("")},[y,_]),ut=()=>{ue(""),X(""),G("")},C=a.useCallback(async(t,n=!1)=>{var l,m;n&&ae(!0),Ie(null);try{const o=await Et(w??void 0,E??void 0,t,fe,F,re,$||void 0,O||void 0,q||void 0,r);we(o.patches),R(o.total_pages),he(o.total_patches),T(o.page),ge(o.per_page);const b=new Map;if(f&&o.patches)for(const de of o.patches)b.set(de.id,{favoriteId:de.favorite_id});Z(b)}catch(o){const b=((m=(l=o.response)==null?void 0:l.data)==null?void 0:m.msg)||o.message||"Failed to fetch patches.";n?(Ie(b),we([]),R(0),he(0)):u(b)}finally{n&&ae(!1)}},[w,E,fe,F,re,$,O,q,f,r]);a.useEffect(()=>{_(null);const t=setTimeout(()=>v(B),500);return()=>clearTimeout(t)},[B,_]),a.useEffect(()=>{_(null);const t=setTimeout(()=>ee(L),500);return()=>clearTimeout(t)},[L,_]),a.useEffect(()=>{_(null);const t=setTimeout(()=>Ne(U),500);return()=>clearTimeout(t)},[U,_]),a.useEffect(()=>{_(null),f?C(1,!0):(we([]),ae(!1))},[f,w,E,F,re,$,O,q,r,C,_]),a.useEffect(()=>{const t=Me.get("page"),n=Me.get("highlight");if(t){const l=parseInt(t,10);!isNaN(l)&&l>0&&l!==te&&(T(l),C(l,!0))}_(n||null)},[Me,te,T,C]),a.useEffect(()=>{const t=new URLSearchParams(Ye.search),n=t.get("item_id"),l=t.get("comment_id");if(n&&l&&p.length>0){const m=parseInt(n,10);if(!isNaN(m)){const o=p.find(b=>b.id===m);o?((!N||N.id!==o.id)&&je(o),setTimeout(()=>{var b;(b=De.current)==null||b.scrollIntoView({behavior:"smooth",block:"center"})},100)):console.warn(`PatchesView: Patch with item_id ${m} not found in the current list.`)}}},[Ye.search,p,N]),a.useEffect(()=>{x(new Set)},[w,E,F,re,$,O,q,r,te]),a.useEffect(()=>{f&&ot().then(i).catch(t=>u("Failed to load software list."))},[f]),a.useEffect(()=>{w?Ae(w).then(I).catch(t=>{var n,l;u(((l=(n=t.response)==null?void 0:n.data)==null?void 0:l.msg)||t.message||"Failed to fetch versions."),I([])}):(I([]),A(null))},[w]),a.useEffect(()=>{be?(Je(!0),Ae(be).then(Xe).catch(()=>u("Failed to load versions for move target.")).finally(()=>Je(!1))):Xe([])},[be]);const ft=t=>{k(t),_(null),A(null),T(1)},gt=t=>{_(null);const n=t.target.value?parseInt(t.target.value,10):null;A(n),T(1)},ht=t=>{_(null),j(t),Se(n=>F===t&&n==="asc"?"desc":"asc")},xt=t=>{_(null),C(t,!0);const n=new URLSearchParams(Me);n.set("page",t.toString()),n.delete("highlight"),dt(n)},Ze=t=>{xe(!1),s(null),C(1,!0)},pt=()=>{s(null),xe(!0)},bt=t=>{s(t),xe(!0),window.scrollTo({top:0,behavior:"smooth"})},Ke=()=>{s(null),xe(!1)},yt=t=>{z(t),g(!0)},Be=()=>{z(null),g(!1)},vt=async()=>{if(h){ie(!0),N&&N.id===h.id&&je(null);try{await Gt(h.id),M(`Patch "${h.patch_name}" deleted.`),Be(),C(1,!0)}catch(t){u(t.message||"Delete failed."),Be()}finally{ie(!1)}}},Qe=a.useMemo(()=>r?new xs(p,{keys:["patch_name","description","software_name","version_number","uploaded_by_username","updated_by_username"],includeScore:!0,threshold:.4}).search(r).map(n=>n.item):p,[p,r]),wt=(t,n)=>x(l=>{const m=new Set(l);return n?m.add(t):m.delete(t),m}),kt=t=>{const n=new Set;t&&Qe.forEach(l=>n.add(l.id)),x(n)},St=()=>{if(S.size===0){u("No items selected.");return}Re(!0)},_t=async()=>{Re(!1),H(!0),N&&S.has(N.id)&&je(null);try{const t=await Jt(Array.from(S),"patch");M(t.msg||`${t.deleted_count} patch(es) deleted.`),x(new Set),C(1,!0)}catch(t){u(t.message||"Bulk delete failed.")}finally{H(!1)}},jt=async()=>{if(S.size===0){u("No items selected.");return}const t=p.filter(l=>S.has(l.id)&&!l.is_external_link&&l.is_downloadable!==!1);if(t.length===0){u("No downloadable patch files selected. External links or non-downloadable items cannot be bulk downloaded.");return}const n=t.map(l=>l.id);Te(!0);try{const l=await Tt(n,"patch"),m=URL.createObjectURL(l),o=document.createElement("a");o.href=m;const b=new Date().toISOString().replace(/:/g,"-");o.download=`bulk_download_patches_${b}.zip`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(m),n.length===S.size?M("Download started for all selected downloadable patches."):M(`Starting download for ${n.length} patch file(s). External links or non-downloadable items were excluded.`)}catch(l){u(l.message||"Bulk download failed.")}finally{Te(!1)}},Nt=()=>{if(S.size===0){u("No items selected.");return}if(Q.length===0){u("Software list unavailable.");return}Ue(null),Ce(null),Fe(!0)},It=async()=>{if(!Pe){u("Select target version.");return}Fe(!1),He(!0);try{const t=await Yt(Array.from(S),"patch",{target_version_id:Pe});M(t.msg||`${t.moved_count} patch(es) moved.`),x(new Set),C(1,!0)}catch(t){if(t.response&&t.response.data&&t.response.data.conflicted_items&&Array.isArray(t.response.data.conflicted_items)&&t.response.data.conflicted_items.length>0&&(t.response.status===400||t.response.status===207)){let n="Bulk move could not be completed for some patches due to naming conflicts. ";const l=t.response.data.conflicted_items,m=l.slice(0,3).map(o=>`"${o.name}" (ID ${o.id})`).join(", ");n+=`Conflicting items: ${m}`,l.length>3&&(n+=` and ${l.length-3} more.`),n+=" Please rename the patches or check the target version.",u(n),t.response.data.msg}else t.message&&typeof t.message=="string"&&t.message.includes("UNIQUE constraint failed")?u("A patch with this name already exists for the target software/version. Please check for duplicates."):t.message?u(t.message):u("Bulk move failed due to an unexpected error.")}finally{He(!1),Ue(null),Ce(null)}},Vt=[{key:"patch_name",header:"Patch Name",sortable:!0},{key:"software_name",header:"Software",sortable:!0},{key:"version_number",header:"Version",sortable:!0},{key:"patch_by_developer",header:"Developer",sortable:!0,render:t=>t.patch_by_developer||"-"},{key:"compatible_vms_versions",header:"VMS Compatibility",sortable:!0,render:t=>{const n=t.software_name==="VMS"||t.software_name==="VA";let l="-";return n&&(t.compatible_vms_versions&&t.compatible_vms_versions.length>0?Array.isArray(t.compatible_vms_versions)?l=t.compatible_vms_versions.join(", "):typeof t.compatible_vms_versions=="string"?l=t.compatible_vms_versions:l="N/A":l="N/A"),e.jsx("div",{className:"text-center",children:l})}},{key:"description",header:"Description",render:(t,n)=>{const l=qe.useRef(null),[m,o]=qe.useState(!1),b=t.description||"-";return qe.useEffect(()=>{l.current&&o(l.current.scrollHeight>l.current.clientHeight)},[t.description]),e.jsxs("div",{className:"flex items-center justify-between w-72",children:[e.jsx("span",{ref:l,className:"block line-clamp-3 text-sm w-full",title:t.description||"",children:b}),m&&e.jsx("button",{onClick:de=>{de.stopPropagation(),n.showModal(t.description||"-")},className:"ml-2 p-1 text-blue-600 hover:text-blue-800 flex-shrink-0",title:"Read More",children:e.jsx(Ht,{size:16})})]})}},{key:"release_date",header:"Release Date",sortable:!0,render:t=>qt(t.release_date)},{key:"download_link",header:"Link",render:t=>{var l;const n=t.is_external_link||t.is_downloadable!==!1;return!n&&!t.is_external_link?e.jsxs("span",{className:"flex items-center text-gray-400 cursor-not-allowed",title:"Download not permitted",children:[e.jsx(Oe,{size:14,className:"mr-1"}),"Link"]}):e.jsxs("a",{href:t.download_link,target:t.is_external_link||!((l=t.download_link)!=null&&l.startsWith("/"))?"_blank":"_self",rel:"noopener noreferrer",className:`flex items-center ${n?"text-blue-600 hover:text-blue-800":"text-gray-400 cursor-not-allowed"}`,onClick:m=>{n||m.preventDefault(),m.stopPropagation()},title:n?t.is_external_link?"Open external link":"Download patch":"Download not permitted",children:[t.is_external_link?e.jsx(gs,{size:14,className:"mr-1"}):e.jsx(Oe,{size:14,className:"mr-1"}),"Link"]})}},{key:"uploaded_by_username",header:"Uploaded By",sortable:!0,render:t=>t.uploaded_by_username||"N/A"},{key:"updated_by_username",header:"Updated By",sortable:!1,render:t=>t.updated_by_username||"N/A"},{key:"created_at",header:"Created At",sortable:!0,render:t=>st(t.created_at??"")},{key:"updated_at",header:"Updated At",sortable:!0,render:t=>st(t.updated_at??"")},{key:"actions",header:"Actions",render:t=>{var n,l,m;return e.jsxs("div",{className:"flex space-x-1 items-center",children:[f&&e.jsx("button",{onClick:o=>{o.stopPropagation(),Ft(t,"patch")},className:`p-1 rounded-md ${(n=Y.get(t.id))!=null&&n.favoriteId?"text-yellow-500 hover:text-yellow-600":"text-gray-400 hover:text-yellow-500"}`,title:(l=Y.get(t.id))!=null&&l.favoriteId?"Remove Favorite":"Add Favorite",children:e.jsx(Wt,{size:16,className:(m=Y.get(t.id))!=null&&m.favoriteId?"fill-current":""})}),f&&e.jsxs("button",{onClick:o=>{o.stopPropagation(),N&&N.id===t.id?je(null):(je(t),setTimeout(()=>{var b;return(b=De.current)==null?void 0:b.scrollIntoView({behavior:"smooth"})},0))},className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 rounded-md",title:N&&N.id===t.id?"Hide Comments":"View Comments",children:[e.jsx(Xt,{size:16}),e.jsxs("span",{className:"ml-1 text-xs",children:["(",t.comment_count??0,")"]})]}),(d==="admin"||d==="super_admin")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),bt(t)},className:"p-1 text-blue-600 hover:text-blue-800 rounded-md",title:"Edit",children:e.jsx(ds,{size:16})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),yt(t)},className:"p-1 text-red-600 hover:text-red-800 rounded-md",title:"Delete",children:e.jsx(at,{size:16})})]})]})}}],et=a.useCallback(()=>{C(1,!0)},[C]),Ft=async(t,n)=>{var b,de;if(!f){u("Please log in to manage favorites.");return}const l=Y.get(t.id),m=!!(l!=null&&l.favoriteId),o=new Map(Y);m?o.set(t.id,{favoriteId:void 0}):o.set(t.id,{favoriteId:-1}),Z(o);try{if(m&&typeof(l==null?void 0:l.favoriteId)=="number")await Zt(t.id,n),M(`"${t.patch_name}" removed from favorites.`),Z(K=>{const ye=new Map(K);return ye.set(t.id,{favoriteId:void 0}),ye});else{const K=await Kt(t.id,n);Z(ye=>{const ve=new Map(ye);return ve.set(t.id,{favoriteId:K.id}),ve}),M(`"${t.patch_name}" added to favorites.`)}}catch(K){u(((de=(b=K==null?void 0:K.response)==null?void 0:b.data)==null?void 0:de.msg)||K.message||"Failed to update favorite."),Z(ye=>{const ve=new Map(ye);return m?ve.set(t.id,{favoriteId:l==null?void 0:l.favoriteId}):ve.set(t.id,{favoriteId:void 0}),ve})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start sm:items-center mb-6 flex-col sm:flex-row",children:[e.jsxs("div",{children:[" ",e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Patches"})," ",e.jsx("p",{className:"text-gray-600 mt-1 dark:text-gray-300",children:"Browse and manage software patches."})," "]}),f&&(d==="admin"||d==="super_admin")&&!J&&e.jsxs("button",{onClick:ne&&!J?Ke:pt,className:`mt-4 sm:mt-0 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white focus:outline-none focus:ring-2 focus:ring-offset-2
              ${ne&&!J?"bg-red-600 hover:bg-red-700 focus:ring-red-500":"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500"}`,children:[ne&&!J?e.jsx(it,{size:18,className:"mr-2"}):e.jsx(bs,{size:18,className:"mr-2"}),ne&&!J?"Cancel":"Add New Patch"]})]}),ne&&e.jsxs("div",{className:"my-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg shadow",children:[" ",e.jsx(vs,{patchToEdit:J,onPatchAdded:()=>Ze(),onPatchUpdated:()=>Ze(),onCancelEdit:Ke})," "]}),S.size>0&&e.jsx("div",{className:"my-4 p-3 bg-gray-100 dark:bg-gray-700 rounded-md shadow-sm border border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:[S.size," item(s) selected"]}),(d==="admin"||d==="super_admin")&&e.jsxs("button",{onClick:St,disabled:V,className:"px-3 py-1.5 text-xs font-medium rounded-md shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 text-white bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 focus:ring-red-500 disabled:opacity-50",children:[e.jsx(at,{size:14,className:"mr-1.5"}),"Delete"]}),f&&e.jsxs("button",{onClick:jt,disabled:Le,className:"px-3 py-1.5 text-xs font-medium rounded-md shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 text-white bg-green-500 hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700 focus:ring-green-500 disabled:opacity-50",children:[e.jsx(Oe,{size:14,className:"mr-1.5"}),"Download"]}),(d==="admin"||d==="super_admin")&&e.jsxs("button",{onClick:Nt,disabled:pe,className:"px-3 py-1.5 text-xs font-medium rounded-md shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 text-white bg-blue-500 hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700 focus:ring-blue-500 disabled:opacity-50",children:[e.jsx(ns,{size:14,className:"mr-1.5"}),"Move"]})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:gap-4 mb-4",children:[Q.length>0&&e.jsx("div",{className:"w-fit flex-shrink-0",children:e.jsx(fs,{software:Q,selectedSoftwareId:w,onSelectFilter:ft})}),w&&e.jsx("div",{className:"flex items-center gap-2 min-w-[200px] mt-4 md:mt-0 flex-shrink-0",children:e.jsxs("select",{id:"versionFilterPatches",value:E||"",onChange:gt,className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200",disabled:me.length===0,children:[e.jsx("option",{value:"",children:"Version"}),me.map(t=>e.jsx("option",{value:t.id,children:t.version_number},t.id))]})})]}),e.jsx("div",{className:"my-4",children:e.jsxs("button",{onClick:()=>Ve(t=>!t),className:"flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-md text-sm font-medium",children:[_e?e.jsxs(e.Fragment,{children:[e.jsx(cs,{size:18,className:"mr-2"}),"Hide"]}):e.jsxs(e.Fragment,{children:[e.jsx(os,{size:18,className:"mr-2"}),"Show"]})," Advanced Filters"]})}),_e&&e.jsxs("div",{className:"my-4 p-4 border dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 space-y-4 md:space-y-0 md:flex md:flex-wrap md:items-end md:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"patchedByDevFilter",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Developer"}),e.jsx("input",{id:"patchedByDevFilter",type:"text",value:U,onChange:t=>G(t.target.value),placeholder:"e.g., Main Dev",className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Released"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:B,onChange:t=>ue(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"to"}),e.jsx("input",{type:"date",value:L,onChange:t=>X(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"})]})]}),e.jsx("div",{className:"flex items-end gap-2 pt-5",children:e.jsx("button",{onClick:ut,className:"text-sm px-4 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Clear"})})]}),P?e.jsx("div",{className:"py-10",children:e.jsx(Bt,{message:"Loading patches..."})}):le&&p.length===0&&!P?e.jsx(hs,{message:le,onRetry:et}):!P&&!le&&p.length===0?e.jsxs("div",{className:"text-center py-10 bg-white dark:bg-gray-800 rounded-lg shadow-sm my-6",children:[e.jsx(Ot,{size:48,className:"mx-auto text-yellow-500 dark:text-yellow-400 mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-700 dark:text-gray-200 mb-3",children:Ee?"No Patches Found Matching Criteria":"No Patches Available"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 px-4",children:Ee?"Try adjusting or clearing your search/filter settings.":d==="admin"||d==="super_admin"?"Add new patches to get started.":"Please check back later."}),Ee&&e.jsx("button",{onClick:mt,className:"mt-6 btn-primary text-sm",children:"Clear All Filters & Search"})]}):e.jsx(ms,{columns:Vt,data:Qe,highlightedRowId:ct,rowClassName:"group",isLoading:P||oe,currentPage:te,totalPages:se,onPageChange:xt,itemsPerPage:fe,totalItems:ke,sortColumn:F,sortOrder:re,onSort:ht,isSelectionEnabled:!0,selectedItemIds:S,onSelectItem:wt,onSelectAllItems:kt}),c&&h&&e.jsx(rt,{isOpen:c,title:"Delete Patch",message:`Delete "${h.patch_name}"?`,onConfirm:vt,onCancel:Be,isConfirming:oe,confirmButtonText:"Delete",confirmButtonVariant:"danger"}),Ge&&e.jsx(rt,{isOpen:Ge,title:`Delete ${S.size} Patch(es)`,message:`Delete ${S.size} selected items?`,onConfirm:_t,onCancel:()=>Re(!1),isConfirming:V,confirmButtonText:"Delete Selected",confirmButtonVariant:"danger"}),We&&e.jsx(ps,{isOpen:We,onClose:()=>Fe(!1),title:`Move ${S.size} Patch(es)`,children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:"Select target Software and Version:"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"modalSoftwareMove",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Target Software"}),e.jsxs("select",{id:"modalSoftwareMove",value:be??"",onChange:t=>{Ue(t.target.value?parseInt(t.target.value):null),Ce(null)},className:"input-class w-full dark:bg-gray-700 dark:text-white dark:border-gray-600",disabled:pe||Q.length===0,children:[e.jsx("option",{value:"",children:"Select Software..."}),Q.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),be&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"modalVersionMove",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Target Version"}),e.jsxs("select",{id:"modalVersionMove",value:Pe??"",onChange:t=>Ce(t.target.value?parseInt(t.target.value):null),className:"input-class w-full dark:bg-gray-700 dark:text-white dark:border-gray-600",disabled:pe||ze||$e.length===0,children:[e.jsx("option",{value:"",children:ze?"Loading...":"Select Version..."}),$e.map(t=>e.jsx("option",{value:t.id,children:t.version_number},t.id))]}),$e.length===0&&!ze&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"No versions for selected software."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>Fe(!1),className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:pe,children:"Cancel"}),e.jsx("button",{type:"button",onClick:It,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:pe||!be||!Pe,children:pe?"Moving...":"Confirm Move"})]})]})}),f&&N&&e.jsxs("div",{ref:De,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-4",children:["Comments for: ",e.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:N.patch_name})]}),e.jsx(is,{itemId:N.id,itemType:"patch",onCommentAction:et})]}),!f&&N&&e.jsx("div",{ref:De,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Please log in to view and manage comments."})})]})};export{Fs as default};
