import{r as s,u as Fe,C as Ye,s as g,j as e,F as kt,X as wt,c as jt,D as Ct,Q as he,E as Ft,G as Nt,d as St,g as _t,H as Mt,i as Dt,a as H,k as It,S as At,I as zt,J as Pt,m as Bt,n as Lt,o as $t,p as Ut}from"./index-CHdKXerz.js";import{u as We,U as Et,o as Ze,c as Qe,a as de,b as Ot,P as Ke,T as Xe,D as je,M as Vt,F as Rt,C as Tt,e as qt,d as Gt}from"./CommentSection-DOcMteLz.js";import{C as Ht,D as Jt,a as Ce,M as Kt}from"./Modal-QJOmJ8of.js";import{f as Xt}from"./dateUtils-C4q4Gbs_.js";import{E as Yt}from"./ErrorState-vMrAulW_.js";import{A as Wt}from"./archive-qQqPxPrW.js";const Zt=Qe().shape({selectedCategoryId:de().required("Please select a misc category."),selectedFile:Ot().when("$isEditMode",{is:r=>!r,then:r=>r.required("Please select a file to upload.").test("filePresent","File is required for upload.",c=>!!c),otherwise:r=>r.nullable()}),title:de().transform(r=>r===""?void 0:r).optional().max(255,"Title cannot exceed 255 characters.").nullable(),description:de().transform(r=>r===""?void 0:r).optional().max(1e3,"Description cannot exceed 1000 characters.").nullable()}),Qt=({fileToEdit:r,preselectedCategoryId:c,onUploadSuccess:u,onFileUpdated:h,onCancelEdit:f})=>{const n=!!r,{register:k,handleSubmit:O,control:ce,formState:{errors:x},watch:P,setValue:w,reset:N}=We({resolver:Ze(Zt),context:{isEditMode:n},defaultValues:{selectedCategoryId:(c==null?void 0:c.toString())||"",title:"",description:"",selectedFile:null}}),[M,J]=s.useState([]),[B,p]=s.useState(null),[m,D]=s.useState(!1),[V,_]=s.useState(!1),[v,S]=s.useState(0),[R,T]=s.useState(!1),j=s.useRef(null),{isAuthenticated:K,user:I}=Fe(),L=I==null?void 0:I.role,C=P("selectedFile");s.useEffect(()=>{const i=$=>{R&&($.preventDefault(),$.returnValue="")};return window.addEventListener("beforeunload",i),()=>{window.removeEventListener("beforeunload",i)}},[R]),s.useEffect(()=>{K&&(L==="admin"||L==="super_admin")&&(_(!0),Ye().then(J).catch(()=>g("Failed to load misc categories.")).finally(()=>_(!1)))},[K,L]),s.useEffect(()=>{n&&r?(N({selectedCategoryId:r.misc_category_id.toString(),title:r.user_provided_title||"",description:r.user_provided_description||"",selectedFile:null}),p(r.original_filename),j.current&&(j.current.value="")):(N({selectedCategoryId:(c==null?void 0:c.toString())||"",title:"",description:"",selectedFile:null}),p(null),j.current&&(j.current.value=""))},[n,r,c,N]);const be=i=>{i.target.files&&i.target.files[0]?(w("selectedFile",i.target.files[0],{shouldValidate:!0,shouldDirty:!0}),n&&p(null)):w("selectedFile",null,{shouldValidate:!0,shouldDirty:!0})},ee=()=>{w("selectedFile",null,{shouldValidate:!0,shouldDirty:!0}),j.current&&(j.current.value=""),n&&r&&p(r.original_filename)},W=async i=>{var $,X,Z,Q,U,me;if(!K||!L||!["admin","super_admin"].includes(L)){g("Not authorized.");return}D(!0),i.selectedFile&&T(!0),S(0);try{let A;if(i.selectedFile){const z={misc_category_id:i.selectedCategoryId,user_provided_title:(($=i.title)==null?void 0:$.trim())||"",user_provided_description:((X=i.description)==null?void 0:X.trim())||""};A=await jt(i.selectedFile,"misc_file",z,ye=>S(ye)),u&&u(A),N({selectedCategoryId:(c==null?void 0:c.toString())||i.selectedCategoryId,title:"",description:"",selectedFile:null}),j.current&&(j.current.value="")}else if(n&&r){const z=new FormData;z.append("misc_category_id",i.selectedCategoryId),z.append("user_provided_title",((Z=i.title)==null?void 0:Z.trim())||""),z.append("user_provided_description",((Q=i.description)==null?void 0:Q.trim())||""),A=await Ct(r.id,z),h&&h(A)}else{g("No file selected for new upload."),D(!1);return}}catch(A){const z=((me=(U=A.response)==null?void 0:U.data)==null?void 0:me.msg)||A.message||"File operation failed.";g(z),i.selectedFile&&T(!1)}finally{D(!1),i.selectedFile&&T(!1)}},te=i=>{console.error("Form validation errors:",i),g("Please correct the errors highlighted in the form.")};return!K||!L||!["admin","super_admin"].includes(L)?null:e.jsxs("form",{onSubmit:O(W,te),className:"space-y-6 bg-white dark:bg-gray-800 dark:border-gray-700 p-6 rounded-lg shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:n?"Edit Miscellaneous File":"Upload File to Misc Category"}),n&&f&&e.jsx("button",{type:"button",onClick:f,className:"text-sm text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",children:"Cancel Edit"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectedCategoryId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Misc Category*"}),V?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading categories..."}):e.jsxs("select",{id:"selectedCategoryId",...k("selectedCategoryId"),disabled:m||M.length===0,className:`mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md ${x.selectedCategoryId?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a category"}),M.map(i=>e.jsx("option",{value:i.id.toString(),children:i.name},i.id))]}),x.selectedCategoryId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.selectedCategoryId.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n?"Replace File (Optional)":"Select File*"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md dark:border-gray-600 hover:border-blue-500 dark:hover:border-blue-400",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(Et,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500"}),e.jsxs("div",{className:"flex text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("label",{htmlFor:"selectedFile",className:"relative cursor-pointer bg-white dark:bg-gray-800 rounded-md font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300 focus-within:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("span",{children:C?"Change file":"Upload a file"}),e.jsx("input",{id:"selectedFile",name:"selectedFile-input",type:"file",className:"sr-only",onChange:be,ref:j,disabled:m})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Any allowed file type."})]})}),(C||n&&B)&&e.jsxs("div",{className:"mt-3 flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden",children:[e.jsx(kt,{size:18,className:"text-gray-500 dark:text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:C?C.name:B}),n&&B&&!C&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:"(current file)"})]}),C&&e.jsx("button",{type:"button",onClick:ee,disabled:m,className:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-200 dark:text-gray-500 dark:hover:text-gray-300 dark:hover:bg-gray-600",children:e.jsx(wt,{size:16})})]}),x.selectedFile&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.selectedFile.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"File Title (Optional)"}),e.jsx("input",{type:"text",id:"title",...k("title"),placeholder:n&&r?r.original_filename:"Defaults to filename if blank",disabled:m,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${x.title?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),x.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.title.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"File Description (Optional)"}),e.jsx("textarea",{id:"description",rows:3,...k("description"),disabled:m,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${x.description?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),x.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.description.message})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"submit",disabled:m||V||!n&&!C||!P("selectedCategoryId"),className:"flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:m?n?"Updating...":"Uploading...":n?"Update File Details":"Upload to Misc"}),n&&f&&e.jsx("button",{type:"button",onClick:f,disabled:m,className:"flex-1 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 dark:border-gray-500 dark:text-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600",children:"Cancel"})]}),m&&C&&v>0&&e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-4 dark:bg-gray-700 my-3 relative",children:[e.jsx("div",{className:"bg-blue-600 h-4 rounded-full transition-all duration-150 ease-out",style:{width:`${v}%`}}),e.jsxs("p",{className:"absolute inset-0 text-center text-xs font-medium leading-4 text-white dark:text-gray-100",children:[Math.round(v),"%"]})]})]})},es=Qe().shape({name:de().required("Category name is required.").max(100,"Category name cannot exceed 100 characters."),description:de().optional().max(500,"Description cannot exceed 500 characters.").nullable()}),ts=({categoryToEdit:r,onSuccess:c,onCancel:u})=>{const h=!!r,{register:f,handleSubmit:n,formState:{errors:k},reset:O,setValue:ce}=We({resolver:Ze(es),defaultValues:{name:"",description:""}}),[x,P]=s.useState(!1),{isAuthenticated:w,user:N}=Fe(),M=N==null?void 0:N.role;s.useEffect(()=>{O(h&&r?{name:r.name,description:r.description||""}:{name:"",description:""})},[r,h,O]);const J=async p=>{var m,D,V,_;P(!0);try{let v;if(h&&r){const S={};let R=!1;p.name.trim()!==r.name&&(S.name=p.name.trim(),R=!0);const T=r.description||"",j=((m=p.description)==null?void 0:m.trim())||"";if(j!==T&&(S.description=j||void 0,R=!0),!R){he.info("No changes detected."),P(!1),c&&c(r);return}v=await Ft(r.id,S)}else{const S={name:p.name.trim(),description:((D=p.description)==null?void 0:D.trim())||void 0};v=await Nt(S)}he.success(`Category "${v.name}" ${h?"updated":"added"} successfully!`),h||O({name:"",description:""}),c&&c(v)}catch(v){const S=((_=(V=v.response)==null?void 0:V.data)==null?void 0:_.msg)||v.message||`Failed to ${h?"update":"add"} category.`;he.error(S)}finally{P(!1)}},B=p=>{console.error("Form validation errors:",p),he.error("Please correct the errors in the form.")};return!w||!M||!["admin","super_admin"].includes(M)?e.jsx("p",{children:"You are not authorized to manage categories."}):e.jsxs("form",{onSubmit:n(J,B),className:"space-y-4 p-4 border border-gray-200 rounded-lg bg-white shadow-sm dark:bg-gray-800 dark:border-gray-700",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800 dark:text-gray-100",children:h?"Edit Miscellaneous Category":"Add New Miscellaneous Category"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name*"}),e.jsx("input",{type:"text",id:"name",...f("name"),disabled:x,className:`mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${k.name?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),k.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:k.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Description"}),e.jsx("textarea",{id:"description",...f("description"),rows:3,disabled:x,className:`mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${k.description?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),k.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:k.description.message})]}),e.jsxs("div",{className:"flex items-center space-x-3 pt-2",children:[e.jsx("button",{type:"submit",disabled:x,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-60",children:x?h?"Updating...":"Adding...":h?"Save Changes":"Add Category"}),u&&e.jsx("button",{type:"button",onClick:u,disabled:x,className:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:border-gray-500 dark:text-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600",children:"Cancel"})]})]})},ss="http://127.0.0.1:7000",ds=()=>{const{searchTerm:r,setSearchTerm:c}=St(),{isAuthenticated:u,user:h}=Fe(),f=h==null?void 0:h.role,[n,k]=s.useState([]),[O,ce]=s.useState(!0),[x,P]=s.useState(null),[w,N]=s.useState([]),[M,J]=s.useState(!0),[B,p]=s.useState(null),[m,D]=s.useState(null),[V,_]=s.useState(1),[v,S]=s.useState(15),[R,T]=s.useState(0),[j,K]=s.useState(0),[I,L]=s.useState("user_provided_title"),[C,be]=s.useState("asc"),[ee,W]=s.useState(!1),[te,i]=s.useState(null),[$,X]=s.useState(!1),[Z,Q]=s.useState(null),[U,me]=s.useState(null),[A,z]=s.useState(!1),[ye,Ne]=s.useState(!1),[q,Se]=s.useState(null),[_e,Me]=s.useState(!1),[De,Ie]=s.useState(!1),[se,re]=s.useState(new Map),[Ae,et]=s.useState(!0),[F,ae]=s.useState(new Set),[ze,Pe]=s.useState(!1),[tt,Be]=s.useState(!1),[le,Le]=s.useState(!1),[$e,ue]=s.useState(!1),[ge,pe]=s.useState(null),[Ue,ve]=s.useState(!1),[b,ie]=s.useState(null),fe=s.useRef(null),Ee=_t(),ke=s.useMemo(()=>m!==null||r!=="",[m,r]),st=s.useCallback(()=>{D(null),c&&c(""),_(1)},[c]),xe=s.useCallback(async()=>{var t,a;ce(!0),P(null);try{const l=await Ye();k(l)}catch(l){k([]);const d=((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.msg)||l.message||"Failed to load categories.";P(d),g(d)}finally{ce(!1)}},[]);s.useEffect(()=>{u?xe():k([])},[u,xe]),s.useEffect(()=>{const t=new URLSearchParams(Ee.search),a=t.get("item_id"),l=t.get("comment_id");if(a&&l&&w.length>0){const d=parseInt(a,10);if(!isNaN(d)){const o=w.find(y=>y.id===d);o?((!b||b.id!==o.id)&&ie(o),setTimeout(()=>{var y;(y=fe.current)==null||y.scrollIntoView({behavior:"smooth",block:"center"})},100)):console.warn(`MiscView: MiscFile with item_id ${d} not found in the current list.`)}}},[Ee.search,w,b]);const E=s.useCallback(async(t,a=!1)=>{var l,d;a&&J(!0),p(null);try{const o=await Mt(m||void 0,t,v,I,C);N(o.misc_files),T(o.total_pages),K(o.total_misc_files),_(o.page),S(o.per_page);const y=new Map;u&&o.misc_files&&o.misc_files.forEach(oe=>y.set(oe.id,{favoriteId:oe.favorite_id})),re(y)}catch(o){const y=((d=(l=o.response)==null?void 0:l.data)==null?void 0:d.msg)||o.message||"Failed to fetch files.";a?(p(y),N([]),T(0),K(0)):g(y)}finally{a&&J(!1)}},[m,v,I,C,u]);s.useEffect(()=>{u?E(1,!0):(N([]),J(!1))},[u,m,I,C,E]),s.useEffect(()=>{ae(new Set)},[m,I,C,r,V]);const rt=t=>{D(t.target.value?parseInt(t.target.value):null),_(1)},at=t=>{_(t),E(t,!0)},lt=t=>{L(t),be(a=>I===t&&a==="asc"?"desc":"asc"),_(1)},Oe=(t,a)=>{X(!1),Q(null),E(1,!0)},it=t=>{W(!1),i(null),H(t),xe()},Ve=t=>{Q(t||null),X(!0),W(!1),t&&window.scrollTo({top:0,behavior:"smooth"})},Re=()=>{Q(null),X(!1)},ot=()=>{i(null),W(!0),X(!1)},Te=()=>{i(null),W(!1)},qe=()=>{me(null),z(!1)},nt=t=>{Se(t),Me(!0)},we=()=>{Se(null),Me(!1)},dt=async()=>{var t,a;if(U){Ne(!0);try{await zt(U.id),H(`Category "${U.name}" deleted.`),qe(),xe(),m===U.id&&D(null)}catch(l){g(((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.msg)||"Delete failed.")}finally{Ne(!1)}}},ct=async()=>{if(q){Ie(!0),b&&b.id===q.id&&ie(null);try{await Pt(q.id),H(`File "${q.user_provided_title||q.original_filename}" deleted.`),we(),E(1,!0)}catch(t){g(t.message||"Delete failed."),we()}finally{Ie(!1)}}},Ge=s.useMemo(()=>{if(!r)return w;const t=r.toLowerCase();return w.filter(a=>(a.user_provided_title||"").toLowerCase().includes(t)||a.original_filename.toLowerCase().includes(t)||(a.user_provided_description||"").toLowerCase().includes(t)||(a.category_name||"").toLowerCase().includes(t))},[w,r]),mt=(t,a)=>ae(l=>{const d=new Set(l);return a?d.add(t):d.delete(t),d}),ut=t=>{const a=new Set;t&&Ge.forEach(l=>a.add(l.id)),ae(a)},gt=()=>{if(F.size===0){g("No items selected.");return}ve(!0)},ft=async()=>{ve(!1),Pe(!0),b&&F.has(b.id)&&ie(null);try{const t=await Bt(Array.from(F),"misc_file");H(t.msg||`${t.deleted_count} file(s) deleted.`),ae(new Set),E(1,!0)}catch(t){g(t.message||"Bulk delete failed.")}finally{Pe(!1)}},xt=async()=>{if(F.size===0){g("No items selected.");return}Be(!0);try{const t=await It(Array.from(F),"misc_file"),a=URL.createObjectURL(t),l=document.createElement("a");l.href=a;const d=new Date().toISOString().replace(/:/g,"-");l.download=`bulk_download_misc_files_${d}.zip`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a),H("Download started.")}catch(t){g(t.message||"Bulk download failed.")}finally{Be(!1)}},ht=()=>{if(F.size===0){g("No items selected.");return}if(n.length===0){g("Categories unavailable for move.");return}pe(null),ue(!0)},bt=async()=>{if(!ge){g("Select target category.");return}ue(!1),Le(!0);try{const t=await Lt(Array.from(F),"misc_file",{target_misc_category_id:ge});H(t.msg||`${t.moved_count} file(s) moved.`),ae(new Set),E(1,!0)}catch(t){g(t.message||"Bulk move failed.")}finally{Le(!1),pe(null)}},yt=t=>{if(t==null)return"N/A";if(t===0)return"0 B";const a=1024,l=["B","KB","MB","GB","TB"],d=Math.floor(Math.log(t)/Math.log(a));return parseFloat((t/Math.pow(a,d)).toFixed(2))+" "+l[d]},pt=[{key:"user_provided_title",header:"Title",sortable:!0,render:t=>t.user_provided_title||e.jsx("span",{className:"italic text-gray-500 dark:text-gray-400",children:t.original_filename})},{key:"original_filename",header:"Original Filename",sortable:!0},{key:"category_name",header:"Category",sortable:!0},{key:"uploaded_by_username",header:"Uploaded By",sortable:!0,render:t=>t.uploaded_by_username||"N/A"},{key:"file_size",header:"Size",sortable:!0,render:t=>yt(t.file_size)},{key:"created_at",header:"Uploaded At",sortable:!0,render:t=>Xt(t.created_at??"")},{key:"file_path",header:"Link",render:t=>t.is_downloadable!==!1?e.jsxs("a",{href:`${ss}${t.file_path}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-blue-600 hover:text-blue-800",onClick:l=>l.stopPropagation(),title:"Download file",children:[e.jsx(je,{size:14,className:"mr-1"}),"Download"]}):e.jsxs("span",{className:"flex items-center text-gray-400 cursor-not-allowed",title:"Download not permitted",children:[e.jsx(je,{size:14,className:"mr-1"}),"Download"]})},{key:"actions",header:"Actions",render:t=>{var a,l,d;return e.jsxs("div",{className:"flex space-x-1 items-center",children:[u&&e.jsx("button",{onClick:o=>{o.stopPropagation(),vt(t,"misc_file")},className:`p-1 rounded-md ${(a=se.get(t.id))!=null&&a.favoriteId?"text-yellow-500 hover:text-yellow-600":"text-gray-400 hover:text-yellow-500"}`,title:(l=se.get(t.id))!=null&&l.favoriteId?"Remove Favorite":"Add Favorite",children:e.jsx(At,{size:16,className:(d=se.get(t.id))!=null&&d.favoriteId?"fill-current":""})}),u&&e.jsxs("button",{onClick:o=>{o.stopPropagation(),b&&b.id===t.id?ie(null):(ie(t),setTimeout(()=>{var y;return(y=fe.current)==null?void 0:y.scrollIntoView({behavior:"smooth"})},0))},className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 rounded-md",title:b&&b.id===t.id?"Hide Comments":"View Comments",children:[e.jsx(qt,{size:16}),e.jsxs("span",{className:"ml-1 text-xs",children:["(",t.comment_count??0,")"]})]}),(f==="admin"||f==="super_admin")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),Ve(t)},className:"p-1 text-blue-600 hover:text-blue-800 rounded-md",title:"Edit",children:e.jsx(Gt,{size:16})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),nt(t)},className:"p-1 text-red-600 hover:text-red-800 rounded-md",title:"Delete",children:e.jsx(Xe,{size:16})})]})]})}}],He=s.useCallback(()=>{E(1,!0)},[E]),vt=async(t,a)=>{var y,oe;if(!u){g("Log in to manage favorites.");return}const l=se.get(t.id),d=!!(l!=null&&l.favoriteId),o=new Map(se);d?o.set(t.id,{favoriteId:void 0}):o.set(t.id,{favoriteId:-1}),re(o);try{const Y=t.user_provided_title||t.original_filename;if(d&&typeof(l==null?void 0:l.favoriteId)=="number")await $t(t.id,a),H(`"${Y}" removed from favorites.`),re(ne=>{const G=new Map(ne);return G.set(t.id,{favoriteId:void 0}),G});else{const ne=await Ut(t.id,a);re(G=>{const Je=new Map(G);return Je.set(t.id,{favoriteId:ne.id}),Je}),H(`"${Y}" added to favorites.`)}}catch(Y){g(((oe=(y=Y==null?void 0:Y.response)==null?void 0:y.data)==null?void 0:oe.msg)||Y.message||"Failed to update favorite."),re(ne=>{const G=new Map(ne);return d?G.set(t.id,{favoriteId:l==null?void 0:l.favoriteId}):G.set(t.id,{favoriteId:void 0}),G})}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-start sm:items-center mb-6 flex-col sm:flex-row",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Miscellaneous Files"}),e.jsx("p",{className:"text-gray-600 mt-1 dark:text-gray-300",children:"Manage and browse categorized files."})]}),u&&(f==="admin"||f==="super_admin")&&e.jsxs("div",{className:"flex space-x-3 mt-4 sm:mt-0",children:[e.jsxs("button",{onClick:ee&&!te?Te:ot,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(Ke,{size:18,className:"mr-2"}),ee&&!te?"Cancel":"Add/Edit Category"]}),e.jsxs("button",{onClick:$&&!Z?Re:()=>Ve(),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(Ke,{size:18,className:"mr-2"}),$&&!Z?"Cancel":"Upload New File"]})]})]}),ee&&e.jsx("div",{className:"my-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg shadow",children:e.jsx(ts,{categoryToEdit:te,onSuccess:t=>it(`Category "${t.name}" saved.`),onCancel:Te})}),$&&e.jsx("div",{className:"my-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg shadow",children:e.jsx(Qt,{fileToEdit:Z,onUploadSuccess:t=>Oe(),onFileUpdated:t=>Oe(),onCancelEdit:Re})}),F.size>0&&e.jsx("div",{className:"my-4 p-3 bg-gray-100 dark:bg-gray-700 rounded-md shadow-sm border border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:[F.size," item(s) selected"]}),(f==="admin"||f==="super_admin")&&e.jsxs("button",{onClick:gt,disabled:ze,className:"px-3 py-1.5 text-xs font-medium rounded-md shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 text-white bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 focus:ring-red-500 disabled:opacity-50",children:[e.jsx(Xe,{size:14,className:"mr-1.5"}),"Delete"]}),u&&e.jsxs("button",{onClick:xt,disabled:tt,className:"px-3 py-1.5 text-xs font-medium rounded-md shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 text-white bg-green-500 hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700 focus:ring-green-500 disabled:opacity-50",children:[e.jsx(je,{size:14,className:"mr-1.5"}),"Download"]}),(f==="admin"||f==="super_admin")&&e.jsxs("button",{onClick:ht,disabled:le,className:"px-3 py-1.5 text-xs font-medium rounded-md shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 text-white bg-blue-500 hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700 focus:ring-blue-500 disabled:opacity-50",children:[e.jsx(Vt,{size:14,className:"mr-1.5"}),"Move"]})]})}),e.jsxs("div",{className:"my-4",children:[e.jsxs("button",{onClick:()=>et(t=>!t),className:"flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-md text-sm font-medium mb-2",children:[Ae?e.jsx(Ht,{size:18,className:"mr-2"}):e.jsx(Rt,{size:18,className:"mr-2"})," Category Filter"]}),Ae&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"category-filter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sr-only",children:"Filter by Category"}),e.jsxs("select",{id:"category-filter",value:m??"",onChange:rt,className:"block w-full sm:w-1/3 pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200",disabled:O||n.length===0,children:[e.jsx("option",{value:"",children:"All Categories"}),n.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),M?e.jsx("div",{className:"py-10",children:e.jsx(Dt,{message:"Loading files..."})}):B&&w.length===0&&!M?e.jsx(Yt,{message:B,onRetry:He}):!M&&!B&&w.length===0?e.jsxs("div",{className:"text-center py-10 bg-white dark:bg-gray-800 rounded-lg shadow-sm my-6",children:[e.jsx(Wt,{size:48,className:"mx-auto text-yellow-500 dark:text-yellow-400 mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-700 dark:text-gray-200 mb-3",children:ke?"No Files Found Matching Criteria":"No Files Available"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 px-4",children:ke?"Try adjusting or clearing your search/filter settings.":f==="admin"||f==="super_admin"?"Upload new files to get started.":"Please check back later."}),ke&&e.jsx("button",{onClick:st,className:"mt-6 btn-primary text-sm",children:"Clear All Filters & Search"})]}):e.jsx(Jt,{columns:pt,data:Ge,rowClassName:"group",isLoading:M||De,currentPage:V,totalPages:R,onPageChange:at,itemsPerPage:v,totalItems:j,sortColumn:I,sortOrder:C,onSort:lt,isSelectionEnabled:!0,selectedItemIds:F,onSelectItem:mt,onSelectAllItems:ut}),A&&U&&e.jsx(Ce,{isOpen:A,title:"Delete Category",message:`Delete category "${U.name}"? Files in it won't be deleted but will become uncategorized.`,onConfirm:dt,onCancel:qe,isConfirming:ye,confirmButtonText:"Delete",confirmButtonVariant:"danger"}),_e&&q&&e.jsx(Ce,{isOpen:_e,title:"Delete File",message:`Delete "${q.user_provided_title||q.original_filename}"?`,onConfirm:ct,onCancel:we,isConfirming:De,confirmButtonText:"Delete",confirmButtonVariant:"danger"}),Ue&&e.jsx(Ce,{isOpen:Ue,title:`Delete ${F.size} File(s)`,message:`Delete ${F.size} selected items?`,onConfirm:ft,onCancel:()=>ve(!1),isConfirming:ze,confirmButtonText:"Delete Selected",confirmButtonVariant:"danger"}),$e&&e.jsx(Kt,{isOpen:$e,onClose:()=>ue(!1),title:`Move ${F.size} File(s)`,children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:"Select target category:"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"modalCategoryMove",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Target Category*"}),e.jsxs("select",{id:"modalCategoryMove",value:ge??"",onChange:t=>pe(t.target.value?parseInt(t.target.value):null),className:"input-class w-full dark:bg-gray-700 dark:text-white dark:border-gray-600",disabled:le||n.length===0,children:[e.jsx("option",{value:"",children:"Select Category..."}),n.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),n.length===0&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Categories unavailable."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>ue(!1),className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:le,children:"Cancel"}),e.jsx("button",{type:"button",onClick:bt,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:le||!ge,children:le?"Moving...":"Confirm Move"})]})]})}),u&&b&&e.jsxs("div",{ref:fe,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-4",children:["Comments for: ",e.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:b.user_provided_title||b.original_filename})]}),e.jsx(Tt,{itemId:b.id,itemType:"misc_file",onCommentAction:He})]}),!u&&b&&e.jsx("div",{ref:fe,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Please log in to view and manage comments."})})]})};export{ds as default};
