import{B as J,r as a,bd as q,s as H,j as e,be as V,k as G,bf as K,a9 as Q,aa as T,bg as E,bh as W}from"./index-B__RXaY0.js";import{E as X}from"./ErrorState-CRL0BUl_.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=J("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]),ee=()=>{const[g,j]=a.useState([]),[o,l]=a.useState(1),[x,D]=a.useState(15),[u,N]=a.useState(0),[h,_]=a.useState(1),[m,I]=a.useState("timestamp"),[y,w]=a.useState("desc"),[s,v]=a.useState({user_id:"",username:"",action_type:"",target_table:"",date_from:"",date_to:""}),[r,S]=a.useState(s),[p,F]=a.useState(!0),[C,L]=a.useState(null),[n,b]=a.useState(!0),[k,M]=a.useState(!1),f=a.useCallback(async()=>{var c,A;F(!0),n&&L(null);const t=new URLSearchParams({page:o.toString(),per_page:x.toString(),sort_by:m,sort_order:y});r.user_id&&t.append("user_id",r.user_id),r.username&&t.append("username",r.username),r.action_type&&t.append("action_type",r.action_type),r.target_table&&t.append("target_table",r.target_table),r.date_from&&t.append("date_from",r.date_from),r.date_to&&t.append("date_to",r.date_to);try{const d=await q(t);j(d.logs),l(d.page),D(d.per_page),N(d.total_logs),_(d.total_pages),n&&b(!1)}catch(d){console.error("Failed to load audit logs:",d);const P=((A=(c=d.response)==null?void 0:c.data)==null?void 0:A.msg)||d.message||"An unknown error occurred.";n?(L(P),j([]),_(1),N(0)):H(P)}finally{F(!1)}},[o,x,m,y,r,n]);a.useEffect(()=>{f()},[f]);const B=t=>{m===t?w(y==="asc"?"desc":"asc"):(I(t),w("asc"))},i=t=>{v({...s,[t.target.name]:t.target.value})},O=()=>{S(s),l(1),b(!0)},R=()=>{const t={user_id:"",username:"",action_type:"",target_table:"",date_from:"",date_to:""};v(t),S(t),l(1),b(!0)},U=t=>{if(!t)return e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"N/A"});try{const c=JSON.parse(t);return e.jsx("pre",{className:"text-xs bg-gray-100 dark:bg-gray-700 dark:text-gray-200 p-2 rounded overflow-auto max-h-32",children:JSON.stringify(c,null,2)})}catch{return e.jsx("span",{className:"text-sm dark:text-gray-200",children:t})}},z=({column:t})=>m!==t?e.jsx(E,{className:"inline ml-1 text-gray-400"}):y==="asc"?e.jsx(W,{className:"inline ml-1"}):e.jsx(E,{className:"inline ml-1"});return e.jsxs("div",{className:"container mx-auto p-4 bg-white dark:bg-gray-800 shadow-lg rounded-lg",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-6 text-gray-700 dark:text-gray-200",children:"Audit Logs"}),e.jsxs("button",{onClick:()=>M(!k),className:"mb-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center",children:[e.jsx(V,{className:"mr-2"})," ",k?"Hide":"Show"," Filters"]}),k&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6 p-4 border dark:border-gray-700 rounded-md bg-gray-50 dark:bg-gray-700",children:[e.jsxs("div",{children:[" ",e.jsx("label",{htmlFor:"user_id",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"User ID"})," ",e.jsx("input",{type:"number",name:"user_id",id:"user_id",value:s.user_id,onChange:i,className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Username"})," ",e.jsx("input",{type:"text",name:"username",id:"username",value:s.username,onChange:i,className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{htmlFor:"action_type",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Action Type"})," ",e.jsx("input",{type:"text",name:"action_type",id:"action_type",value:s.action_type,onChange:i,className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{htmlFor:"target_table",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Target Table"})," ",e.jsx("input",{type:"text",name:"target_table",id:"target_table",value:s.target_table,onChange:i,className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{htmlFor:"date_from",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Date From"})," ",e.jsx("input",{type:"date",name:"date_from",id:"date_from",value:s.date_from,onChange:i,className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})," "]}),e.jsxs("div",{children:[" ",e.jsx("label",{htmlFor:"date_to",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Date To"})," ",e.jsx("input",{type:"date",name:"date_to",id:"date_to",value:s.date_to,onChange:i,className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})," "]}),e.jsxs("div",{className:"col-span-1 md:col-span-2 lg:col-span-3 flex justify-end space-x-2 mt-2",children:[e.jsx("button",{onClick:O,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600",children:"Apply Filters"}),e.jsx("button",{onClick:R,className:"px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded hover:bg-gray-400 dark:hover:bg-gray-500",children:"Clear Filters"})]})]}),n&&p?e.jsx(G,{message:"Loading audit logs..."}):C&&n&&g.length===0?e.jsx(X,{message:C,onRetry:f}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[["id","timestamp","user_id","username","action_type","target_table","target_id"].map(t=>e.jsxs("th",{scope:"col",onClick:()=>B(t),className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",children:[t.replace("_"," ")," ",e.jsx(z,{column:t})]},t)),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Details"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:p&&!n&&g.length>0?e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"text-center py-4 dark:text-gray-300",children:[e.jsx(K,{className:"animate-spin text-2xl text-blue-500 dark:text-blue-400 inline-block"})," Refreshing..."]})}):g.length>0?g.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.id}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:new Date(t.timestamp).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.user_id??"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.username??"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.action_type}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.target_table??"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.target_id??"N/A"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-300",children:U(t.details)})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:8,children:e.jsxs(Q,{sx:{textAlign:"center",py:4,px:3},children:[e.jsx(Y,{size:50,className:"text-gray-400 dark:text-gray-500 mb-3"}),e.jsx(T,{variant:"subtitle1",color:"text.secondary",children:"No audit logs found."}),e.jsx(T,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:"Try adjusting the filters or check back later."})]})})})})]})}),u>0&&e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Showing ",e.jsx("span",{className:"font-medium",children:(o-1)*x+1})," to ",e.jsx("span",{className:"font-medium",children:Math.min(o*x,u)})," of ",e.jsx("span",{className:"font-medium",children:u})," results"]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>l(t=>Math.max(1,t-1)),disabled:o===1||p,className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsxs("span",{className:"px-3 py-1 text-sm text-gray-700 dark:text-gray-300",children:["Page ",o," of ",h]}),e.jsx("button",{onClick:()=>l(t=>Math.min(h,t+1)),disabled:o===h||p,className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})]})};export{ee as default};
