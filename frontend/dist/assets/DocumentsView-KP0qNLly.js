import{r as s,u as Xe,f as Je,s as f,j as e,L as jt,F as _e,X as Nt,a as St,e as Ft,b as I,c as Dt,d as _t,g as Ct,h as It,i as Mt,k as At,D as De,l as Et,m as qe,C as Ge,n as Pt,S as Ut,M as Tt,o as Lt,p as $t,q as zt,t as Bt,v as Rt}from"./index-BwC4OtEy.js";import{C as Ot,D as Vt}from"./DataTable-M6u3iFRE.js";import{y as qt,F as Gt}from"./validationUtils-BDdPRYf3.js";import{E as Wt}from"./ErrorState-DYFQ7toM.js";import{u as Ht,M as Ze,U as Xt,o as Jt,c as Zt,a as W,b as Yt,T as We,d as Kt,F as Qt,C as es,P as ts}from"./CommentSection-BDfCPnOX.js";import{F as ss}from"./fuse-Ch1WBRTM.js";import{M as rs}from"./Modal-CL3fsATn.js";import{P as as}from"./plus-circle-BqCvkcWc.js";const os=Zt().shape({selectedSoftwareId:W().required("Software selection is required."),docName:W().trim().min(1,"Document Name cannot be empty and must contain non-space characters.").max(255,"Document Name cannot exceed 255 characters."),docType:W().transform(a=>a===""?void 0:a).nullable().optional(),inputMode:W().oneOf(["url","upload"]).required("Input mode must be selected."),externalUrl:W().when("inputMode",(a,u)=>(Array.isArray(a)?a[0]:a)==="url"?qt().required("External Download URL is required."):W().optional().nullable()),selectedFile:Yt().when(["inputMode","$isEditMode","$documentToEditIsExternal"],{is:(a,u,D)=>a!=="upload"?!1:!!(!u||u&&D),then:a=>a.required("Please select a file to upload.").test("filePresent","File is required.",u=>!!u),otherwise:a=>a.nullable()}),description:W().optional().max(1e3,"Description cannot exceed 1000 characters.")}),He=({documentToEdit:a,onDocumentAdded:u,onDocumentUpdated:D,onCancelEdit:g})=>{const m=!!a,{register:x,handleSubmit:H,formState:{errors:d},watch:R,setValue:M,reset:X}=Ht({resolver:Jt(os),context:{isEditMode:m,documentToEditIsExternal:(a==null?void 0:a.is_external_link)||!1},defaultValues:{selectedSoftwareId:"",docName:"",docType:"",description:"",inputMode:"url",externalUrl:"",selectedFile:null}}),[fe,z]=s.useState([]),[O,V]=s.useState(null),[p,A]=s.useState(!1),[_,Y]=s.useState(!1),[K,N]=s.useState(0),[q,b]=s.useState(!1),S=s.useRef(null),{isAuthenticated:E,user:Q}=Xe(),P=Q==null?void 0:Q.role,B=R("inputMode"),L=R("selectedFile");s.useEffect(()=>{const r=U=>{q&&(U.preventDefault(),U.returnValue="")};return window.addEventListener("beforeunload",r),()=>{window.removeEventListener("beforeunload",r)}},[q]),s.useEffect(()=>{const r=()=>{document.visibilityState==="hidden"&&q&&St("Changing tabs or minimizing the window might interrupt the upload process.")};return document.addEventListener("visibilitychange",r),()=>{document.removeEventListener("visibilitychange",r)}},[q]),s.useEffect(()=>{E&&(P==="admin"||P==="super_admin")&&(Y(!0),Je().then(z).catch(()=>f("Failed to load software list.")).finally(()=>Y(!1)))},[E,P]),s.useEffect(()=>{var r;if(m&&a){const U={selectedSoftwareId:((r=a.software_id)==null?void 0:r.toString())||"",docName:a.doc_name,docType:a.doc_type||"",description:a.description||"",inputMode:a.is_external_link?"url":"upload",externalUrl:a.is_external_link?a.download_link:""};if(X(U),a.is_external_link)V(null);else{const C=a.download_link.split("/");V(a.original_filename_ref||C[C.length-1])}M("selectedFile",null),S.current&&(S.current.value="")}else J()},[a,m,X,M]);const J=(r=!1)=>{const U=r?R("selectedSoftwareId"):"";X({selectedSoftwareId:U,docName:"",docType:"",description:"",inputMode:"url",externalUrl:"",selectedFile:null}),V(null),S.current&&(S.current.value="")},ee=r=>{r.target.files&&r.target.files[0]?(M("selectedFile",r.target.files[0],{shouldValidate:!0,shouldDirty:!0}),V(null)):M("selectedFile",null,{shouldValidate:!0,shouldDirty:!0})},ge=()=>{if(M("selectedFile",null,{shouldValidate:!0,shouldDirty:!0}),S.current&&(S.current.value=""),m&&a&&!a.is_external_link){const r=a.download_link.split("/");V(a.original_filename_ref||r[r.length-1])}},xe=async r=>{var U,C,T,pe;A(!0),r.inputMode==="upload"&&r.selectedFile&&b(!0),N(0);try{let i;const y={software_id:r.selectedSoftwareId,doc_name:r.docName.trim(),description:((U=r.description)==null?void 0:U.trim())||"",doc_type:((C=r.docType)==null?void 0:C.trim())||""};if(r.inputMode==="url"){const w={software_id:parseInt(r.selectedSoftwareId),doc_name:y.doc_name,description:y.description,doc_type:y.doc_type,download_link:r.externalUrl.trim()};m&&a?(i=await Ft(a.id,w),I(`Document "${i.doc_name}" updated successfully!`),D&&D(i)):(i=await Dt(w),I(`Document "${i.doc_name}" added successfully!`),u&&u(i),m||J(!0))}else{const w={software_id:parseInt(r.selectedSoftwareId),doc_name:y.doc_name,description:y.description,doc_type:y.doc_type};if(m&&a)if(!a.is_external_link||a.is_external_link&&r.selectedFile)console.log("AdminDocumentEntryForm: Editing existing document (file or switching to file). File selected:",r.selectedFile),i=await _t(a.id,w,r.selectedFile||null),I(`Document "${i.doc_name}" updated successfully!`),D&&D(i);else{f("If switching from a URL to an uploaded file, please select a file."),A(!1),b(!1);return}else if(r.selectedFile)console.log("AdminDocumentEntryForm: Adding new document with file. File selected:",r.selectedFile),i=await Ct(r.selectedFile,"document",y,be=>N(be)),I(`Document "${i.doc_name}" added successfully via chunked upload!`),u&&u(i),J(!0);else{f("No file selected for upload. Please select a file."),A(!1),b(!1);return}}}catch(i){console.error("Error in AdminDocumentEntryForm onSubmit:",i);const y=((pe=(T=i.response)==null?void 0:T.data)==null?void 0:pe.msg)||i.message;let w=`Failed to ${m&&r.inputMode==="url"?"update":"add"} document.`;y&&typeof y=="string"&&y.includes("UNIQUE constraint failed")?m?w="A document with this name already exists for this software. Please use a different name or check for duplicates.":w="A document with this name already exists for this software. Please use a different name.":y&&(w=y),f(w),r.inputMode==="upload"&&b(!1)}finally{console.log("AdminDocumentEntryForm onSubmit finally block reached."),A(!1),r.inputMode==="upload"&&b(!1)}},te=r=>{console.error("Form validation errors (onFormError) in AdminDocumentEntryForm:",r),console.log("AdminDocumentEntryForm onFormError, active element:",document.activeElement),f("Please correct the errors highlighted in the form.")},he=["Guide","Manual","API Reference","Datasheet","Whitepaper","Specification","Other"];return!E||!P||!["admin","super_admin"].includes(P)?null:e.jsxs("form",{onSubmit:H(xe,te),className:"space-y-6 bg-white dark:bg-gray-800 dark:border-gray-700 p-6 rounded-lg shadow-md border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:m?"Edit Document":"Add New Document"}),m&&g&&e.jsxs("button",{type:"button",onClick:g,disabled:p,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[e.jsx(Ze,{size:18,className:"mr-2"}),"Cancel Edit"]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectedSoftwareId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Software*"}),_?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading software..."}):e.jsxs("select",{id:"selectedSoftwareId",...x("selectedSoftwareId"),disabled:p||_,className:`mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md ${d.selectedSoftwareId?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`,children:[e.jsx("option",{value:"",disabled:!0,children:"Select Software"}),fe.map(r=>e.jsx("option",{value:r.id.toString(),children:r.name},r.id))]}),d.selectedSoftwareId&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.selectedSoftwareId.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"docName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Document Name*"}),e.jsx("input",{type:"text",id:"docName",...x("docName"),disabled:p,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.docName?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),d.docName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.docName.message})]}),e.jsxs("div",{className:"my-4",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Document Source:"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",...x("inputMode"),value:"url",className:"form-radio h-4 w-4 text-blue-600",disabled:p}),e.jsxs("span",{className:"flex items-center dark:text-gray-300",children:[e.jsx(jt,{size:16,className:"mr-1 text-gray-600 dark:text-gray-400"}),"Provide External Link"]})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",...x("inputMode"),value:"upload",className:"form-radio h-4 w-4 text-blue-600",disabled:p}),e.jsxs("span",{className:"flex items-center dark:text-gray-300",children:[e.jsx(Xt,{size:16,className:"mr-1 text-gray-600 dark:text-gray-400"}),"Upload File"]})]})]}),d.inputMode&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.inputMode.message})]}),B==="url"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"externalUrl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"External Download URL*"}),e.jsx("input",{type:"text",id:"externalUrl",...x("externalUrl"),placeholder:"https://example.com/document.pdf",disabled:p,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.externalUrl?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),d.externalUrl&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.externalUrl.message})]}),B==="upload"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:m&&O&&!L?"Replace File (Optional)":"Select File to Upload*"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-blue-500 dark:border-gray-600 dark:hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(_e,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500"}),e.jsxs("div",{className:"flex text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("label",{htmlFor:"doc-file-upload-input",className:"relative cursor-pointer bg-white dark:bg-gray-800 rounded-md font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500",children:[e.jsx("span",{children:L?"Change file":"Upload a file"}),e.jsx("input",{id:"doc-file-upload-input",name:"doc-file-input",type:"file",className:"sr-only",onChange:ee,ref:S,disabled:p})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PDF, DOCX, PNG, JPG, ZIP etc."})]})}),(L||O)&&e.jsxs("div",{className:"mt-3 flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden",children:[e.jsx(_e,{size:18,className:"text-gray-500 dark:text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:L?L.name:O}),m&&O&&!L&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:"(current)"})]}),L&&e.jsx("button",{type:"button",onClick:ge,disabled:p,className:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-200 dark:text-gray-500 dark:hover:text-gray-300 dark:hover:bg-gray-600",children:e.jsx(Nt,{size:16})})]}),d.selectedFile&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.selectedFile.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"docType",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Document Type"}),e.jsxs("select",{id:"docType",...x("docType"),disabled:p,className:`mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md ${d.docType?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`,children:[e.jsx("option",{value:"",children:"Select Type (Optional)"}),he.map(r=>e.jsx("option",{value:r,children:r},r))]}),d.docType&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.docType.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Description"}),e.jsx("textarea",{id:"description",rows:3,...x("description"),disabled:p,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${d.description?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),d.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.description.message})]}),e.jsx("div",{className:"flex space-x-3",children:e.jsx("button",{type:"submit",disabled:p||_,className:"flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:p?m?"Updating...":"Adding...":m?"Update Document":"Add Document"})}),p&&B==="upload"&&K>0&&e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-4 dark:bg-gray-700 my-3 relative",children:[e.jsx("div",{className:"bg-blue-600 h-4 rounded-full transition-all duration-150 ease-out",style:{width:`${K}%`}}),e.jsxs("p",{className:"absolute inset-0 text-center text-xs font-medium leading-4 text-white dark:text-gray-100",children:[Math.round(K),"%"]})]})]})},gs=()=>{const{searchTerm:u,setSearchTerm:D}=It(),{isAuthenticated:g,user:m}=Xe(),x=m==null?void 0:m.role,[H,d]=s.useState(!1),[R,M]=s.useState(null),[X,fe]=s.useState(!1),[z,O]=s.useState(null),[V,p]=s.useState(!1),[A,_]=s.useState(new Map),[Y,K]=s.useState(!1),[N,q]=s.useState(null),[b,S]=s.useState([]),[E,Q]=s.useState([]),[P,B]=s.useState(!0),[L,J]=s.useState(!1),[ee,ge]=s.useState(null),[xe,te]=s.useState(1),[he,r]=s.useState(0),[U,C]=s.useState(!1),[T,pe]=s.useState("doc_name"),[i,y]=s.useState("asc"),[w,be]=s.useState(""),[se,Ce]=s.useState(""),[re,Ie]=s.useState(""),[ae,Me]=s.useState(""),[oe,Ae]=s.useState(""),[le,Ye]=s.useState(""),[ne,Ke]=s.useState(""),[de,Qe]=s.useState(""),[ie,et]=s.useState(""),[ce,tt]=s.useState(""),[k,Z]=s.useState(new Set),[Ee,ye]=s.useState(!1),[we,je]=s.useState(null),[Pe,Ne]=s.useState(!1),[Ue,Te]=s.useState(!1),[st,Le]=s.useState(!1),[ue,$e]=s.useState(!1),[v,me]=s.useState(null),ke=s.useRef(null),ze=Mt(),Se=s.useMemo(()=>N!==null||w!==""||se!==""||re!==""||ae!==""||oe!==""||u!=="",[N,w,se,re,ae,oe,u]),Be=s.useCallback(()=>{q(null),be(""),Ce(""),Ie(""),Me(""),Ae(""),D&&D("")},[D]),j=s.useCallback(async(t,o=!1)=>{var n,c;o?(B(!0),ge(null)):J(!0);try{const l=await At(N===null?void 0:N,t,15,T,i,le||void 0,ne||void 0,de||void 0,ie||void 0,ce||void 0,u),h=l.documents;S(ve=>{const F=o?h:[...ve,...h];return _(G=>{const $=new Map;if(g&&F)for(const Ve of F)$.set(Ve.id,{favoriteId:Ve.favorite_id});return $}),F}),r(l.total_documents),te(l.page),C(l.page<l.total_pages)}catch(l){console.error(`Failed to load documents (page ${t}):`,l);const h=((c=(n=l.response)==null?void 0:n.data)==null?void 0:c.msg)||l.message||"Failed to fetch documents.";o?(ge(h),S([]),C(!1)):(f(h),C(!1))}finally{o?B(!1):J(!1)}},[N,15,T,i,le,ne,de,ie,ce,g,u]);s.useEffect(()=>{const t=setTimeout(()=>Ye(w),500);return()=>clearTimeout(t)},[w]),s.useEffect(()=>{const t=setTimeout(()=>Ke(se),500);return()=>clearTimeout(t)},[se]),s.useEffect(()=>{const t=setTimeout(()=>Qe(re),500);return()=>clearTimeout(t)},[re]),s.useEffect(()=>{const t=setTimeout(()=>et(ae),500);return()=>clearTimeout(t)},[ae]),s.useEffect(()=>{const t=setTimeout(()=>tt(oe),500);return()=>clearTimeout(t)},[oe]),s.useEffect(()=>{if(!g){S([]),_(new Map),te(1),C(!1),B(!1);return}j(1,!0)},[g,N,T,i,le,ne,de,ie,ce,u,j]),s.useEffect(()=>{Z(new Set)},[N,T,i,le,ne,de,ie,ce,u,xe]),s.useEffect(()=>{g&&(async()=>{try{const o=await Je();Q(o)}catch(o){console.error("Failed to load software for filters",o),f("Failed to load software list for filtering.")}})()},[g]),s.useEffect(()=>{const t=new URLSearchParams(ze.search),o=t.get("item_id"),n=t.get("comment_id");if(o&&n&&b.length>0){const c=parseInt(o,10);if(!isNaN(c)){const l=b.find(h=>h.id===c);l?((!v||v.id!==l.id)&&me(l),setTimeout(()=>{var h;(h=ke.current)==null||h.scrollIntoView({behavior:"smooth",block:"center"})},100)):console.warn(`DocumentsView: Document with item_id ${c} not found in the current list.`)}}},[ze.search,b]);const rt=t=>{q(t)};s.useEffect(()=>{if(!g){S([]),_(new Map),te(1),C(!1),B(!1);return}j(1,!0)},[g,N,T,i,le,ne,de,ie,ce,u,j]);const at=t=>{const o=T===t&&i==="asc"?"desc":"asc";pe(t),y(o)},ot=s.useCallback(t=>{j(t,!0),Z(new Set)},[j]),lt=t=>{d(!1),j(1,!0)},nt=t=>{M(null),j(1,!0)},dt=t=>{d(!1),M(t),window.scrollTo({top:0,behavior:"smooth"})},it=()=>M(null),ct=t=>{O(t),fe(!0)},Fe=()=>{O(null),fe(!1)},ut=async()=>{if(z){p(!0),v&&z.id===v.id&&me(null);try{await Lt(z.id),I(`Document "${z.doc_name}" deleted.`),Fe(),j(1,!0)}catch(t){f(t.message||"Failed to delete document."),Fe()}finally{p(!1)}}},Re=s.useMemo(()=>u?new ss(b,{keys:["doc_name","description","software_name","uploaded_by_username","updated_by_username"],includeScore:!0,threshold:.4}).search(u).map(o=>o.item):b,[b,u]),mt=(t,o)=>{Z(n=>{const c=new Set(n);return o?c.add(t):c.delete(t),c})},ft=t=>{const o=new Set;t&&Re.forEach(n=>o.add(n.id)),Z(o)},gt=()=>{if(k.size===0){f("No items selected.");return}Ne(!0)},xt=async()=>{Ne(!1),Te(!0);try{const t=await $t(Array.from(k),"document");I(t.msg||`${t.deleted_count} item(s) deleted.`),Z(new Set),v&&k.has(v.id)&&me(null),j(1,!0)}catch(t){f(t.message||"Bulk delete failed.")}finally{Te(!1)}},ht=async()=>{if(k.size===0){f("No items selected.");return}const t=b.filter(n=>k.has(n.id)&&!n.is_external_link&&n.is_downloadable!==!1);if(t.length===0){f("No downloadable files selected. External links or non-downloadable items cannot be bulk downloaded.");return}const o=t.map(n=>n.id);Le(!0);try{const n=await Pt(o,"document"),c=URL.createObjectURL(n),l=document.createElement("a");l.href=c;const h=new Date().toISOString().replace(/:/g,"-");l.download=`bulk_download_documents_${h}.zip`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(c),o.length===k.size?I("Download started for all selected downloadable documents."):I(`Starting download for ${o.length} file(s). External links or non-downloadable items were excluded.`)}catch(n){f(n.message||"Bulk download failed.")}finally{Le(!1)}},pt=()=>{if(k.size===0){f("No items selected.");return}if(E.length===0){f("Software list unavailable.");return}je(null),ye(!0)},bt=async()=>{if(!we){f("Select target software.");return}ye(!1),$e(!0);try{const t=await zt(Array.from(k),"document",{target_software_id:we});I(t.msg||`${t.moved_count} item(s) moved.`),Z(new Set),j(1,!0)}catch(t){let o="Bulk move failed.";t.message&&typeof t.message=="string"&&t.message.includes("UNIQUE constraint failed")?o="A document with this name already exists in the target software category. Please check for duplicates.":t.message&&(o=t.message),f(o)}finally{$e(!1),je(null)}},yt=[{key:"doc_name",header:"Name",sortable:!0},{key:"doc_type",header:"Type",sortable:!0},{key:"software_name",header:"Software",sortable:!0},{key:"description",header:"Description",render:t=>e.jsx("span",{className:"text-sm block max-w-xs truncate",title:t.description||"",children:t.description||"-"})},{key:"download_link",header:"Download",render:t=>{var c;const o=t.is_external_link||t.is_downloadable;return!(t.is_external_link||t.is_downloadable!==!1)&&!t.is_external_link?e.jsxs("span",{className:"flex items-center text-gray-400 cursor-not-allowed",title:"Download not permitted",children:[e.jsx(De,{size:14,className:"mr-1"}),"Link"]}):e.jsxs("a",{href:t.download_link,target:t.is_external_link||!((c=t.download_link)!=null&&c.startsWith("/"))?"_blank":"_self",rel:"noopener noreferrer",className:`flex items-center ${o?"text-blue-600 hover:text-blue-800":"text-gray-400 cursor-not-allowed"}`,onClick:l=>{o||l.preventDefault(),l.stopPropagation()},title:o?t.is_external_link?"Open external link":"Download file":"Download not permitted",children:[e.jsx(De,{size:14,className:"mr-1"}),"Link"]})}},{key:"uploaded_by_username",header:"Uploaded By",sortable:!0,render:t=>t.uploaded_by_username||"N/A"},{key:"updated_by_username",header:"Updated By",sortable:!1,render:t=>t.updated_by_username||"N/A"},{key:"created_at",header:"Created At",sortable:!0,render:t=>qe(t.created_at??"")},{key:"updated_at",header:"Updated At",sortable:!0,render:t=>qe(t.updated_at??"")},{key:"actions",header:"Actions",render:t=>{var o,n,c;return e.jsxs("div",{className:"flex space-x-1 items-center",children:[g&&e.jsx("button",{onClick:l=>{l.stopPropagation(),vt(t,"document")},className:`p-1 rounded-md ${(o=A.get(t.id))!=null&&o.favoriteId?"text-yellow-500 hover:text-yellow-600":"text-gray-400 hover:text-yellow-500"}`,title:(n=A.get(t.id))!=null&&n.favoriteId?"Remove Favorite":"Add Favorite",children:e.jsx(Ut,{size:16,className:(c=A.get(t.id))!=null&&c.favoriteId?"fill-current":""})}),(x==="admin"||x==="super_admin")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),dt(t)},className:"p-1 text-blue-600 hover:text-blue-800 rounded-md",title:"Edit",children:e.jsx(ts,{size:16})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),ct(t)},className:"p-1 text-red-600 hover:text-red-800 rounded-md",title:"Delete",children:e.jsx(We,{size:16})})]}),g&&e.jsxs("button",{onClick:l=>{l.stopPropagation(),v&&v.id===t.id?me(null):(me(t),setTimeout(()=>{var h;return(h=ke.current)==null?void 0:h.scrollIntoView({behavior:"smooth"})},0))},className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 rounded-md",title:v&&v.id===t.id?"Hide Comments":"View Comments",children:[e.jsx(Tt,{size:16}),e.jsxs("span",{className:"ml-1 text-xs",children:["(",t.comment_count??0,")"]})]})]})}}],wt=Math.ceil(he/15),Oe=s.useCallback(()=>{j(1,!0)},[j]),kt=()=>R?e.jsx("div",{className:"my-6 p-4 bg-gray-50 rounded-lg shadow dark:bg-gray-700",children:e.jsx(He,{documentToEdit:R,onDocumentUpdated:nt,onCancelEdit:it})}):H?e.jsx("div",{className:"my-6 p-4 bg-gray-50 rounded-lg shadow dark:bg-gray-700",children:e.jsx(He,{onDocumentAdded:lt,onCancelEdit:()=>d(!1)})}):null,vt=async(t,o)=>{var h,ve;if(!g){f("Please log in to manage favorites.");return}const n=A.get(t.id),c=!!(n!=null&&n.favoriteId),l=new Map(A);c?l.set(t.id,{favoriteId:void 0}):l.set(t.id,{favoriteId:-1}),_(l);try{if(c&&typeof(n==null?void 0:n.favoriteId)=="number")await Bt(t.id,o),I(`"${t.doc_name}" removed from favorites.`),_(F=>{const G=new Map(F);return G.set(t.id,{favoriteId:void 0}),G});else{const F=await Rt(t.id,o);_(G=>{const $=new Map(G);return $.set(t.id,{favoriteId:F.id}),$}),I(`"${t.doc_name}" added to favorites.`)}}catch(F){f(((ve=(h=F==null?void 0:F.response)==null?void 0:h.data)==null?void 0:ve.msg)||F.message||"Failed to update favorite."),_(G=>{const $=new Map(G);return c?$.set(t.id,{favoriteId:n==null?void 0:n.favoriteId}):$.set(t.id,{favoriteId:void 0}),$})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start sm:items-center mb-6 flex-col sm:flex-row",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Documents"}),e.jsx("p",{className:"text-gray-600 mt-1 dark:text-gray-300",children:"Browse and manage official documents and resources."})]}),g&&(x==="admin"||x==="super_admin")&&!R&&e.jsxs("button",{onClick:()=>{d(t=>!t),M(null)},className:`mt-4 sm:mt-0 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white ${H?"bg-red-600 hover:bg-red-700 focus:ring-red-500":"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500"} focus:outline-none focus:ring-2 focus:ring-offset-2`,children:[H?e.jsx(Ze,{size:18,className:"mr-2"}):e.jsx(as,{size:18,className:"mr-2"}),H?"Cancel":"Add New Document"]})]}),kt(),k.size>0&&e.jsx("div",{className:"my-4 p-3 bg-gray-100 dark:bg-gray-700 rounded-md shadow-sm border border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:[k.size," item(s) selected"]}),(x==="admin"||x==="super_admin")&&e.jsxs("button",{onClick:gt,disabled:Ue,className:"px-3 py-1.5 text-xs font-medium rounded-md shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 text-white bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 focus:ring-red-500 disabled:opacity-50",children:[e.jsx(We,{size:14,className:"mr-1.5"}),"Delete"]}),g&&e.jsxs("button",{onClick:ht,disabled:st,className:"px-3 py-1.5 text-xs font-medium rounded-md shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 text-white bg-green-500 hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700 focus:ring-green-500 disabled:opacity-50",children:[e.jsx(De,{size:14,className:"mr-1.5"}),"Download"]}),(x==="admin"||x==="super_admin")&&e.jsxs("button",{onClick:pt,disabled:ue,className:"px-3 py-1.5 text-xs font-medium rounded-md shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 text-white bg-blue-500 hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700 focus:ring-blue-500 disabled:opacity-50",children:[e.jsx(Kt,{size:14,className:"mr-1.5"}),"Move"]})]})}),E.length>0&&e.jsx(Gt,{software:E,selectedSoftwareId:N,onSelectFilter:rt}),e.jsx("div",{className:"mb-4",children:e.jsxs("button",{onClick:()=>K(t=>!t),className:"flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-md text-sm font-medium",children:[Y?e.jsxs(e.Fragment,{children:[e.jsx(Ot,{size:18,className:"mr-2"}),"Hide"]}):e.jsxs(e.Fragment,{children:[e.jsx(Qt,{size:18,className:"mr-2"}),"Show"]})," Advanced Filters"]})}),Y&&e.jsxs("div",{className:"my-4 p-4 border dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 space-y-4 md:space-y-0 md:flex md:flex-wrap md:items-end md:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"docTypeFilterInput",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Doc Type"}),e.jsx("input",{id:"docTypeFilterInput",type:"text",value:w,onChange:t=>be(t.target.value),placeholder:"e.g., Manual",className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Created"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:se,onChange:t=>Ce(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"to"}),e.jsx("input",{type:"date",value:re,onChange:t=>Ie(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Updated"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:ae,onChange:t=>Me(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"to"}),e.jsx("input",{type:"date",value:oe,onChange:t=>Ae(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200"})]})]}),e.jsx("div",{className:"flex items-end gap-2 pt-5",children:e.jsx("button",{onClick:Be,className:"text-sm px-4 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Clear"})})]}),P?e.jsx("div",{className:"py-10",children:e.jsx(Et,{message:"Loading documents..."})}):ee&&b.length===0&&!P?e.jsx(Wt,{message:ee,onRetry:Oe}):!P&&!ee&&b.length===0?e.jsxs("div",{className:"text-center py-10 bg-white dark:bg-gray-800 rounded-lg shadow-sm my-6",children:[e.jsx(_e,{size:48,className:"mx-auto text-yellow-500 dark:text-yellow-400 mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-700 dark:text-gray-200 mb-3",children:Se?"No Documents Found Matching Criteria":"No Documents Available"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 px-4",children:Se?"Try adjusting or clearing your search/filter settings.":x==="admin"||x==="super_admin"?"Add new documents to get started.":"Please check back later."}),Se&&e.jsx("button",{onClick:Be,className:"mt-6 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 text-sm font-medium",children:"Clear All Filters & Search"})]}):e.jsx(Vt,{columns:yt,data:Re,rowClassName:"group",isLoading:P||L,currentPage:xe,totalPages:wt,onPageChange:ot,itemsPerPage:15,totalItems:he,sortColumn:T,sortOrder:i,onSort:at,isSelectionEnabled:!0,selectedItemIds:k,onSelectItem:mt,onSelectAllItems:ft}),X&&z&&e.jsx(Ge,{isOpen:X,title:"Delete Document",message:`Delete "${z.doc_name}"?`,onConfirm:ut,onCancel:Fe,isConfirming:V,confirmButtonText:"Delete",confirmButtonVariant:"danger"}),Pe&&e.jsx(Ge,{isOpen:Pe,title:`Delete ${k.size} Document(s)`,message:`Delete ${k.size} selected items?`,onConfirm:xt,onCancel:()=>Ne(!1),isConfirming:Ue,confirmButtonText:"Delete Selected",confirmButtonVariant:"danger"}),Ee&&e.jsx(rs,{isOpen:Ee,onClose:()=>ye(!1),title:`Move ${k.size} Document(s)`,children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:"Select target software:"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"targetSoftware",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Target Software"}),e.jsxs("select",{id:"targetSoftware",value:we??"",onChange:t=>je(t.target.value?parseInt(t.target.value):null),className:"input-class w-full dark:bg-gray-700 dark:text-white dark:border-gray-600",disabled:E.length===0||ue,children:[e.jsx("option",{value:"",children:"Select Software..."}),E.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),E.length===0&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Software list unavailable."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>ye(!1),className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:ue,children:"Cancel"}),e.jsx("button",{type:"button",onClick:bt,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:ue||!we,children:ue?"Moving...":"Confirm Move"})]})]})}),g&&v&&e.jsxs("div",{ref:ke,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-4",children:["Comments for: ",e.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:v.doc_name})]}),e.jsx(es,{itemId:v.id,itemType:"document",onCommentAction:Oe})]}),!g&&v&&e.jsx("div",{ref:ke,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Please log in to view and manage comments."})})]})};export{gs as default};
