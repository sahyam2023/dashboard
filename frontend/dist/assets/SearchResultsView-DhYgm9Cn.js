import{O as D,u as P,k as z,ad as C,r as m,j as a,m as L,ae as K,af as f,ag as B,S as O,ah as U,v as W,w as X}from"./index-D4LpaxLs.js";import{E as V}from"./ErrorState-C67oOGTq.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=D("SearchX",[["path",{d:"m13.5 8.5-5 5",key:"1cs55j"}],["path",{d:"m8.5 8.5 5 5",key:"a8mexj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Q=()=>{const{isAuthenticated:h}=P(),[M]=z();C();const p=M.get("q")||"",[E,w]=m.useState({}),[j,k]=m.useState(0),[A,$]=m.useState(!1),[N,_]=m.useState(null),[b,x]=m.useState(null),[y,g]=m.useState(new Map);m.useEffect(()=>{h||g(new Map)},[h]),m.useEffect(()=>{if(!p){w({}),k(0);return}(async()=>{try{$(!0),_(null);const s=await B(p),o=s.reduce((r,i)=>{const d=i.type||"unknown";return r[d]||(r[d]=[]),r[d].push(i),r},{});w(o),k(s.length);const t=new Map;if(h&&s&&s.length>0)for(const r of s){const i=`${r.type}-${r.id}`;r.favorite_id?t.set(i,{favoriteId:r.favorite_id}):t.set(i,{favoriteId:void 0})}g(t)}catch(s){_("Failed to fetch search results. Please try again later."),console.error(s),w({}),k(0)}finally{$(!1)}})()},[p,h]);const T=(e,s)=>{var I,S,F;const o=`${e.type}-${e.id}-${s}`;let t,r=!1,i=!1,d,v=!0;switch(e.type){case"document":t=`/documents?page=${e.page_number||1}&highlight=${e.id}`;break;case"patch":t=`/patches?page=${e.page_number||1}&highlight=${e.id}`;break;case"software":t=`/documents?software_id=${e.id}`;break;case"version":t=`/patches?software_id=${e.software_id}`;break;case"link":e.page_number&&e.id?t=`/links?page=${e.page_number}&highlight=${e.id}`:e.is_external_link&&e.url?(t=e.url,r=!0):e.stored_filename&&(d=`/official_uploads/links/${e.stored_filename}`,i=!0,v=e.is_downloadable!==!1);break;case"misc_file":e.page_number&&e.id?t=`/misc?page=${e.page_number}&highlight=${e.id}`:e.stored_filename&&(d=`/misc_uploads/${e.stored_filename}`,i=!0,v=e.is_downloadable!==!1);break}const c=e.title||e.name||"Untitled",l=e.description?e.description.length>150?e.description.substring(0,147)+"...":e.description:"No description available.",n=a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsx("h4",{className:"font-medium text-lg text-gray-900 mb-1 flex-grow",children:c}),h&&a.jsx("button",{onClick:R=>{R.stopPropagation(),R.preventDefault(),q(e)},className:`p-1 ${(I=y.get(`${e.type}-${e.id}`))!=null&&I.favoriteId?"text-yellow-500":"text-gray-400"} hover:text-yellow-600 flex-shrink-0`,title:(S=y.get(`${e.type}-${e.id}`))!=null&&S.favoriteId?"Remove from Favorites":"Add to Favorites",children:a.jsx(O,{size:16,className:(F=y.get(`${e.type}-${e.id}`))!=null&&F.favoriteId?"fill-current":""})})]}),a.jsxs("p",{className:"text-xs text-gray-500 mb-1 uppercase tracking-wider",children:["Type: ",e.type,e.type==="version"&&e.software_name&&` (for ${e.software_name})`,e.type!=="version"&&e.software_name&&` â€¢ Software: ${e.software_name}`]}),a.jsx("p",{className:"text-gray-600 text-sm",children:l})]}),u="block bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow";return r&&t?a.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:u,children:n},o):i&&d?v?a.jsx("a",{href:d,className:u,download:!0,target:"_blank",rel:"noopener noreferrer",children:n},o):a.jsx("div",{className:`${u} cursor-not-allowed opacity-70`,title:"Download not permitted",children:n},o):t?a.jsx(U,{to:t,className:u,children:n},o):a.jsx("div",{className:u+" cursor-default",children:n},o)},q=async e=>{var d,v;if(!h){x("Please log in to manage favorites.");return}const s=`${e.type}-${e.id}`,o=typeof e.id=="string"?parseInt(e.id,10):e.id;if(isNaN(o)){x("Invalid item ID for favoriting.");return}const t=y.get(s),r=!!(t!=null&&t.favoriteId),i=new Map(y);r?i.set(s,{favoriteId:void 0}):i.set(s,{favoriteId:-1}),g(i),x(null);try{if(r&&typeof(t==null?void 0:t.favoriteId)=="number")await W(o,e.type),x(`"${e.name||e.title}" removed from favorites.`),g(c=>{const l=new Map(c);return l.set(s,{favoriteId:void 0}),l});else{const c=await X(o,e.type);g(l=>{const n=new Map(l);return n.set(s,{favoriteId:c.id}),n}),x(`"${e.name||e.title}" added to favorites.`)}}catch(c){console.error("Failed to toggle favorite for search result:",c),x(((v=(d=c==null?void 0:c.response)==null?void 0:d.data)==null?void 0:v.msg)||c.message||"Failed to update favorite status."),g(l=>{const n=new Map(l);return r?n.set(s,{favoriteId:t==null?void 0:t.favoriteId}):n.set(s,{favoriteId:void 0}),n})}};return A?a.jsx(L,{message:"Searching..."}):N?a.jsx(V,{message:N}):j===0&&p?a.jsxs(K,{className:"container mx-auto px-4 py-8",sx:{textAlign:"center",mt:4,p:3},children:[a.jsx(f,{variant:"h5",component:"h2",sx:{mb:2,color:"text.primary"},children:"Search Results"}),a.jsx(G,{size:60,className:"text-gray-400 dark:text-gray-500 mb-4 mx-auto"}),a.jsxs(f,{variant:"h6",color:"text.secondary",sx:{mb:1},children:['No results found for "',a.jsx(f,{component:"span",sx:{fontWeight:"medium",color:"text.primary"},children:p}),'"']}),a.jsx(f,{variant:"body2",color:"text.secondary",children:"Try different keywords or check back later."})]}):p?a.jsxs("div",{className:"container mx-auto px-4 py-8",children:[b&&a.jsx("div",{className:"p-3 my-2 bg-blue-100 text-blue-700 rounded text-sm",children:b}),a.jsxs("div",{className:"mb-6",children:[a.jsx(f,{variant:"h5",component:"h2",sx:{mb:1,color:"text.primary"},children:"Search Results"}),a.jsxs(f,{color:"text.secondary",children:["Found ",j," result",j!==1?"s":"",' for "',a.jsx(f,{component:"span",sx:{fontWeight:"medium",color:"text.primary"},children:p}),'"']})]}),Object.entries(E).map(([e,s])=>s.length>0&&a.jsxs("div",{className:"mb-8",children:[a.jsxs(f,{variant:"h6",component:"h3",sx:{mb:2,textTransform:"capitalize",borderBottom:1,borderColor:"divider",pb:1,color:"text.primary"},children:[e.replace("_"," "),"s"]}),a.jsx("div",{className:"space-y-4",children:s.map((o,t)=>T(o,t))})]},e))]}):a.jsxs("div",{className:"container mx-auto px-4 py-8",children:[b&&a.jsx("div",{className:"p-3 my-2 bg-blue-100 text-blue-700 rounded text-sm",children:b}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Search"}),a.jsx("p",{className:"text-gray-600",children:"Please enter a search term in the header to find results."})]})]})};export{Q as default};
