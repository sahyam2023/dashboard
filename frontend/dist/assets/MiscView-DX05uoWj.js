import{r as s,u as je,N as He,s as u,j as e,F as vt,X as kt,a as wt,g as jt,O as Ct,Q as Qe,R as Ft,T as Nt,b as L,h as St,i as _t,U as Mt,D as ke,l as Dt,m as It,C as we,n as At,S as Pt,M as zt,V as Ut,W as Bt,p as $t,q as Lt,t as Et,v as Ot}from"./index-CMD0hoPe.js";import{u as Ke,U as Vt,o as Xe,c as Ye,a as me,b as Rt,T as We,M as Tt,F as qt,C as Qt,P as Wt}from"./CommentSection-CN1_kgv-.js";import{C as Gt,D as Ht}from"./DataTable-VvBgKFOl.js";import{E as Kt}from"./ErrorState-rSCZ_ZZ_.js";import{M as Xt}from"./Modal-D4ZcctNE.js";import{P as Ge}from"./plus-circle-DcR8ybqu.js";import{A as Yt}from"./archive-DLS09qhE.js";const Jt=Ye().shape({selectedCategoryId:me().required("Please select a misc category."),selectedFile:Rt().when("$isEditMode",{is:r=>!r,then:r=>r.required("Please select a file to upload.").test("filePresent","File is required for upload.",c=>!!c),otherwise:r=>r.nullable()}),title:me().transform(r=>r===""?void 0:r).optional().max(255,"Title cannot exceed 255 characters.").nullable(),description:me().transform(r=>r===""?void 0:r).optional().max(1e3,"Description cannot exceed 1000 characters.").nullable()}),Zt=({fileToEdit:r,preselectedCategoryId:c,onUploadSuccess:g,onFileUpdated:k,onCancelEdit:f})=>{const n=!!r,{register:N,handleSubmit:E,formState:{errors:m},watch:Q,setValue:O,reset:h}=Ke({resolver:Xe(Jt),context:{isEditMode:n},defaultValues:{selectedCategoryId:(c==null?void 0:c.toString())||"",title:"",description:"",selectedFile:null}}),[I,V]=s.useState([]),[A,y]=s.useState(null),[w,j]=s.useState(!1),[P,R]=s.useState(!1),[b,x]=s.useState(0),[S,W]=s.useState(!1),C=s.useRef(null),{isAuthenticated:Y,user:J}=je(),_=J==null?void 0:J.role,D=Q("selectedFile");s.useEffect(()=>{const l=z=>{S&&(z.preventDefault(),z.returnValue="")};return window.addEventListener("beforeunload",l),()=>{window.removeEventListener("beforeunload",l)}},[S]),s.useEffect(()=>{const l=()=>{document.visibilityState==="hidden"&&S&&wt("Changing tabs or minimizing the window might interrupt the upload process.")};return document.addEventListener("visibilitychange",l),()=>{document.removeEventListener("visibilitychange",l)}},[S]),s.useEffect(()=>{Y&&(_==="admin"||_==="super_admin")&&(R(!0),He().then(V).catch(()=>u("Failed to load misc categories.")).finally(()=>R(!1)))},[Y,_]),s.useEffect(()=>{n&&r?(h({selectedCategoryId:r.misc_category_id.toString(),title:r.user_provided_title||"",description:r.user_provided_description||"",selectedFile:null}),y(r.original_filename),C.current&&(C.current.value="")):(h({selectedCategoryId:(c==null?void 0:c.toString())||"",title:"",description:"",selectedFile:null}),y(null),C.current&&(C.current.value=""))},[n,r,c,h]);const G=l=>{l.target.files&&l.target.files[0]?(O("selectedFile",l.target.files[0],{shouldValidate:!0,shouldDirty:!0}),n&&y(null)):O("selectedFile",null,{shouldValidate:!0,shouldDirty:!0})},he=()=>{O("selectedFile",null,{shouldValidate:!0,shouldDirty:!0}),C.current&&(C.current.value=""),n&&r&&y(r.original_filename)},re=async l=>{var z,ee,H,te,se,U;if(!Y||!_||!["admin","super_admin"].includes(_)){u("Not authorized.");return}j(!0),l.selectedFile&&W(!0),x(0);try{let B;if(l.selectedFile){const F={misc_category_id:l.selectedCategoryId,user_provided_title:((z=l.title)==null?void 0:z.trim())||"",user_provided_description:((ee=l.description)==null?void 0:ee.trim())||""};B=await jt(l.selectedFile,"misc_file",F,K=>x(K)),g&&g(B),h({selectedCategoryId:(c==null?void 0:c.toString())||l.selectedCategoryId,title:"",description:"",selectedFile:null}),C.current&&(C.current.value="")}else if(n&&r){const F=new FormData;F.append("misc_category_id",l.selectedCategoryId),F.append("user_provided_title",((H=l.title)==null?void 0:H.trim())||""),F.append("user_provided_description",((te=l.description)==null?void 0:te.trim())||""),B=await Ct(r.id,F),k&&k(B)}else{u("No file selected for new upload."),j(!1);return}}catch(B){const F=((U=(se=B.response)==null?void 0:se.data)==null?void 0:U.msg)||B.message;let K="File operation failed.";F&&typeof F=="string"&&F.includes("UNIQUE constraint failed")?K="A file with this title or name already exists in this category. Please use a different title or check for duplicates.":F&&(K=F),u(K),l.selectedFile&&W(!1)}finally{j(!1),l.selectedFile&&W(!1)}},Z=l=>{console.error("Form validation errors:",l),u("Please correct the errors highlighted in the form.")};return!Y||!_||!["admin","super_admin"].includes(_)?null:e.jsxs("form",{onSubmit:E(re,Z),className:"space-y-6 bg-white dark:bg-gray-800 dark:border-gray-700 p-6 rounded-lg shadow-lg border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:n?"Edit Miscellaneous File":"Upload File to Misc Category"}),n&&f&&e.jsx("button",{type:"button",onClick:f,className:"text-sm text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",children:"Cancel Edit"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"selectedCategoryId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Misc Category*"}),P?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading categories..."}):e.jsxs("select",{id:"selectedCategoryId",...N("selectedCategoryId"),disabled:w||I.length===0,className:`mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md ${m.selectedCategoryId?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600`,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a category"}),I.map(l=>e.jsx("option",{value:l.id.toString(),children:l.name},l.id))]}),m.selectedCategoryId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.selectedCategoryId.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n?"Replace File (Optional)":"Select File*"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md dark:border-gray-600 hover:border-blue-500 dark:hover:border-blue-400",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(Vt,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500"}),e.jsxs("div",{className:"flex text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("label",{htmlFor:"selectedFile",className:"relative cursor-pointer bg-white dark:bg-gray-800 rounded-md font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300 focus-within:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("span",{children:D?"Change file":"Upload a file"}),e.jsx("input",{id:"selectedFile",name:"selectedFile-input",type:"file",className:"sr-only",onChange:G,ref:C,disabled:w})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Any allowed file type."})]})}),(D||n&&A)&&e.jsxs("div",{className:"mt-3 flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden",children:[e.jsx(vt,{size:18,className:"text-gray-500 dark:text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:D?D.name:A}),n&&A&&!D&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:"(current file)"})]}),D&&e.jsx("button",{type:"button",onClick:he,disabled:w,className:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-200 dark:text-gray-500 dark:hover:text-gray-300 dark:hover:bg-gray-600",children:e.jsx(kt,{size:16})})]}),m.selectedFile&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.selectedFile.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"File Title (Optional)"}),e.jsx("input",{type:"text",id:"title",...N("title"),placeholder:n&&r?r.original_filename:"Defaults to filename if blank",disabled:w,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${m.title?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),m.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.title.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"File Description (Optional)"}),e.jsx("textarea",{id:"description",rows:3,...N("description"),disabled:w,className:`mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 ${m.description?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),m.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.description.message})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"submit",disabled:w||P||!n&&!D||!Q("selectedCategoryId"),className:"flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:w?n?"Updating...":"Uploading...":n?"Update File Details":"Upload to Misc"}),n&&f&&e.jsx("button",{type:"button",onClick:f,disabled:w,className:"flex-1 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 dark:border-gray-500 dark:text-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600",children:"Cancel"})]}),w&&D&&b>0&&e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-4 dark:bg-gray-700 my-3 relative",children:[e.jsx("div",{className:"bg-blue-600 h-4 rounded-full transition-all duration-150 ease-out",style:{width:`${b}%`}}),e.jsxs("p",{className:"absolute inset-0 text-center text-xs font-medium leading-4 text-white dark:text-gray-100",children:[Math.round(b),"%"]})]})]})},es=Ye().shape({name:me().required("Category name is required.").max(100,"Category name cannot exceed 100 characters."),description:me().optional().max(500,"Description cannot exceed 500 characters.").nullable()}),ts=({categoryToEdit:r,onSuccess:c,onCancel:g})=>{const k=!!r,{register:f,handleSubmit:n,formState:{errors:N},reset:E}=Ke({resolver:Xe(es),defaultValues:{name:"",description:""}}),[m,Q]=s.useState(!1),{isAuthenticated:O,user:h}=je(),I=h==null?void 0:h.role;s.useEffect(()=>{E(k&&r?{name:r.name,description:r.description||""}:{name:"",description:""})},[r,k,E]);const V=async y=>{var w,j,P,R;Q(!0);try{let b;if(k&&r){const x={};let S=!1;y.name.trim()!==r.name&&(x.name=y.name.trim(),S=!0);const W=r.description||"",C=((w=y.description)==null?void 0:w.trim())||"";if(C!==W&&(x.description=C||void 0,S=!0),!S){Qe.info("No changes detected."),Q(!1),c&&c(r);return}b=await Ft(r.id,x)}else{const x={name:y.name.trim(),description:((j=y.description)==null?void 0:j.trim())||void 0};b=await Nt(x)}L("Category saved successfully!"),k||E({name:"",description:""}),c&&c(b)}catch(b){const x=((R=(P=b.response)==null?void 0:P.data)==null?void 0:R.msg)||b.message;let S=`Failed to ${k?"update":"add"} category.`;x&&typeof x=="string"&&x.includes("UNIQUE constraint failed")?S="A category with this name already exists. Please use a different name.":x&&(S=x),u(S)}finally{Q(!1)}},A=y=>{console.error("Form validation errors:",y),Qe.error("Please correct the errors in the form.")};return!O||!I||!["admin","super_admin"].includes(I)?e.jsx("p",{children:"You are not authorized to manage categories."}):e.jsxs("form",{onSubmit:n(V,A),className:"space-y-4 p-4 border border-gray-200 rounded-lg bg-white shadow-sm dark:bg-gray-800 dark:border-gray-700",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800 dark:text-gray-100",children:k?"Edit Miscellaneous Category":"Add New Miscellaneous Category"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name*"}),e.jsx("input",{type:"text",id:"name",...f("name"),disabled:m,className:`mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${N.name?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),N.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:N.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Description"}),e.jsx("textarea",{id:"description",...f("description"),rows:3,disabled:m,className:`mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${N.description?"border-red-500":""} dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:placeholder-gray-400`}),N.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:N.description.message})]}),e.jsxs("div",{className:"flex items-center space-x-3 pt-2",children:[e.jsx("button",{type:"submit",disabled:m,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-60",children:m?k?"Updating...":"Adding...":k?"Save Changes":"Add Category"}),g&&e.jsx("button",{type:"button",onClick:g,disabled:m,className:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:border-gray-500 dark:text-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600",children:"Cancel"})]})]})},ss="http://localhost:7000",cs=()=>{const{searchTerm:r,setSearchTerm:c}=St(),{isAuthenticated:g,user:k}=je(),f=k==null?void 0:k.role,[n,N]=s.useState([]),[E,m]=s.useState(!0),[Q,O]=s.useState(null),[h,I]=s.useState([]),[V,A]=s.useState(!0),[y,w]=s.useState(null),[j,P]=s.useState(null),[R,b]=s.useState(1),[x,S]=s.useState(15),[W,C]=s.useState(0),[Y,J]=s.useState(0),[_,D]=s.useState("user_provided_title"),[G,he]=s.useState("asc"),[re,Z]=s.useState(!1),[l,z]=s.useState(null),[ee,H]=s.useState(!1),[te,se]=s.useState(null),[U,B]=s.useState(null),[F,K]=s.useState(!1),[Je,Ce]=s.useState(!1),[T,Fe]=s.useState(null),[Ne,Se]=s.useState(!1),[_e,Me]=s.useState(!1),[ae,ie]=s.useState(new Map),[De,Ze]=s.useState(!0),[M,le]=s.useState(new Set),[Ie,Ae]=s.useState(!1),[et,Pe]=s.useState(!1),[oe,ze]=s.useState(!1),[Ue,ue]=s.useState(!1),[ge,ye]=s.useState(null),[Be,be]=s.useState(!1),[p,ne]=s.useState(null),fe=s.useRef(null),$e=_t(),pe=s.useMemo(()=>j!==null||r!=="",[j,r]),tt=s.useCallback(()=>{P(null),c&&c(""),b(1)},[c]),xe=s.useCallback(async()=>{var t,i;m(!0),O(null);try{const a=await He();N(a)}catch(a){N([]);const d=((i=(t=a.response)==null?void 0:t.data)==null?void 0:i.msg)||a.message||"Failed to load categories.";O(d),u(d)}finally{m(!1)}},[]);s.useEffect(()=>{g?xe():N([])},[g,xe]),s.useEffect(()=>{const t=new URLSearchParams($e.search),i=t.get("item_id"),a=t.get("comment_id");if(i&&a&&h.length>0){const d=parseInt(i,10);if(!isNaN(d)){const o=h.find(v=>v.id===d);o?((!p||p.id!==o.id)&&ne(o),setTimeout(()=>{var v;(v=fe.current)==null||v.scrollIntoView({behavior:"smooth",block:"center"})},100)):console.warn(`MiscView: MiscFile with item_id ${d} not found in the current list.`)}}},[$e.search,h,p]);const $=s.useCallback(async(t,i=!1)=>{var a,d;i&&A(!0),w(null);try{const o=await Mt(j||void 0,t,x,_,G,r);I(o.misc_files),C(o.total_pages),J(o.total_misc_files),b(o.page),S(o.per_page);const v=new Map;g&&o.misc_files&&o.misc_files.forEach(de=>v.set(de.id,{favoriteId:de.favorite_id})),ie(v)}catch(o){const v=((d=(a=o.response)==null?void 0:a.data)==null?void 0:d.msg)||o.message||"Failed to fetch files.";i?(w(v),I([]),C(0),J(0)):u(v)}finally{i&&A(!1)}},[j,x,_,G,g,r]);s.useEffect(()=>{g?$(1,!0):(I([]),A(!1))},[g,j,_,G,r,$]),s.useEffect(()=>{le(new Set)},[j,_,G,r,R]);const st=t=>{P(t.target.value?parseInt(t.target.value):null),b(1)},rt=t=>{b(t),$(t,!0)},at=t=>{D(t),he(i=>_===t&&i==="asc"?"desc":"asc"),b(1)},Le=(t,i)=>{H(!1),se(null),$(1,!0)},it=t=>{Z(!1),z(null),L(t),xe()},Ee=t=>{se(t||null),H(!0),Z(!1),t&&window.scrollTo({top:0,behavior:"smooth"})},Oe=()=>{se(null),H(!1)},lt=()=>{z(null),Z(!0),H(!1)},Ve=()=>{z(null),Z(!1)},Re=()=>{B(null),K(!1)},ot=t=>{Fe(t),Se(!0)},ve=()=>{Fe(null),Se(!1)},nt=async()=>{var t,i;if(U){Ce(!0);try{await Ut(U.id),L(`Category "${U.name}" deleted.`),Re(),xe(),j===U.id&&P(null)}catch(a){u(((i=(t=a.response)==null?void 0:t.data)==null?void 0:i.msg)||"Delete failed.")}finally{Ce(!1)}}},dt=async()=>{if(T){Me(!0),p&&p.id===T.id&&ne(null);try{await Bt(T.id),L(`File "${T.user_provided_title||T.original_filename}" deleted.`),ve(),$(1,!0)}catch(t){u(t.message||"Delete failed."),ve()}finally{Me(!1)}}},ct=(t,i)=>le(a=>{const d=new Set(a);return i?d.add(t):d.delete(t),d}),mt=t=>{const i=new Set;t&&h.forEach(a=>i.add(a.id)),le(i)},ut=()=>{if(M.size===0){u("No items selected.");return}be(!0)},gt=async()=>{be(!1),Ae(!0),p&&M.has(p.id)&&ne(null);try{const t=await $t(Array.from(M),"misc_file");L(t.msg||`${t.deleted_count} file(s) deleted.`),le(new Set),$(1,!0)}catch(t){u(t.message||"Bulk delete failed.")}finally{Ae(!1)}},ft=async()=>{if(M.size===0){u("No items selected.");return}Pe(!0);try{const t=await At(Array.from(M),"misc_file"),i=URL.createObjectURL(t),a=document.createElement("a");a.href=i;const d=new Date().toISOString().replace(/:/g,"-");a.download=`bulk_download_misc_files_${d}.zip`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(i),L("Download started.")}catch(t){u(t.message||"Bulk download failed.")}finally{Pe(!1)}},xt=()=>{if(M.size===0){u("No items selected.");return}if(n.length===0){u("Categories unavailable for move.");return}ye(null),ue(!0)},ht=async()=>{if(!ge){u("Select target category.");return}ue(!1),ze(!0);try{const t=await Lt(Array.from(M),"misc_file",{target_misc_category_id:ge});L(t.msg||`${t.moved_count} file(s) moved.`),le(new Set),$(1,!0)}catch(t){let i="Bulk move failed.";t.message&&typeof t.message=="string"&&t.message.includes("UNIQUE constraint failed")?i="A file with this name already exists in the target category. Please check for duplicates.":t.message&&(i=t.message),u(i)}finally{ze(!1),ye(null)}},yt=t=>{if(t==null)return"N/A";if(t===0)return"0 B";const i=1024,a=["B","KB","MB","GB","TB"],d=Math.floor(Math.log(t)/Math.log(i));return parseFloat((t/Math.pow(i,d)).toFixed(2))+" "+a[d]},bt=[{key:"user_provided_title",header:"Title",sortable:!0,render:t=>t.user_provided_title||e.jsx("span",{className:"italic text-gray-500 dark:text-gray-400",children:t.original_filename})},{key:"original_filename",header:"Original Filename",sortable:!0},{key:"category_name",header:"Category",sortable:!0},{key:"uploaded_by_username",header:"Uploaded By",sortable:!0,render:t=>t.uploaded_by_username||"N/A"},{key:"file_size",header:"Size",sortable:!0,render:t=>yt(t.file_size)},{key:"created_at",header:"Uploaded At",sortable:!0,render:t=>It(t.created_at??"")},{key:"file_path",header:"Link",render:t=>t.is_downloadable!==!1?e.jsxs("a",{href:`${ss}${t.file_path}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-blue-600 hover:text-blue-800",onClick:a=>a.stopPropagation(),title:"Download file",children:[e.jsx(ke,{size:14,className:"mr-1"}),"Download"]}):e.jsxs("span",{className:"flex items-center text-gray-400 cursor-not-allowed",title:"Download not permitted",children:[e.jsx(ke,{size:14,className:"mr-1"}),"Download"]})},{key:"actions",header:"Actions",render:t=>{var i,a,d;return e.jsxs("div",{className:"flex space-x-1 items-center",children:[g&&e.jsx("button",{onClick:o=>{o.stopPropagation(),pt(t,"misc_file")},className:`p-1 rounded-md ${(i=ae.get(t.id))!=null&&i.favoriteId?"text-yellow-500 hover:text-yellow-600":"text-gray-400 hover:text-yellow-500"}`,title:(a=ae.get(t.id))!=null&&a.favoriteId?"Remove Favorite":"Add Favorite",children:e.jsx(Pt,{size:16,className:(d=ae.get(t.id))!=null&&d.favoriteId?"fill-current":""})}),g&&e.jsxs("button",{onClick:o=>{o.stopPropagation(),p&&p.id===t.id?ne(null):(ne(t),setTimeout(()=>{var v;return(v=fe.current)==null?void 0:v.scrollIntoView({behavior:"smooth"})},0))},className:"p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 rounded-md",title:p&&p.id===t.id?"Hide Comments":"View Comments",children:[e.jsx(zt,{size:16}),e.jsxs("span",{className:"ml-1 text-xs",children:["(",t.comment_count??0,")"]})]}),(f==="admin"||f==="super_admin")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),Ee(t)},className:"p-1 text-blue-600 hover:text-blue-800 rounded-md",title:"Edit",children:e.jsx(Wt,{size:16})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),ot(t)},className:"p-1 text-red-600 hover:text-red-800 rounded-md",title:"Delete",children:e.jsx(We,{size:16})})]})]})}}],Te=s.useCallback(()=>{$(1,!0)},[$]),pt=async(t,i)=>{var v,de;if(!g){u("Log in to manage favorites.");return}const a=ae.get(t.id),d=!!(a!=null&&a.favoriteId),o=new Map(ae);d?o.set(t.id,{favoriteId:void 0}):o.set(t.id,{favoriteId:-1}),ie(o);try{const X=t.user_provided_title||t.original_filename;if(d&&typeof(a==null?void 0:a.favoriteId)=="number")await Et(t.id,i),L(`"${X}" removed from favorites.`),ie(ce=>{const q=new Map(ce);return q.set(t.id,{favoriteId:void 0}),q});else{const ce=await Ot(t.id,i);ie(q=>{const qe=new Map(q);return qe.set(t.id,{favoriteId:ce.id}),qe}),L(`"${X}" added to favorites.`)}}catch(X){u(((de=(v=X==null?void 0:X.response)==null?void 0:v.data)==null?void 0:de.msg)||X.message||"Failed to update favorite."),ie(ce=>{const q=new Map(ce);return d?q.set(t.id,{favoriteId:a==null?void 0:a.favoriteId}):q.set(t.id,{favoriteId:void 0}),q})}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-start sm:items-center mb-6 flex-col sm:flex-row",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Miscellaneous Files"}),e.jsx("p",{className:"text-gray-600 mt-1 dark:text-gray-300",children:"Manage and browse categorized files."})]}),g&&(f==="admin"||f==="super_admin")&&e.jsxs("div",{className:"flex space-x-3 mt-4 sm:mt-0",children:[e.jsxs("button",{onClick:re&&!l?Ve:lt,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(Ge,{size:18,className:"mr-2"}),re&&!l?"Cancel":"Add/Edit Category"]}),e.jsxs("button",{onClick:ee&&!te?Oe:()=>Ee(),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(Ge,{size:18,className:"mr-2"}),ee&&!te?"Cancel":"Upload New File"]})]})]}),re&&e.jsx("div",{className:"my-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg shadow",children:e.jsx(ts,{categoryToEdit:l,onSuccess:t=>it(`Category "${t.name}" saved.`),onCancel:Ve})}),ee&&e.jsx("div",{className:"my-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg shadow",children:e.jsx(Zt,{fileToEdit:te,onUploadSuccess:t=>Le(),onFileUpdated:t=>Le(),onCancelEdit:Oe})}),M.size>0&&e.jsx("div",{className:"my-4 p-3 bg-gray-100 dark:bg-gray-700 rounded-md shadow-sm border border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:[M.size," item(s) selected"]}),(f==="admin"||f==="super_admin")&&e.jsxs("button",{onClick:ut,disabled:Ie,className:"px-3 py-1.5 text-xs font-medium rounded-md shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 text-white bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 focus:ring-red-500 disabled:opacity-50",children:[e.jsx(We,{size:14,className:"mr-1.5"}),"Delete"]}),g&&e.jsxs("button",{onClick:ft,disabled:et,className:"px-3 py-1.5 text-xs font-medium rounded-md shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 text-white bg-green-500 hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700 focus:ring-green-500 disabled:opacity-50",children:[e.jsx(ke,{size:14,className:"mr-1.5"}),"Download"]}),(f==="admin"||f==="super_admin")&&e.jsxs("button",{onClick:xt,disabled:oe,className:"px-3 py-1.5 text-xs font-medium rounded-md shadow-sm flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 text-white bg-blue-500 hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700 focus:ring-blue-500 disabled:opacity-50",children:[e.jsx(Tt,{size:14,className:"mr-1.5"}),"Move"]})]})}),e.jsxs("div",{className:"my-4",children:[e.jsxs("button",{onClick:()=>Ze(t=>!t),className:"flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-md text-sm font-medium mb-2",children:[De?e.jsx(Gt,{size:18,className:"mr-2"}):e.jsx(qt,{size:18,className:"mr-2"})," Category Filter"]}),De&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"category-filter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sr-only",children:"Filter by Category"}),e.jsxs("select",{id:"category-filter",value:j??"",onChange:st,className:"block w-full sm:w-1/3 pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200",disabled:E||n.length===0,children:[e.jsx("option",{value:"",children:"All Categories"}),n.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),V?e.jsx("div",{className:"py-10",children:e.jsx(Dt,{message:"Loading files..."})}):y&&h.length===0&&!V?e.jsx(Kt,{message:y,onRetry:Te}):!V&&!y&&h.length===0?e.jsxs("div",{className:"text-center py-10 bg-white dark:bg-gray-800 rounded-lg shadow-sm my-6",children:[e.jsx(Yt,{size:48,className:"mx-auto text-yellow-500 dark:text-yellow-400 mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-700 dark:text-gray-200 mb-3",children:pe?"No Files Found Matching Criteria":"No Files Available"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 px-4",children:pe?"Try adjusting or clearing your search/filter settings.":f==="admin"||f==="super_admin"?"Upload new files to get started.":"Please check back later."}),pe&&e.jsx("button",{onClick:tt,className:"mt-6 btn-primary text-sm",children:"Clear All Filters & Search"})]}):e.jsx(Ht,{columns:bt,data:h,rowClassName:"group",isLoading:V||_e,currentPage:R,totalPages:W,onPageChange:rt,itemsPerPage:x,totalItems:Y,sortColumn:_,sortOrder:G,onSort:at,isSelectionEnabled:!0,selectedItemIds:M,onSelectItem:ct,onSelectAllItems:mt}),F&&U&&e.jsx(we,{isOpen:F,title:"Delete Category",message:`Delete category "${U.name}"? Files in it won't be deleted but will become uncategorized.`,onConfirm:nt,onCancel:Re,isConfirming:Je,confirmButtonText:"Delete",confirmButtonVariant:"danger"}),Ne&&T&&e.jsx(we,{isOpen:Ne,title:"Delete File",message:`Delete "${T.user_provided_title||T.original_filename}"?`,onConfirm:dt,onCancel:ve,isConfirming:_e,confirmButtonText:"Delete",confirmButtonVariant:"danger"}),Be&&e.jsx(we,{isOpen:Be,title:`Delete ${M.size} File(s)`,message:`Delete ${M.size} selected items?`,onConfirm:gt,onCancel:()=>be(!1),isConfirming:Ie,confirmButtonText:"Delete Selected",confirmButtonVariant:"danger"}),Ue&&e.jsx(Xt,{isOpen:Ue,onClose:()=>ue(!1),title:`Move ${M.size} File(s)`,children:e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:"Select target category:"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"modalCategoryMove",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Target Category*"}),e.jsxs("select",{id:"modalCategoryMove",value:ge??"",onChange:t=>ye(t.target.value?parseInt(t.target.value):null),className:"input-class w-full dark:bg-gray-700 dark:text-white dark:border-gray-600",disabled:oe||n.length===0,children:[e.jsx("option",{value:"",children:"Select Category..."}),n.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),n.length===0&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Categories unavailable."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>ue(!1),className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",disabled:oe,children:"Cancel"}),e.jsx("button",{type:"button",onClick:ht,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:oe||!ge,children:oe?"Moving...":"Confirm Move"})]})]})}),g&&p&&e.jsxs("div",{ref:fe,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-4",children:["Comments for: ",e.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:p.user_provided_title||p.original_filename})]}),e.jsx(Qt,{itemId:p.id,itemType:"misc_file",onCommentAction:Te})]}),!g&&p&&e.jsx("div",{ref:fe,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Please log in to view and manage comments."})})]})};export{cs as default};
