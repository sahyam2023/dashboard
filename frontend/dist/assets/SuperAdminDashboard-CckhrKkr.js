import{r,j as e,aq as qs,s as ls,ar as Ds,b as Ms,u as Us,as as Ts,aj as Is,C as He,at as $s,l as Bs,au as Ls,av as Qs,aw as Gs,ax as Os,ay as Vs,az as Ys,aA as zs,aB as Hs,aC as Ws,aD as Zs,aE as Js,aF as Xs,aG as Ks,aH as et,aI as st}from"./index-D4LpaxLs.js";import{D as tt}from"./DataTable-BSJeBYq_.js";import{M as Te}from"./Modal-C5NFPohJ.js";const We=i=>i.length<8?{strong:!1,message:"Password must be at least 8 characters long."}:/[A-Z]/.test(i)?/[a-z]/.test(i)?/[0-9]/.test(i)?/[!@#$%^&*(),.?":{}|<>]/.test(i)?{strong:!0,message:"Password is strong."}:{strong:!1,message:"Password must include at least one special character."}:{strong:!1,message:"Password must include at least one digit."}:{strong:!1,message:"Password must include at least one lowercase letter."}:{strong:!1,message:"Password must include at least one uppercase letter."},rt=({expanded:i})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 transform transition-transform duration-200 ${i?"rotate-180":"rotate-0"}`,viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})}),at=({onUserCreated:i,onCancel:h})=>{const[Q,ce]=r.useState(""),[P,ue]=r.useState(""),[q,D]=r.useState(""),[_,ee]=r.useState(""),[me,we]=r.useState("user"),[p,Ie]=r.useState([]),[ke,je]=r.useState(!1),[C,se]=r.useState(""),[M,ve]=r.useState(""),[A,U]=r.useState(""),[G,u]=r.useState(""),[R,F]=r.useState(""),[O,ge]=r.useState(""),[T,be]=r.useState(!1),[te,re]=r.useState(null),[m,y]=r.useState({}),[V,Y]=r.useState(""),[z,ae]=r.useState(""),[H,Ne]=r.useState(!0);r.useEffect(()=>{q?P===q?(y(n=>({...n,confirmPassword:""})),ae("Passwords match.")):(y(n=>({...n,confirmPassword:"Passwords do not match."})),ae("")):(y(n=>({...n,confirmPassword:""})),ae(""))},[P,q]),r.useEffect(()=>{(async()=>{je(!0);try{const c=await qs();Ie(c),c.length>0&&(c.length>=1&&se(c[0].id.toString()),c.length>=2&&U(c[1].id.toString()),c.length>=3&&F(c[2].id.toString()))}catch{re("Failed to load security questions."),ls("Failed to load security questions. Please try again.")}finally{je(!1)}})()},[]);const Se=n=>{const c=n.target.value;ue(c);const w=We(c);Y(w.message)},Pe=()=>{const n={};Q.trim()||(n.username="Username is required.");const c=We(P);c.strong||(n.password=c.message),P!==q&&(n.confirmPassword="Passwords do not match."),_.trim()&&!/\S+@\S+\.\S+/.test(_)&&(n.email="Email is invalid."),me||(n.role="Role is required.");const w=C,g=A,E=R;return!w||!g||!E?n.securityQuestions="All three security questions must be selected.":(w===g||w===E||g===E)&&(n.securityQuestions="Security questions must be unique."),M.trim()||(n.answer1="Answer for question 1 is required."),G.trim()||(n.answer2="Answer for question 2 is required."),O.trim()||(n.answer3="Answer for question 3 is required."),y(n),Object.keys(n).length===0},Ce=async n=>{var w,g;if(n.preventDefault(),re(null),!Pe())return;be(!0);const c={username:Q,password:P,email:_.trim()||void 0,role:me,security_answers:[{question_id:parseInt(C,10),answer:M},{question_id:parseInt(A,10),answer:G},{question_id:parseInt(R,10),answer:O}]};try{await Ds(c),Ms(`User "${Q}" created successfully!`),i(),ce(""),ue(""),D(""),ee(""),we("user"),p.length>=1&&se(p[0].id.toString()),p.length>=2&&U(p[1].id.toString()),p.length>=3?F(p[2].id.toString()):p.length===2?F(""):p.length===1?(U(""),F("")):(se(""),U(""),F("")),ve(""),u(""),ge(""),y({}),Y("")}catch(E){const W=((g=(w=E.response)==null?void 0:w.data)==null?void 0:g.msg)||E.message||"Failed to create user.";re(W),ls(W)}finally{be(!1)}},ne=n=>{const c=[C,A,R].filter(Boolean);return p.filter(w=>{const g=w.id.toString();return n==="q1"?g===C||!c.includes(g)||g==="":n==="q2"?g===A||!c.includes(g)||g==="":n==="q3"?g===R||!c.includes(g)||g==="":!c.includes(g)})};return ke?e.jsx("div",{className:"text-center p-4",children:"Loading security questions..."}):e.jsxs("form",{onSubmit:Ce,className:"space-y-4 p-2 sm:p-4 bg-white dark:bg-gray-800 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:"Create New User"}),te&&e.jsx("div",{className:"p-3 mb-4 text-sm text-red-700 bg-red-100 rounded-lg dark:bg-red-200 dark:text-red-800",role:"alert",children:te}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Username"}),e.jsx("input",{type:"text",id:"username",value:Q,onChange:n=>ce(n.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0}),m.username&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:m.username})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Password"}),e.jsx("input",{type:"password",id:"password",value:P,onChange:Se,className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0}),V&&e.jsx("p",{className:`mt-1 text-xs ${We(P).strong?"text-green-500":"text-red-500"}`,children:V}),m.password&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:m.password})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Confirm Password"}),e.jsx("input",{type:"password",id:"confirmPassword",value:q,onChange:n=>D(n.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0}),m.confirmPassword&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:m.confirmPassword}),z&&!m.confirmPassword&&e.jsx("p",{className:"mt-1 text-xs text-green-500",children:z})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Email (Optional)"}),e.jsx("input",{type:"email",id:"email",value:_,onChange:n=>ee(n.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white"}),m.email&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:m.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Role"}),e.jsxs("select",{id:"role",value:me,onChange:n=>we(n.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"super_admin",children:"Super Admin"})]}),m.role&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:m.role})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{type:"button",onClick:()=>Ne(n=>!n),className:"flex justify-between items-center w-full py-2 text-left text-md font-medium text-gray-900 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-md px-2 focus:outline-none focus-visible:ring focus-visible:ring-blue-500 focus-visible:ring-opacity-75","aria-expanded":H,"aria-controls":"security-questions-content",children:[e.jsx("span",{children:"Security Questions"}),e.jsx(rt,{expanded:H})]}),m.securityQuestions&&!H&&e.jsxs("p",{className:"text-xs text-red-500 mt-1 px-2",children:[" ",m.securityQuestions]}),H&&e.jsxs("div",{id:"security-questions-content",className:"space-y-4 pt-2 pl-2 pr-2 pb-2 border-t border-gray-200 dark:border-gray-700 mt-2",children:[" ",e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"question1",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Question 1"}),e.jsxs("select",{id:"question1",value:C,onChange:n=>se(n.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md dark:bg-gray-700 dark:text-white",disabled:p.length===0,children:[e.jsx("option",{value:"",children:"Select a question"}),ne("q1").map(n=>e.jsx("option",{value:n.id.toString(),children:n.question_text},`q1-${n.id}`))]}),e.jsx("input",{type:"text",id:"answer1",value:M,onChange:n=>ve(n.target.value),placeholder:"Answer for question 1",className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0}),m.answer1&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:m.answer1})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"question2",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Question 2"}),e.jsxs("select",{id:"question2",value:A,onChange:n=>U(n.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md dark:bg-gray-700 dark:text-white",disabled:p.length===0,children:[e.jsx("option",{value:"",children:"Select a question"}),ne("q2").map(n=>e.jsx("option",{value:n.id.toString(),children:n.question_text},`q2-${n.id}`))]}),e.jsx("input",{type:"text",id:"answer2",value:G,onChange:n=>u(n.target.value),placeholder:"Answer for question 2",className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0}),m.answer2&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:m.answer2})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"question3",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Question 3"}),e.jsxs("select",{id:"question3",value:R,onChange:n=>F(n.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md dark:bg-gray-700 dark:text-white",disabled:p.length===0,children:[e.jsx("option",{value:"",children:"Select a question"}),ne("q3").map(n=>e.jsx("option",{value:n.id.toString(),children:n.question_text},`q3-${n.id}`))]}),e.jsx("input",{type:"text",id:"answer3",value:O,onChange:n=>ge(n.target.value),placeholder:"Answer for question 3",className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white",required:!0}),m.answer3&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:m.answer3})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-end sm:space-x-3 pt-4 space-y-2 sm:space-y-0",children:[e.jsx("button",{type:"button",onClick:h,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white dark:bg-gray-600 dark:text-gray-200 border border-gray-300 dark:border-gray-500 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:T||ke,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 border border-transparent rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:T?"Creating...":"Create User"})]})]})},it=()=>{var rs,as,ns,os;const i=Us(),[h,Q]=r.useState([]),[ce,P]=r.useState(!0),[ue,q]=r.useState(null),[D,_]=r.useState(1),[ee,me]=r.useState(10),[we,p]=r.useState(0),[Ie,ke]=r.useState(0),[je,C]=r.useState(!1),se=()=>{C(!1),K(),u({type:"success",message:"New user created successfully!"})},[M,ve]=r.useState("username"),[A,U]=r.useState("asc"),[G,u]=r.useState(null),[R,F]=r.useState(null),[O,ge]=r.useState("user"),[T,be]=r.useState(""),[te,re]=r.useState(""),[m,y]=r.useState(null),[V,Y]=r.useState(null),[z,ae]=r.useState(!1),[H,Ne]=r.useState(!1),[Se,Pe]=r.useState(null),[Ce,ne]=r.useState(null),[n,c]=r.useState(!1),[w,g]=r.useState(null),[E,W]=r.useState(null),[$e,Be]=r.useState(null),[is,cs]=r.useState(Date.now()),[I,Ze]=r.useState(!1),[Fe,_e]=r.useState(!0),[Ae,Re]=r.useState(null),[v,j]=r.useState(0),[Z,oe]=r.useState(""),[xe,Le]=r.useState(""),[fe,Qe]=r.useState(""),[N,Ee]=r.useState(!1),[S,f]=r.useState(null),[Ge,k]=r.useState(null),[us,Je]=r.useState(null),[qe,Xe]=r.useState(""),[Oe,Ve]=r.useState(!1),[De,he]=r.useState(null),[$,Ke]=r.useState(null),[nt,Me]=r.useState([]),[J,Ye]=r.useState([]),[es,pe]=r.useState([]),[de,ye]=r.useState(!1),[le,X]=r.useState(null),[Ue,B]=r.useState(null),[ze,ss]=r.useState(""),ts=(s,t,a,d)=>{pe(o=>{let l;const b=o.findIndex(x=>x.file_id===s&&x.file_type===t);if(b>-1)return o.map((L,ie)=>ie===b?(l={...L,[a]:d},l):L);{const x=J.find(L=>L.id===s&&L.type===t);if(x)return l={file_id:x.id,file_type:x.type,can_view:!0,can_download:!0},l[a]=d,[...o,l]}return o}),Ue&&B(null),le&&X(null)},ms=async()=>{var t,a;if(!$){B({type:"error",message:"No user selected."});return}ye(!0),X(null),B(null);const s=es.map(d=>({...d,can_view:typeof d.can_view=="boolean"?d.can_view:!1,can_download:typeof d.can_download=="boolean"?d.can_download:!1}));try{const d=await Hs($.id,s);B({type:"success",message:d.msg||"Permissions updated successfully!"});const o=d.permissions||[];Me(o);const l=J.map(b=>{const x=o.find(ie=>ie.file_id===b.id&&ie.file_type===b.type);return{file_id:b.id,file_type:b.type,can_view:x?!!x.can_view:!0,can_download:x?!!x.can_download:!0}});pe(l)}catch(d){console.error("Error saving permissions:",d);const o=((a=(t=d.response)==null?void 0:t.data)==null?void 0:a.msg)||d.message||"Failed to save permissions.";X(o),B({type:"error",message:o})}finally{ye(!1)}},gs=()=>{Ke(null),Me([]),Ye([]),pe([]),X(null),B(null),ss("")},K=r.useCallback(async()=>{var s;if(i.isAuthenticated&&((s=i.user)==null?void 0:s.role)==="super_admin"){P(!0),q(null);try{const t=await Ts(D,ee,M,A);Q(t.users),p(t.total_pages),ke(t.total_users),_(t.page),me(t.per_page)}catch(t){Q([]),q(t.message||"Failed to fetch users."),u({type:"error",message:t.message||"Failed to fetch users."})}finally{P(!1)}}},[i.isAuthenticated,(rs=i.user)==null?void 0:rs.role,D,ee,M,A]);if(r.useEffect(()=>{K()},[K]),r.useEffect(()=>{if(h&&h.length>0){let s=1/0,t=null;for(const a of h)a.role==="super_admin"&&a.id<s&&(s=a.id,t=a.id);Je(t)}else Je(null)},[h]),r.useEffect(()=>{(async()=>{var t,a,d;if(i.isAuthenticated&&((t=i.user)==null?void 0:t.role)==="super_admin"){_e(!0),Re(null);try{const o=await $s();Ze(o.maintenance_mode_enabled)}catch(o){console.error("Failed to fetch maintenance mode status:",o);const l=((d=(a=o.response)==null?void 0:a.data)==null?void 0:d.msg)||o.message||"Failed to fetch maintenance status.";Re(l)}finally{_e(!1)}}})()},[i.isAuthenticated,(as=i.user)==null?void 0:as.role]),r.useEffect(()=>{$&&(async()=>{var t;if(!i.isAuthenticated||((t=i.user)==null?void 0:t.role)!=="super_admin"){X("User not authorized for this action."),ye(!1);return}ye(!0),X(null),B(null),Me([]),Ye([]),pe([]);try{const d=(await Bs(void 0,1,100)).documents.map(b=>({id:b.id,name:b.doc_name,type:"document"}));Ye(d);const o=await Ls($.id);Me(o);const l=d.map(b=>{const x=o.find(ds=>ds.file_id===b.id&&ds.file_type===b.type),L=x?!!x.can_view:!0,ie=x?!!x.can_download:!0;return{file_id:b.id,file_type:b.type,can_view:L,can_download:ie}});pe(l)}catch(a){console.error("Error fetching data for permissions:",a);const d=a.message||"Failed to fetch data for permissions.";X(d),B({type:"error",message:d})}finally{ye(!1)}})()},[$,i.isAuthenticated,(ns=i.user)==null?void 0:ns.role]),!i.isAuthenticated)return e.jsx(Is,{to:"/login",replace:!0});if(((os=i.user)==null?void 0:os.role)!=="super_admin")return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600",children:"Unauthorized"}),e.jsx("p",{children:"You do not have permission to view this page."})]});const bs=s=>{_(s)},xs=s=>{M===s?U(t=>t==="asc"?"desc":"asc"):(ve(s),U("asc")),_(1)},fs=s=>{F(s.id),ge(s.role),u(null)},hs=async s=>{if(!(!R||s!==R)){u(null);try{const a=await Js(s,{new_role:O});u({type:"success",message:`User ${a.username}'s role updated to ${a.role}.`}),K()}catch(t){u({type:"error",message:t.message||"Failed to update role."})}finally{F(null)}}},ps=s=>s.length<8?"Password must be at least 8 characters long.":/[A-Z]/.test(s)?/[a-z]/.test(s)?/[0-9]/.test(s)?"":"Password must include at least one digit.":"Password must include at least one lowercase letter.":"Password must include at least one uppercase letter.",ys=async s=>{var a,d;if(s.preventDefault(),y(null),Y(null),!T||!te){y("Both password fields are required.");return}if(T!==te){y("New passwords do not match.");return}const t=ps(T);if(t){y(t);return}ae(!0);try{const l=await Qs({new_password:T});Y(l.msg||"Global password updated successfully!"),be(""),re("")}catch(o){y(((d=(a=o.response)==null?void 0:a.data)==null?void 0:d.msg)||o.message||"Failed to change global password.")}finally{ae(!1)}},ws=async(s,t)=>{if(window.confirm(`Are you sure you want to deactivate user ${t}?`)){u(null);try{await Xs(s),u({type:"success",message:`User ${t} deactivated.`}),K()}catch(a){u({type:"error",message:a.message||`Failed to deactivate ${t}.`})}}},ks=async()=>{var d,o;_e(!0),Re(null),u(null);const s=I?Ys:zs,t=I?"Maintenance mode disabled.":"Maintenance mode enabled.",a=I?"Failed to disable maintenance mode.":"Failed to enable maintenance mode.";try{const l=await s();Ze(l.maintenance_mode_enabled),u({type:"success",message:t})}catch(l){const b=((o=(d=l.response)==null?void 0:d.data)==null?void 0:o.msg)||l.message||a;Re(b),u({type:"error",message:b})}finally{_e(!1)}},js=async(s,t)=>{if(window.confirm(`Are you sure you want to activate user ${t}?`)){u(null);try{await Ks(s),u({type:"success",message:`User ${t} activated.`}),K()}catch(a){u({type:"error",message:a.message||`Failed to activate ${t}.`})}}},vs=async(s,t)=>{if(window.confirm(`Are you sure you want to PERMANENTLY DELETE user ${t}? This action cannot be undone.`)){u(null);try{await et(s),u({type:"success",message:`User ${t} deleted.`}),h.length===1&&D>1?_(D-1):K()}catch(a){u({type:"error",message:a.message||`Failed to delete ${t}.`})}}},Ns=async(s,t)=>{if(window.confirm(`Are you sure you want to require user ${t} to reset their password on next login?`)){u(null);try{await st(s),u({type:"success",message:`User ${t} will be required to reset their password on next login.`})}catch(a){u({type:"error",message:a.message||`Failed to force password reset for ${t}.`})}}},Ss=async()=>{var s,t;Ne(!0),Pe(null),ne(null);try{const a=await Gs();Pe(a.message+(a.backup_path?` Path: ${a.backup_path}`:""))}catch(a){ne(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.msg)||a.message||"Failed to create backup.")}finally{Ne(!1)}},Ps=s=>{s.target.files&&s.target.files[0]?(Be(s.target.files[0]),W(null),g(null)):Be(null)},Cs=async()=>{var t,a;if(!$e){W("Please select a .db backup file to restore.");return}if(window.confirm("Are you sure you want to restore the database? This will overwrite the current data and cannot be undone. It is highly recommended to take a fresh backup before restoring.")){c(!0),g(null),W(null);const d=new FormData;d.append("backup_file",$e);try{const o=await Vs(d);g(o.message),Be(null),cs(Date.now())}catch(o){W(((a=(t=o.response)==null?void 0:t.data)==null?void 0:a.msg)||o.message||"Failed to restore database.")}finally{c(!1)}}},Fs=async s=>{var t,a;if(s.preventDefault(),Z.trim()===""){f("Reason cannot be empty.");return}Ee(!0),f(null),k(null);try{const d=await Ws(Z);k({type:"success",message:d.message||"Database reset process initiated. Backup created."}),j(5),oe(""),f(null)}catch(d){const o=((a=(t=d.response)==null?void 0:t.data)==null?void 0:a.msg)||d.message||"Failed to start database reset process.";f(o),k({type:"error",message:o})}finally{Ee(!1)}},_s=async s=>{var t,a;if(s.preventDefault(),xe.trim()===""||fe.trim()===""){f("Password and confirmation text are required.");return}Ee(!0),f(null),k(null);try{const o=await Zs({reset_password:xe,confirmation_text:fe});k({type:"success",message:o.message||"Database has been successfully reset."}),j(0),oe(""),Le(""),Qe(""),f(null)}catch(d){const o=((a=(t=d.response)==null?void 0:t.data)==null?void 0:a.msg)||d.message||"Failed to confirm database reset.";f(o),k({type:"error",message:o})}finally{Ee(!1)}},As=s=>{Qe(s.target.value),S&&f(null)},Rs=async s=>{var t,a;if(s.preventDefault(),Ve(!0),he(null),!qe.trim()){he({type:"error",message:"Announcement message cannot be empty."}),Ve(!1);return}try{const d=await Os(qe.trim());he({type:"success",message:d.msg||"Announcement sent successfully!"}),Xe("")}catch(d){const o=((a=(t=d.response)==null?void 0:t.data)==null?void 0:a.msg)||d.message||"Failed to send announcement.";he({type:"error",message:o})}finally{Ve(!1)}},Es=[{key:"username",header:"Username",sortable:!0},{key:"email",header:"Email",sortable:!0,render:s=>s.email||"N/A"},{key:"role",header:"Role",sortable:!0,render:s=>{var t,a,d;return R===s.id?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:O,onChange:o=>ge(o.target.value),className:"block w-auto pl-3 pr-10 py-1.5 text-sm border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200",disabled:((t=i.user)==null?void 0:t.username)===s.username&&h.filter(o=>o.role==="super_admin").length<=1&&O!=="super_admin",onClick:o=>o.stopPropagation(),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"super_admin",children:"Super Admin"})]}),e.jsx("button",{onClick:o=>{o.stopPropagation(),hs(s.id)},className:"px-3 py-1 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Save"}),e.jsx("button",{onClick:o=>{o.stopPropagation(),F(null)},className:"px-3 py-1 border border-gray-300 dark:border-gray-500 text-xs font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 shadow-sm",children:"Cancel"})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:s.role}),((a=i.user)==null?void 0:a.username)!==s.username&&e.jsx("button",{onClick:o=>{o.stopPropagation(),fs(s)},className:"text-blue-600 hover:text-blue-700 text-xs font-medium",children:"Edit"}),((d=i.user)==null?void 0:d.username)===s.username&&s.role==="super_admin"&&h.filter(o=>o.role==="super_admin").length<=1&&e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500 italic",children:"(Cannot change role - only Super Admin)"})]})}},{key:"is_active",header:"Status",sortable:!0,render:s=>e.jsx("span",{className:`px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full ${s.is_active?"bg-green-100 text-green-800 dark:bg-green-700 dark:text-green-100":"bg-red-100 text-red-800 dark:bg-red-700 dark:text-red-100"}`,children:s.is_active?"Active":"Inactive"})},{key:"created_at",header:"Created At",sortable:!0,render:s=>s.created_at?new Date(s.created_at).toLocaleDateString():"N/A"},{key:"actions",header:"Actions",render:s=>{var o;const t=((o=i.user)==null?void 0:o.id)===s.id,a=s.id===us,d=s.role==="super_admin"&&s.is_active&&h.filter(l=>l.role==="super_admin"&&l.is_active).length<=1;return e.jsxs("div",{className:"flex items-center space-x-3 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[s.is_active?e.jsx("button",{onClick:l=>{l.stopPropagation(),ws(s.id,s.username)},className:"text-yellow-600 hover:text-yellow-700 disabled:text-gray-400 dark:disabled:text-gray-500 text-xs font-medium",disabled:t&&d||a,title:a?"The primary super admin account cannot be deactivated.":t&&d?"Cannot deactivate your own account as the only active super admin.":d?"Cannot deactivate the only active super admin.":"Deactivate user",children:"Deactivate"}):e.jsx("button",{onClick:l=>{l.stopPropagation(),js(s.id,s.username)},className:"text-green-600 hover:text-green-700 text-xs font-medium",title:"Activate user",children:"Activate"}),e.jsx("button",{onClick:l=>{l.stopPropagation(),vs(s.id,s.username)},className:"text-red-600 hover:text-red-700 disabled:text-gray-400 dark:disabled:text-gray-500 text-xs font-medium",disabled:t||a,title:a?"The primary super admin account cannot be deleted.":t?"You cannot delete your own account.":"Delete user",children:"Delete"}),s.role!=="super_admin"&&!t&&e.jsx("button",{onClick:l=>{l.stopPropagation(),Ns(s.id,s.username)},className:"text-purple-600 hover:text-purple-700 text-xs font-medium",title:"Force password reset for user",children:"Force Reset"}),e.jsx("button",{onClick:l=>{l.stopPropagation(),Ke(s)},className:"text-teal-600 hover:text-teal-700 disabled:text-gray-400 dark:disabled:text-gray-500 disabled:cursor-not-allowed text-xs font-medium",disabled:a,title:a?"Permissions for the primary super admin cannot be modified here.":"Manage file permissions",children:"Permissions"})]})}}];return e.jsxs("div",{className:"container mx-auto p-4 md:p-6 lg:p-8 space-y-10 md:space-y-12",children:[e.jsxs("section",{className:"bg-white dark:bg-gray-800 shadow-xl rounded-xl p-6 md:p-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 dark:text-gray-100",children:"User Management"}),e.jsx("button",{onClick:()=>C(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition ease-in-out duration-150",children:"Create User"})]}),G&&e.jsx("div",{className:`p-4 mb-6 rounded-lg text-sm ${G.type==="success"?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-200 border border-green-200 dark:border-green-700":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-200 border border-red-200 dark:border-red-700"}`,children:G.message}),ue&&h.length===0&&!ce&&e.jsxs("div",{className:"text-red-500 bg-red-100 dark:bg-red-900 dark:text-red-200 p-4 rounded-lg mb-6 text-sm",children:["Error: ",ue]}),e.jsx(tt,{columns:Es,data:h,rowClassName:"group hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",isLoading:ce,currentPage:D,totalPages:we,onPageChange:bs,itemsPerPage:ee,totalItems:Ie,sortColumn:M,sortOrder:A,onSort:xs})]}),e.jsxs("section",{className:"bg-white dark:bg-gray-800 shadow-xl rounded-xl p-6 md:p-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 text-gray-800 dark:text-gray-100",children:"Global Site Password"}),m&&e.jsx("div",{className:"p-3 mb-4 rounded-md bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 border border-red-200 dark:border-red-700 text-sm",children:m}),V&&e.jsx("div",{className:"p-3 mb-4 rounded-md bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 border border-green-200 dark:border-green-700 text-sm",children:V}),e.jsxs("form",{onSubmit:ys,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newGlobalPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"New Global Password"}),e.jsx("input",{id:"newGlobalPassword",type:"password",value:T,onChange:s=>{be(s.target.value),m&&y(null),V&&Y(null)},className:"block w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500",required:!0,disabled:z})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmNewGlobalPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Confirm New Global Password"}),e.jsx("input",{id:"confirmNewGlobalPassword",type:"password",value:te,onChange:s=>{re(s.target.value),m&&y(null),V&&Y(null)},className:"block w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500",required:!0,disabled:z})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"submit",disabled:z,className:"w-full flex justify-center py-2.5 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-60 transition-colors",children:z?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"}):"Change Global Password"})})]})]}),e.jsxs("section",{className:"bg-white dark:bg-gray-800 shadow-xl rounded-xl p-6 md:p-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 text-gray-800 dark:text-gray-100",children:"Database Backup"}),Ce&&e.jsx("div",{className:"p-3 mb-4 rounded-md bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 border border-red-200 dark:border-red-700 text-sm",children:Ce}),Se&&e.jsx("div",{className:"p-3 mb-4 rounded-md bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 border border-green-200 dark:border-green-700 text-sm",children:Se}),e.jsx("button",{onClick:Ss,disabled:H,className:"w-full flex justify-center py-2.5 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-60 transition-colors",children:H?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"}):"Create Backup"})]}),e.jsxs("section",{className:"bg-white dark:bg-gray-800 shadow-xl rounded-xl p-6 md:p-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 text-gray-800 dark:text-gray-100",children:"Send Announcement"}),De&&e.jsx("div",{className:`p-3 mb-4 rounded-md text-sm ${De.type==="success"?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 border border-green-200 dark:border-green-700":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 border border-red-200 dark:border-red-700"}`,children:De.message}),e.jsxs("form",{onSubmit:Rs,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"announcementMessage",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Announcement Message"}),e.jsx("textarea",{id:"announcementMessage",rows:4,value:qe,onChange:s=>{Xe(s.target.value),De&&he(null)},className:"block w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500",required:!0,disabled:Oe})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"submit",disabled:Oe||!qe.trim(),className:"w-full flex justify-center py-2.5 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-60 transition-colors",children:Oe?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"}):"Send Announcement"})})]})]}),e.jsxs("section",{className:"bg-white dark:bg-gray-800 shadow-xl rounded-xl p-6 md:p-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 text-gray-800 dark:text-gray-100",children:"Database Restore"}),E&&e.jsx("div",{className:"p-3 mb-4 rounded-md bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 border border-red-200 dark:border-red-700 text-sm",children:E}),w&&e.jsx("div",{className:"p-3 mb-4 rounded-md bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 border border-green-200 dark:border-green-700 text-sm",children:w}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"restoreFile",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Select .db Backup File"}),e.jsx("input",{id:"restoreFile",type:"file",accept:".db",onChange:Ps,className:"block w-full text-sm text-gray-700 dark:text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 dark:file:bg-gray-600 file:text-blue-700 dark:file:text-gray-200 hover:file:bg-blue-100 dark:hover:file:bg-gray-500 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white dark:bg-gray-700",disabled:n},is)]}),e.jsx("button",{onClick:Cs,disabled:n||!$e,className:"w-full flex justify-center py-2.5 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 transition-colors",children:n?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"}):"Restore from Backup"})]})]}),e.jsxs("section",{className:"bg-white dark:bg-gray-800 shadow-xl rounded-xl p-6 md:p-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 text-gray-800 dark:text-gray-100",children:"Reset Database"}),Ge&&e.jsx("div",{className:`p-3 mb-4 rounded-md text-sm ${Ge.type==="success"?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 border border-green-200 dark:border-green-700":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 border border-red-200 dark:border-red-700"}`,children:Ge.message}),e.jsx("button",{onClick:()=>{k(null),f(null),j(1)},className:"w-full flex justify-center py-2.5 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-60 transition-colors",disabled:N||v!==0,children:N?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"}):"Reset Database"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-3",children:"This action will permanently delete all data in the database. This process involves multiple confirmation steps."})]}),e.jsxs("section",{className:"bg-white dark:bg-gray-800 shadow-xl rounded-xl p-6 md:p-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 text-gray-800 dark:text-gray-100",children:"System Maintenance Mode"}),Ae&&e.jsxs("div",{className:"p-3 mb-4 rounded-md bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 border border-red-200 dark:border-red-700 text-sm",children:["Error: ",Ae]}),Fe&&!h.length&&!Ae&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading maintenance status..."}),(!Fe||h.length>0||Ae)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-3",children:[e.jsx("label",{htmlFor:"maintenanceToggle",className:"flex items-center cursor-pointer",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",id:"maintenanceToggle",className:"sr-only",checked:I,onChange:ks,disabled:Fe}),e.jsx("div",{className:`block w-14 h-8 rounded-full transition-colors ${I?"bg-green-500":"bg-gray-300 dark:bg-gray-600"}`}),e.jsx("div",{className:`dot absolute left-1 top-1 bg-white dark:bg-gray-300 w-6 h-6 rounded-full shadow-md transition-transform duration-300 ease-in-out ${I?"transform translate-x-6":""}`})]})}),e.jsxs("span",{className:`text-sm font-medium ${I?"text-green-700 dark:text-green-300":"text-gray-700 dark:text-gray-300"}`,children:["Maintenance Mode is ",I?"ACTIVATED":"DEACTIVATED"]}),Fe&&e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-blue-500"})]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2",children:"When activated, only Super Administrators can log in. Other users will be denied access."})]})]}),e.jsx(Te,{isOpen:$!==null,onClose:gs,title:$?`File Permissions: ${$.username}`:"",children:e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search files...",value:ze,onChange:s=>ss(s.target.value),className:"block w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500"})}),de&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:"Loading permissions..."}),le&&e.jsx("div",{className:"p-3 mb-4 rounded-md bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 border border-red-200 dark:border-red-700 text-sm",children:le}),Ue&&e.jsx("div",{className:`p-3 mb-4 rounded-md text-sm ${Ue.type==="success"?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 border border-green-200 dark:border-green-700":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 border border-red-200 dark:border-red-700"}`,children:Ue.message}),!de&&!le&&J.length>0&&e.jsxs("form",{onSubmit:s=>{s.preventDefault(),ms()},className:"space-y-4",children:[e.jsx("div",{className:"max-h-96 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg p-1 bg-gray-50 dark:bg-gray-800/50",children:J.filter(s=>s.name.toLowerCase().includes(ze.toLowerCase())).map(s=>{const t=es.find(a=>a.file_id===s.id&&a.file_type===s.type);return e.jsxs("div",{className:"p-3 border-b border-gray-200 dark:border-gray-600 last:border-b-0 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors duration-150 bg-white dark:bg-gray-700 shadow-sm my-1",children:[e.jsxs("h4",{className:"font-medium text-gray-800 dark:text-gray-100 truncate",title:s.name,children:[s.name," ",e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",s.type.replace("_"," "),")"]})]}),e.jsxs("div",{className:"flex items-center space-x-6 mt-2.5",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",className:"rounded text-blue-600 focus:ring-blue-500 h-4 w-4 border-gray-300 dark:border-gray-500 bg-gray-100 dark:bg-gray-600 checked:bg-blue-600 dark:checked:bg-blue-500",checked:(t==null?void 0:t.can_view)??!0,onChange:a=>ts(s.id,s.type,"can_view",a.target.checked)}),e.jsx("span",{children:"View"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",className:"rounded text-blue-600 focus:ring-blue-500 h-4 w-4 border-gray-300 dark:border-gray-500 bg-gray-100 dark:bg-gray-600 checked:bg-blue-600 dark:checked:bg-blue-500",checked:(t==null?void 0:t.can_download)??!0,onChange:a=>ts(s.id,s.type,"can_download",a.target.checked)}),e.jsx("span",{children:"Download"})]})]})]},`${s.type}-${s.id}`)})}),e.jsx("div",{className:"flex justify-end pt-3",children:e.jsx("button",{type:"submit",disabled:de,className:"px-6 py-2.5 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-blue-500 disabled:opacity-50",children:de?"Saving...":"Save Permissions"})})]}),!de&&!le&&J.filter(s=>s.name.toLowerCase().includes(ze.toLowerCase())).length===0&&J.length>0&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:"No files match your search term."}),!de&&!le&&J.length===0&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:"No documents found to set permissions for. Ensure documents are uploaded."})]})}),e.jsx(Te,{isOpen:je,onClose:()=>C(!1),title:"Create New User",children:e.jsx(at,{onUserCreated:se,onCancel:()=>C(!1)})}),v===1&&e.jsx(He,{isOpen:v===1,title:"Confirm Database Reset - Step 1/3",message:e.jsx("span",{className:"text-red-700 dark:text-red-300 font-semibold",children:"This will delete EVERYTHING in the database. Are you sure you want to proceed?"}),onConfirm:()=>j(2),onCancel:()=>{j(0),k(null)},confirmButtonText:"Yes, I'm sure",cancelButtonText:"No, cancel",confirmButtonVariant:"danger"}),v===2&&e.jsx(He,{isOpen:v===2,title:"Confirm Database Reset - Step 2/3",message:e.jsx("span",{className:"text-red-700 dark:text-red-300 font-semibold",children:"This action is IRREVERSIBLE. Once the database is reset, the data cannot be recovered. Are you absolutely sure?"}),onConfirm:()=>j(3),onCancel:()=>{j(0),k(null)},confirmButtonText:"Yes, I understand the risk",cancelButtonText:"No, cancel",confirmButtonVariant:"danger"}),v===3&&e.jsx(He,{isOpen:v===3,title:"Confirm Database Reset - Step 3/3",message:e.jsx("span",{className:"text-yellow-600 dark:text-yellow-400 font-semibold",children:"FINAL WARNING: Proceeding will open a form for you to state your reason before the reset. This is your last chance to cancel."}),onConfirm:()=>{j(4),f(null)},onCancel:()=>{j(0),k(null)},confirmButtonText:"Yes, proceed to reason form",cancelButtonText:"No, cancel",confirmButtonVariant:"warning"}),v===4&&e.jsx(Te,{isOpen:v===4,onClose:()=>{j(0),oe(""),f(null),k(null)},title:"Reason for Database Reset",showCloseButton:!1,children:e.jsxs("form",{onSubmit:Fs,className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:"For security and auditing purposes, please provide a reason for resetting the database. This reason will be logged. Your action will be recorded along with this reason. This is a critical operation."}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"resetReason",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Reason for Reset ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"resetReason",value:Z,onChange:s=>{oe(s.target.value),S&&s.target.value.trim()!==""&&f(null)},rows:4,className:`block w-full px-3 py-2 border ${S&&Z.trim()===""?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:placeholder-gray-500`,required:!0,disabled:N,"aria-describedby":S&&Z.trim()===""?"resetReason-error":void 0}),S&&Z.trim()===""&&e.jsx("p",{id:"resetReason-error",className:"text-red-500 dark:text-red-400 text-xs mt-1",children:S})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-3 pt-3 border-t border-gray-200 dark:border-gray-700 mt-5",children:[e.jsx("button",{type:"button",onClick:()=>{j(0),oe(""),f(null),k({type:"error",message:"Database reset cancelled."})},disabled:N,className:"w-full sm:w-auto px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500 dark:border-gray-500",children:"Cancel Reset Process"}),e.jsx("button",{type:"submit",disabled:N||!Z.trim(),className:"w-full sm:w-auto px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:bg-red-300 dark:disabled:bg-red-400 transition-opacity",children:N?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Processing..."]}):"Submit and Reset Database"})]})]})}),v===5&&e.jsx(Te,{isOpen:v===5,onClose:()=>{},title:"Final Database Reset Confirmation",showCloseButton:!1,children:e.jsxs("form",{onSubmit:_s,className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"This is the final step. The database backup has been created. To proceed with the reset, please enter the confirmation password and text."}),S&&e.jsx("div",{className:"p-3 rounded-md bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 border border-red-200 dark:border-red-700 text-sm",children:S}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"resetProcessPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Confirmation Password"}),e.jsx("input",{id:"resetProcessPassword",type:"password",value:xe,onChange:s=>{Le(s.target.value),S&&f(null)},className:`block w-full px-3 py-2 border ${!xe.trim()&&S?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:placeholder-gray-500`,required:!0,disabled:N})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"resetProcessConfirmText",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:'Type "CONFIRM DELETE"'}),e.jsx("input",{id:"resetProcessConfirmText",type:"text",value:fe,onChange:As,className:`block w-full px-3 py-2 border ${!fe.trim()&&S?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:placeholder-gray-500`,required:!0,disabled:N})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-3 pt-3 border-t border-gray-200 dark:border-gray-700 mt-5",children:[e.jsx("button",{type:"button",onClick:()=>{j(0),oe(""),Le(""),Qe(""),f(null),k({type:"error",message:"Database reset process cancelled by user at final confirmation."})},disabled:N,className:"w-full sm:w-auto px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500 dark:border-gray-500",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:N||!xe.trim()||!fe.trim(),className:"w-full sm:w-auto px-4 py-2 text-sm font-medium text-white bg-red-700 hover:bg-red-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:bg-red-400 dark:disabled:bg-red-500 transition-opacity",children:N?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Resetting..."]}):"Confirm and Reset Database Now"})]})]})})]})};export{it as default};
