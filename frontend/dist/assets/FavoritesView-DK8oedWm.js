import{K as F,u as A,r,ac as E,s as N,j as t,i as C,a6 as M,S as v,a4 as $,a3 as W,P as q,F as D,o as R,a as H}from"./index-Cx0gNuKI.js";import{E as K}from"./ErrorState-ByXhRj64.js";import{f as V}from"./dateUtils-C4q4Gbs_.js";import{A as B}from"./archive-BuqNEVlV.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=F("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=F("Puzzle",[["path",{d:"M19.439 7.85c-.049.322.059.648.289.878l1.568 1.568c.47.47.706 1.087.706 1.704s-.235 1.233-.706 1.704l-1.611 1.611a.98.98 0 0 1-.837.276c-.47-.07-.802-.48-.968-.925a2.501 2.501 0 1 0-3.214 3.214c.446.166.855.497.925.968a.979.979 0 0 1-.276.837l-1.61 1.61a2.404 2.404 0 0 1-1.705.707 2.402 2.402 0 0 1-1.704-.706l-1.568-1.568a1.026 1.026 0 0 0-.877-.29c-.493.074-.84.504-1.02.968a2.5 2.5 0 1 1-3.237-3.237c.464-.18.894-.527.967-1.02a1.026 1.026 0 0 0-.289-.877l-1.568-1.568A2.402 2.402 0 0 1 1.998 12c0-.617.236-1.234.706-1.704L4.23 8.77c.24-.24.581-.353.917-.303.515.077.877.528 1.073 1.01a2.5 2.5 0 1 0 3.259-3.259c-.482-.196-.933-.558-1.01-1.073-.05-.336.062-.676.303-.917l1.525-1.525A2.402 2.402 0 0 1 12 1.998c.617 0 1.234.236 1.704.706l1.568 1.568c.23.23.556.338.877.29.493-.074.84-.504 1.02-.968a2.5 2.5 0 1 1 3.237 3.237c-.464.18-.894.527-.967 1.02Z",key:"i0oyt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=F("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),te=()=>{const{isAuthenticated:c,isLoading:d}=A(),[l,x]=r.useState([]),[h,w]=r.useState(!0),[P,k]=r.useState(null),[i,_]=r.useState(1),[m,b]=r.useState(0),[z,g]=r.useState(0),[S,G]=r.useState(10),[n,j]=r.useState(!0),[J,u]=r.useState(new Map),I=e=>{switch(e){case"document":return t.jsx(D,{size:18,className:"mr-2 text-blue-500"});case"patch":return t.jsx(Y,{size:18,className:"mr-2 text-green-500"});case"link":return t.jsx(U,{size:18,className:"mr-2 text-purple-500"});case"misc_file":return t.jsx(B,{size:18,className:"mr-2 text-yellow-500"});case"software":return t.jsx(q,{size:18,className:"mr-2 text-indigo-500"});case"version":return t.jsx(Z,{size:18,className:"mr-2 text-pink-500"});default:return t.jsx(v,{size:18,className:"mr-2 text-gray-500"})}},L=e=>{switch(e.item_type){case"document":return`/documents?highlight=${e.item_id}&software_id=${e.software_id||""}`;case"patch":return`/patches?highlight=${e.item_id}&software_id=${e.software_id||""}&version_id=${e.version_id||""}`;case"link":return e.name&&(e.name.startsWith("http://")||e.name.startsWith("https://"))?e.name:`/links?highlight=${e.item_id}&software_id=${e.software_id||""}&version_id=${e.version_id||""}`;case"misc_file":return`/misc?highlight=${e.item_id}`;case"software":return`/documents?software_id=${e.item_id}`;case"version":return`/patches?software_id=${e.software_id||""}&version_id=${e.item_id}`;default:return"#"}},f=r.useCallback(async()=>{var e,y;if(!c){w(!1),k("Please log in to view your favorites."),x([]),u(new Map),b(0),g(0),n&&j(!1);return}w(!0),n&&k(null);try{const s=await E(i,S);x(s.favorites),b(s.total_pages),g(s.total_favorites);const o=new Map;s.favorites.forEach(a=>{o.set(`${a.item_type}-${a.item_id}`,{favoriteId:a.favorite_id})}),u(o),n&&j(!1)}catch(s){console.error("Failed to load favorites:",s);const o=((y=(e=s.response)==null?void 0:e.data)==null?void 0:y.msg)||s.message||"Failed to fetch favorites.";n?(k(o),x([]),u(new Map),b(0),g(0)):N(o)}finally{w(!1),n&&j(!1)}},[c,i,S]);r.useEffect(()=>{d||f()},[f,d]);const T=async e=>{var s,o;if(!c){N("Please log in to manage favorites.");return}const y=`${e.item_type}-${e.item_id}`;x(a=>a.filter(p=>p.favorite_id!==e.favorite_id)),u(a=>{const p=new Map(a);return p.delete(y),p});try{await R(e.item_id,e.item_type),H(`"${e.name}" removed from favorites.`),g(a=>a-1),l.length===1&&i>1?_(a=>a-1):l.length}catch(a){N(((o=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:o.msg)||a.message||"Failed to update favorite status."),f()}};return d||n&&h?t.jsx(C,{message:"Loading favorites..."}):!c&&!d?t.jsx("div",{className:"text-center py-10",children:t.jsxs("p",{className:"text-lg text-gray-600",children:["Please ",t.jsx(M,{to:"/login",className:"text-blue-600 hover:underline",children:"log in"})," to view your favorites."]})}):P&&n&&l.length===0?t.jsx(K,{message:P,onRetry:f}):t.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[t.jsx(v,{size:32,className:"text-yellow-500"}),t.jsx($,{variant:"h4",component:"h1",sx:{fontWeight:"bold",color:"text.primary"},children:"My Favorites"})]}),l.length===0&&!h?t.jsxs(W,{sx:{textAlign:"center",py:10,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm my-6",children:[t.jsx(v,{size:48,className:"text-yellow-500 dark:text-yellow-400 mb-4"})," ",t.jsx($,{variant:"h6",color:"text.secondary",sx:{mb:1},className:"dark:text-gray-400",children:"You haven't favorited any items yet."}),t.jsx($,{variant:"body2",color:"text.secondary",className:"dark:text-gray-400",children:"Start exploring and mark your favorites by clicking the star icon!"})]}):t.jsx("div",{className:"space-y-4",children:l.map(e=>t.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-sm rounded-lg p-4 flex items-center justify-between hover:shadow-md transition-shadow dark:border dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-center",children:[I(e.item_type),t.jsxs("div",{children:[t.jsx(M,{to:L(e),target:e.item_type==="link"&&(e.name.startsWith("http://")||e.name.startsWith("https://"))?"_blank":"_self",rel:e.item_type==="link"&&(e.name.startsWith("http://")||e.name.startsWith("https://"))?"noopener noreferrer":"",className:"text-lg font-semibold text-blue-600 hover:underline dark:text-blue-400 dark:hover:underline",children:e.name}),t.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 capitalize",children:["Type: ",e.item_type.replace("_"," "),e.software_name&&` • Software: ${e.software_name}`,e.version_number&&` • Version: ${e.version_number}`]}),t.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Favorited on: ",V(e.favorited_at)]})]})]}),t.jsx("button",{onClick:()=>T(e),className:"p-2 rounded-full text-yellow-500 hover:text-yellow-600 dark:text-yellow-400 dark:hover:text-yellow-500 focus:outline-none",title:"Remove from Favorites",children:t.jsx(v,{size:20,className:"fill-current"})})]},e.favorite_id))}),m>1&&t.jsxs("div",{className:"flex justify-between items-center mt-8",children:[t.jsx("button",{onClick:()=>_(e=>Math.max(e-1,1)),disabled:i===1||h,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 disabled:opacity-50 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600",children:"Previous"}),t.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-400",children:[" Page ",i," of ",m," (Total: ",z," items) "]}),t.jsx("button",{onClick:()=>_(e=>Math.min(e+1,m)),disabled:i===m||h,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 disabled:opacity-50 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600",children:"Next"})]})]})};export{te as default};
