import{B as D,u as P,a7 as z,a8 as C,r as f,j as t,k as L,a9 as B,aa as m,ab as K,S as U,ac as W,p as X,q as O}from"./index-988MvyxU.js";import{E as V}from"./ErrorState-MNG4Ic6l.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=D("SearchX",[["path",{d:"m13.5 8.5-5 5",key:"1cs55j"}],["path",{d:"m8.5 8.5 5 5",key:"a8mexj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Q=()=>{const{isAuthenticated:p}=P(),[M]=z();C();const h=M.get("q")||"",[E,w]=f.useState({}),[j,k]=f.useState(0),[q,N]=f.useState(!1),[I,$]=f.useState(null),[b,x]=f.useState(null),[u,v]=f.useState(new Map);f.useEffect(()=>{p||v(new Map)},[p]),f.useEffect(()=>{if(!h){w({}),k(0);return}(async()=>{try{N(!0),$(null);const s=await K(h),o=s.reduce((r,i)=>{const c=i.type||"unknown";return r[c]||(r[c]=[]),r[c].push(i),r},{});w(o),k(s.length);const a=new Map;if(p&&s&&s.length>0)for(const r of s){const i=`${r.type}-${r.id}`;r.favorite_id?a.set(i,{favoriteId:r.favorite_id}):a.set(i,{favoriteId:void 0})}v(a)}catch(s){$("Failed to fetch search results. Please try again later."),console.error(s),w({}),k(0)}finally{N(!1)}})()},[h,p]);const A=(e,s)=>{var _,S,F;const o=`${e.type}-${e.id}-${s}`;let a,r=!1,i=!1,c,y=!0;switch(e.type){case"document":a=`/documents?highlight=${e.id}`;break;case"patch":a=`/patches?highlight=${e.id}`;break;case"software":a=`/documents?software_id=${e.id}`;break;case"version":a=`/patches?software_id=${e.software_id}`;break;case"link":e.is_external_link&&e.url?(a=e.url,r=!0):e.stored_filename&&(c=`/official_uploads/links/${e.stored_filename}`,i=!0,y=e.is_downloadable!==!1);break;case"misc_file":e.stored_filename&&(c=`/misc_uploads/${e.stored_filename}`,i=!0,y=e.is_downloadable!==!1);break}const d=e.title||e.name||"Untitled",l=e.description?e.description.length>150?e.description.substring(0,147)+"...":e.description:"No description available.",n=t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsx("h4",{className:"font-medium text-lg text-gray-900 mb-1 flex-grow",children:d}),p&&t.jsx("button",{onClick:R=>{R.stopPropagation(),R.preventDefault(),T(e)},className:`p-1 ${(_=u.get(`${e.type}-${e.id}`))!=null&&_.favoriteId?"text-yellow-500":"text-gray-400"} hover:text-yellow-600 flex-shrink-0`,title:(S=u.get(`${e.type}-${e.id}`))!=null&&S.favoriteId?"Remove from Favorites":"Add to Favorites",children:t.jsx(U,{size:16,className:(F=u.get(`${e.type}-${e.id}`))!=null&&F.favoriteId?"fill-current":""})})]}),t.jsxs("p",{className:"text-xs text-gray-500 mb-1 uppercase tracking-wider",children:["Type: ",e.type,e.type==="version"&&e.software_name&&` (for ${e.software_name})`,e.type!=="version"&&e.software_name&&` â€¢ Software: ${e.software_name}`]}),t.jsx("p",{className:"text-gray-600 text-sm",children:l})]}),g="block bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow";return r&&a?t.jsx("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:g,children:n},o):i&&c?y?t.jsx("a",{href:c,className:g,download:!0,target:"_blank",rel:"noopener noreferrer",children:n},o):t.jsx("div",{className:`${g} cursor-not-allowed opacity-70`,title:"Download not permitted",children:n},o):a?t.jsx(W,{to:a,className:g,children:n},o):t.jsx("div",{className:g+" cursor-default",children:n},o)},T=async e=>{var c,y;if(!p){x("Please log in to manage favorites.");return}const s=`${e.type}-${e.id}`,o=typeof e.id=="string"?parseInt(e.id,10):e.id;if(isNaN(o)){x("Invalid item ID for favoriting.");return}const a=u.get(s),r=!!(a!=null&&a.favoriteId),i=new Map(u);r?i.set(s,{favoriteId:void 0}):i.set(s,{favoriteId:-1}),v(i),x(null);try{if(r&&typeof(a==null?void 0:a.favoriteId)=="number")await X(o,e.type),x(`"${e.name||e.title}" removed from favorites.`),v(d=>{const l=new Map(d);return l.set(s,{favoriteId:void 0}),l});else{const d=await O(o,e.type);v(l=>{const n=new Map(l);return n.set(s,{favoriteId:d.id}),n}),x(`"${e.name||e.title}" added to favorites.`)}}catch(d){console.error("Failed to toggle favorite for search result:",d),x(((y=(c=d==null?void 0:d.response)==null?void 0:c.data)==null?void 0:y.msg)||d.message||"Failed to update favorite status."),v(l=>{const n=new Map(l);return r?n.set(s,{favoriteId:a==null?void 0:a.favoriteId}):n.set(s,{favoriteId:void 0}),n})}};return q?t.jsx(L,{message:"Searching..."}):I?t.jsx(V,{message:I}):j===0&&h?t.jsxs(B,{className:"container mx-auto px-4 py-8",sx:{textAlign:"center",mt:4,p:3},children:[t.jsx(m,{variant:"h5",component:"h2",sx:{mb:2,color:"text.primary"},children:"Search Results"}),t.jsx(G,{size:60,className:"text-gray-400 dark:text-gray-500 mb-4 mx-auto"}),t.jsxs(m,{variant:"h6",color:"text.secondary",sx:{mb:1},children:['No results found for "',t.jsx(m,{component:"span",sx:{fontWeight:"medium",color:"text.primary"},children:h}),'"']}),t.jsx(m,{variant:"body2",color:"text.secondary",children:"Try different keywords or check back later."})]}):h?t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[b&&t.jsx("div",{className:"p-3 my-2 bg-blue-100 text-blue-700 rounded text-sm",children:b}),t.jsxs("div",{className:"mb-6",children:[t.jsx(m,{variant:"h5",component:"h2",sx:{mb:1,color:"text.primary"},children:"Search Results"}),t.jsxs(m,{color:"text.secondary",children:["Found ",j," result",j!==1?"s":"",' for "',t.jsx(m,{component:"span",sx:{fontWeight:"medium",color:"text.primary"},children:h}),'"']})]}),Object.entries(E).map(([e,s])=>s.length>0&&t.jsxs("div",{className:"mb-8",children:[t.jsxs(m,{variant:"h6",component:"h3",sx:{mb:2,textTransform:"capitalize",borderBottom:1,borderColor:"divider",pb:1,color:"text.primary"},children:[e.replace("_"," "),"s"]}),t.jsx("div",{className:"space-y-4",children:s.map((o,a)=>A(o,a))})]},e))]}):t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[b&&t.jsx("div",{className:"p-3 my-2 bg-blue-100 text-blue-700 rounded text-sm",children:b}),t.jsxs("div",{className:"mb-6",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Search"}),t.jsx("p",{className:"text-gray-600",children:"Please enter a search term in the header to find results."})]})]})};export{Q as default};
