import{O as E,u as ve,ai as Pe,r as a,j as e,aj as Ce,s as d,ak as Se,b,al as Ue,am as Fe,an as Ee,ao as Me}from"./index-kTCMLqQo.js";import{M as ue}from"./Modal-Co5e9u24.js";import{P as ge}from"./plus-circle-C6nL9ayl.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=E("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=E("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=E("MessageCircleQuestion",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Oe=()=>{var de,le,ie;const o=ve(),{watchPreferences:h,isLoading:x,updatePreference:be,isWatching:i}=Pe(),he="http://192.168.3.129:7000",[l,k]=a.useState(null),[N,j]=a.useState(null),[v,M]=a.useState(!1),[_,I]=a.useState(!1),[P,A]=a.useState(""),[c,W]=a.useState(""),[C,L]=a.useState(""),[O,u]=a.useState(null),[z,g]=a.useState(""),[R,T]=a.useState(null),[p,V]=a.useState(""),[S,D]=a.useState(""),[q,f]=a.useState(null),[B,$]=a.useState(null),[w,G]=a.useState(""),[U,H]=a.useState(""),[Q,m]=a.useState(null),[Z,J]=a.useState(null),[X,Y]=a.useState(!1),[K,y]=a.useState(!1),[ee,re]=a.useState("feedback"),[F,se]=a.useState(""),[ae,te]=a.useState(!1),xe={documents:{displayName:"Documents",categories:["VA","VMS","ICCC","Analytic Manager","ITMS"]},patches:{displayName:"Patches",categories:["VA","VMS","ICCC","Analytic Manager","ITMS"]},links:{displayName:"Links",categories:["VA","VMS","ICCC","Analytic Manager","ITMS"]},misc:{displayName:"Miscellaneous",categories:null}},ne=async(r,s,t)=>{await be(r,s??null,!t)},pe=async r=>{if(r.preventDefault(),m(null),J(null),!w||!U){m("New username and current password are required.");return}if(w.length<3){m("New username must be at least 3 characters long.");return}Y(!0);try{const s=await Me({new_username:w,current_password:U});b(s.msg||"Username updated successfully!"),J(s.msg||"Username updated successfully!"),o&&o.updateAuthUsername?o.updateAuthUsername(s.new_username):console.warn("AuthContext does not have updateAuthUsername method. UI might not reflect new username immediately."),G("")}catch(s){s.isPasswordMismatchError===!0?m(s.message||"Incorrect current password."):m(s.message||"Failed to update username."),d(s.message||"Failed to update username.")}finally{H(""),Y(!1)}};if(!o.isAuthenticated)return e.jsx(Ce,{to:"/login",replace:!0});const oe=r=>r.length<8?"Password must be at least 8 characters long.":/[A-Z]/.test(r)?/[a-z]/.test(r)?/[0-9]/.test(r)?"":"Password must include at least one digit.":"Password must include at least one lowercase letter.":"Password must include at least one uppercase letter.",fe=r=>{const s=r.target.value;W(s);const t=oe(s);g(t)},we=async r=>{var t;r.preventDefault(),u(null),T(null);const s=oe(c);if(s){g(s);return}else g("");if(!P||!c||!C){u("All password fields are required.");return}if(c!==C){u("New passwords do not match.");return}try{const n=await Fe({current_password:P,new_password:c});b(n.msg||"Password changed successfully!"),T(n.msg||"Password changed successfully!"),A(""),W(""),L(""),g("")}catch(n){if(n.isPasswordMismatchError===!0)u(n.message||"Incorrect current password.");else{const ce=((t=n.message)==null?void 0:t.toLowerCase())||"";ce.includes("password must")||ce.includes("password should")?g(n.message):u(n.message||"Failed to change password.")}d(n.message||"Failed to change password.")}},ye=async r=>{if(r.preventDefault(),f(null),$(null),!p||!S){f("Both email and password are required.");return}if(!/\S+@\S+\.\S+/.test(p)){f("Invalid email format.");return}try{const s=await Ee({new_email:p,password:S});b(s.msg||"Email updated successfully!"),$(s.msg||"Email updated successfully!"),V(""),D("")}catch(s){d(s.message||"Failed to update email."),f(s.message||"Failed to update email.")}},ke=r=>{var t;const s=(t=r.target.files)==null?void 0:t[0];s?(k(s),j(URL.createObjectURL(s))):(k(null),j(null))},Ne=async()=>{if(!l){d("Please select a file first.");return}M(!0);const r=new FormData;r.append("profile_picture",l);try{const s=await Se(r);b(s.msg||"Profile picture updated successfully!"),o.user&&s.profile_picture_url&&o.updateUserProfilePictureUrl(s.profile_picture_url),k(null),j(null)}catch(s){d(s.message||"Failed to upload profile picture."),console.error("Profile picture upload error:",s)}finally{M(!1)}},je=async r=>{if(r.preventDefault(),!F.trim()){d("Feedback message cannot be empty.");return}te(!0);try{await Ue({message_content:F,type:ee}),b("Feedback submitted successfully!"),y(!1),se(""),re("feedback")}catch(s){d(s.message||"Failed to submit feedback.")}finally{te(!1)}};return a.useEffect(()=>{var r;(r=o.user)!=null&&r.profile_picture_url},[(de=o.user)==null?void 0:de.profile_picture_url,N,l]),e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-8 text-gray-900 dark:text-white",children:"User Profile"}),e.jsxs("div",{className:"mb-8 p-6 bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Profile Picture"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("div",{className:"shrink-0",children:e.jsx("img",{className:"h-24 w-24 object-cover rounded-full",src:N||((le=o.user)!=null&&le.profile_picture_url?`${he}${o.user.profile_picture_url}`:`https://ui-avatars.com/api/?name=${encodeURIComponent(((ie=o.user)==null?void 0:ie.username)||"User")}&background=random&size=128`),alt:"Profile"})}),e.jsxs("label",{htmlFor:"profile-picture-upload",className:"block",children:[e.jsx("span",{className:"sr-only",children:"Choose profile photo"}),e.jsx("input",{type:"file",id:"profile-picture-upload",accept:"image/png, image/jpeg, image/gif",onChange:ke,className:`block w-full text-sm text-gray-500 dark:text-gray-400\r
                         file:mr-4 file:py-2 file:px-4\r
                         file:rounded-lg file:border-0\r
                         file:text-sm file:font-semibold\r
                         file:bg-indigo-50 dark:file:bg-indigo-800 file:text-indigo-600 dark:file:text-indigo-300\r
                         hover:file:bg-indigo-100 dark:hover:file:bg-indigo-700\r
                         disabled:opacity-50`,disabled:v})]})]}),l&&e.jsx("div",{className:"mt-4",children:e.jsxs("button",{onClick:Ne,disabled:v||!l,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:[v?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}):e.jsx(_e,{size:16,className:"mr-2"}),"Upload New Picture"]})})]}),e.jsxs("div",{className:"mb-8 p-6 bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Watch Preferences"}),e.jsx("button",{onClick:()=>I(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Manage Watch Preferences"})]}),e.jsxs("div",{className:"mb-8 p-6 bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Support"}),e.jsxs("button",{onClick:()=>y(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500",children:[e.jsx(Ie,{size:16,className:"mr-2"}),"Report Bug / Give Feedback"]})]}),_&&e.jsx(ue,{isOpen:_,onClose:()=>I(!1),title:"Manage Watch Preferences",children:x&&(!h||h.length===0)?e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-center py-4",children:"Loading watch preferences..."}):e.jsxs("div",{className:"space-y-6",children:[" ",Object.entries(xe).map(([r,s])=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-200 mb-2",children:s.displayName}),s.categories?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2",children:s.categories.map(t=>{const n=i(r,t);return e.jsxs("button",{onClick:()=>ne(r,t,n),className:`w-full flex items-center justify-center px-3 py-2 border text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-1
                                          ${n?"bg-green-600 hover:bg-green-700 text-white border-transparent focus:ring-green-500":"bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600 border-gray-300 dark:border-gray-500 focus:ring-indigo-500"} transition-colors duration-150 ease-in-out`,disabled:x,children:[n?e.jsx(me,{size:16,className:"mr-2"}):e.jsx(ge,{size:16,className:"mr-2"}),n?"Watching":"Watch"," ",e.jsxs("span",{className:"ml-1 font-normal hidden sm:inline",children:["- ",t]})]},t)})}):e.jsxs("button",{onClick:()=>{const t=i(r,void 0);ne(r,void 0,t)},className:`w-auto flex items-center justify-center px-4 py-2 border text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-1
                                    ${i(r,void 0)?"bg-green-600 hover:bg-green-700 text-white border-transparent focus:ring-green-500":"bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600 border-gray-300 dark:border-gray-500 focus:ring-indigo-500"} transition-colors duration-150 ease-in-out`,disabled:x,children:[i(r,void 0)?e.jsx(me,{size:16,className:"mr-2"}):e.jsx(ge,{size:16,className:"mr-2"}),i(r,void 0)?"Watching":"Watch General"]})]},r)),x&&h&&h.length>0&&e.jsxs("div",{className:"mt-4 flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-indigo-500 mr-2"}),"Saving preferences..."]})]})}),K&&e.jsx(ue,{isOpen:K,onClose:()=>y(!1),title:"Submit Feedback or Report Bug",children:e.jsxs("form",{onSubmit:je,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"feedbackType",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Type"}),e.jsxs("select",{id:"feedbackType",name:"feedbackType",value:ee,onChange:r=>re(r.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"feedback",children:"General Feedback"}),e.jsx("option",{value:"bug",children:"Bug Report"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"feedbackMessage",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Message"}),e.jsx("textarea",{id:"feedbackMessage",name:"feedbackMessage",rows:4,value:F,onChange:r=>se(r.target.value),className:"mt-1 block w-full shadow-sm sm:text-sm border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Please provide details..."})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>y(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-500 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:ae,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 border border-transparent rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:[ae?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}):null,"Submit"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Change Password"}),O&&e.jsx("p",{className:"text-red-600 dark:text-red-300 bg-red-100 dark:bg-red-900 border border-red-300 dark:border-red-700 p-3 rounded mb-4",children:O}),R&&e.jsx("p",{className:"text-green-600 dark:text-green-300 bg-green-100 dark:bg-green-900 border border-green-300 dark:border-green-700 p-3 rounded mb-4",children:R}),e.jsxs("form",{onSubmit:we,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"currentPassword",children:"Current Password"}),e.jsx("input",{type:"password",id:"currentPassword",value:P,onChange:r=>A(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"newPassword",children:"New Password"}),e.jsx("input",{type:"password",id:"newPassword",value:c,onChange:fe,className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"}),z&&e.jsx("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:z})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"confirmNewPassword",children:"Confirm New Password"}),e.jsx("input",{type:"password",id:"confirmNewPassword",value:C,onChange:r=>L(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 mb-3 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsx("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Change Password"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Update Email"}),q&&e.jsx("p",{className:"text-red-600 dark:text-red-300 bg-red-100 dark:bg-red-900 border border-red-300 dark:border-red-700 p-3 rounded mb-4",children:q}),B&&e.jsx("p",{className:"text-green-600 dark:text-green-300 bg-green-100 dark:bg-green-900 border border-green-300 dark:border-green-700 p-3 rounded mb-4",children:B}),e.jsxs("form",{onSubmit:ye,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"newEmail",children:"New Email"}),e.jsx("input",{type:"email",id:"newEmail",value:p,onChange:r=>V(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"confirmPasswordForEmail",children:"Confirm Password"}),e.jsx("input",{type:"password",id:"confirmPasswordForEmail",value:S,onChange:r=>D(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 mb-3 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsx("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Update Email"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Change Username"}),Q&&e.jsx("p",{className:"text-red-600 dark:text-red-300 bg-red-100 dark:bg-red-900 border border-red-300 dark:border-red-700 p-3 rounded mb-4",children:Q}),Z&&e.jsx("p",{className:"text-green-600 dark:text-green-300 bg-green-100 dark:bg-green-900 border border-green-300 dark:border-green-700 p-3 rounded mb-4",children:Z}),e.jsxs("form",{onSubmit:pe,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"newUsername",children:"New Username"}),e.jsx("input",{type:"text",id:"newUsername",value:w,onChange:r=>G(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",htmlFor:"currentPasswordForUsername",children:"Current Password"}),e.jsx("input",{type:"password",id:"currentPasswordForUsername",value:U,onChange:r=>H(r.target.value),className:"shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-gray-200 mb-3 leading-tight focus:outline-none focus:shadow-outline bg-white dark:bg-gray-700"})]}),e.jsx("button",{type:"submit",disabled:X,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline disabled:opacity-50",children:X?"Changing...":"Change Username"})]})]})]})]})};export{Oe as default};
